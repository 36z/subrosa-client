function closeEvents(){for(var i in appcore.list)if(appcore.list[i].active){var oldState=appcore.list[i].active.state,oldType=appcore.list[i].active.callType;appcore.list[i].active=-1,api.emit("callUpdate",{state:"",oldState:oldState,target:appcore.list[i].id,callType:oldType})}}function commHandler(comm,target,isFromBuffer){if(target||(target=comm.target),isFromBuffer||(isFromBuffer=!1),comm.sender||(comm.sender=appcore.uid),comm.time||(comm.time=(new Date).getTime()),comm.type&&!getProp(comm.sender+"-blocked")){if(37==target.length&&!appcore.list[appcore.listHash[target]])return appcore.noListBuffer[target]||(appcore.noListBuffer[target]=[]),void appcore.noListBuffer[target].push(comm);var listItem=appcore.list[appcore.listHash[target]]?appcore.list[appcore.listHash[target]]:!1;if(1==comm.type){if(isFromBuffer&&-1!=appcore.bufferTimestampIgnore.indexOf(comm.time+target))return;comm.sender!=appcore.uid&&(appcore.profileBlob.conversations[target]||decryptAndVerifyRSA(comm.data,comm.auxdata,comm.pubKey)),comm.pubKey&&(listItem.pubKey=comm.pubKey),api.emit("newText",{user:"*",userShow:"*",message:"<span class='fa fa-lock'></span> Encryption initialized. <a href='javascript:;' class='verifyKey'>Verify</a>",isMe:!1,target:target,unread:!1,isFromBuffer:isFromBuffer,small:!0}),appcore.sockemit("clearHistory",{target:target,time:comm.time}),isFromBuffer||listItem.hasBundle||appcore.bufferTimestampIgnore.push(comm.time+target)}else{var obj=decryptComm(comm,target);if(obj.failedDecrypt&&(comm.type=2),obj){if(isFromBuffer&&-1!=appcore.bufferTimestampIgnore.indexOf(comm.time+target))return;var userInfo=getUserItem(comm.sender);userInfo||(comm.username?(appcore.userList[comm.sender]={username:comm.username,bgColor:comm.bgColor},userInfo=appcore.userList[comm.sender],api.emit("notify",{type:"userIdentified",target:target})):alert("DEBUG: No userInfo & no comm.username"));var isMe=comm.sender==appcore.uid,userDisplay=escapeText(userInfo.displayname?userInfo.displayname:userInfo.username),unread=listItem.lastRead<comm.time,theMessage="";if(2==comm.type){if(theMessage=escapeText(obj.msg),listItem.typings)for(var i in listItem.typings)if(listItem.typings[i][0]==comm.sender){listItem.typings.splice(i,1),api.emit("refreshTypingDisplay",{});break}if(obj.replaceTimestamp)return appcore.bufferTimestampReplace[obj.replaceTimestamp]={target:target,newMessage:theMessage,replaceTimestamp:obj.replaceTimestamp,user:comm.sender,replacedTime:comm.time},void api.emit("replaceText",appcore.bufferTimestampReplace[obj.replaceTimestamp])}else if(5==comm.type)theMessage=obj.accepted?"<b>"+userDisplay+" accepted the contact request</b>":isMe?'<b>You sent a contact request</b>: "'+escapeText(obj.msg)+'"':"<b>"+userDisplay+' sent you a contact request</b>: "'+escapeText(obj.msg)+'"';else if(6==comm.type){if(2==listItem.contact||20==listItem.id.length)if("voice"==obj.type||"video"==obj.type){if(listItem.active&&-1!=listItem.active)return;listItem.active={type:obj.type,state:"CALLING",myInitiate:!1},37==listItem.id.length?callTimeout=setTimeout(function(){if("CALLING"==listItem.active.state){var oldType=listItem.active.type;listItem.active=-1,api.emit("callUpdate",{state:"",oldState:"CALLING",target:target,callType:oldType})}},3e4):listItem.active.callUsers=[comm.sender],api.emit("callUpdate",{state:"CALLING",oldState:"",target:target,callType:listItem.active.type})}else if("acceptCall"==obj.type)37==target.length?acceptCall(listItem.id,!1):listItem.active&&(listItem.active.callUsers.push(comm.sender),api.emit("notify",{type:"callUserUpdate",event:"JOIN",target:listItem.id,uid:comm.sender,callType:listItem.active.type}));else if(37==target.length){clearTimeout(callTimeout);var oldState=listItem.active.state,oldType=listItem.active.type;listItem.active=-1,appcore.activeCall="",api.emit("callUpdate",{state:"",oldState:oldState,target:target,callType:oldType})}else handleRoomCallQuit(target,comm.sender)}else if(7==comm.type)theMessage=isMe?'<b>You invited them to <a href="javascript:;" class="roomInviteLink dottedLink" data-target="'+escapeText(obj.target)+'" data-convKey="'+btoa(obj.convKey)+'">'+escapeText(obj.name)+"</a> (group chat)</b>":"<b>"+userDisplay+' invited you to <a href="javascript:;" class="roomInviteLink dottedLink" data-target="'+escapeText(obj.target)+'" data-convKey="'+btoa(obj.convKey)+'">'+escapeText(obj.name)+"</a> (group chat)</b>";else if(8==comm.type)theMessage=isMe?'<b>You invited <a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(obj.uid)+'">'+escapeText(obj.username)+"</a> to this room.</b>":"<b>"+userDisplay+' invited <a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(obj.uid)+'">'+escapeText(obj.username)+"</a> to this room.</b>";else if(9==comm.type)isMe?theMessage=obj.quit?"<b>You left the room.</b>":"<b>You joined the room.</b>":obj.quit?(theMessage=obj.kickedByUID?"<b>"+userDisplay+' was kicked from the room by <a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(obj.kickedByUID)+'">'+escapeText(obj.kickedByUsername)+"</a></b>":"<b>"+userDisplay+" left the room.</b>",listItem.active&&listItem.active.callUsers&&-1!==listItem.active.callUsers.indexOf(comm.sender)&&handleRoomCallQuit(target,comm.sender),-1!=listItem.users.indexOf(comm.sender)&&(listItem.users.splice(listItem.users.indexOf(comm.sender),1),isFromBuffer||listItem.usercount--,api.emit("notify",{type:"userIdentified",target:listItem.id}))):(theMessage="<b>"+userDisplay+" joined the room.</b>",isFromBuffer||listItem.usercount++);else if(10==comm.type)try{rtcProcessSignal(obj.o,obj.to,comm.sender)}catch(error){console.log(error)}else if(11==comm.type){var ranks=["normal user","","moderator","","admin","","","","","superadmin"];theMessage="<b>"+(isMe?"You":userDisplay)+' set the rank of <a href="javascript:;" class="userLink dottedLnk" data-uid="'+escapeText(obj.targetUserUID)+'">'+escapeText(obj.targetUserUsername)+"</a> to <i>"+ranks[obj.newRank]+"</i>.</b>",isFromBuffer||(listItem.ranks[obj.targetUserUID]=obj.newRank,obj.targetUserUID==appcore.uid&&(listItem.myRank=obj.newRank),api.emit("notify",{type:"userRankChanged",target:target,uid:obj.targetUserUID,newRank:obj.newRank}))}(5==comm.type||2==comm.type||comm.type>=7&&comm.type<=9||11==comm.type)&&(isFromBuffer||listItem.hasBundle||appcore.bufferTimestampIgnore.push(comm.time+target),listItem.canMarkRead=!0,api.emit("newText",{user:comm.sender,userShow:2==comm.type?userDisplay:"*",message:theMessage,isMe:isMe,timestamp:comm.time,target:target,unread:unread,isFromBuffer:isFromBuffer,bgColor:getUserItem(comm.sender).bgColor}),2==comm.type&&appcore.bufferTimestampReplace[comm.time]&&appcore.bufferTimestampReplace[comm.time].target==target&&(api.emit("replaceText",appcore.bufferTimestampReplace[comm.time]),delete appcore.bufferTimestampReplace[comm.time]),!listItem.users||-1!=listItem.users.indexOf(comm.sender)||9==comm.type&&obj.quit||(listItem.users.push(comm.sender),api.emit("notify",{type:"userIdentified",target:listItem.id})))}}}}function handleRoomCallQuit(target,quitter){var listItem=appcore.list[appcore.listHash[target]];-1!=listItem.active.callUsers.indexOf(quitter)&&(listItem.active.callUsers.splice(listItem.active.callUsers.indexOf(quitter),1),0==listItem.active.callUsers.length?(listItem.active=-1,api.emit("callUpdate",{state:"CALLING",oldState:"",target:target,callType:listItem.active.type})):api.emit("notify",{type:"callUserUpdate",event:"QUIT",target:listItem.id,uid:quitter,callType:listItem.active.type}))}function escapeText(input){return input.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}function uploadPart(includeTarget){var partsLeft=Math.ceil(appcore.fileString.length/10240),part=appcore.fileString.substr(0,10240);appcore.fileString=appcore.fileString.substr(10240),appcore.sockemit("filePart",{t:"a",p:partsLeft-1,d:part,target:includeTarget?appcore.currentUploadTarget:void 0}),api.emit("avatarUploadProgress",{percent:Math.round((appcore.partsTotal-partsLeft)/appcore.partsTotal*100),target:appcore.currentUploadTarget})}function acceptCall(target,sendAccept){var listItem=appcore.list[appcore.listHash[target]];"CALLING"==listItem.active.state&&(appcore.activeCall&&api.emit("dropCall",{target:appcore.activeCall}),clearTimeout(callTimeout),listItem.active.state="INCALL",appcore.activeCall=listItem.id,sendAccept&&(api.emit("sendComm",{target:target,type:6,message:{type:"acceptCall"}}),listItem.active.callUsers&&listItem.active.callUsers.push(appcore.uid)),appcore.sockemit("setActive",{target:target,type:listItem.active.type}),api.emit("callUpdate",{state:"INCALL",oldState:"CALLING",target:target,callType:listItem.active.type}))}function decryptComm(comm,target){if(comm.decrypted)return comm.decrypted;if(8==comm.type||9==comm.type||11==comm.type)return JSON.parse(comm.data);appcore.list[appcore.listHash[target]];try{var key=appcore.profileBlob.conversations[target],cipher=forge.cipher.createDecipher("AES-GCM",key);if(16==comm.auxdata.length)cipher.start({iv:comm.auxdata});else{var iv=comm.auxdata.substr(0,16),tag=comm.auxdata.substr(16,16);cipher.start({iv:iv,tagLength:128,tag:tag})}if(cipher.update(forge.util.createBuffer(comm.data)),!cipher.finish())throw new Error("Auth tag doesn't match.")}catch(error){return console.error("Failed to decrypt message in "+target,comm,error),{failedDecrypt:!0,msg:"Failed to decrypt message."}}var decryptedData=cipher.output;decryptedData.data&&(decryptedData=decryptedData.data);var decryptedObject;try{decryptedObject=JSON.parse(decryptedData);var fullTimestamp=14e11+36e5*decryptedObject.t;if(!(Math.abs(fullTimestamp-comm.time)<9e7))throw decryptedObject=!1,new Error("Difference between client and server timestamp exceeds threshold.")}catch(e){console.log(e,decryptedData)}return decryptedObject?decryptedObject:!1}function decryptAndVerifyRSA(encrypted,signature,otherPubKey){var privateKey=forge.pki.privateKeyFromPem(appcore.profileBlob.privateKey);try{var decrypted=privateKey.decrypt(encrypted,"RSA-OAEP"),md=forge.md.sha256.create();md.update(decrypted,"utf8"),otherPubKey=forge.pki.publicKeyFromPem(otherPubKey);var verified=otherPubKey.verify(md.digest().bytes(),signature);if(verified){var convKey=decrypted.substr(0,32),convId=decrypted.substr(32);37==convId.length&&(appcore.profileBlob.conversations[convId]=convKey,updateBlob(!0,"decryptAndVerify"))}}catch(exception){throw exception}}function sortUID(a,b){var r=[a,b].sort();return r[0]+"-"+r[1]}function updateBlob(force,info){if(appcore.profileBlob){var newProfileBlob=JSON.parse(JSON.stringify(appcore.profileBlob)),modified=!1;if(appcore.profileBlob.props||(newProfileBlob.props={},modified=!0),modified||force){var profileBlobJson=JSON.stringify(newProfileBlob),iv=forge.random.getBytesSync(16),cipher=forge.cipher.createCipher("AES-CBC",appcore.derivedKey);cipher.start({iv:iv}),cipher.update(forge.util.createBuffer(profileBlobJson)),cipher.finish();var cipherOutput=btoa(cipher.output.data);console.log("Updated userblob. - ",force,info),appcore.sockemit("updateBlob",{iv:iv,blob:cipherOutput}),appcore.profileBlob=newProfileBlob}}}function randomUID(length){for(var s="",randomchar=function(){var n=Math.floor(62*Math.random());return 10>n?n:String.fromCharCode(36>n?n+55:n+61)};s.length<length;)s+=randomchar();return s}function getUserItem(uid){if(uid==appcore.uid)return appcore;for(var i in appcore.list)if(appcore.list[i].uid==uid)return appcore.list[i];for(var i in appcore.userList)if(i==uid)return appcore.userList[i];return!1}function getNameFromUID(uid){var item=getUserItem(uid);return item?item.displayname||item.username:"?"}function getProp(name){return appcore.profileBlob.props&&"undefined"!=typeof appcore.profileBlob.props[name]?appcore.profileBlob.props[name]:!1}function layScreen(keepScrollBot){var w=$(window).width(),h=$(window).height(),headerHeight=$("#header").height();if($("#app").width(w),$("#body").height(h-headerHeight),$("#startScreen").is(":visible")&&(500>h-headerHeight?($("#startScreenContent,#createAccountContent").css("height",h-headerHeight+"px"),$("#startScreenContent,#createAccountContent").css("top","10px")):($("#startScreenContent,#createAccountContent").css("height","480px"),$("#startScreenContent,#createAccountContent").css("top",(h-headerHeight-480)/2+"px"))),685>=w&&!sidebarCollapsed?(sidebarCollapsed=!0,$("#mainSidebar").addClass("collapsed"),$("#mainLeftDivider").hide()):w>685&&sidebarCollapsed&&(sidebarCollapsed=!1,$("#mainSidebar").removeClass("collapsed"),$("#mainLeftDivider").show()),$("#mainScreen").is(":visible")&&($("#mainSidebar").width(sidebarCollapsed?73:sidebarWidth),$("#mainSidebar #sidebarList").height(h-headerHeight-20-30-45),$("#mainContent").height(h-headerHeight-22),$("#mainContent").width(w-(sidebarCollapsed?73:sidebarWidth)-35)),$("#permissionScreen").is(":visible")&&($("#permissionScreenContent").css("left",(w-500)/2+"px"),500>h-headerHeight?($("#permissionScreenContent").css("height",h-headerHeight+"px"),$("#permissionScreenContent").css("top","0px")):($("#permissionScreenContent").css("height","480px"),$("#permissionScreenContent").css("top",(h-headerHeight-480)/2+"px"))),lastMessageContentWidth=$("#mainContent").width()<530?$("#mainContent").width()-167:$("#mainContent").width()-226,$(".tab-conv").is(":visible")){var tabH=$(".tab-conv").height(),tabW=$(".tab-conv").width(),interactive=$("#convActive").is(":visible")?$("#convActive").height():0;$("#convBody").height(tabH-71-interactive-70),$(".convMessageContent").width(lastMessageContentWidth),$("#convInput").width(Math.min(475,$("#convFooter").width()-190)),keepScrollBot===!0&&($("#convText")[0].scrollTop=$("#convText")[0].scrollHeight),530>=tabW&&!convMessageMetaHidden?(convMessageMetaHidden=!0,$("#convText").addClass("hideMeta")):tabW>530&&convMessageMetaHidden&&(convMessageMetaHidden=!1,$("#convText").removeClass("hideMeta"))}keepPos&&keepPos(),keepPosModals&&keepPosModals()}function layContent(header,body){var curTab=$(".contentTab:visible");document.getElementsByTagName("body")[0].style.display="none";var curItem=curTab.attr("data-item");if(curTab.hasClass("tab-conv")){var listItem=appcore.list[appcore.listHash[currentTab]],convHeader=curTab.find("#convHeader"),convFooter=curTab.find("#convFooter");if(header){-1!=listItem.id.indexOf("-")?(convHeader.find("#convPicture").attr("data-status","undefined"!=typeof listItem.status?listItem.status:""),convHeader.find("#convDisplayName").text(listItem.displayname?listItem.displayname:listItem.username),convHeader.find("#convSubtitleStatus").show().text("undefined"!=typeof listItem.status?statusText[listItem.status]:"Not contacts"),convHeader.find("#convSubtitleUsers").hide(),convHeader.find("#inviteButton, #editGroupChat, #removeFromListRoom").hide(),convHeader.find("#newGroupChat, #blockUser").show(),2==listItem.contact?(convHeader.find("#addContactButton,#addContactFakeButton,#removeFromList,#acceptContactButton").hide(),convHeader.find("#voiceButton,#videoButton,#removeFromContacts").show()):1==listItem.contact?(listItem.myRequest?(convHeader.find("#addContactFakeButton,#removeFromList").show(),convHeader.find("#acceptContactButton").hide()):(convHeader.find("#acceptContactButton").show(),convHeader.find("#addContactFakeButton").hide()),convHeader.find("#removeFromList").show(),convHeader.find("#voiceButton,#videoButton,#addContactButton,#removeFromContacts").hide()):0==listItem.contact&&(convHeader.find("#addContactButton,#removeFromList").show(),convHeader.find("#voiceButton,#videoButton,#addContactFakeButton,#removeFromContacts,#acceptContactButton").hide()),getProp(listItem.uid+"-blocked")?($("#unblockButton").show(),$("#addContactButton,#blockUser").hide()):$("#unblockButton").hide()):(convHeader.find("#convPicture").attr("data-status",""),convHeader.find("#convDisplayName").text(listItem.name),layUsers(),convHeader.find("#convSubtitleStatus,#addContactButton,#addContactFakeButton,#removeFromList,#removeFromContacts,#acceptContactButton,#newGroupChat,#unblockButton,#blockUser").hide(),convHeader.find("#convSubtitleUsers,#voiceButton,#videoButton,#removeFromListRoom,#inviteButton").show(),listItem.myRank>=4?convHeader.find("#editGroupChat").show():convHeader.find("#editGroupChat").hide()),convHeader.find("#convPicture")[0].src=listItem.avatar?listItem.avatar:-1==listItem.id.indexOf("-")?"img/group.png":"img/noavatar.png",getProp(listItem.id+"-pinned")?($("#unpinFromList").show(),$("#pinToList").hide()):($("#unpinFromList").hide(),$("#pinToList").show());var convActive=$("#convActive");listItem.active&&listItem.active.type?(listItem.active.callUsers?(convActive.find("#voiceUsers").show(),convActive.find("#voiceUsersCount").text(listItem.active.callUsers.length)):convActive.find("#voiceUsers").hide(),"voice"==listItem.active.type?($("#voiceButton").addClass("disabled"),listItem.active.callUsers&&$("#videoButton").addClass("disabled"),$("#voiceActive").removeClass("video"),$("#videoIcon,#videoMute").hide(),$("#voiceIcon").show()):($("#videoButton").addClass("disabled"),listItem.active.callUsers&&$("#voiceButton").addClass("disabled"),$("#voiceActive").addClass("video"),$("#voiceIcon").hide(),$("#videoIcon,#videoMute").show()),"CALLING"==listItem.active.state?listItem.active.myInitiate?(convActive.find("#voiceAccept,#voiceDropDrop,#voiceIncallText,#callDuration,#voiceGroupText,#voiceControls,#voiceIncomingText").hide(),convActive.find("#voiceRingingText,#voiceDropCancel").show()):(convActive.find("#voiceDropCancel,#voiceRingingText,#voiceIncallText,#callDuration,#voiceControls").hide(),convActive.find("#voiceIncomingText,#voiceAccept,#voiceDropAccept,#voiceDropDrop").show(),listItem.active.callUsers?(convActive.find("#voiceAcceptAccept,#voiceDrop,#voiceIncomingText").hide(),convActive.find("#voiceAcceptJoin,#voiceGroupText").show()):(convActive.find("#voiceAcceptJoin,#voiceGroupText").hide(),convActive.find("#voiceAcceptAccept,#voiceIncomingText").show())):"INCALL"==listItem.active.state&&(convActive.find("#voiceIncomingText,#voiceAccept,#voiceRingingText,#voiceDropCancel,#voiceGroupText").hide(),convActive.find("#voiceIncallText,#callDuration,#voiceDropDrop,#voiceDrop,#voiceControls").show()),convActive.is(":visible")||convActive.slideDown(400,function(){layScreen(!0)})):(appcore.activeCall&&appcore.activeCall!=currentTab?convActive.hide():convActive.slideUp(400,function(){layScreen(!0)}),$("#voiceButton").removeClass("disabled"),$("#videoButton").removeClass("disabled"))}if(appcore.profileBlob.conversations[listItem.id]?(convFooter.find("#encInfoReady,#encPopoverReady").hide(),convFooter.find("#encInfoEncrypted,#encPopoverEncrypted").show(),convFooter.find("#encKey").text(appcore.profileBlob.conversations[listItem.id])):(convFooter.find("#encInfoReady,#encPopoverReady").show(),convFooter.find("#encInfoEncrypted,#encPopoverEncrypted").hide()),body){curTab.find("#convText").html((listItem.hasBundle?1==listItem.hasBundle?"<a id='bufferMore' href='javascript:;'><span class='fa fa-clock-o'></span>Decrypt earlier history</a>":"":"<div id='bufferLoading'>Loading..</div>")+convBodyHolders[curItem].buffer.join("")+"<div id='bufferLiveDivider'></div>"+convBodyHolders[curItem].live.join("")),curTab.find("#convText")[0].scrollTop=curTab.find("#convText")[0].scrollHeight,curTab.find("#convText .convMessage[data-unread=true]:not(.smallMessage):first").before("<hr class='readMarker' />"),setTimeout(function(){curTab.find("#convText .convMessage[data-unread=true]").attr("data-unread",!1)},70);for(var i in convBodyHolders[curItem].buffer)convBodyHolders[curItem].buffer[i]=convBodyHolders[curItem].buffer[i].replace("data-unread='true'","data-unread='false'");for(var i in convBodyHolders[curItem].live)convBodyHolders[curItem].live[i]=convBodyHolders[curItem].live[i].replace("data-unread='true'","data-unread='false'")}layScreen(),$(".sidebarListItem[data-item='"+listItem.id+"'] .listItemIcon").attr("data-status","undefined"!=typeof listItem.status?listItem.status:"")}document.getElementsByTagName("body")[0].style.display="block"}function layList(){$(".sidebarList").hide();for(var i in appcore.list){var item=appcore.list[i];if(0==$(".sidebarListItem[data-item='"+item.id+"']").length){var added=!1,thisPinned=getProp(item.id+"-pinned"),thisName=item.name||item.displayname||item.username;$(".sidebarListItem").each(function(){var itemID=$(this).attr("data-item");if("me"==itemID||"searchElement"==itemID||"home"==itemID||"meta"==itemID||"gedit"==itemID);else{var lastCommunication=Math.max(appcore.list[appcore.listHash[itemID]].lastMessage,appcore.list[appcore.listHash[itemID]].lastMyMessage),objPinned=getProp(itemID+"-pinned"),objName=$(this).find(".listItemTitle").text();if(thisPinned?objPinned?objName>thisName&&(added=!0):added=!0:objPinned||Math.max(item.lastMessage,item.lastMyMessage)>lastCommunication&&(added=!0),added)return $(this).before(createItemHTML("conv",item)),!1}}),added||$(".sidebarListItem:last").after(createItemHTML("conv",item)),convBodyHolders[item.id]||(convBodyHolders[item.id]={buffer:[],live:[]}),$(".sidebarListItem[data-item='searchElement']").attr("data-searchelementadd")==item.id&&($(".sidebarSearchInput").val("").trigger("keyup"),changeTabTo(item.id)),item.created&&changeTabTo(item.id)}}appcore.list.length&&$("#quickstart").hide(),$(".sidebarList").show()}function createItemHTML(type,item){if("conv"==type){var pinnedIcon='<span class="listItemPinned fa fa-thumb-tack"'+(getProp(item.id+"-pinned")?"":' style="display: none"')+"></span>";if(-1!=item.id.indexOf("-")){var subtitle="undefined"!=typeof item.displayname?item.username:"";return subtitle||(subtitle=0==item.contact?"Not contacts":item.myRequest?"Sent request":"Contact request"),'<div class="sidebarListItem'+(currentTab==item.id?" activeItem":"")+'" data-item="'+escapeText(item.id)+'" data-trigger="conv">'+pinnedIcon+'<div class="unreadBadge">0</div><img src="'+(item.avatar?escapeText(item.avatar):"img/noavatar.png")+'" class="listItemIcon" data-status="'+("undefined"!=typeof item.status?item.status:"")+'" /><span class="listItemTitle">'+escapeText(item.displayname||item.username)+'</span> <br /><span class="listItemSubtitle">'+escapeText(subtitle)+"</span></div>"}return'<div class="sidebarListItem'+(currentTab==item.id?" activeItem":"")+'" data-item="'+escapeText(item.id)+'" data-trigger="conv">'+pinnedIcon+'<div class="unreadBadge">0</div><img src="'+(item.avatar?escapeText(item.avatar):"img/group.png")+'" class="listItemIcon" data-status="room" /><span class="listItemTitle">'+escapeText(item.name)+'</span> <br /><span class="listItemSubtitle">'+(item.active?'<span class="inCallSubtitle">Group call</span>':"Group chat")+"</span></div>"}}function setListItem(id){var sidebarList=$(".sidebarListItem[data-item='"+id+"']"),listItem=appcore.list[appcore.listHash[id]];if(20==id.length)sidebarList.find(".listItemTitle").text(listItem.name),sidebarList.find(".listItemSubtitle").html(listItem.active&&-1!=listItem.active?'<span class="inCallSubtitle">Group call</span>':"Group chat");else{sidebarList.find(".listItemTitle").text(listItem.displayname||listItem.username);var subtitle="undefined"!=typeof listItem.displayname?escapeText(listItem.username):"";subtitle||(subtitle=0==listItem.contact?"Not contacts":listItem.myRequest?"Sent request":"Contact request"),sidebarList.find(".listItemSubtitle").html(subtitle)}appcore.activeCall==id&&sidebarList.find(".listItemSubtitle").html('<span class="inCallSubtitle">In call..</span>')}function layRoomInviteUserList(checked,addTo){var userListHTML="";for(var i in appcore.list)if(-1!=appcore.list[i].id.indexOf("-")){var selected=-1!=checked.indexOf(appcore.list[i].uid);userListHTML+='<div class="userListElement '+(selected?"selected":"")+'" data-uid="'+escapeText(appcore.list[i].uid)+'"><img src="'+(appcore.list[i].avatar?escapeText(appcore.list[i].avatar):"img/noavatar.png")+'" class="userListIcon" /><span>'+escapeText(appcore.list[i].username)+'</span><br /><small class="inviteMsg">'+(selected?"Selected":"Not selected")+"</small></div>"}if($("#roomInviteConfirm").addClass("disabled"),$("#roomInviteUserlist").html(userListHTML),addTo){var name=appcore.list[appcore.listHash[addTo]].name;$("#roomInviteCreate,#roomCreateBtnText").hide(),$("#roomInviteAdd,#roomAddBtnText").show(),$("#roomAddName").text(name),disableInvited(addTo),appcore.list[appcore.listHash[addTo]].pendingInvites||api.emit("getUsers",{target:addTo})}else $("#roomInviteCreate,#roomCreateBtnText").show(),$("#roomInviteAdd,#roomAddBtnText").hide();$(".userListElement").click(function(){var userListElement=$(this).hasClass("userListElement")?$(this):$(this).parent();userListElement.hasClass("invited")?$(userListElement).shake():userListElement.hasClass("selected")?$(userListElement).removeClass("selected").find(".inviteMsg").text("Not selected"):$(userListElement).addClass("selected").find(".inviteMsg").text("Selected"),testRoomInviteConfirm()})}function testRoomInviteConfirm(){$("#roomInviteUserlist").find(".userListElement.selected").length>=1&&$("#roomInviteUserlist").find(".userListElement.selected").length<=20&&(!$("#roomCreateName").is(":visible")||$("#roomCreateName").val().length>0)?$("#roomInviteConfirm").removeClass("disabled"):$("#roomInviteConfirm").addClass("disabled")}function layRoomEdit(id){var listItem=appcore.list[appcore.listHash[id]];$("#roomEditName").val(listItem.name),$("#roomEditMenu").find(".avatarFile,.uploadAvatarProgress").attr("data-target",id)}function testRoomEditConfirm(){$("#roomEditName").val().length?$("#roomEditConfirm").removeClass("disabled"):$("#roomEditConfirm").addClass("disabled")}function layUsers(){lastLayTime+1e3<(new Date).getTime()?_layUsers():layUsersTimeout||(layUsersTimeout=setTimeout(_layUsers,50))}function _layUsers(){if("home"!=currentTab){lastLayTime=(new Date).getTime(),layUsersTimeout=0;var uidArray=appcore.list[appcore.listHash[currentTab]].users,returnString="",notShownUsers=appcore.list[appcore.listHash[currentTab]].usercount,showLeft=4;for(var i in uidArray)if(showLeft>0){var userItem=getUserItem(uidArray[i]);if(!userItem)return String+=(0==i?"":", ")+"<small>Not found</small>";returnString+=userItem.uid==appcore.uid?(0==i?"":", ")+escapeText(userItem.displayname):(0==i?"":", ")+'<a href="javascript:;" class="userLink dottedLink" data-uid="'+escapeText(uidArray[i])+'">'+escapeText(userItem.displayname?userItem.displayname:userItem.username)+"</a>",showLeft--,notShownUsers--}$("#convSubtitleUsersList").html(returnString),notShownUsers?$("#convSubtitleUsersMore").text(notShownUsers+" more").show():$("#convSubtitleUsersMore").text("More")}}function getUsersMore(){appcore.list[appcore.listHash[currentTab]];api.emit("getUsers",{target:currentTab}),$("#usersMorePopoverLoading").show(),$("#usersMorePopoverContent").hide()}function getCallUsers(){layUsersMore(!0)}function layUsersMore(call){var usersHTML="",usersArray=[],uidArray=call?appcore.list[appcore.listHash[currentTab]].active.callUsers:appcore.list[appcore.listHash[currentTab]].users,ranks=appcore.list[appcore.listHash[currentTab]].ranks||[],myRank=appcore.list[appcore.listHash[currentTab]].myRank;call&&(usersHTML+="<b>Call Participants</b><hr />");for(var i in uidArray)usersArray.push([getNameFromUID(uidArray[i]),uidArray[i]]);usersArray.sort(function(a,b){return a[0]>b[0]});for(var i in usersArray){var userRank=0;call||ranks[usersArray[i][1]]&&(userRank=ranks[usersArray[i][1]]),usersArray[i][1]!=appcore.uid?(usersHTML+='<a href="javascript:;" class="userLink userPopoverLink dottedLink" data-uid="'+escapeText(usersArray[i][1])+'" data-rank="'+userRank+'">'+escapeText(usersArray[i][0])+"</a> ",call||(myRank>=4&&(usersHTML+='<a href="javascript:;" class="userRankLink" data-uid="'+escapeText(usersArray[i][1])+'">Set</a>'),myRank>=1&&(9==myRank||myRank>userRank)&&(usersHTML+='<a href="javascript:;" class="userKickLink" data-uid="'+escapeText(usersArray[i][1])+'">Kick</a>')),usersHTML+="<br />"):usersHTML+='<span data-rank="'+userRank+'">'+escapeText(usersArray[i][0])+"</span><br />"}$("#usersMorePopoverLoading").hide(),$("#usersMorePopoverContent").html(usersHTML).show()}function userList(data){data.target==currentTab&&layUsersMore(),"meta"==currentTab&&lastTab==data.target&&disableInvited(lastTab)}function disableInvited(target){var pendingInvites=($("#roomInviteUserlist"),appcore.list[appcore.listHash[target]].pendingInvites||[]),users=appcore.list[appcore.listHash[target]].users;$(".userListElement").each(function(){var uid=$(this).attr("data-uid");-1!=pendingInvites.indexOf(uid)?$(this).addClass("invited").find(".inviteMsg").text("Invited"):-1!=users.indexOf(uid)&&$(this).addClass("invited").find(".inviteMsg").text("Joined")})}function refreshTypingDisplay(){var listItem=appcore.list[appcore.listHash[currentTab]];if(listItem){var typingText="";if(listItem.typings){var typingArray=[],typedArray=[];for(var i in listItem.typings){var displayName;displayName=37==listItem.id.length?listItem.displayname||listItem.username:getUserItem(listItem.typings[i][0]).username,"typing"==listItem.typings[i][1]?typingArray.push(displayName):typedArray.push(displayName)}1==typingArray.length?typingText+=typingArray[0]+" is typing...":typingArray.length>1&&(typingText+=typingArray.join(", ")+" is typing..."),1==typedArray.length?typingText+=typedArray[0]+" has typed.":typedArray.length>1&&(typingText+=typedArray.join(", ")+" has typed."),$("#convTyping").text(typingText)}else $("#convTyping").text("")}}function keepPosModals(){if(activeModal){var left=window.innerWidth/2-activeModal.outerWidth()/2;window.innerWidth<400&&(left=0);var top=window.innerHeight/2-activeModal.outerHeight()/2;activeModal.css({left:left+"px",top:top+"px"})}}function canvasLoadImage(context,src){var imageObj=new Image;imageObj.onload=function(){context.drawImage(this,0,0)},imageObj.src=src}function setFaviconBadge(badgeNumber){var faviconCanvas=document.createElement("canvas");faviconCanvas.width=16,faviconCanvas.height=16;var ctx=faviconCanvas.getContext("2d");ctx.drawImage(baseFaviconImage,0,0);var numberMasks=["","^`_^^^y","hkjf\\[y","hkjfjkh","kkkxjjj","y[[ijji","hk[ikkh","yjjb^^^","hkkhkkh","hkkxjjj","Z^^y^^Z"];if(0!=badgeNumber){ctx.fillStyle="#FF955A",ctx.fillRect(9,7,7,9),ctx.fillStyle="#FFFFFF";for(var numberMask=numberMasks[Math.min(badgeNumber,10)],i=0;7>i;i++){var currentMask=numberMask.charCodeAt(i)-90;1&currentMask&&ctx.fillRect(10,8+i,1,1),2&currentMask&&ctx.fillRect(11,8+i,1,1),4&currentMask&&ctx.fillRect(12,8+i,1,1),8&currentMask&&ctx.fillRect(13,8+i,1,1),16&currentMask&&ctx.fillRect(14,8+i,1,1)}}var imgDataUrl=faviconCanvas.toDataURL();$("#favicon").remove();var newFavicon=document.createElement("link");newFavicon.setAttribute("id","favicon"),newFavicon.setAttribute("rel","icon"),newFavicon.setAttribute("type","image/png"),newFavicon.setAttribute("href",imgDataUrl),document.head.appendChild(newFavicon)}function startTitleAlert(title){originalTitle=title,clearInterval(titleAlertInterval),titleAlertInterval=setInterval(function(){document.title=document.title==originalTitle?"** "+originalTitle:originalTitle},700)}function stopTitleAlert(){clearInterval(titleAlertInterval),document.title=originalTitle}function startScreen(){$("#createAccountContent").hide(),$("#startScreen").css("position","relative").show(),$("#startScreenContent").fadeIn(250),layScreen(),$("#createAccountBtn").click(function(){$(this).hasClass("disabled")||createAccountScreen()}),0==$("#loginUsername").val().length&&localStorage&&localStorage.getItem("lastUsername")&&$("#loginUsername").val(localStorage.getItem("lastUsername")),$("#header").children().hide(),"http:"==document.location.protocol&&"localhost"!=document.location.hostname&&"127.0.0.1"!=document.location.hostname&&$("#httpWarning").removeClass("hide"),$("#versionString").text(appcore.version)}function createAccountScreen(){$("#startScreenContent").fadeOut(250),layScreen(),setTimeout(function(){$("#createAccountContent").fadeIn(250)
},250),$("#backToStartScreen").show()}function hooks(){createAccountHooks(),mainAppHooks(),$("form").submit(function(e){e.preventDefault()})}function createAccountHooks(){$("#backToStartScreen").click(startScreen),$("#createAccountStep1Username").val(""),$("#createAccountStep1Username").keyup(function(){clearTimeout(checkUsernameTimeout),checkUsernameTimeout=setTimeout(function(){api.emit("userExists",{username:$("#createAccountStep1Username").val()}),$("#createAccountStep1Available").text("Checking.."),$("#createAccountStep1Available").removeClass("errorNotice")},550)}),$("#createAccountStep1Displayname,#createAccountStep1Username").keyup(function(){$("#createAccountStep1Displayname").val().length>2&&!$("#createAccountStep1Available").hasClass("errorNotice")?$("#createAccountStep1Btn").removeClass("disabled"):$("#createAccountStep1Btn").addClass("disabled")}),$("#createAccountStep1Btn").click(function(){$(this).hasClass("disabled")||($("#createAccountFooterError").text(""),$("#createAccountStep1").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep2").show().css("left","500px").animate({left:"0px"},550),$("#loginUsername").val($("#createAccountStep1Username").val()))}),$("#createAccountStep2Pass1").keyup(function(){$("#createAccountStep2Length").text($("#createAccountStep2Pass1").val().length>=10?"OK":"At least 10 chars"),$("#createAccountStep2Match").text($("#createAccountStep2Pass1").val()==$("#createAccountStep2Pass2").val()?"OK":"Doesn't match.")}),$("#createAccountStep2Pass2").keyup(function(){$("#createAccountStep2Match").text($("#createAccountStep2Pass1").val()==$("#createAccountStep2Pass2").val()?"OK":"Doesn't match."),"OK"==$("#createAccountStep2Match").text()&&"OK"==$("#createAccountStep2Length").text()&&$("#createAccountStep2Btn").removeClass("disabled")}),$("#createAccountStep2Btn").click(function(){$(this).hasClass("disabled")||($("#backToStartScreen").hide(),$(this).addClass("disabled"),$("#createAccountStep2").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep3").show().css("left","500px").animate({left:"0px"},550),api.emit("genKey",{generating:function(){for(var htmlGen="",i=0;10>i;i++)htmlGen+=randomUID(53)+"<br />";$("#createAccountStep3Gen").html(htmlGen)},generated:function(){$("#createAccountStep3").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep4").show().css("left","500px").animate({left:"0px"},550),api.emit("getCaptcha",{purpose:"createAccount"})}}))}),$("#createAccountStep4Captcha,#createAccountStep4Email").keyup(function(){$("#createAccountStep2Pass1").val().length>5&&$("#createAccountStep4Email").val().length>5&&$("#createAccountStep4Btn").removeClass("disabled")}),$("#createAccountStep4Btn").click(function(){$(this).hasClass("disabled")||($("#createAccountFooterError").text(""),api.emit("register",{username:$("#createAccountStep1Username").val(),displayname:$("#createAccountStep1Displayname").val(),password:$("#createAccountStep2Pass1").val(),email:$("#createAccountStep4Email").val(),newsletter:$("#createAccountStep4Newsletter").is(":checked"),challenge:lastCaptchaChallenge,captcha:$("input#createAccountStep4Captcha").val()}),$("#createAccountStep4Btn").hide(),$("#createAccountStep4Text").html("<img src='/img/spinner.gif' class='spinneralign'> Registering.."))}),api.on("registerResult",function(data){"FAIL"==data.status?($("input#createAccountStep4Captcha").val(""),$("#createAccountFooterError").text(data.message),$("#createAccountStep4Text").text(""),setTimeout(function(){$("#createAccountStep4Btn").show()},300),data.restart?($("#createAccountStep1").css("position","relative").css("left","0px"),$("#createAccountStep2").hide().css("position","relative").css("left","0px"),$("#createAccountStep3").hide().css("position","relative").css("left","0px"),$("#createAccountStep4").hide().css("position","absolute").css("left","-500px"),$("#createAccountStep1Available").text(""),$("#createAccountStep2Btn").removeClass("disabled")):api.emit("getCaptcha",{purpose:"createAccount"})):($("#createAccountStep4").css("position","absolute").animate({left:"-500px"},550),$("#createAccountStep5").show().css("left","500px").animate({left:"0px"},550),$("#createAccountStep5Name").text($("#createAccountStep1Displayname").val()),$("#createAccountStep5Username").text($("#createAccountStep1Username").val()),$("#createAccountStep1Username").val(""))}),$("#createAccountStep5Btn").click(startScreen),api.on("userExistsResult",function(data){data.username==$("#createAccountStep1Username").val()?($("#createAccountStep1Available").text(data.exists?"Already taken.":"Available!"),data.error&&$("#createAccountStep1Available").text(data.error),(data.exists||data.error)&&$("#createAccountStep1Available").addClass("errorNotice"),$("#createAccountStep1Displayname").val().length>2&&!$("#createAccountStep1Available").hasClass("errorNotice")&&$("#createAccountStep1Btn").removeClass("disabled")):data.exists?($(".sidebarListItem[data-item=searchElement] .listItemSubtitle").text("Add to your list"),$(".sidebarListItem[data-item=searchElement]").attr("data-searchElementAdd","conv"+sortUID(data.uid,appcore.uid))):$(".sidebarListItem[data-item=searchElement] .listItemSubtitle").text("There is no user named "+data.username)}),$("#loginButton").click(function(){if(!$(this).hasClass("disabled")){if(0==$("#loginUsername").val().length)return void $("#loginUsername").shake();if(0==$("#loginPassword").val().length)return void $("#loginPassword").shake();$("#loginButton").addClass("disabled"),$("#loginButton").text("Logging in.."),$("#loginErrorMessage").text(""),$("#signInSpinner").show(),api.emit("loginMain",{username:$("#loginUsername").val(),password:$("#loginPassword").val()})}}),api.on("loginMainResult",function(data){$("#loginButton").text("Decrypt & Login"),$("#loginButton").removeClass("disabled"),$("#signInSpinner").hide(),"FAIL"==data.status?$("#loginErrorMessage").text(data.message):"OK"==data.status&&(loggedInCalls(),mainApp())})}function mainAppHooks(){permissionsContinue=function(){$("#permissionScreen").css("position","absolute").fadeOut(300),$("#mainScreen").css("position","relative").fadeIn(300),changeTabTo("home")},-1!=navigator.userAgent.indexOf("Chrome")?($(".permissionsWebkit").removeClass("hide"),"granted"===window.Notification.permission&&(hasNotificationPerm=!0)):-1!=navigator.userAgent.indexOf("Firefox")?($(".permissionsMozilla").removeClass("hide"),"granted"==Notification.permission&&(hasNotificationPerm=!0)):hasNotificationPerm=!0,$(".notificationPermPrompt").click(function(){$(this).hasClass("disabled")||(Notification&&Notification.requestPermission(function(){hasNotificationPerm=!0,permissionsContinue()}),$(this).addClass("disabled").text("Look up"))}),$(".sidebarListItem[data-item='me']").click(function(){$(this).popover($("#setStatusPopover"))});var allowedBgColors=["EDFBFF","EDECFC","F2E8FF","F3DAFF","FCE1F9","FFECEF","FFF5E8","FFF9E8","FEFFE8","E8FDE5","E9FFD2","FCFDFC"],editProfileBgColorPicksHTML="";for(var i in allowedBgColors)editProfileBgColorPicksHTML+="<div class='bgColorPick' style='background-color: #"+allowedBgColors[i]+"' data-bgColor='"+allowedBgColors[i]+"'></div>";$("#editProfileBgColorPicks").html(editProfileBgColorPicksHTML),$("#editProfileBgColorPicks").on("click",".bgColorPick",function(){api.emit("changeProfile",{bgColor:$(this).attr("data-bgColor")}),$("#editProfileBack").click()}),$("#mainSidebar").on("click",".sidebarListItem",function(){var itemName=$(this).attr("data-item");"searchElement"==itemName?$(this).attr("data-searchElementAdd")&&"invalid"!=$(this).attr("data-searchElementAdd")?($(this).find(".listItemSubtitle").text("Loading.."),api.emit("addList",{id:$(this).attr("data-searchElementAdd")}),$("#quickstart").hide(),$("#sidebarSearchInput").val("").trigger("keyup")):$(this).shake():"me"==itemName||changeTabTo(itemName)}),$("#sidebarSearchInput").clearable(),$("#sidebarSearchInput").keyup(function(){searchChange($("#sidebarSearchInput").val())}),$("#mainLeftDivider").mousedown(function(){this.onselectstart=function(e){return e.preventDefault(),!1},dividerDragging="mainLeftDivider"}),$("body").mouseup(function(){"mainLeftDivider"==dividerDragging&&window.localStorage&&window.localStorage.setItem("sidebarWidth",sidebarWidth),dividerDragging="",$("body").css("cursor","auto"),$("body").removeClass("noSelect")}),$("body").mousemove(function(event){dividerDragging&&"mainLeftDivider"==dividerDragging&&(sidebarWidth=event.pageX-15,215>sidebarWidth?sidebarWidth=215:sidebarWidth>500&&(sidebarWidth=500),$("body").addClass("noSelect"),$("body").css("cursor","ew-resize"),layScreen())}),$(".requestTextarea").keyup(function(){$(".requestTextarea").val().length?$(".sendRequestBtn").removeClass("disabled"):$(".sendRequestBtn").addClass("disabled")}),$(".sendRequestBtn").click(function(){return $(this).hasClass("disabled")?void $(this).shake():($("#addContactButton").removeClass("active"),api.emit("addContact",{id:currentTab,message:$(".requestTextarea").val()}),layContent(!0,!1),void $(".addContactButton").popover($(".addContactPopover")))}),$("#convButtons").on("click","button",convButtonClick),$(".convMorePopover").on("click","li",convButtonClick),api.on("getListsResult",layList),api.on("newText",newText),$("#convInput").keydown(function(event){if(13==event.keyCode){if(!event.shiftKey){event.preventDefault();var layContentAfter=!1;appcore.profileBlob.conversations[currentTab]||(layContentAfter=!0),api.emit("sendText",{target:currentTab,message:$("#convInput").val()}),layContentAfter&&layContent(!1,!1),$("#convInput").val("")}}else 38==event.keyCode&&(event.shiftKey||0!=$("#convInput").val().length||$(".convMessage.myMessage.chatMessage:last").length&&$(".convMessage.myMessage:last").find(".messageEditButton").click())}),$("#convInput").keyup(function(event){(8==event.keyCode||event.keyCode>=46&&event.keyCode<=90)&&($("#convInput").val().length>0?api.emit("updateTypingState",{target:currentTab,state:"typing"}):api.emit("updateTypingState",{target:currentTab,state:"empty"}))}),api.on("refreshTypingDisplay",refreshTypingDisplay),$("#convText").on("click",".messageEditButton",function(){$(this).hide(),$(this).parent().addClass("show"),$(this).parent().find(".messageEditCancelButton").show();var $convMessageContent=$(this).parent().parent().find(".convMessageContent"),originalContent=$convMessageContent.text();$convMessageContent.html("<textarea class='messageEditArea' data-original='"+escapeText(originalContent)+"'>"+escapeText(originalContent)+"</textarea>"),setTimeout(function(){$convMessageContent.find("textarea").focus().moveCaretToEnd()},1)}),$("#convText").on("click",".messageEditCancelButton",function(){$(this).hide(),$(this).parent().removeClass("show"),$(this).parent().find(".messageEditButton").show();var $convMessageContent=$(this).parent().parent().find(".convMessageContent"),originalContent=$convMessageContent.find("textarea.messageEditArea").attr("data-original");$(this).parent().parent().find(".convMessageContent").html(originalContent),$("#convInput").focus()}),$("#convText").on("keydown",".messageEditArea",function(event){var replaceTimestamp=$(this).parent().parent().attr("data-timestamp");13==event.keyCode?event.shiftKey||(event.preventDefault(),$(this).parent().parent().find(".messageEditCancelButton").click(),api.emit("editText",{target:currentTab,newMessage:$(this).val(),replaceTimestamp:replaceTimestamp})):27==event.keyCode&&$(this).parent().parent().find(".messageEditCancelButton").click()}),$("#encInfo").click(function(event){$(this).popover($("#encInfoPopover")),event.preventDefault()}),$("#myStatusSelect").change(function(){api.emit("changeStatus",{status:$(this).val()});var myListItem=$(".sidebarListItem[data-item='me']");myListItem.find(".listItemIcon").attr("data-status",appcore.status),myListItem.find(".listItemSubtitle").text(statusText[appcore.status]),$("#editProfileIcon").popover($("#setStatusPopover"))}),$("#editProfileDisplayNameLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfileDisplayName").fadeIn(500)}),$("#editProfileBgColorLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfileBgColor").fadeIn(500)}),$("#editProfileBack").click(function(){$("#editProfileBack").fadeOut(500),$("#editProfileHeader").fadeIn(500),$("#editProfileDisplayName,#editProfileAvatar,#editProfilePassword,#editProfileAvatar,#editProfileBgColor").hide(),$("#editProfileMain").fadeIn(500)}),$("#editProfilePasswordLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfilePassword").fadeIn(500)}),$("#editProfileAvatarLink").click(function(){$("#editProfileHeader").fadeOut(500),$("#editProfileBack").fadeIn(500),$("#editProfileMain").hide(),$("#editProfileAvatar").fadeIn(500)}),$("#editProfilePasswordSave").click(function(){var errorMessages=$("#editProfilePassShort,#editProfilePassMismatch,#editProfilePassOldFail,#editProfileBgColor");return errorMessages.hide(),$("#editProfileNewPass1").val().length<10?void $("#editProfilePassShort").show().shake():$("#editProfileNewPass1").val()!=$("#editProfileNewPass2").val()?void $("#editProfilePassMismatch").show().shake():(api.emit("changeProfile",{newpass:$("#editProfileNewPass1").val(),oldpass:$("#editProfileOldPass").val()}),$("#editProfileNewPass1,#editProfileNewPass2,#editProfileOldPass").val(""),void(errorMessages.is(":visible")||$("#editProfileBack").click()))}),$("#editProfileDisplayNameSave").click(function(){"*"==$("#editProfileDisplayNameInput").val()?$.modal("displayNameNotAllowed"):(api.emit("changeProfile",{displayname:$("#editProfileDisplayNameInput").val()}),$("#editProfileDisplayNameText").text(appcore.displayname),$("#editProfileBack").click())}),$("#settingsBtn").click(function(){$(this).popover($("#settingsPopover"))}),$("#generalVolumeSlider").change(function(){api.emit("setProp",{name:"generalVolume",value:this.value/100});var soundNewMessage=$("#soundNewMessage")[0];soundNewMessage.volume=this.value/100,soundNewMessage.pause(),soundNewMessage.currentTime=0,soundNewMessage.play()}),$("#ringerVolumeSlider").change(function(){api.emit("setProp",{name:"ringerVolume",value:this.value/100});var soundRinging=$("#soundRinging")[0];(soundRinging.paused||!soundRinging.loop)&&(soundRinging.volume=this.value/100,soundRinging.pause(),soundRinging.currentTime=0,soundRinging.loop=!1,soundRinging.play())}),$("#enableNotificationsCheckbox").change(function(){api.emit("setProp",{name:"disableNotifications",value:!this.checked})}),$("#roomInviteConfirm").click(function(){if(!$(this).hasClass("disabled")){var uids=[];$("#roomInviteUserlist").find(".userListElement.selected").each(function(){uids.push($(this).attr("data-uid"))}),$(this).find("#roomCreateBtnText").is(":visible")?(api.emit("createRoom",{invite:uids,mode:"new",name:$("#roomCreateName").val()}),$(this).addClass("disabled")):(api.emit("createRoom",{invite:uids,mode:"add",target:lastTab}),$(this).addClass("disabled"),changeTabTo(lastTab))}}),$("#roomCreateName").keyup(testRoomInviteConfirm),$("#convText").on("click","a.roomInviteLink",function(){appcore.listHash[$(this).attr("data-target")]?changeTabTo($(this).attr("data-target")):api.emit("joinRoom",{target:$(this).attr("data-target"),convKey:atob($(this).attr("data-convkey"))})}),$("#roomInviteCancel,#roomEditCancel").click(function(){changeTabTo(lastTab)}),$("#roomEditName").keyup(testRoomEditConfirm),$("#roomEditConfirm").click(function(){$(this).hasClass("disabled")||(api.emit("changeGroupInfo",{target:lastTab,name:$("#roomEditName").val()}),changeTabTo(lastTab))}),$("#convText").on("click","#bufferMore",function(){$(this).text("Loading.."),$(this).attr("data-scrollPos",$("#convText")[0].scrollHeight),api.emit("getBuffer",{target:currentTab,small:!1})}),$("#convText").on("click",".verifyKey",function(){api.emit("verifyKey",{target:currentTab})}),$("#convSubtitleUsersMore").click(function(){$(this).popover($("#usersMorePopover")),getUsersMore()}),$("#voiceUsers").click(function(){$(this).popover($("#usersMorePopover")),getCallUsers()}),$("#convSubtitleUsersList,#usersMorePopoverContent,#convText,#modal").on("click",".userLink",function(){var convID="conv"+sortUID(appcore.uid,$(this).attr("data-uid"));appcore.listHash[convID]?changeTabTo(convID):(api.emit("addList",{id:convID}),$(this).text("Loading..")),$(this).parents("#usersMorePopoverContent").length&&$(this).popover($("#usersMorePopover")),$.modal("kick","hide")}),$("#usersMorePopover").on("click",".userKickLink",function(){api.emit("kickUser",{target:currentTab,kicking:$(this).attr("data-uid")}),$(this).text("Kicking.."),$(this).parents("#usersMorePopoverContent").length&&$(this).popover($("#usersMorePopover")),layContent(!0,!1)}),$("#usersMorePopover").on("click",".userRankLink",function(){$("#userRankUsername").text(getNameFromUID($(this).attr("data-uid"))),$("#userRankUsername").attr("data-uid",$(this).attr("data-uid")),$("#userRankSelect").change(),$.modal("userRank","show")}),$("#userRankSelect").change(function(){var myRank=appcore.list[appcore.listHash[currentTab]].myRank,userRank=appcore.list[appcore.listHash[currentTab]].ranks[$("#userRankUsername").attr("data-uid")]||0,setRankTo=$("#userRankSelect").val();$(".userRankDesc").hide(),$(".userRankDesc[data-rank='"+setRankTo+"']").show(),$("#userRankNoPermU,#userRankNoPermR").hide(),$("#userRankApply").removeClass("disabled"),setRankTo>=myRank&&9!=myRank?($("#userRankNoPermR").show(),$("#userRankApply").addClass("disabled")):userRank>=myRank&&9!=myRank&&($("#userRankNoPermU").show(),$("#userRankApply").addClass("disabled"))}),$("#userRankApply").click(function(){$.modal("userRank","hide"),$(this).hasClass("disabled")||api.emit("setUserRank",{target:currentTab,user:$("#userRankUsername").attr("data-uid"),newRank:$("#userRankSelect").val()})}),api.on("userList",userList),$("#voiceDrop").click(function(){api.emit("dropCall",{target:currentTab})}),$("#voiceAccept").click(function(){return apprtc.supported?getProp("webrtcWarning")?void api.emit("acceptCall",{target:currentTab}):($("#p2pWarningContinue").attr("data-click","#voiceAccept"),$.modal("p2pWarning"),void api.emit("setProp",{name:"webrtcWarning",value:!0})):void $.modal("callsNotSupported","show")}),$("#voiceMute").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),setMicrophoneMute(!1)):($(this).addClass("on"),setMicrophoneMute(!0))}),$("#videoMute").click(function(){$(this).hasClass("on")?($(this).removeClass("on"),setVideoMute(!1)):($(this).addClass("on"),setVideoMute(!0))}),$(".avatarFile").change(function(event){var allowedTypes=["image/png","image/jpg","image/jpeg"],target=$(this).attr("data-target");if(event.target.files.length)if($(".uploadAvatarProgress[data-target='"+target+"']").show(),event.target.files[0].size>2097152)$(".uploadAvatarProgress[data-target='"+target+"']").text("File size is too large (Max: 2MB)");else if(-1==allowedTypes.indexOf(event.target.files[0].type))$(".uploadAvatarProgress[data-target='"+target+"']").text("Only PNG and JPEG files are supported.");else{$(this).hide();var reader=new FileReader;reader.onload=function(){api.emit("uploadAvatar",{data:reader.result,target:target})},reader.readAsBinaryString(event.target.files[0])}}),$("#logoutBtn").click(function(){api.emit("logout",{}),$(".sidebarListItem").each(function(){var dataItem=$(this).attr("data-item");"home"!=dataItem&&"searchElement"!=dataItem&&"meta"!=dataItem&&"gedit"!=dataItem&&"me"!=dataItem&&$(this).remove()}),$(".contentTab.tab-conv,#mainScreen").hide(),$.modal("logout"),startScreen()}),$("#p2pWarningContinue").click(function(){$.modal("videoSecurity","hide"),$(this).attr("data-click")&&$($(this).attr("data-click")).click()}),$("#videoSecurityCancel").click(function(){$.modal("videoSecurity","hide")}),$("#blockUser").click(function(){api.emit("blockUser",{target:currentTab}),removeList(currentTab),$.modal("blockedUser","show")}),$("#unblockButton").click(function(){api.emit("blockUser",{target:currentTab,unblock:!0}),layContent(!0,!1)}),$("#securityInfoTrigger").click(function(){$.modal("securityInfo")}),$("#quickstartLink").click(function(){$(this).select()}),$("#quickstartSearchTip").mouseover(function(){$("#sidebarSearchInput").addClass("highlighted")}),$("#quickstartSearchTip").mouseout(function(){$("#sidebarSearchInput").removeClass("highlighted")}),$("#pinToList").click(function(){$(this).hide(),$("#unpinFromList").show(),$(".sidebarListItem[data-item='"+currentTab+"']").remove(),api.emit("setProp",{name:currentTab+"-pinned",value:!0}),layList()}),$("#unpinFromList").click(function(){$(this).hide(),$("#pinToList").show(),$(".sidebarListItem[data-item='"+currentTab+"']").remove(),api.emit("setProp",{name:currentTab+"-pinned",value:null}),layList()}),$("#testUserMedia").click(function(){$("#mediaTest").is(":visible")?(stopMediaTest(),$("#mediaTest").slideUp()):(startMediaTest(),$("#mediaTest").slideDown())}),$("#mediaTest .close").click(function(){$("#testUserMedia").click()}),$("#errorReporterReport").click(function(){api.emit("sendErrorReport",{trace:$("#errorReportTrace").text()}),$("#errorReporterAsk").hide(),$("#errorReporterThanks").show()}),$("#errorReporterIgnore").click(function(){$.modal("errorReporter","hide")})}function mainApp(){$(".loginButton").text("Decrypt & Login"),$(".loginButton").removeClass("disabled"),$(".signInSpinner").hide(),$(".loginPassword").val(""),localStorage&&localStorage.setItem("lastUsername",$("#loginUsername").val()),$("#startScreen").css("position","absolute").fadeOut(300),hasNotificationPerm?($("#mainScreen").css("position","relative").fadeIn(300),changeTabTo("home")):$("#permissionScreen").css("position","relative").fadeIn(300),layScreen()}function changeTabTo(tab){if(""!=currentTab){var currentTrigger=$(".sidebarListItem[data-item="+currentTab+"]").attr("data-trigger");"conv"==currentTrigger&&(convInputHolders[currentTab]=$("#convInput").val()),$(".tab-"+currentTrigger).hide(),$(".sidebarListItem[data-item="+currentTab+"]").removeClass("activeItem")}lastTab=currentTab,currentTab=tab;var currentTrigger=$(".sidebarListItem[data-item="+currentTab+"]").attr("data-trigger");if($(".tab-"+currentTrigger).show(),$(".tab-"+currentTrigger).attr("data-item",currentTab),$(".sidebarListItem[data-item="+currentTab+"]").addClass("activeItem"),$(".sidebarListItem[data-item="+currentTab+"] .unreadBadge").slideUp(400,function(){$(this).text("0")}),"conv"==currentTrigger){var listItem=appcore.list[appcore.listHash[currentTab]];if(api.emit("markRead",{target:currentTab}),api.emit("getBuffer",{target:currentTab,small:!0}),focusInput(),refreshTypingDisplay(),listItem.relatedNotifications&&listItem.relatedNotifications.length){for(var i in listItem.relatedNotifications)listItem.relatedNotifications[i]&&listItem.relatedNotifications[i].close();listItem.relatedNotifications=[]}convInputHolders[currentTab]?($("#convInput").val(convInputHolders[currentTab]),delete convInputHolders[currentTab]):$("#convInput").val("")}layContent(!0,!0),layScreen(!0)}function removeList(id){currentTab==id&&changeTabTo("home"),$(".sidebarListItem[data-item='"+id+"']").remove()}function newText(data){appcore.list[appcore.listHash[data.target]];convBodyHolders[data.target]||(convBodyHolders[data.target]={buffer:[],live:[],lastUser:null,lastMsgSystem:null,lastDate:null});var convMessageUser=data.user,convMessageUserShow=data.userShow,isChatMessage=!("*"==data.userShow),convMessageContent=parseChatMessage(data.message,data.userShow),convMessageMeta=data.timestamp?"<span title='"+fullTime(data.timestamp)+"'>"+friendlyTime(data.timestamp)+"</span>":"",convMessageActions=data.isMe&&"*"!=data.userShow?"<div class='messageEditButton tinyButton'>Edit</div> <div class='messageEditCancelButton tinyButton' style='display: none'>Cancel</div>":"",newDivider=!0,lapseDivider="",date=new Date(parseInt(data.timestamp)).getDate();if(date!=convBodyHolders[data.target].lastDate&&null!=convBodyHolders[data.target].lastDate){var countdown=dateTime(data.timestamp);lapseDivider="<div class='convMessage lapseDivider'><i class='fa fa-calendar'></i> "+countdown+"</div>",convBodyHolders[data.target].lastUser="calendar"}convBodyHolders[data.target].lastDate=date,data.bgColor=data.bgColor&&6==data.bgColor.length&&0/0!=parseInt("0x"+data.bgColor)?"#"+data.bgColor:"inherit","*"!=data.userShow?(convBodyHolders[data.target].lastUser!=data.user||convBodyHolders[data.target].lastMsgSystem||(convMessageUserShow="&nbsp;",newDivider=!1),convBodyHolders[data.target].lastMsgSystem=!1):convBodyHolders[data.target].lastMsgSystem=!0,convBodyHolders[data.target].lastUser=data.user;var htmlBuild=lapseDivider+"<div class='convMessage "+(data.isMe?"myMessage ":"")+(data.small?"smallMessage ":"")+(newDivider?"newDivider ":"")+(isChatMessage?"chatMessage ":"")+"' data-unread='"+(data.unread&&data.target!=currentTab)+"' style='background-color:"+data.bgColor+"' data-timestamp='"+data.timestamp+"' data-user='"+convMessageUser+"'><div class='newOrb'></div><div class='convMessageActions'>"+convMessageActions+"</div><div class='convMessageUser'>"+convMessageUserShow+"</div><div class='convMessageContent' style='width:"+lastMessageContentWidth+"px'>"+convMessageContent+"</div><div class='convMessageMeta'>"+convMessageMeta+"</span></div></div>";if(data.isFromBuffer?convBodyHolders[data.target].buffer.push(htmlBuild):convBodyHolders[data.target].live.push(htmlBuild),convBodyHolders[data.target].buffer.length+convBodyHolders[data.target].live.length>300&&(convBodyHolders[data.target].buffer.length?convBodyHolders[data.target].buffer.splice(0,1):convBodyHolders[data.target].live.splice(0,1),data.target==currentTab&&$(".convMessage:first").remove()),data.target==currentTab){var convText=$("#convText");if(data.isFromBuffer){var bLD=convText.find("#bufferLiveDivider");bLD.length?bLD.before(htmlBuild):convText.append(htmlBuild),convText[0].scrollTop=convText[0].scrollHeight}else convText[0].scrollTop+convText[0].offsetHeight>convText[0].scrollHeight-50&&convText.stop().animate({scrollTop:convText[0].scrollHeight}),convText.append(htmlBuild);api.emit("markRead",{target:currentTab})}else if(data.unread&&!data.isMe){var badge=$(".sidebarListItem[data-item='"+data.target+"'] .unreadBadge");badge.slideDown(500).text(parseInt(badge.text())+1)}!data.unread||data.isFromBuffer||data.isMe||api.emit("notify",{type:"newMessage",uid:data.user,target:data.target,displayname:data.userShow,message:convMessageContent})}function parseChatMessage(input,userDisplay){var links=input.match(/(^|\s|<br>)https?:\/\/[A-Za-z0-9\-]+\.[A-za-z0-9\/?&%;.#=\-~+!]+/g);for(var i in links)links[i]=links[i].trim().replace("<br>",""),input=input.replace(links[i],'<a href="'+links[i].replace(/&amp;/g,"&")+'" target="_blank">'+links[i]+"</a>");return"/me "==input.substr(0,4)&&(input="<i>"+userDisplay+" "+input.substr(4)+"</i>"),window.SubrosaEmoticons&&window.SubrosaEmoticons.markUp&&(input=window.SubrosaEmoticons.markUp(input)),input}function loggedInCalls(){var myListItem=$(".sidebarListItem[data-item='me']");myListItem.find(".listItemIcon").attr("data-status",appcore.status),myListItem.find(".listItemSubtitle").text(statusText[appcore.status]),$("#myStatusSelect").val(appcore.status),$("#meUsername").text(appcore.username),$("#editProfileUsernameText").text(appcore.username),$("#editProfileDisplayNameText").text(appcore.displayname),$("#editProfileDisplayNameInput").val(appcore.displayname),appcore.avatar&&(myListItem.find(".listItemIcon")[0].src=appcore.avatar),$("#header").children().not("#settingsPopover").show(),apprtc.supported?$("#infoSupportCalls").show():$("#infoNotSupportCalls").show(),getProp("generalVolume")!==!1&&$("#generalVolumeSlider").val(100*getProp("generalVolume")),getProp("ringingVolume")!==!1&&$("#ringingVolumeSlider").val(100*getProp("ringingVolume")),getProp("disableNotifications")&&$("#enableNotificationsCheckbox").attr("checked",!1)}function friendlyTime(timeMs){if(!timeMs)return"?";var theDate=new Date(parseInt(timeMs)),nowDate=new Date;if(nowDate.getTime()-theDate.getTime()>864e5)return shortMonths[theDate.getMonth()]+" "+theDate.getDate();var amOrPm="am",ampmHour=theDate.getHours();theDate.getHours()>12&&(ampmHour=theDate.getHours()-12,amOrPm="pm");var paddedMinute=1==theDate.getMinutes().toString().length?"0"+theDate.getMinutes():theDate.getMinutes();return ampmHour+":"+paddedMinute+amOrPm}function dateTime(timeMs){if(!timeMs)return"?";var theDate=new Date(parseInt(timeMs));return shortMonths[theDate.getMonth()]+" "+theDate.getDate()}function fullTime(timeMs){if(!timeMs)return"?";var theDate=new Date(parseInt(timeMs)),paddedMinute=1==theDate.getSeconds().toString().length?"0"+theDate.getSeconds():theDate.getSeconds(),paddedSecond=1==theDate.getSeconds().toString().length?"0"+theDate.getSeconds():theDate.getSeconds();return theDate.getFullYear()+" "+shortMonths[theDate.getMonth()]+" "+theDate.getDate()+" "+theDate.getHours()+":"+paddedMinute+":"+paddedSecond}function focusInput(){$("#convInput").is(":visible")&&$("#convInput").focus()}function searchChange(newSearchTerm){var neverHide=["me","home","searchElement"],alreadyInList=!1;$(".sidebarListItem").each(function(){if("meta"!=$(this).attr("data-item")&&"gedit"!=$(this).attr("data-item")&&-1==neverHide.indexOf($(this).attr("data-item"))){var title=$(this).find(".listItemTitle").text().toLowerCase();-1==title.indexOf(newSearchTerm.toLowerCase())?$(this).slideUp(80):($(this).slideDown(80),title==newSearchTerm.toLowerCase()&&(alreadyInList=!0))}});var searchElement=$(".sidebarListItem[data-item=searchElement]");0!=newSearchTerm.length?(searchElement.find(".listItemTitle").text(newSearchTerm),searchElement.attr("data-searchElementAdd","invalid"),clearTimeout(searchNameTimeout),newSearchTerm.length<3?searchElement.find(".listItemSubtitle").text("There is no user named "+newSearchTerm):newSearchTerm.toLowerCase()==appcore.username.toLowerCase()?searchElement.find(".listItemSubtitle").text("That's you!"):alreadyInList?searchElement.find(".listItemSubtitle").text("Already in your list!"):(searchElement.find(".listItemSubtitle").text("Loading "+newSearchTerm+".."),searchNameTimeout=setTimeout(function(){api.emit("userExists",{username:newSearchTerm})},700)),searchElement.slideDown(80)):searchElement.slideUp(80)}function newNotification(icon,title,content,closeAfter,showWithFocus){if((!hasFocus||showWithFocus)&&!getProp("disableNotifications")){var newNotif;return hasFocus||closeAfter||(titleBadgeCount++,document.title="("+titleBadgeCount+") Subrosa",setFaviconBadge(titleBadgeCount)),title=$("#htmlToText").html(title).text(),content=$("#htmlToText").html(content).text(),title.length>100&&(title=title.substr(0,98)+".."),content.length>100&&(content=content.substr(0,98)+".."),Notification&&(newNotif=new Notification(title,{body:content,icon:icon})),showWithFocus||openNotifications.push(newNotif),closeAfter&&setTimeout(function(){newNotif.close?newNotif.close():newNotif.cancel&&newNotif.cancel()},closeAfter),newNotif}}function convButtonClick(){"addContactButton"==$(this).attr("id")?($(this).popover($(".addContactPopover")),$(".requestTextarea").val().length?$(".sendRequestBtn").removeClass("disabled"):$(".sendRequestBtn").addClass("disabled")):"moreButton"==$(this).attr("id")?$(this).popover($(".convMorePopover")):"removeFromList"==$(this).attr("id")||"removeFromListRoom"==$(this).attr("id")?(api.emit("removeList",{id:currentTab}),$("#moreButton").popover($(".convMorePopover")),removeList(currentTab)):"removeFromContacts"==$(this).attr("id")?(api.emit("removeContact",{id:currentTab}),layContent(!0,!1)):"acceptContactButton"==$(this).attr("id")?(api.emit("acceptContact",{id:currentTab}),layContent(!0,!1)):"newGroupChat"==$(this).attr("id")?(layRoomInviteUserList([appcore.list[appcore.listHash[currentTab]].uid],""),changeTabTo("meta")):"editGroupChat"==$(this).attr("id")?(layRoomEdit(currentTab),changeTabTo("gedit")):"inviteButton"==$(this).attr("id")?(layRoomInviteUserList([],currentTab),changeTabTo("meta")):"clearHistory"==$(this).attr("id")?(api.emit("clearHistory",{target:currentTab}),convBodyHolders[currentTab]={live:[],buffer:[]},$("#convText").text(""),$.modal("historyCleared")):"voiceButton"==$(this).attr("id")?$(this).hasClass("disabled")||(apprtc.supported?getProp("webrtcWarning")?20==currentTab.length||appcore.list[appcore.listHash[currentTab]].status>0?(api.emit("makeCall",{target:currentTab,type:"voice"}),layContent(!0,!1),$(this).addClass("disabled"),20==currentTab.length&&$("#videoButton").addClass("disabled")):$.modal("notOnline","show"):($("#p2pWarningContinue").attr("data-click","#voiceButton"),$.modal("p2pWarning"),api.emit("setProp",{name:"webrtcWarning",value:!0})):$.modal("callsNotSupported","show")):"videoButton"==$(this).attr("id")&&($(this).hasClass("disabled")||(apprtc.supported?getProp("webrtcWarning")?20==currentTab.length||appcore.list[appcore.listHash[currentTab]].status>0?(api.emit("makeCall",{target:currentTab,type:"video"}),layContent(!0,!1),$(this).addClass("disabled"),20==currentTab.length&&$("#voiceButton").addClass("disabled")):$.modal("notOnline","show"):($("#p2pWarningContinue").attr("data-click","#videoButton"),$.modal("p2pWarning"),api.emit("setProp",{name:"webrtcWarning",value:!0})):$.modal("callsNotSupported","show")))
}function startRinging(){$("#soundRinging")[0].volume=getProp("ringerVolume")!==!1?getProp("ringerVolume"):.7,$("#soundRinging")[0].loop=!0,$("#soundRinging")[0].play()}function stopRinging(){$("#soundRinging")[0].pause()}function startCallInput(group,type){navigator.getUserMedia({audio:!0,video:"video"==type},function(myMediaStream){return $("#overlay").css({opacity:0,"z-index":-100}),$("#permissionGuide").css({"z-index":-101}),appcall.mediaStream=myMediaStream,appcore.activeCall?void(group||appcore.activeCall.substr(4).split("-")[0]!=appcore.uid?rtcStart(appcall.mediaStream,group,"video"==type):setTimeout(function(){rtcStart(appcall.mediaStream,group,"video"==type)},400)):void stopCallInput()},function(error){alert("An error has occured. Please make sure you have allowed permission, and that no other programs are using the microphone/camera. See the console for more information."),console.log(error)}),setTimeout(function(){(!appcall.mediaStream||appcall.mediaStream.ended)&&($("#overlay").css({opacity:1,"z-index":1e4}),$("#permissionGuide").css({"z-index":1e4}))},50),appcall.callDurationInterval=setInterval(function(){appcall.callDuration++;var durationText=Math.floor(appcall.callDuration/60)+":"+(1==(appcall.callDuration%60).toString().length?"0"+appcall.callDuration%60:appcall.callDuration%60);$("#callDuration").text(durationText)},1e3)}function callUserUpdate(event,uid){"JOIN"==event?rtcUserJoin(uid):"QUIT"==event&&rtcUserQuit(uid)}function stopCallInput(){appcall.mediaStream&&appcall.mediaStream.stop(),$("#callDuration").text("0:00"),$("#voiceMute").removeClass("on"),$("#videoMute").removeClass("on"),$("#overlay").css({opacity:0,"z-index":-100}),$("#permissionGuide").css({"z-index":-101}),appcall.micMute=!1,appcall.videoMute=!1,rtcStop(),appcall.callDuration=0,clearInterval(appcall.callDurationInterval)}function setMicrophoneMute(muted){appcall.micMute=muted,appcall.mediaStream&&(appcall.mediaStream.getAudioTracks()[0].enabled=!muted)}function setVideoMute(muted){appcall.videoMute=muted,appcall.mediaStream&&appcall.mediaStream.getVideoTracks().length>=1&&(appcall.mediaStream.getVideoTracks()[0].enabled=!muted),rtcSetVideoMute(muted)}function randomChar(){var n=Math.floor(62*Math.random());return 10>n?n:String.fromCharCode(36>n?n+55:n+61)}function startMediaTest(){navigator.getUserMedia({audio:!0,video:!0},function(myMediaStream){if($("#overlay").css({opacity:0,"z-index":-100}),$("#permissionGuide").css({"z-index":-101}),appcall.mediaStream=myMediaStream,attachMediaStream($("#mediaTestVideo")[0],appcall.mediaStream),$("#mediaTestVideo")[0].volume=0,$("#mediaTestVideo")[0].play(),AudioContext){appcall.mediaTestAudioContext=new AudioContext,appcall.mediaTestMicrophone=appcall.mediaTestAudioContext.createMediaStreamSource(appcall.mediaStream),appcall.mediaTestVolume=appcall.mediaTestAudioContext.createGain(),appcall.mediaTestMicrophone.connect(appcall.mediaTestVolume),appcall.mediaTestNode=appcall.mediaTestAudioContext.createScriptProcessor?appcall.mediaTestAudioContext.createScriptProcessor(2048,1,1):appcall.mediaTestAudioContext.createJavascriptNode(2048,1,1),appcall.mediaTestVolume.connect(appcall.mediaTestNode),appcall.mediaTestNode.connect(appcall.mediaTestAudioContext.destination);var rollingActivity=[];appcall.mediaTestNode.onaudioprocess=function(event){for(var max=0,audioData=event.inputBuffer.getChannelData(0),length=audioData.length,i=0;length>i;i+=128){for(var sum=0,j=0;128>j;j++)sum+=audioData[i+j];sum>max&&(max=sum)}3==rollingActivity.length&&(rollingActivity=rollingActivity.splice(1)),rollingActivity.push(max/128);for(var rollingActivitySum=0,i=0;i<rollingActivity.length;i++)rollingActivitySum+=rollingActivity[i];$("#mediaTestAudioBar").find(".filling").css("width",Math.round(rollingActivitySum/3*80)+"px")}}},function(error){alert("An error has occured. Please make sure you have allowed permission, and that no other programs are using the microphone/camera. See the console for more information."),console.log(error)}),setTimeout(function(){(!appcall.mediaStream||appcall.mediaStream.ended)&&($("#overlay").css({opacity:1,"z-index":1e4}),$("#permissionGuide").css({"z-index":1e4}))},50)}function stopMediaTest(){appcall.mediaStream&&appcall.mediaStream.stop(),appcall.mediaTestMicrophone&&appcall.mediaTestMicrophone.disconnect(appcall.mediaTestVolume),appcall.mediaTestVolume&&appcall.mediaTestVolume.disconnect(appcall.mediaTestNode),appcall.mediaTestNode&&appcall.mediaTestNode.disconnect(appcall.mediaTestAudioContext)}function attachMediaStream(element,stream){"undefined"!=typeof element.srcObject?element.srcObject=stream:"undefined"!=typeof element.mozSrcObject?element.mozSrcObject=stream:"undefined"!=typeof element.src?element.src=URL.createObjectURL(stream):console.log("Error attaching stream to element.")}function rtcStart(mediaStream,group,video){apprtc.mediaStream=mediaStream,apprtc.group=group,apprtc.callVideo=video,video&&(apprtc.localVideoPanel=appcall.createVideoPanel(mediaStream,!0,!1,"")),rtcSendSignal({type:"ready"},null);var callUsers=appcore.list[appcore.listHash[appcore.activeCall]].active.callUsers;callUsers||(callUsers=appcore.activeCall.substr(4).split("-"));for(var i in callUsers)if(callUsers[i]!=appcore.uid){createPeerConnection(callUsers[i]);var pc=apprtc.pc[callUsers[i]];try{pc.addStream(mediaStream)}catch(error){alert("Error while sending mediaStream when I'm joining: "+error+" ; mediastream has "+apprtc.mediaStream.getAudioTracks().length+" audio tracks.")}}}function rtcUserJoin(uid){createPeerConnection(uid);try{apprtc.pc[uid].addStream(apprtc.mediaStream)}catch(error){alert("Error while sending mediaStream to new peer: "+error+" ; mediastream has "+apprtc.mediaStream.getAudioTracks().length+" audio tracks.")}}function rtcUserQuit(uid){apprtc.pc[uid]&&appcall.removeVideoPanel(apprtc.pc[uid].playerID)}function rtcStop(){if(apprtc.callVideo){appcall.removeVideoPanel(apprtc.localVideoPanel);for(var i in apprtc.pc)appcall.removeVideoPanel(apprtc.pc[i].playerID)}else for(var i in apprtc.pc)appcall.removeAudioPlayer(apprtc.pc[i].playerID);apprtc.mediaStream=null,apprtc.pc=[],apprtc.playerCount=0,apprtc.localVideoPanel=null,apprtc.callVideo=null}function createPeerConnection(uid){var pc=new RTCPeerConnection(apprtc.pc_config,apprtc.pc_constraints);apprtc.pc[uid]=pc,pc.uid=uid,pc.onicecandidate=function(event){event.candidate&&rtcSendSignal({type:"candidate",candidate:event.candidate},pc.uid)},pc.onaddstream=handleRemoteStreamAdded,pc.onremovestream=handleRemoteStreamRemoved,dataChannelsEnabled&&(isInitiator?(sendChannel=pc.createDataChannel("sendDataChannel",{reliable:!1}),sendChannel.onmessage=handleMessage,sendChannel.onopen=handleSendChannelStateChange,sendChannel.onclose=handleSendChannelStateChange):apprtc.pc[i].ondatachannel=gotReceiveChannel)}function rtcCall(pc){pc.createOffer(function(sessionDescription){pc.setLocalDescription(sessionDescription),rtcSendSignal({type:"offer",sessionDescription:sessionDescription},pc.uid)},function(error){alert(error)})}function rtcSetVideoMute(muted){apprtc.localVideoPanel&&(muted?$("#"+apprtc.localVideoPanel).find("video").hide():$("#"+apprtc.localVideoPanel).find("video").show())}function handleIceCandidate(){}function handleRemoteStreamAdded(event){var userItem=getUserItem(event.target.uid);apprtc.callVideo?appcall.createVideoPanel(event.stream,!1,event.target,userItem.displayname||userItem.username):appcall.createAudioPlayer(event.stream,!1,event.target,userItem.displayname||userItem.username),setTimeout(function(){verifyFingerprint(event.target.uid,apprtc.pc[event.target.uid].remoteDescription.sdp,apprtc.pc[event.target.uid].localDescription.sdp)},1e3)}function handleRemoteStreamRemoved(){console.log("handleRemoteStreamRemoved")}function handleMessage(){console.log("handleMessage")}function handleSendChannelStateChange(){console.log("handleSendChannelStateChange")}function gotReceiveChannel(){console.log("gotReceiveChannel")}function rtcProcessSignal(object,to,sender){"candidate"==object.type?setTimeout(function(){try{apprtc.pc[sender].addIceCandidate(new RTCIceCandidate(object.candidate)),console.log("successfully added candidate?")}catch(error){console.log("Error adding candidate "+object.candidate.length,error)}},500):"ready"==object.type?(apprtc.playerCount>0||!apprtc.callVideo&&apprtc.mediaStream)&&(apprtc.pc[sender].playerID||(rtcCall(apprtc.pc[sender]),rtcSendSignal({type:"ackReady"},sender))):"ackReady"==object.type&&to==appcore.uid?apprtc.pc[sender].playerID||rtcCall[apprtc.pc[sender]]:"offer"==object.type&&to==appcore.uid?apprtc.pc[sender]&&(apprtc.pc[sender].setRemoteDescription(new RTCSessionDescription(object.sessionDescription)),apprtc.pc[sender].createAnswer(function(sessionDescription){apprtc.pc[sender].setLocalDescription(sessionDescription),rtcSendSignal({type:"answer",sessionDescription:sessionDescription},sender)},function(){},apprtc.sdpVideoConstraints)):"answer"==object.type&&to==appcore.uid?apprtc.pc[sender]&&apprtc.pc[sender].setRemoteDescription(new RTCSessionDescription(object.sessionDescription)):console.log("Discarding RTC signal",object,to,sender)}function rtcSendSignal(object,to){api.emit("sendComm",{target:appcore.activeCall,type:10,message:{o:object,to:to}})}function verifyFingerprint(uid,remoteSdp,localSdp){var remoteFingerprint=remoteSdp.match(/^a=fingerprint:.+/m),localFingerprint=localSdp.match(/^a=fingerprint:.+/m);1==remoteFingerprint.length&&1==localFingerprint.length?(remoteFingerprint=remoteFingerprint[0],console.log("Remote fingerprint for "+uid+": "+remoteFingerprint),localFingerprint=localFingerprint[0],console.log("Local fingerprint for "+uid+": "+localFingerprint)):api.emit("dropCall",{target:appcore.activeCall}),api.emit("verifyFingerprint",{remoteFingerprint:remoteFingerprint,localFingerprint:localFingerprint,uid:uid})}!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function r(a){var b=a.length,c=m.type(a);return"function"===c||m.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}function D(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[m.camelCase(b)])):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}function ab(){return!0}function bb(){return!1}function cb(){try{return y.activeElement}catch(a){}}function db(a){var b=eb.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function ub(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ub(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function vb(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wb(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xb(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function yb(a){var b=pb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function zb(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Ab(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Bb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xb(b).text=a.text,yb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function Eb(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fb(a){var b=y,c=Db[a];return c||(c=Eb(a,b),"none"!==c&&c||(Cb=(Cb||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Cb[0].contentWindow||Cb[0].contentDocument).document,b.write(),b.close(),c=Eb(a,b),Cb.detach()),Db[a]=c),c}function Lb(a,b){return{get:function(){var c=a();return null!=c?c?void delete this.get:(this.get=b).apply(this,arguments):void 0}}}function Ub(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Tb.length;e--;)if(b=Tb[e]+c,b in a)return b;return d}function Vb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fb(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wb(a,b,c){var d=Pb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Yb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ib(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Jb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Hb.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xb(a,b,c||(g?"border":"content"),d,f)+"px"}function Zb(a,b,c,d,e){return new Zb.prototype.init(a,b,c,d,e)}function fc(){return setTimeout(function(){$b=void 0}),$b=m.now()}function gc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hc(a,b,c){for(var d,e=(ec[b]||[]).concat(ec["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ic(a,b,c){var d,e,f,g,h,i,j,l,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(h=m._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=m.css(a,"display"),l="none"===j?m._data(a,"olddisplay")||Fb(a.nodeName):j,"inline"===l&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fb(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ac.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fb(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hc(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function jc(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=m.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kc(a,b,c){var d,e,f=0,g=dc.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$b||fc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$b||fc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jc(k,j.opts.specialEasing);g>f;f++)if(d=dc[f].call(j,a,k,j.opts))return d;return m.map(k,hc,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function Lc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))for(;d=f[e++];)"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mc(a,b,c,d){function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}var e={},f=a===Ic;return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nc(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Oc(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function Vc(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rc.test(a)?d(a,e):Vc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vc(a+"["+e+"]",b[e],c,d)}function Zc(){try{return new a.XMLHttpRequest}catch(b){}}function $c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function dd(a){return m.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.1",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=r(a);if(c){if(g)for(;f>e&&(d=b.apply(a[e],c),d!==!1);e++);else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g)for(;f>e&&(d=b.call(a[e],e,a[e]),d!==!1);e++);else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if(c!==c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=r(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});var s=function(a){function fb(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],!a||"string"!=typeof a)return d;if(1!==(k=b.nodeType)&&9!==k)return[];if(p&&!e){if(f=_.exec(a))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return I.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return I.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=9===k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){for(o=g(a),(r=b.getAttribute("id"))?s=r.replace(bb,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;l--;)o[l]=s+qb(o[l]);w=ab.test(a)&&ob(b.parentNode)||b,x=o.join(",")}if(x)try{return I.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function gb(){function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}var a=[];return b}function hb(a){return a[u]=!0,a}function ib(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function jb(a,b){for(var c=a.split("|"),e=a.length;e--;)d.attrHandle[c[e]]=b}function kb(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||D)-(~a.sourceIndex||D);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function lb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function mb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function nb(a){return hb(function(b){return b=+b,hb(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function ob(a){return a&&typeof a.getElementsByTagName!==C&&a}function pb(){}function qb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function rb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function sb(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function tb(a,b,c){for(var d=0,e=b.length;e>d;d++)fb(a,b[d],c);return c}function ub(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function vb(a,b,c,d,e,f){return d&&!d[u]&&(d=vb(d)),e&&!e[u]&&(e=vb(e,f)),hb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||tb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ub(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=ub(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?K.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ub(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):I.apply(g,r)})}function wb(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=rb(function(a){return a===b},h,!0),l=rb(function(a){return K.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>i;i++)if(c=d.relative[a[i].type])m=[rb(sb(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e&&!d.relative[a[e].type];e++);return vb(i>1&&sb(m),i>1&&qb(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&wb(a.slice(i,e)),f>e&&wb(a=a.slice(e)),f>e&&qb(a))}m.push(c)}return sb(m)}function xb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){for(m=0;o=a[m++];)if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){for(m=0;o=b[m++];)o(r,s,g,h);if(f){if(p>0)for(;q--;)r[q]||s[q]||(s[q]=G.call(i));s=ub(s)}I.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&fb.uniqueSort(i)}return k&&(w=v,j=t),r};return c?hb(f):f}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+-new Date,v=a.document,w=0,x=0,y=gb(),z=gb(),A=gb(),B=function(a,b){return a===b&&(l=!0),0},C="undefined",D=1<<31,E={}.hasOwnProperty,F=[],G=F.pop,H=F.push,I=F.push,J=F.slice,K=F.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},L="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",N="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",O=N.replace("w","w#"),P="\\["+M+"*("+N+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+O+"))|)"+M+"*\\]",Q=":("+N+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+P+")*)|.*)\\)|)",R=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),S=new RegExp("^"+M+"*,"+M+"*"),T=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp("="+M+"*([^\\]'\"]*?)"+M+"*\\]","g"),V=new RegExp(Q),W=new RegExp("^"+O+"$"),X={ID:new RegExp("^#("+N+")"),CLASS:new RegExp("^\\.("+N+")"),TAG:new RegExp("^("+N.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+Q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+L+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ab=/[+~]/,bb=/'|\\/g,cb=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),db=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{I.apply(F=J.call(v.childNodes),v.childNodes),F[v.childNodes.length].nodeType}catch(eb){I={apply:F.length?function(a,b){H.apply(a,J.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}c=fb.support={},f=fb.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fb.setDocument=function(a){var b,e=a?a.ownerDocument||a:v,g=e.defaultView;return e!==n&&9===e.nodeType&&e.documentElement?(n=e,o=e.documentElement,p=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){m()},!1):g.attachEvent&&g.attachEvent("onunload",function(){m()})),c.attributes=ib(function(a){return a.className="i",!a.getAttribute("className")
}),c.getElementsByTagName=ib(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(e.getElementsByClassName)&&ib(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=ib(function(a){return o.appendChild(a).id=u,!e.getElementsByName||!e.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==C&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(cb,db);return function(a){var c=typeof a.getAttributeNode!==C&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==C?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==C&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(e.querySelectorAll))&&(ib(function(a){a.innerHTML="<select msallowclip=''><option selected=''></option></select>",a.querySelectorAll("[msallowclip^='']").length&&q.push("[*^$]="+M+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+M+"*(?:value|"+L+")"),a.querySelectorAll(":checked").length||q.push(":checked")}),ib(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+M+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ib(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",Q)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===v&&t(v,a)?-1:b===e||b.ownerDocument===v&&t(v,b)?1:k?K.call(k,a)-K.call(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:k?K.call(k,a)-K.call(k,b):0;if(f===g)return kb(a,b);for(c=a;c=c.parentNode;)h.unshift(c);for(c=b;c=c.parentNode;)i.unshift(c);for(;h[d]===i[d];)d++;return d?kb(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},e):n},fb.matches=function(a,b){return fb(a,null,null,b)},fb.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fb(b,n,null,[a]).length>0},fb.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fb.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&E.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fb.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fb.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){for(;b=a[f++];)b===a[f]&&(e=d.push(f));for(;e--;)a.splice(d[e],1)}return k=null,a},e=fb.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else for(;b=a[d++];)c+=e(b);return c},d=fb.selectors={cacheLength:50,createPseudo:hb,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(cb,db),a[3]=(a[3]||a[4]||a[5]||"").replace(cb,db),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fb.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fb.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(cb,db).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+M+")"+a+"("+M+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==C&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fb.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[u]||(l[u]={}))[a]=[w,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fb.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?hb(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=K.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:hb(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?hb(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:hb(function(a){return function(b){return fb(a,b).length>0}}),contains:hb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:hb(function(a){return W.test(a||"")||fb.error("unsupported lang: "+a),a=a.replace(cb,db).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:nb(function(){return[0]}),last:nb(function(a,b){return[b-1]}),eq:nb(function(a,b,c){return[0>c?c+b:c]}),even:nb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:nb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:nb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:nb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=lb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=mb(b);return pb.prototype=d.filters=d.pseudos,d.setFilters=new pb,g=fb.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=d.preFilter;h;){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fb.error(a):z(a,i).slice(0)},h=fb.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){for(b||(b=g(a)),c=b.length;c--;)f=wb(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xb(e,d)),f.selector=a}return f},i=fb.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(cb,db),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}for(i=X.needsContext.test(a)?0:j.length;i--&&(k=j[i],!d.relative[l=k.type]);)if((m=d.find[l])&&(f=m(k.matches[0].replace(cb,db),ab.test(j[0].type)&&ob(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qb(j),!a)return I.apply(e,f),e;break}}return(n||h(a,o))(f,b,!p,e,ab.test(a)&&ob(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ib(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ib(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||jb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ib(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||jb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ib(function(a){return null==a.getAttribute("disabled")})||jb(L,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fb}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=y.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?"undefined"!=typeof x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))};A.prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){for(var d=[],e=a[b];e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c));)1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};m.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):m.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){for(var d;(d=m.inArray(c,h,d))>-1;)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var i,j,k,b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}};if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(a===!0?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,a!==!0&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}}),m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var L,K="undefined";for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?m.cache[a[m.expando]]:a[m.expando],!!a&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d])));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b),g=function(){m.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=m._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){for(c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(E)||[""],h=b.length;h--;)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){for(b=(b||"").match(E)||[""],j=b.length;j--;)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){for(l=m.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,n=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;f--;)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}for(n=0;(h=o[n++])&&!b.isPropagationStopped();)b.type=n>1?i:k.bindType||p,f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){l=d[g],l&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=m.event.handlers.call(this,a,j),b=0;(f=h[b++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,g=0;(e=f.handlers[g++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==cb()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===cb()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?ab:bb):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:bb,isPropagationStopped:bb,isImmediatePropagationStopped:bb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=ab,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=ab,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=ab,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return m.nodeName(this,"form")?!1:void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return m.nodeName(this,"form")?!1:void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)
}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=bb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=bb),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});var eb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fb=/ jQuery\d+="(?:null|\d+)"/g,gb=new RegExp("<(?:"+eb+")[\\s/>]","i"),hb=/^\s+/,ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,jb=/<([\w:]+)/,kb=/<tbody/i,lb=/<|&#?\w+;/,mb=/<(?:script|style|link)/i,nb=/checked\s*(?:[^=]|=\s*.checked.)/i,ob=/^$|\/(?:java|ecma)script/i,pb=/^true\/(.*)/,qb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,rb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sb=db(y),tb=sb.appendChild(y.createElement("div"));rb.optgroup=rb.option,rb.tbody=rb.tfoot=rb.colgroup=rb.caption=rb.thead,rb.th=rb.td,m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!gb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(tb.innerHTML=a.outerHTML,tb.removeChild(f=tb.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ub(f),h=ub(a),g=0;null!=(e=h[g]);++g)d[g]&&Bb(e,d[g]);if(b)if(c)for(h=h||ub(a),d=d||ub(f),g=0;null!=(e=h[g]);g++)Ab(e,d[g]);else Ab(a,f);return d=ub(f,"script"),d.length>0&&zb(d,!i&&ub(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=db(b),p=[],q=0;n>q;q++)if(f=a[q],f||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(lb.test(f)){for(h=h||o.appendChild(b.createElement("div")),i=(jb.exec(f)||["",""])[1].toLowerCase(),l=rb[i]||rb._default,h.innerHTML=l[1]+f.replace(ib,"<$1></$2>")+l[2],e=l[0];e--;)h=h.lastChild;if(!k.leadingWhitespace&&hb.test(f)&&p.push(b.createTextNode(hb.exec(f)[0])),!k.tbody)for(f="table"!==i||kb.test(f)?"<table>"!==l[1]||kb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;e--;)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(m.merge(p,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));for(h&&o.removeChild(h),k.appendChecked||m.grep(ub(p,"input"),vb),q=0;f=p[q++];)if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ub(o.appendChild(f),"script"),g&&zb(h),c))for(e=0;f=h[e++];)ob.test(f.type||"")&&c.push(f);return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ub(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&zb(ub(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&m.cleanData(ub(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fb,""):void 0;if(!("string"!=typeof a||mb.test(a)||!k.htmlSerialize&&gb.test(a)||!k.leadingWhitespace&&hb.test(a)||rb[(jb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ib,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(m.cleanData(ub(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ub(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&nb.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=m.map(ub(i,"script"),xb),f=g.length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ub(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,yb),j=0;f>j;j++)d=g[j],ob.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qb,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Cb,Db={};!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=y.getElementsByTagName("body")[0],c&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Ib,Jb,Gb=/^margin/,Hb=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Kb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ib=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Hb.test(g)&&Gb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ib=function(a){return a.currentStyle},Jb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ib(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Hb.test(g)&&!Kb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"}),!function(){function i(){var b,c,d,i;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",g=0===i[0].offsetHeight,g&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}var b,c,d,e,f,g,h;b=y.createElement("div"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],(c=d&&d.style)&&(c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}}))}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Mb=/alpha\([^)]*\)/i,Nb=/opacity\s*=\s*([^)]*)/,Ob=/^(none|table(?!-c[ea]).+)/,Pb=new RegExp("^("+S+")(.*)$","i"),Qb=new RegExp("^([+-])=("+S+")","i"),Rb={position:"absolute",visibility:"hidden",display:"block"},Sb={letterSpacing:"0",fontWeight:"400"},Tb=["Webkit","O","Moz","ms"];m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Jb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ub(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Qb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ub(a.style,h)),g=m.cssHooks[b]||m.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Jb(a,b,d)),"normal"===f&&b in Sb&&(f=Sb[b]),""===c||c?(e=parseFloat(f),c===!0||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Ob.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Rb,function(){return Yb(a,b,d)}):Yb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ib(a);return Wb(a,c,d?Xb(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Nb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Mb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Mb.test(f)?f.replace(Mb,e):f+" "+e)}}),m.cssHooks.marginRight=Lb(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Jb,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Gb.test(a)||(m.cssHooks[a+b].set=Wb)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ib(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Vb(this,!0)},hide:function(){return Vb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}}),m.Tween=Zb,Zb.prototype={constructor:Zb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")},cur:function(){var a=Zb.propHooks[this.prop];return a&&a.get?a.get(this):Zb.propHooks._default.get(this)},run:function(a){var b,c=Zb.propHooks[this.prop];return this.pos=b=this.options.duration?m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Zb.propHooks._default.set(this),this}},Zb.prototype.init.prototype=Zb.prototype,Zb.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Zb.propHooks.scrollTop=Zb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Zb.prototype.init,m.fx.step={};var $b,_b,ac=/^(?:toggle|show|hide)$/,bc=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cc=/queueHooks$/,dc=[ic],ec={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bc.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bc.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,m.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};m.Animation=m.extend(kc,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ec[c]=ec[c]||[],ec[c].unshift(b)},prefilter:function(a,b){b?dc.unshift(a):dc.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kc(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gc(b,!0),a,d,e)}}),m.each({slideDown:gc("show"),slideUp:gc("hide"),slideToggle:gc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($b=m.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$b=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_b||(_b=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_b),_b=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;b=y.createElement("div"),b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=y.createElement("select"),e=c.appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,a=y.createElement("input"),a.setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lc=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,m(this).val()):a,null==e?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))})):e?(b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(lc,""):null==c?"":c)):void 0}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=m.makeArray(b),g=e.length;g--;)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mc,nc,oc=m.expr.attrHandle,pc=/^(?:checked|selected)$/i,qc=k.getSetAttribute,rc=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;return a&&3!==f&&8!==f&&2!==f?typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nc:mc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=m.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b)):void 0},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)for(;c=f[e++];)d=m.propFix[c]||c,m.expr.match.bool.test(c)?rc&&qc||!pc.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qc?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nc={set:function(a,b,c){return b===!1?m.removeAttr(a,c):rc&&qc||!pc.test(c)?a.setAttribute(!qc&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=oc[b]||m.find.attr;oc[b]=rc&&qc||!pc.test(b)?function(a,b,d){var e,f;return d||(f=oc[b],oc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,oc[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rc&&qc||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mc&&mc.set(a,b,c)}}),qc||(mc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},oc.id=oc.name=oc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mc.set},m.attrHooks.contenteditable={set:function(a,b,c){mc.set(a,""===b?!1:b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sc=/^(?:input|select|textarea|button|object)$/i,tc=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;return a&&3!==g&&8!==g&&2!==g?(f=1!==g||!m.isXMLDoc(a),f&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]):void 0},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sc.test(a.nodeName)||tc.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var uc=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(uc," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=m(this),f=a.match(E)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||a===!1?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(uc," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vc=m.now(),wc=/\?/,xc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yc,zc,Ac=/#.*$/,Bc=/([?&])_=[^&]*/,Cc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Dc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Ec=/^(?:GET|HEAD)$/,Fc=/^\/\//,Gc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hc={},Ic={},Jc="*/".concat("*");try{zc=location.href}catch(Kc){zc=y.createElement("a"),zc.href="",zc=zc.href}yc=Gc.exec(zc.toLowerCase())||[],m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zc,type:"GET",isLocal:Dc.test(yc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nc(Nc(a,m.ajaxSettings),b):Nc(m.ajaxSettings,a)},ajaxPrefilter:Lc(Hc),ajaxTransport:Lc(Ic),ajax:function(a,b){function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Oc(k,v,c)),u=Pc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(m.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j)for(j={};b=Cc.exec(f);)j[b[1].toLowerCase()]=b[2];b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zc)+"").replace(Ac,"").replace(Fc,yc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yc[1]&&c[2]===yc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yc[3]||("http:"===yc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mc(Hc,k,b,v),2===t)return v;h=k.global,h&&0===m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Ec.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wc.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Bc.test(e)?e.replace(Bc,"$1_="+vc++):e+(wc.test(e)?"&":"?")+"_="+vc++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();
u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mc(Ic,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qc=/%20/g,Rc=/\[\]$/,Sc=/\r?\n/g,Tc=/^(?:submit|button|image|reset|file)$/i,Uc=/^(?:input|select|textarea|keygen)/i;m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vc(c,a[c],b,e);return d.join("&").replace(Qc,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Uc.test(this.nodeName)&&!Tc.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sc,"\r\n")}}):{name:b.name,value:c.replace(Sc,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zc()||$c()}:Zc;var Wc=0,Xc={},Yc=m.ajaxSettings.xhr();a.ActiveXObject&&m(a).on("unload",function(){for(var a in Xc)Xc[a](void 0,!0)}),k.cors=!!Yc&&"withCredentials"in Yc,Yc=k.ajax=!!Yc,Yc&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xc[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}}),m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){b=y.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _c=[],ad=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_c.pop()||m.expando+"_"+vc++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(ad.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ad.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ad,"$1"+e):b.jsonp!==!1&&(b.url+=(wc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_c.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bd=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bd)return bd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cd=a.document.documentElement;m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),j=("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;return f?(b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dd(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d):void 0},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||cd;a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position");)a=a.offsetParent;return a||cd})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dd(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=Lb(k.pixelPosition,function(a,c){return c?(c=Jb(a,b),Hb.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ed=a.jQuery,fd=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fd),b&&a.jQuery===m&&(a.jQuery=ed),m},typeof b===K&&(a.jQuery=a.$=m),m}),function(e,t){"function"==typeof define&&define.amd?define([],t):e.forge=t()}(this,function(){var e,t,n;return function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&"."===e.charAt(0))if(t){for(v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e),c=0;c<e.length;c+=1)if(p=e[c],"."===p)e.splice(c,1),c-=1;else if(".."===p){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((v||g)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),v)for(h=v.length;h>0;h-=1)if(i=m[v.slice(0,h).join("/")],i&&(i=i[r])){s=i,u=c;break}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?e=n&&n.normalize?n.normalize(e,y(t)):m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return"undefined"!=typeof t?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,E,m=[],y=typeof n;if(i=i||e,"undefined"===y||"function"===y){for(t=!t.length&&n.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(p=o(t[d],i),l=p.f,"require"===l)m[d]=u.require(e);else if("exports"===l)m[d]=u.exports(e),E=!0;else if("module"===l)s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}h=n?n.apply(a[e],m):void 0,e&&(s&&s.exports!==r&&s.exports!==a[e]?a[e]=s.exports:h===r&&E||(a[e]=h))}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if("string"==typeof e)return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){if(l=e,l.deps&&s(l.deps,l.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("node_modules/almond/almond",function(){}),function(){function e(e){var t=e.util=e.util||{};"undefined"!=typeof process&&process.nextTick?(t.nextTick=process.nextTick,t.setImmediate="function"==typeof setImmediate?setImmediate:t.nextTick):"function"==typeof setImmediate?(t.setImmediate=setImmediate,t.nextTick=function(e){return setImmediate(e)}):(t.setImmediate=function(e){setTimeout(e,0)},t.nextTick=t.setImmediate),t.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.isArrayBuffer=function(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer};var n=[];"undefined"!=typeof Int8Array&&n.push(Int8Array),"undefined"!=typeof Uint8Array&&n.push(Uint8Array),"undefined"!=typeof Uint8ClampedArray&&n.push(Uint8ClampedArray),"undefined"!=typeof Int16Array&&n.push(Int16Array),"undefined"!=typeof Uint16Array&&n.push(Uint16Array),"undefined"!=typeof Int32Array&&n.push(Int32Array),"undefined"!=typeof Uint32Array&&n.push(Uint32Array),"undefined"!=typeof Float32Array&&n.push(Float32Array),"undefined"!=typeof Float64Array&&n.push(Float64Array),t.isArrayBufferView=function(e){for(var t=0;t<n.length;++t)if(e instanceof n[t])return!0;return!1},t.ByteBuffer=function(e){if(this.data="",this.read=0,"string"==typeof e)this.data=e;else if(t.isArrayBuffer(e)||t.isArrayBufferView(e)){var n=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,n)}catch(r){for(var i=0;i<n.length;++i)this.putByte(n[i])}}else e instanceof t.ByteBuffer?(this.data=e.data,this.read=e.read):"object"==typeof e&&"data"in e&&"read"in e&&"string"==typeof e.data&&"number"==typeof e.read&&(this.data=e.data,this.read=e.read)},t.ByteBuffer.prototype.length=function(){return this.data.length-this.read},t.ByteBuffer.prototype.isEmpty=function(){return this.length()<=0},t.ByteBuffer.prototype.putByte=function(e){return this.data+=String.fromCharCode(e),this},t.ByteBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var n=this.data;t>0;)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return this.data=n,this},t.ByteBuffer.prototype.putBytes=function(e){return this.data+=e,this},t.ByteBuffer.prototype.putString=function(e){return this.data+=t.encodeUtf8(e),this},t.ByteBuffer.prototype.putInt16=function(e){return this.data+=String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},t.ByteBuffer.prototype.putInt24=function(e){return this.data+=String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},t.ByteBuffer.prototype.putInt32=function(e){return this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e),this},t.ByteBuffer.prototype.putInt16Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255),this},t.ByteBuffer.prototype.putInt24Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255),this},t.ByteBuffer.prototype.putInt32Le=function(e){return this.data+=String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255),this},t.ByteBuffer.prototype.putInt=function(e,t){do t-=8,this.data+=String.fromCharCode(e>>t&255);while(t>0);return this},t.ByteBuffer.prototype.putSignedInt=function(e,t){return 0>e&&(e+=2<<t-1),this.putInt(e,t)},t.ByteBuffer.prototype.putBuffer=function(e){return this.data+=e.getBytes(),this},t.ByteBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},t.ByteBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},t.ByteBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},t.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},t.ByteBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},t.ByteBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},t.ByteBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},t.ByteBuffer.prototype.getInt=function(e){var t=0;do t=(t<<8)+this.data.charCodeAt(this.read++),e-=8;while(e>0);return t},t.ByteBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},t.ByteBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},t.ByteBuffer.prototype.bytes=function(e){return"undefined"==typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},t.ByteBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},t.ByteBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},t.ByteBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},t.ByteBuffer.prototype.copy=function(){var e=t.createBuffer(this.data);return e.read=this.read,e},t.ByteBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},t.ByteBuffer.prototype.clear=function(){return this.data="",this.read=0,this},t.ByteBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},t.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);16>n&&(e+="0"),e+=n.toString(16)}return e},t.ByteBuffer.prototype.toString=function(){return t.decodeUtf8(this.bytes())},t.createBuffer=function(e,n){return n=n||"raw",void 0!==e&&"utf8"===n&&(e=t.encodeUtf8(e)),new t.ByteBuffer(e)},t.fillString=function(e,t){for(var n="";t>0;)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return n},t.xorBytes=function(e,t,n){for(var r="",i="",s="",o=0,u=0;n>0;--n,++o)i=e.charCodeAt(o)^t.charCodeAt(o),u>=10&&(r+=s,s="",u=0),s+=String.fromCharCode(i),++u;return r+=s},t.hexToBytes=function(e){var t="",n=0;for(e.length&!0&&(n=1,t+=String.fromCharCode(parseInt(e[0],16)));n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t},t.bytesToHex=function(e){return t.createBuffer(e).toHex()},t.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];t.encode64=function(e,t){for(var s,o,u,n="",i="",a=0;a<e.length;)s=e.charCodeAt(a++),o=e.charCodeAt(a++),u=e.charCodeAt(a++),n+=r.charAt(s>>2),n+=r.charAt((3&s)<<4|o>>4),isNaN(o)?n+="==":(n+=r.charAt((15&o)<<2|u>>6),n+=isNaN(u)?"=":r.charAt(63&u)),t&&n.length>t&&(i+=n.substr(0,t)+"\r\n",n=n.substr(t));return i+=n},t.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var n,r,s,o,t="",u=0;u<e.length;)n=i[e.charCodeAt(u++)-43],r=i[e.charCodeAt(u++)-43],s=i[e.charCodeAt(u++)-43],o=i[e.charCodeAt(u++)-43],t+=String.fromCharCode(n<<2|r>>4),64!==s&&(t+=String.fromCharCode((15&r)<<4|s>>2),64!==o&&(t+=String.fromCharCode((3&s)<<6|o)));return t},t.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},t.decodeUtf8=function(e){return decodeURIComponent(escape(e))},t.deflate=function(e,n,r){if(n=t.decode64(e.deflate(t.encode64(n)).rval),r){var i=2,s=n.charCodeAt(1);32&s&&(i=6),n=n.substring(i,n.length-4)}return n},t.inflate=function(e,n){var i=e.inflate(t.encode64(n)).rval;return null===i?null:t.decode64(i)};var s=function(e,n,r){if(!e)throw{message:"WebStorage not available."};var i;if(null===r?i=e.removeItem(n):(r=t.encode64(JSON.stringify(r)),i=e.setItem(n,r)),"undefined"!=typeof i&&i.rval!==!0)throw i.error},o=function(e,n){if(!e)throw{message:"WebStorage not available."};var r=e.getItem(n);if(e.init)if(null===r.rval){if(r.error)throw r.error;r=null}else r=r.rval;return null!==r&&(r=JSON.parse(t.decode64(r))),r},u=function(e,t,n,r){var i=o(e,t);null===i&&(i={}),i[n]=r,s(e,t,i)},a=function(e,t,n){var r=o(e,t);return null!==r&&(r=n in r?r[n]:null),r},f=function(e,t,n){var r=o(e,t);if(null!==r&&n in r){delete r[n];var i=!0;for(var u in r){i=!1;break}i&&(r=null),s(e,t,r)}},l=function(e,t){s(e,t,null)},c=function(e,t,n){var r=null;"undefined"==typeof n&&(n=["web","flash"]);var i,s=!1,o=null;for(var u in n){i=n[u];try{if("flash"===i||"both"===i){if(null===t[0])throw{message:"Flash local storage not available."};r=e.apply(this,t),s="flash"===i}("web"===i||"both"===i)&&(t[0]=localStorage,r=e.apply(this,t),s=!0)}catch(a){o=a}if(s)break}if(!s)throw o;return r};t.setItem=function(e,t,n,r,i){c(u,arguments,i)},t.getItem=function(e,t,n,r){return c(a,arguments,r)},t.removeItem=function(e,t,n,r){c(f,arguments,r)},t.clearItems=function(e,t,n){c(l,arguments,n)},t.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var n=t.exec(e),r=null===n?null:{full:e,scheme:n[1],host:n[2],port:n[3],path:n[4]};return r&&(r.fullHost=r.host,r.port?80!==r.port&&"http"===r.scheme?r.fullHost+=":"+r.port:443!==r.port&&"https"===r.scheme&&(r.fullHost+=":"+r.port):"http"===r.scheme?r.port=80:"https"===r.scheme&&(r.port=443),r.full=r.scheme+"://"+r.fullHost),r};var h=null;t.getQueryVariables=function(e){var n,t=function(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var s,o,i=n[r].indexOf("=");i>0?(s=n[r].substring(0,i),o=n[r].substring(i+1)):(s=n[r],o=null),s in t||(t[s]=[]),!(s in Object.prototype)&&null!==o&&t[s].push(unescape(o))}return t};return"undefined"==typeof e?(null===h&&(h="undefined"==typeof window?{}:t(window.location.search.substring(1))),n=h):n=t(e),n},t.parseFragment=function(e){var n=e,r="",i=e.indexOf("?");i>0&&(n=e.substring(0,i),r=e.substring(i+1));var s=n.split("/");s.length>0&&""===s[0]&&s.shift();var o=""===r?{}:t.getQueryVariables(r);return{pathString:n,queryString:r,path:s,query:o}},t.makeRequest=function(e){var n=t.parseFragment(e),r={path:n.pathString,query:n.queryString,getPath:function(e){return"undefined"==typeof e?n.path:n.path[e]},getQuery:function(e,t){var r;return"undefined"==typeof e?r=n.query:(r=n.query[e],r&&"undefined"!=typeof t&&(r=r[t])),r},getQueryLast:function(e,t){var n,i=r.getQuery(e);return n=i?i[i.length-1]:t}};return r},t.makeLink=function(e,t,n){e=jQuery.isArray(e)?e.join("/"):e;var r=jQuery.param(t||{});return n=n||"",e+(r.length>0?"?"+r:"")+(n.length>0?"#"+n:"")},t.setPath=function(e,t,n){if("object"==typeof e&&null!==e)for(var r=0,i=t.length;i>r;){var s=t[r++];if(r==i)e[s]=n;else{var o=s in e;(!o||o&&"object"!=typeof e[s]||o&&null===e[s])&&(e[s]={}),e=e[s]}}},t.getPath=function(e,t,n){for(var r=0,i=t.length,s=!0;s&&i>r&&"object"==typeof e&&null!==e;){var o=t[r++];s=o in e,s&&(e=e[o])}return s?e:n},t.deletePath=function(e,t){if("object"==typeof e&&null!==e)for(var n=0,r=t.length;r>n;){var i=t[n++];if(n==r)delete e[i];else{if(!(i in e&&"object"==typeof e[i]&&null!==e[i]))break;e=e[i]}}},t.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},t.format=function(e){for(var n,r,t=/%./g,i=0,s=[],o=0;n=t.exec(e);){r=e.substring(o,t.lastIndex-2),r.length>0&&s.push(r),o=t.lastIndex;var u=n[0][1];switch(u){case"s":case"o":s.push(i<arguments.length?arguments[i++ +1]:"<?>");break;case"%":s.push("%");break;default:s.push("<%"+u+"?>")}}return s.push(e.substring(o)),s.join("")},t.formatNumber=function(e,t,n,r){var i=e,s=isNaN(t=Math.abs(t))?2:t,o=void 0===n?",":n,u=void 0===r?".":r,a=0>i?"-":"",f=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",l=f.length>3?f.length%3:0;return a+(l?f.substr(0,l)+u:"")+f.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+u)+(s?o+Math.abs(i-f).toFixed(s).slice(2):"")},t.formatSize=function(e){return e=e>=1073741824?t.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?t.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?t.formatNumber(e/1024,0)+" KiB":t.formatNumber(e,0)+" bytes"},t.bytesFromIP=function(e){return-1!==e.indexOf(".")?t.bytesFromIPv4(e):-1!==e.indexOf(":")?t.bytesFromIPv6(e):null},t.bytesFromIPv4=function(e){if(e=e.split("."),4!==e.length)return null;for(var n=t.createBuffer(),r=0;r<e.length;++r){var i=parseInt(e[r],10);if(isNaN(i))return null;n.putByte(i)}return n.getBytes()},t.bytesFromIPv6=function(e){var n=0;e=e.split(":").filter(function(e){return 0===e.length&&++n,!0});for(var r=2*(8-e.length+n),i=t.createBuffer(),s=0;8>s;++s)if(e[s]&&0!==e[s].length){var o=t.hexToBytes(e[s]);o.length<2&&i.putByte(0),i.putBytes(o)}else i.fillWithByte(0,r),r=0;return i.getBytes()},t.bytesToIP=function(e){return 4===e.length?t.bytesToIPv4(e):16===e.length?t.bytesToIPv6(e):null},t.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t.join(".")},t.bytesToIPv6=function(e){if(16!==e.length)return null;for(var n=[],r=[],i=0,s=0;s<e.length;s+=2){for(var o=t.bytesToHex(e[s]+e[s+1]);"0"===o[0]&&"0"!==o;)o=o.substr(1);if("0"===o){var u=r[r.length-1],a=n.length;u&&a===u.end+1?(u.end=a,u.end-u.start>r[i].end-r[i].start&&(i=r.length-1)):r.push({start:a,end:a})}n.push(o)}if(r.length>0){var f=r[i];f.end-f.start>0&&(n.splice(f.start,f.end-f.start+1,""),0===f.start&&n.unshift(""),7===f.end&&n.push(""))}return n.join(":")},t.estimateCores=function(e,n){function i(e,u,a){if(0===u){var f=Math.floor(e.reduce(function(e,t){return e+t},0)/e.length);return t.cores=Math.max(1,f),URL.revokeObjectURL(r),n(null,t.cores)}s(a,function(t,n){e.push(o(a,n)),i(e,u-1,a)})}function s(e,t){for(var n=[],i=[],s=0;e>s;++s){var o=new Worker(r);o.addEventListener("message",function(r){if(i.push(r.data),i.length===e){for(var s=0;e>s;++s)n[s].terminate();t(null,i)}}),n.push(o)}for(var s=0;e>s;++s)n[s].postMessage(s)}function o(e,t){for(var n=[],r=0;e>r;++r)for(var i=t[r],s=n[r]=[],o=0;e>o;++o)if(r!==o){var u=t[o];(i.st>u.st&&i.st<u.et||u.st>i.st&&u.st<i.et)&&s.push(o)}return n.reduce(function(e,t){return Math.max(e,t.length)},0)}if("function"==typeof e&&(n=e,e={}),e=e||{},"cores"in t&&!e.update)return n(null,t.cores);if(void 0===typeof Worker)return t.cores=1,n(null,t.cores);if(void 0===typeof Blob)return t.cores=2,n(null,t.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(){for(var t=Date.now(),n=t+4;Date.now()<n;);self.postMessage({st:t,et:n})})}.toString(),")()"],{type:"application/javascript"}));i([],5,16)}}var r="util";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/util",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.cipher=e.cipher||{},e.cipher.algorithms=e.cipher.algorithms||{},e.cipher.createCipher=function(t,n){var r=t;if("string"==typeof r&&(r=e.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new e.cipher.BlockCipher({algorithm:r,key:n,decrypt:!1})},e.cipher.createDecipher=function(t,n){var r=t;if("string"==typeof r&&(r=e.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new e.cipher.BlockCipher({algorithm:r,key:n,decrypt:!0})},e.cipher.registerAlgorithm=function(t,n){t=t.toUpperCase(),e.cipher.algorithms[t]=n},e.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in e.cipher.algorithms?e.cipher.algorithms[t]:null};var t=e.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};t.prototype.start=function(t){t=t||{},this._finish=!1,this._input=e.util.createBuffer(),this.output=t.output||e.util.createBuffer(),this.mode.start(t)},t.prototype.update=function(e){for(this._finish||this._input.putBuffer(e);this._input.length()>=this.blockSize||this._input.length()>0&&this._finish;)this._op.call(this.mode,this._input,this.output);this._input.compact()},t.prototype.finish=function(e){e&&"CBC"===this.mode.name&&(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.overflow=this._input.length()%this.blockSize,this._decrypt||!this.mode.pad||this.mode.pad(this._input,t)?(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t)?!1:this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)?!1:!0):!1}}var r="cipher";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/cipher",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(t){if("string"==typeof t&&(t=e.util.createBuffer(t)),e.util.isArray(t)&&t.length>4){var n=t;t=e.util.createBuffer();for(var r=0;r<t.length;++r)t.putByte(n[r])}return e.util.isArray(t)||(t=[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()]),t}function r(e){e[e.length-1]=e[e.length-1]+1&4294967295}function i(e){return[e/4294967296|0,4294967295&e]}e.cipher=e.cipher||{};var t=e.cipher.modes=e.cipher.modes||{};t.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)},t.ecb.prototype.start=function(){},t.ecb.prototype.encrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._outBlock[n])},t.ecb.prototype.decrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._outBlock[n])},t.ecb.prototype.pad=function(e){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},t.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return r>this.blockSize<<2?!1:(e.truncate(r),!0)},t.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks)
},t.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._prev=this._iv.slice(0)}},t.cbc.prototype.encrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},t.cbc.prototype.decrypt=function(e,t){for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},t.cbc.prototype.pad=function(e){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},t.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return r>this.blockSize<<2?!1:(e.truncate(r),!0)},t.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks)},t.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0)},t.cfb.prototype.encrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32()^this._outBlock[n],t.putInt32(this._inBlock[n])},t.cfb.prototype.decrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)this._inBlock[n]=e.getInt32(),t.putInt32(this._inBlock[n]^this._outBlock[n])},t.cfb.prototype.afterFinish=function(e,t){return t.overflow>0&&e.truncate(this.blockSize-t.overflow),!0},t.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks)},t.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0)},t.ofb.prototype.encrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._blocks;++n)t.putInt32(e.getInt32()^this._outBlock[n]),this._inBlock[n]=this._outBlock[n]},t.ofb.prototype.decrypt=t.ofb.prototype.encrypt,t.ofb.prototype.afterFinish=function(e,t){return t.overflow>0&&e.truncate(this.blockSize-t.overflow),!0},t.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._blocks)},t.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=n(e.iv),this._inBlock=this._iv.slice(0)},t.ctr.prototype.encrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock);for(var n=0;n<this._blocks;++n)t.putInt32(e.getInt32()^this._outBlock[n])},t.ctr.prototype.decrypt=t.ctr.prototype.encrypt,t.ctr.prototype.afterFinish=function(e,t){return t.overflow>0&&e.truncate(this.blockSize-t.overflow),!0},t.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._blocks=this.blockSize/4,this._inBlock=new Array(this._blocks),this._outBlock=new Array(this._blocks),this._R=3774873600},t.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var n=e.util.createBuffer(t.iv);this._cipherLength=0;var s;s="additionalData"in t?e.util.createBuffer(t.additionalData):e.util.createBuffer(),this._tagLength="tagLength"in t?t.tagLength:128,this._tag=e.util.createBuffer(t.tag).getBytes(),this._hashBlock=new Array(this._blocks),this.tag=null,this._hashSubkey=new Array(this._blocks),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var o=n.length();if(12===o)this._j0=[n.getInt32(),n.getInt32(),n.getInt32(),1];else{for(this._j0=[0,0,0,0];n.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(i(8*o)))}this._inBlock=this._j0.slice(0),r(this._inBlock),s=e.util.createBuffer(s),this._aDataLength=i(8*s.length());var u=s.length()%this.blockSize;for(u&&s.fillWithByte(0,this.blockSize-u),this._s=[0,0,0,0];s.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[s.getInt32(),s.getInt32(),s.getInt32(),s.getInt32()])},t.gcm.prototype.encrypt=function(t,n){this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock);for(var i=t.length(),s=0;s<this._blocks;++s)this._outBlock[s]^=t.getInt32();if(i<this.blockSize){var o=i%this.blockSize;this._cipherLength+=o;var u=e.util.createBuffer();u.putInt32(this._outBlock[0]),u.putInt32(this._outBlock[1]),u.putInt32(this._outBlock[2]),u.putInt32(this._outBlock[3]),u.truncate(this.blockSize-o),this._outBlock[0]=u.getInt32(),this._outBlock[1]=u.getInt32(),this._outBlock[2]=u.getInt32(),this._outBlock[3]=u.getInt32()}else this._cipherLength+=this.blockSize;for(var s=0;s<this._blocks;++s)n.putInt32(this._outBlock[s]);this._s=this.ghash(this._hashSubkey,this._s,this._outBlock)},t.gcm.prototype.decrypt=function(e,t){this.cipher.encrypt(this._inBlock,this._outBlock),r(this._inBlock);var n=e.length();this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._blocks;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);this._cipherLength+=n<this.blockSize?n%this.blockSize:this.blockSize},t.gcm.prototype.afterFinish=function(t,n){var r=!0;n.overflow&&t.truncate(this.blockSize-n.overflow),this.tag=e.util.createBuffer();var s=this._aDataLength.concat(i(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,s);var o=[];this.cipher.encrypt(this._j0,o);for(var u=0;u<this._blocks;++u)this.tag.putInt32(this._s[u]^o[u]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),this._tag&&this.tag.bytes()!==this._tag&&(r=!1),r},t.gcm.prototype.multiply=function(e,t){for(var n=[0,0,0,0],r=t.slice(0),i=0;128>i;++i){var s=e[i/32|0]&1<<31-i%32;s&&(n[0]^=r[0],n[1]^=r[1],n[2]^=r[2],n[3]^=r[3]),this.pow(r,r)}return n},t.gcm.prototype.pow=function(e,t){for(var n=1&e[3],r=3;r>0;--r)t[r]=e[r]>>>1|(1&e[r-1])<<31;t[0]=e[0]>>>1,n&&(t[0]^=this._R)},t.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],n=0;32>n;++n){var r=n/8|0,i=e[r]>>>4*(7-n%8)&15,s=this._m[n][i];t[0]^=s[0],t[1]^=s[1],t[2]^=s[2],t[3]^=s[3]}return t},t.gcm.prototype.ghash=function(e,t,n){return t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3],this.tableMultiply(t)},t.gcm.prototype.generateHashTable=function(e,t){for(var n=8/t,r=4*n,i=16*n,s=new Array(i),o=0;i>o;++o){var u=[0,0,0,0],a=o/r|0,f=(r-1-o%r)*t;u[a]=1<<t-1<<f,s[o]=this.generateSubHashTable(this.multiply(u,e),t)}return s},t.gcm.prototype.generateSubHashTable=function(e,t){var n=1<<t,r=n>>>1,i=new Array(n);i[r]=e.slice(0);for(var s=r>>>1;s>0;)this.pow(i[2*s],i[s]=[]),s>>=1;for(s=2;r>s;){for(var o=1;s>o;++o){var u=i[s],a=i[o];i[s+o]=[u[0]^a[0],u[1]^a[1],u[2]^a[2],u[3]^a[3]]}s*=2}for(i[0]=[0,0,0,0],s=r+1;n>s;++s){var f=i[s^r];i[s]=[e[0]^f[0],e[1]^f[1],e[2]^f[2],e[3]^f[3]]}return i}}var r="cipherModes";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/cipherModes",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function t(t,n){var r=function(){return new e.aes.Algorithm(t,n)};e.cipher.registerAlgorithm(t,r)}function f(){n=!0,o=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;128>t;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;i=new Array(256),s=new Array(256),u=new Array(4),a=new Array(4);for(var t=0;4>t;++t)u[t]=new Array(256),a[t]=new Array(256);for(var l,c,h,p,d,v,m,r=0,f=0,t=0;256>t;++t){p=f^f<<1^f<<2^f<<3^f<<4,p=p>>8^255&p^99,i[r]=p,s[p]=r,d=e[p],l=e[r],c=e[l],h=e[c],v=d<<24^p<<16^p<<8^(p^d),m=(l^c^h)<<24^(r^h)<<16^(r^c^h)<<8^(r^l^h);for(var g=0;4>g;++g)u[g][r]=v,a[g][p]=m,v=v<<24|v>>>8,m=m<<24|m>>>8;0===r?r=f=1:(r=l^e[e[e[l^h]]],f^=e[e[f]])}}function l(e,t){for(var s,n=e.slice(0),u=1,f=n.length,l=f+6+1,c=r*l,h=f;c>h;++h)s=n[h-1],h%f===0?(s=i[s>>>16&255]<<24^i[s>>>8&255]<<16^i[255&s]<<8^i[s>>>24]^o[u]<<24,u++):f>6&&h%f===4&&(s=i[s>>>24]<<24^i[s>>>16&255]<<16^i[s>>>8&255]<<8^i[255&s]),n[h]=n[h-f]^s;if(t){var p,d=a[0],v=a[1],m=a[2],g=a[3],y=n.slice(0);c=n.length;for(var h=0,b=c-r;c>h;h+=r,b-=r)if(0===h||h===c-r)y[h]=n[b],y[h+1]=n[b+3],y[h+2]=n[b+2],y[h+3]=n[b+1];else for(var w=0;r>w;++w)p=n[b+w],y[h+(3&-w)]=d[i[p>>>24]]^v[i[p>>>16&255]]^m[i[p>>>8&255]]^g[i[255&p]];n=y}return n}function c(e,t,n,r){var f,l,c,h,p,o=e.length/4-1;r?(f=a[0],l=a[1],c=a[2],h=a[3],p=s):(f=u[0],l=u[1],c=u[2],h=u[3],p=i);var d,v,m,g,y,b,w;d=t[0]^e[0],v=t[r?3:1]^e[1],m=t[2]^e[2],g=t[r?1:3]^e[3];for(var E=3,S=1;o>S;++S)y=f[d>>>24]^l[v>>>16&255]^c[m>>>8&255]^h[255&g]^e[++E],b=f[v>>>24]^l[m>>>16&255]^c[g>>>8&255]^h[255&d]^e[++E],w=f[m>>>24]^l[g>>>16&255]^c[d>>>8&255]^h[255&v]^e[++E],g=f[g>>>24]^l[d>>>16&255]^c[v>>>8&255]^h[255&m]^e[++E],d=y,v=b,m=w;n[0]=p[d>>>24]<<24^p[v>>>16&255]<<16^p[m>>>8&255]<<8^p[255&g]^e[++E],n[r?3:1]=p[v>>>24]<<24^p[m>>>16&255]<<16^p[g>>>8&255]<<8^p[255&d]^e[++E],n[2]=p[m>>>24]<<24^p[g>>>16&255]<<16^p[d>>>8&255]<<8^p[255&v]^e[++E],n[r?1:3]=p[g>>>24]<<24^p[d>>>16&255]<<16^p[v>>>8&255]<<8^p[255&m]^e[++E]}function h(t){t=t||{};var i,n=(t.mode||"CBC").toUpperCase(),r="AES-"+n;i=t.decrypt?e.cipher.createDecipher(r,t.key):e.cipher.createCipher(r,t.key);var s=i.start;return i.start=function(t,n){var r=null;n instanceof e.util.ByteBuffer&&(r=n,n={}),n=n||{},n.output=r,n.iv=t,s.call(i,n)},i}e.aes=e.aes||{},e.aes.startEncrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!1,mode:r});return i.start(t),i},e.aes.createEncryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!1,mode:t})},e.aes.startDecrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!0,mode:r});return i.start(t),i},e.aes.createDecryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!0,mode:t})},e.aes.Algorithm=function(e,t){n||f();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return c(r._w,e,t,!1)},decrypt:function(e,t){return c(r._w,e,t,!0)}}}),r._init=!1},e.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var r,n=t.key;if("string"!=typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(e.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){r=n,n=e.util.createBuffer();for(var i=0;i<r.length;++i)n.putByte(r[i])}}else n=e.util.createBuffer(n);if(!e.util.isArray(n)){r=n,n=[];var s=r.length();if(16===s||24===s||32===s){s>>>=2;for(var i=0;s>i;++i)n.push(r.getInt32())}}if(!e.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var o=this.mode.name,u=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=l(n,t.decrypt&&!u),this._init=!0}},e.aes._expandKey=function(e,t){return n||f(),l(e,t)},e.aes._updateBlock=c,t("AES-CBC",e.cipher.modes.cbc),t("AES-CFB",e.cipher.modes.cfb),t("AES-OFB",e.cipher.modes.ofb),t("AES-CTR",e.cipher.modes.ctr),t("AES-GCM",e.cipher.modes.gcm);var i,s,o,u,a,n=!1,r=4}var r="aes";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/aes",["require","module","./cipher","./cipherModes","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.pki=e.pki||{};var t=e.pki.oids=e.oids=e.oids||{};t["1.2.840.113549.1.1.1"]="rsaEncryption",t.rsaEncryption="1.2.840.113549.1.1.1",t["1.2.840.113549.1.1.4"]="md5WithRSAEncryption",t.md5WithRSAEncryption="1.2.840.113549.1.1.4",t["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption",t.sha1WithRSAEncryption="1.2.840.113549.1.1.5",t["1.2.840.113549.1.1.7"]="RSAES-OAEP",t["RSAES-OAEP"]="1.2.840.113549.1.1.7",t["1.2.840.113549.1.1.8"]="mgf1",t.mgf1="1.2.840.113549.1.1.8",t["1.2.840.113549.1.1.9"]="pSpecified",t.pSpecified="1.2.840.113549.1.1.9",t["1.2.840.113549.1.1.10"]="RSASSA-PSS",t["RSASSA-PSS"]="1.2.840.113549.1.1.10",t["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption",t.sha256WithRSAEncryption="1.2.840.113549.1.1.11",t["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption",t.sha384WithRSAEncryption="1.2.840.113549.1.1.12",t["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption",t.sha512WithRSAEncryption="1.2.840.113549.1.1.13",t["1.3.14.3.2.7"]="desCBC",t.desCBC="1.3.14.3.2.7",t["1.3.14.3.2.26"]="sha1",t.sha1="1.3.14.3.2.26",t["2.16.840.1.101.3.4.2.1"]="sha256",t.sha256="2.16.840.1.101.3.4.2.1",t["2.16.840.1.101.3.4.2.2"]="sha384",t.sha384="2.16.840.1.101.3.4.2.2",t["2.16.840.1.101.3.4.2.3"]="sha512",t.sha512="2.16.840.1.101.3.4.2.3",t["1.2.840.113549.2.5"]="md5",t.md5="1.2.840.113549.2.5",t["1.2.840.113549.1.7.1"]="data",t.data="1.2.840.113549.1.7.1",t["1.2.840.113549.1.7.2"]="signedData",t.signedData="1.2.840.113549.1.7.2",t["1.2.840.113549.1.7.3"]="envelopedData",t.envelopedData="1.2.840.113549.1.7.3",t["1.2.840.113549.1.7.4"]="signedAndEnvelopedData",t.signedAndEnvelopedData="1.2.840.113549.1.7.4",t["1.2.840.113549.1.7.5"]="digestedData",t.digestedData="1.2.840.113549.1.7.5",t["1.2.840.113549.1.7.6"]="encryptedData",t.encryptedData="1.2.840.113549.1.7.6",t["1.2.840.113549.1.9.1"]="emailAddress",t.emailAddress="1.2.840.113549.1.9.1",t["1.2.840.113549.1.9.2"]="unstructuredName",t.unstructuredName="1.2.840.113549.1.9.2",t["1.2.840.113549.1.9.3"]="contentType",t.contentType="1.2.840.113549.1.9.3",t["1.2.840.113549.1.9.4"]="messageDigest",t.messageDigest="1.2.840.113549.1.9.4",t["1.2.840.113549.1.9.5"]="signingTime",t.signingTime="1.2.840.113549.1.9.5",t["1.2.840.113549.1.9.6"]="counterSignature",t.counterSignature="1.2.840.113549.1.9.6",t["1.2.840.113549.1.9.7"]="challengePassword",t.challengePassword="1.2.840.113549.1.9.7",t["1.2.840.113549.1.9.8"]="unstructuredAddress",t.unstructuredAddress="1.2.840.113549.1.9.8",t["1.2.840.113549.1.9.20"]="friendlyName",t.friendlyName="1.2.840.113549.1.9.20",t["1.2.840.113549.1.9.21"]="localKeyId",t.localKeyId="1.2.840.113549.1.9.21",t["1.2.840.113549.1.9.22.1"]="x509Certificate",t.x509Certificate="1.2.840.113549.1.9.22.1",t["1.2.840.113549.1.12.10.1.1"]="keyBag",t.keyBag="1.2.840.113549.1.12.10.1.1",t["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag",t.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2",t["1.2.840.113549.1.12.10.1.3"]="certBag",t.certBag="1.2.840.113549.1.12.10.1.3",t["1.2.840.113549.1.12.10.1.4"]="crlBag",t.crlBag="1.2.840.113549.1.12.10.1.4",t["1.2.840.113549.1.12.10.1.5"]="secretBag",t.secretBag="1.2.840.113549.1.12.10.1.5",t["1.2.840.113549.1.12.10.1.6"]="safeContentsBag",t.safeContentsBag="1.2.840.113549.1.12.10.1.6",t["1.2.840.113549.1.5.13"]="pkcs5PBES2",t.pkcs5PBES2="1.2.840.113549.1.5.13",t["1.2.840.113549.1.5.12"]="pkcs5PBKDF2",t.pkcs5PBKDF2="1.2.840.113549.1.5.12",t["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4",t.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1",t["1.2.840.113549.1.12.1.2"]="pbeWithSHAAnd40BitRC4",t.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2",t["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC",t["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3",t["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC",t["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4",t["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC",t["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5",t["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC",t["pbewithSHAAnd40BitRC2-CBC"]="1.2.840.113549.1.12.1.6",t["1.2.840.113549.3.7"]="des-EDE3-CBC",t["des-EDE3-CBC"]="1.2.840.113549.3.7",t["2.16.840.1.101.3.4.1.2"]="aes128-CBC",t["aes128-CBC"]="2.16.840.1.101.3.4.1.2",t["2.16.840.1.101.3.4.1.22"]="aes192-CBC",t["aes192-CBC"]="2.16.840.1.101.3.4.1.22",t["2.16.840.1.101.3.4.1.42"]="aes256-CBC",t["aes256-CBC"]="2.16.840.1.101.3.4.1.42",t["2.5.4.3"]="commonName",t.commonName="2.5.4.3",t["2.5.4.5"]="serialName",t.serialName="2.5.4.5",t["2.5.4.6"]="countryName",t.countryName="2.5.4.6",t["2.5.4.7"]="localityName",t.localityName="2.5.4.7",t["2.5.4.8"]="stateOrProvinceName",t.stateOrProvinceName="2.5.4.8",t["2.5.4.10"]="organizationName",t.organizationName="2.5.4.10",t["2.5.4.11"]="organizationalUnitName",t.organizationalUnitName="2.5.4.11",t["2.16.840.1.113730.1.1"]="nsCertType",t.nsCertType="2.16.840.1.113730.1.1",t["2.5.29.1"]="authorityKeyIdentifier",t["2.5.29.2"]="keyAttributes",t["2.5.29.3"]="certificatePolicies",t["2.5.29.4"]="keyUsageRestriction",t["2.5.29.5"]="policyMapping",t["2.5.29.6"]="subtreesConstraint",t["2.5.29.7"]="subjectAltName",t["2.5.29.8"]="issuerAltName",t["2.5.29.9"]="subjectDirectoryAttributes",t["2.5.29.10"]="basicConstraints",t["2.5.29.11"]="nameConstraints",t["2.5.29.12"]="policyConstraints",t["2.5.29.13"]="basicConstraints",t["2.5.29.14"]="subjectKeyIdentifier",t.subjectKeyIdentifier="2.5.29.14",t["2.5.29.15"]="keyUsage",t.keyUsage="2.5.29.15",t["2.5.29.16"]="privateKeyUsagePeriod",t["2.5.29.17"]="subjectAltName",t.subjectAltName="2.5.29.17",t["2.5.29.18"]="issuerAltName",t.issuerAltName="2.5.29.18",t["2.5.29.19"]="basicConstraints",t.basicConstraints="2.5.29.19",t["2.5.29.20"]="cRLNumber",t["2.5.29.21"]="cRLReason",t["2.5.29.22"]="expirationDate",t["2.5.29.23"]="instructionCode",t["2.5.29.24"]="invalidityDate",t["2.5.29.25"]="cRLDistributionPoints",t["2.5.29.26"]="issuingDistributionPoint",t["2.5.29.27"]="deltaCRLIndicator",t["2.5.29.28"]="issuingDistributionPoint",t["2.5.29.29"]="certificateIssuer",t["2.5.29.30"]="nameConstraints",t["2.5.29.31"]="cRLDistributionPoints",t["2.5.29.32"]="certificatePolicies",t["2.5.29.33"]="policyMappings",t["2.5.29.34"]="policyConstraints",t["2.5.29.35"]="authorityKeyIdentifier",t["2.5.29.36"]="policyConstraints",t["2.5.29.37"]="extKeyUsage",t.extKeyUsage="2.5.29.37",t["2.5.29.46"]="freshestCRL",t["2.5.29.54"]="inhibitAnyPolicy",t["1.3.6.1.5.5.7.3.1"]="serverAuth",t.serverAuth="1.3.6.1.5.5.7.3.1",t["1.3.6.1.5.5.7.3.2"]="clientAuth",t.clientAuth="1.3.6.1.5.5.7.3.2",t["1.3.6.1.5.5.7.3.3"]="codeSigning",t.codeSigning="1.3.6.1.5.5.7.3.3",t["1.3.6.1.5.5.7.3.4"]="emailProtection",t.emailProtection="1.3.6.1.5.5.7.3.4",t["1.3.6.1.5.5.7.3.8"]="timeStamping",t.timeStamping="1.3.6.1.5.5.7.3.8"}var r="oids";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/oids",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1=e.asn1||{};t.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},t.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},t.create=function(t,n,r,i){if(e.util.isArray(i)){for(var s=[],o=0;o<i.length;++o)void 0!==i[o]&&s.push(i[o]);i=s}return{tagClass:t,type:n,constructed:r,composed:r||e.util.isArray(i),value:i}};var n=function(e){var t=e.getByte();if(128===t)return void 0;var n,r=128&t;return n=r?e.getInt((127&t)<<3):t};t.fromDer=function(r,i){if(void 0===i&&(i=!0),"string"==typeof r&&(r=e.util.createBuffer(r)),r.length()<2)throw{message:"Too few bytes to parse DER.",bytes:r.length()};var s=r.getByte(),o=192&s,u=31&s,a=n(r);if(r.length()<a){if(i)throw{message:"Too few bytes to read ASN.1 value.",detail:r.length()+" < "+a};a=r.length()}var f,l=32===(32&s),c=l;if(!c&&o===t.Class.UNIVERSAL&&u===t.Type.BITSTRING&&a>1){var h=r.read,p=r.getByte();if(0===p){s=r.getByte();var d=192&s;if(d===t.Class.UNIVERSAL||d===t.Class.CONTEXT_SPECIFIC)try{var v=n(r);c=v===a-(r.read-h),c&&(++h,--a)}catch(m){}}r.read=h}if(c)if(f=[],void 0===a)for(;;){if(r.bytes(2)===String.fromCharCode(0,0)){r.getBytes(2);break}f.push(t.fromDer(r,i))}else for(var g=r.length();a>0;)f.push(t.fromDer(r,i)),a-=g-r.length(),g=r.length();else{if(void 0===a){if(i)throw{message:"Non-constructed ASN.1 object of indefinite length."};a=r.length()}if(u===t.Type.BMPSTRING){f="";for(var y=0;a>y;y+=2)f+=String.fromCharCode(r.getInt16())}else f=r.getBytes(a)}return t.create(o,u,l,f)},t.toDer=function(n){var r=e.util.createBuffer(),i=n.tagClass|n.type,s=e.util.createBuffer();if(n.composed){n.constructed?i|=32:s.putByte(0);for(var o=0;o<n.value.length;++o)void 0!==n.value[o]&&s.putBuffer(t.toDer(n.value[o]))}else if(n.type===t.Type.BMPSTRING)for(var o=0;o<n.value.length;++o)s.putInt16(n.value.charCodeAt(o));else s.putBytes(n.value);if(r.putByte(i),s.length()<=127)r.putByte(127&s.length());else{var u=s.length(),a="";do a+=String.fromCharCode(255&u),u>>>=8;while(u>0);r.putByte(128|a.length);for(var o=a.length-1;o>=0;--o)r.putByte(a.charCodeAt(o))}return r.putBuffer(s),r},t.oidToDer=function(t){var n=t.split("."),r=e.util.createBuffer();r.putByte(40*parseInt(n[0],10)+parseInt(n[1],10));for(var i,s,o,u,a=2;a<n.length;++a){i=!0,s=[],o=parseInt(n[a],10);do u=127&o,o>>>=7,i||(u|=128),s.push(u),i=!1;while(o>0);for(var f=s.length-1;f>=0;--f)r.putByte(s[f])}return r},t.derToOid=function(t){var n;"string"==typeof t&&(t=e.util.createBuffer(t));var r=t.getByte();n=Math.floor(r/40)+"."+r%40;for(var i=0;t.length()>0;)r=t.getByte(),i<<=7,128&r?i+=127&r:(n+="."+(i+r),i=0);return n},t.utcTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,2),10);n=n>=50?1900+n:2e3+n;var r=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),s=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),u=0;if(e.length>11){var a=e.charAt(10),f=10;"+"!==a&&"-"!==a&&(u=parseInt(e.substr(10,2),10),f+=2)}if(t.setUTCFullYear(n,r,i),t.setUTCHours(s,o,u,0),f&&(a=e.charAt(f),"+"===a||"-"===a)){var l=parseInt(e.substr(f+1,2),10),c=parseInt(e.substr(f+4,2),10),h=60*l+c;h*=6e4,t.setTime("+"===a?+t-h:+t+h)}return t},t.generalizedTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,4),10),r=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),u=parseInt(e.substr(12,2),10),a=0,f=0,l=!1;"Z"===e.charAt(e.length-1)&&(l=!0);var c=e.length-5,h=e.charAt(c);if("+"===h||"-"===h){var p=parseInt(e.substr(c+1,2),10),d=parseInt(e.substr(c+4,2),10);f=60*p+d,f*=6e4,"+"===h&&(f*=-1),l=!0}return"."===e.charAt(14)&&(a=1e3*parseFloat(e.substr(14),10)),l?(t.setUTCFullYear(n,r,i),t.setUTCHours(s,o,u,a),t.setTime(+t+f)):(t.setFullYear(n,r,i),t.setHours(s,o,u,a)),t},t.dateToUtcTime=function(e){var t="",n=[];n.push((""+e.getUTCFullYear()).substr(2)),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(t+="0"),t+=n[r];return t+="Z"},t.integerToDer=function(t){var n=e.util.createBuffer();if(t>=-128&&128>t)return n.putSignedInt(t,8);if(t>=-32768&&32768>t)return n.putSignedInt(t,16);if(t>=-8388608&&8388608>t)return n.putSignedInt(t,24);if(t>=-2147483648&&2147483648>t)return n.putSignedInt(t,32);throw{message:"Integer too large; max is 32-bits.",integer:t}},t.derToInteger=function(t){"string"==typeof t&&(t=e.util.createBuffer(t));var n=8*t.length();if(n>32)throw{message:"Integer too large; max is 32-bits."};return t.getSignedInt(n)},t.validate=function(n,r,i,s){var o=!1;if(n.tagClass!==r.tagClass&&"undefined"!=typeof r.tagClass||n.type!==r.type&&"undefined"!=typeof r.type)s&&(n.tagClass!==r.tagClass&&s.push("["+r.name+'] Expected tag class "'+r.tagClass+'", got "'+n.tagClass+'"'),n.type!==r.type&&s.push("["+r.name+'] Expected type "'+r.type+'", got "'+n.type+'"'));else if(n.constructed===r.constructed||"undefined"==typeof r.constructed){if(o=!0,r.value&&e.util.isArray(r.value))for(var u=0,a=0;o&&a<r.value.length;++a)o=r.value[a].optional||!1,n.value[u]&&(o=t.validate(n.value[u],r.value[a],i,s),o?++u:r.value[a].optional&&(o=!0)),!o&&s&&s.push("["+r.name+'] Tag class "'+r.tagClass+'", type "'+r.type+'" expected value length "'+r.value.length+'", got "'+n.value.length+'"');o&&i&&(r.capture&&(i[r.capture]=n.value),r.captureAsn1&&(i[r.captureAsn1]=n))}else s&&s.push("["+r.name+'] Expected constructed "'+r.constructed+'", got "'+n.constructed+'"');return o};var r=/[^\\u0000-\\u00ff]/;t.prettyPrint=function(n,i,s){var o="";i=i||0,s=s||2,i>0&&(o+="\n");for(var u="",a=0;i*s>a;++a)u+=" ";switch(o+=u+"Tag: ",n.tagClass){case t.Class.UNIVERSAL:o+="Universal:";break;case t.Class.APPLICATION:o+="Application:";break;case t.Class.CONTEXT_SPECIFIC:o+="Context-Specific:";break;case t.Class.PRIVATE:o+="Private:"}if(n.tagClass===t.Class.UNIVERSAL)switch(o+=n.type,n.type){case t.Type.NONE:o+=" (None)";break;case t.Type.BOOLEAN:o+=" (Boolean)";break;case t.Type.BITSTRING:o+=" (Bit string)";break;case t.Type.INTEGER:o+=" (Integer)";break;case t.Type.OCTETSTRING:o+=" (Octet string)";break;case t.Type.NULL:o+=" (Null)";break;case t.Type.OID:o+=" (Object Identifier)";break;case t.Type.ODESC:o+=" (Object Descriptor)";break;case t.Type.EXTERNAL:o+=" (External or Instance of)";break;case t.Type.REAL:o+=" (Real)";break;case t.Type.ENUMERATED:o+=" (Enumerated)";break;case t.Type.EMBEDDED:o+=" (Embedded PDV)";break;case t.Type.UTF8:o+=" (UTF8)";break;case t.Type.ROID:o+=" (Relative Object Identifier)";break;case t.Type.SEQUENCE:o+=" (Sequence)";break;case t.Type.SET:o+=" (Set)";break;case t.Type.PRINTABLESTRING:o+=" (Printable String)";break;case t.Type.IA5String:o+=" (IA5String (ASCII))";break;case t.Type.UTCTIME:o+=" (UTC time)";break;case t.Type.GENERALIZEDTIME:o+=" (Generalized time)";break;case t.Type.BMPSTRING:o+=" (BMP String)"}else o+=n.type;if(o+="\n",o+=u+"Constructed: "+n.constructed+"\n",n.composed){for(var f=0,l="",a=0;a<n.value.length;++a)void 0!==n.value[a]&&(f+=1,l+=t.prettyPrint(n.value[a],i+1,s),a+1<n.value.length&&(l+=","));o+=u+"Sub values: "+f+l}else{if(o+=u+"Value: ",n.type===t.Type.OID){var c=t.derToOid(n.value);o+=c,e.pki&&e.pki.oids&&c in e.pki.oids&&(o+=" ("+e.pki.oids[c]+")")}if(n.type===t.Type.INTEGER)try{o+=t.derToInteger(n.value)}catch(h){o+="0x"+e.util.bytesToHex(n.value)}else o+=r.test(n.value)?"0x"+e.util.createBuffer(n.value,"utf8").toHex():0===n.value.length?"[null]":n.value}return o}}var r="asn1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/asn1",["require","module","./util","./oids"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function u(){n=String.fromCharCode(128),n+=e.util.fillString(String.fromCharCode(0),64),r=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9],i=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21],s=new Array(64);for(var t=0;64>t;++t)s[t]=Math.floor(4294967296*Math.abs(Math.sin(t+1)));o=!0}function a(e,t,n){for(var o,u,a,f,l,c,h,p,d=n.length();d>=64;){for(u=e.h0,a=e.h1,f=e.h2,l=e.h3,p=0;16>p;++p)t[p]=n.getInt32Le(),c=l^a&(f^l),o=u+c+s[p]+t[p],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;for(;32>p;++p)c=f^l&(a^f),o=u+c+s[p]+t[r[p]],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;for(;48>p;++p)c=a^f^l,o=u+c+s[p]+t[r[p]],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;for(;64>p;++p)c=f^(a|~l),o=u+c+s[p]+t[r[p]],h=i[p],u=l,l=f,f=a,a+=o<<h|o>>>32-h;e.h0=e.h0+u|0,e.h1=e.h1+a|0,e.h2=e.h2+f|0,e.h3=e.h3+l|0,d-=64}}var t=e.md5=e.md5||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.md5=e.md.algorithms.md5=t,t.create=function(){o||u();var t=null,r=e.util.createBuffer(),i=new Array(16),s={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,messageLength64:[0,0]};return s.start=function(){return s.messageLength=0,s.messageLength64=[0,0],r=e.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878},s},s.start(),s.update=function(n,o){return"utf8"===o&&(n=e.util.encodeUtf8(n)),s.messageLength+=n.length,s.messageLength64[0]+=n.length/4294967296>>>0,s.messageLength64[1]+=n.length>>>0,r.putBytes(n),a(t,i,r),(r.read>2048||0===r.length())&&r.compact(),s},s.digest=function(){var o=e.util.createBuffer();o.putBytes(r.bytes()),o.putBytes(n.substr(0,64-(s.messageLength64[1]+8&63))),o.putInt32Le(s.messageLength64[1]<<3),o.putInt32Le(s.messageLength64[0]<<3|s.messageLength64[0]>>>28);var u={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3};a(u,i,o);var f=e.util.createBuffer();return f.putInt32Le(u.h0),f.putInt32Le(u.h1),f.putInt32Le(u.h2),f.putInt32Le(u.h3),f},s};var n=null,r=null,i=null,s=null,o=!1}var r="md5";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/md5",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function i(){n=String.fromCharCode(128),n+=e.util.fillString(String.fromCharCode(0),64),r=!0}function s(e,t,n){for(var r,i,s,o,u,a,f,l,c=n.length();c>=64;){for(i=e.h0,s=e.h1,o=e.h2,u=e.h3,a=e.h4,l=0;16>l;++l)r=n.getInt32(),t[l]=r,f=u^s&(o^u),r=(i<<5|i>>>27)+f+a+1518500249+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;20>l;++l)r=t[l-3]^t[l-8]^t[l-14]^t[l-16],r=r<<1|r>>>31,t[l]=r,f=u^s&(o^u),r=(i<<5|i>>>27)+f+a+1518500249+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;32>l;++l)r=t[l-3]^t[l-8]^t[l-14]^t[l-16],r=r<<1|r>>>31,t[l]=r,f=s^o^u,r=(i<<5|i>>>27)+f+a+1859775393+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;40>l;++l)r=t[l-6]^t[l-16]^t[l-28]^t[l-32],r=r<<2|r>>>30,t[l]=r,f=s^o^u,r=(i<<5|i>>>27)+f+a+1859775393+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;for(;60>l;++l)r=t[l-6]^t[l-16]^t[l-28]^t[l-32],r=r<<2|r>>>30,t[l]=r,f=s&o|u&(s^o),r=(i<<5|i>>>27)+f+a+2400959708+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;
for(;80>l;++l)r=t[l-6]^t[l-16]^t[l-28]^t[l-32],r=r<<2|r>>>30,t[l]=r,f=s^o^u,r=(i<<5|i>>>27)+f+a+3395469782+r,a=u,u=o,o=s<<30|s>>>2,s=i,i=r;e.h0=e.h0+i|0,e.h1=e.h1+s|0,e.h2=e.h2+o|0,e.h3=e.h3+u|0,e.h4=e.h4+a|0,c-=64}}var t=e.sha1=e.sha1||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha1=e.md.algorithms.sha1=t,t.create=function(){r||i();var t=null,o=e.util.createBuffer(),u=new Array(80),a={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,messageLength64:[0,0]};return a.start=function(){return a.messageLength=0,a.messageLength64=[0,0],o=e.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},a},a.start(),a.update=function(n,r){return"utf8"===r&&(n=e.util.encodeUtf8(n)),a.messageLength+=n.length,a.messageLength64[0]+=n.length/4294967296>>>0,a.messageLength64[1]+=n.length>>>0,o.putBytes(n),s(t,u,o),(o.read>2048||0===o.length())&&o.compact(),a},a.digest=function(){var r=e.util.createBuffer();r.putBytes(o.bytes()),r.putBytes(n.substr(0,64-(a.messageLength64[1]+8&63))),r.putInt32(a.messageLength64[0]<<3|a.messageLength64[0]>>>28),r.putInt32(a.messageLength64[1]<<3);var i={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};s(i,u,r);var f=e.util.createBuffer();return f.putInt32(i.h0),f.putInt32(i.h1),f.putInt32(i.h2),f.putInt32(i.h3),f.putInt32(i.h4),f},a};var n=null,r=!1}var r="sha1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/sha1",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function s(){n=String.fromCharCode(128),n+=e.util.fillString(String.fromCharCode(0),64),i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],r=!0}function o(e,t,n){for(var r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=n.length();b>=64;){for(l=0;16>l;++l)t[l]=n.getInt32();for(;64>l;++l)r=t[l-2],r=(r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,s=t[l-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,t[l]=r+t[l-7]+s+t[l-16]|0;for(c=e.h0,h=e.h1,p=e.h2,d=e.h3,v=e.h4,m=e.h5,g=e.h6,y=e.h7,l=0;64>l;++l)u=(v>>>6|v<<26)^(v>>>11|v<<21)^(v>>>25|v<<7),a=g^v&(m^g),o=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),f=c&h|p&(c^h),r=y+u+a+i[l]+t[l],s=o+f,y=g,g=m,m=v,v=d+r|0,d=p,p=h,h=c,c=r+s|0;e.h0=e.h0+c|0,e.h1=e.h1+h|0,e.h2=e.h2+p|0,e.h3=e.h3+d|0,e.h4=e.h4+v|0,e.h5=e.h5+m|0,e.h6=e.h6+g|0,e.h7=e.h7+y|0,b-=64}}var t=e.sha256=e.sha256||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha256=e.md.algorithms.sha256=t,t.create=function(){r||s();var t=null,i=e.util.createBuffer(),u=new Array(64),a={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,messageLength64:[0,0]};return a.start=function(){return a.messageLength=0,a.messageLength64=[0,0],i=e.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},a},a.start(),a.update=function(n,r){return"utf8"===r&&(n=e.util.encodeUtf8(n)),a.messageLength+=n.length,a.messageLength64[0]+=n.length/4294967296>>>0,a.messageLength64[1]+=n.length>>>0,i.putBytes(n),o(t,u,i),(i.read>2048||0===i.length())&&i.compact(),a},a.digest=function(){var r=e.util.createBuffer();r.putBytes(i.bytes()),r.putBytes(n.substr(0,64-(a.messageLength64[1]+8&63))),r.putInt32(a.messageLength64[0]<<3|a.messageLength64[0]>>>28),r.putInt32(a.messageLength64[1]<<3);var s={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};o(s,u,r);var f=e.util.createBuffer();return f.putInt32(s.h0),f.putInt32(s.h1),f.putInt32(s.h2),f.putInt32(s.h3),f.putInt32(s.h4),f.putInt32(s.h5),f.putInt32(s.h6),f.putInt32(s.h7),f},a};var n=null,r=!1,i=null}var r="sha256";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/sha256",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function u(){r=String.fromCharCode(128),r+=e.util.fillString(String.fromCharCode(0),128),s=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],o={},o["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],o["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],o["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],o["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],i=!0}function a(e,t,n){for(var r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I=n.length();I>=128;){for(_=0;16>_;++_)t[_][0]=n.getInt32()>>>0,t[_][1]=n.getInt32()>>>0;for(;80>_;++_)H=t[_-2],D=H[0],P=H[1],r=((D>>>19|P<<13)^(P>>>29|D<<3)^D>>>6)>>>0,i=((D<<13|P>>>19)^(P<<3|D>>>29)^(D<<26|P>>>6))>>>0,j=t[_-15],D=j[0],P=j[1],o=((D>>>1|P<<31)^(D>>>8|P<<24)^D>>>7)>>>0,u=((D<<31|P>>>1)^(D<<24|P>>>8)^(D<<25|P>>>7))>>>0,B=t[_-7],F=t[_-16],P=i+B[1]+u+F[1],t[_][0]=r+B[0]+o+F[0]+(P/4294967296>>>0)>>>0,t[_][1]=P>>>0;for(m=e[0][0],g=e[0][1],y=e[1][0],b=e[1][1],w=e[2][0],E=e[2][1],S=e[3][0],x=e[3][1],T=e[4][0],N=e[4][1],C=e[5][0],k=e[5][1],L=e[6][0],A=e[6][1],O=e[7][0],M=e[7][1],_=0;80>_;++_)l=((T>>>14|N<<18)^(T>>>18|N<<14)^(N>>>9|T<<23))>>>0,c=((T<<18|N>>>14)^(T<<14|N>>>18)^(N<<23|T>>>9))>>>0,h=(L^T&(C^L))>>>0,p=(A^N&(k^A))>>>0,a=((m>>>28|g<<4)^(g>>>2|m<<30)^(g>>>7|m<<25))>>>0,f=((m<<4|g>>>28)^(g<<30|m>>>2)^(g<<25|m>>>7))>>>0,d=(m&y|w&(m^y))>>>0,v=(g&b|E&(g^b))>>>0,P=M+c+p+s[_][1]+t[_][1],r=O+l+h+s[_][0]+t[_][0]+(P/4294967296>>>0)>>>0,i=P>>>0,P=f+v,o=a+d+(P/4294967296>>>0)>>>0,u=P>>>0,O=L,M=A,L=C,A=k,C=T,k=N,P=x+i,T=S+r+(P/4294967296>>>0)>>>0,N=P>>>0,S=w,x=E,w=y,E=b,y=m,b=g,P=i+u,m=r+o+(P/4294967296>>>0)>>>0,g=P>>>0;P=e[0][1]+g,e[0][0]=e[0][0]+m+(P/4294967296>>>0)>>>0,e[0][1]=P>>>0,P=e[1][1]+b,e[1][0]=e[1][0]+y+(P/4294967296>>>0)>>>0,e[1][1]=P>>>0,P=e[2][1]+E,e[2][0]=e[2][0]+w+(P/4294967296>>>0)>>>0,e[2][1]=P>>>0,P=e[3][1]+x,e[3][0]=e[3][0]+S+(P/4294967296>>>0)>>>0,e[3][1]=P>>>0,P=e[4][1]+N,e[4][0]=e[4][0]+T+(P/4294967296>>>0)>>>0,e[4][1]=P>>>0,P=e[5][1]+k,e[5][0]=e[5][0]+C+(P/4294967296>>>0)>>>0,e[5][1]=P>>>0,P=e[6][1]+A,e[6][0]=e[6][0]+L+(P/4294967296>>>0)>>>0,e[6][1]=P>>>0,P=e[7][1]+M,e[7][0]=e[7][0]+O+(P/4294967296>>>0)>>>0,e[7][1]=P>>>0,I-=128}}var t=e.sha512=e.sha512||{};e.md=e.md||{},e.md.algorithms=e.md.algorithms||{},e.md.sha512=e.md.algorithms.sha512=t;var n=e.sha384=e.sha512.sha384=e.sha512.sha384||{};n.create=function(){return t.create("SHA-384")},e.md.sha384=e.md.algorithms.sha384=n,e.sha512.sha256=e.sha512.sha256||{create:function(){return t.create("SHA-512/256")}},e.md["sha512/256"]=e.md.algorithms["sha512/256"]=e.sha512.sha256,e.sha512.sha224=e.sha512.sha224||{create:function(){return t.create("SHA-512/224")}},e.md["sha512/224"]=e.md.algorithms["sha512/224"]=e.sha512.sha224,t.create=function(t){if(i||u(),"undefined"==typeof t&&(t="SHA-512"),t in o){for(var n=o[t],s=null,f=e.util.createBuffer(),l=new Array(80),c=0;80>c;++c)l[c]=new Array(2);var h={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,messageLength128:[0,0,0,0]};return h.start=function(){h.messageLength=0,h.messageLength128=[0,0,0,0],f=e.util.createBuffer(),s=new Array(n.length);for(var t=0;t<n.length;++t)s[t]=n[t].slice(0);return h},h.start(),h.update=function(t,n){"utf8"===n&&(t=e.util.encodeUtf8(t)),h.messageLength+=t.length;var r=t.length;r=[r/4294967296>>>0,r>>>0];for(var i=3;i>=0;--i)h.messageLength128[i]+=r[1],r[1]=r[0]+(h.messageLength128[i]/4294967296>>>0),h.messageLength128[i]=h.messageLength128[i]>>>0,r[0]=r[1]/4294967296>>>0;return f.putBytes(t),a(s,l,f),(f.read>2048||0===f.length())&&f.compact(),h},h.digest=function(){var n=e.util.createBuffer();n.putBytes(f.bytes()),n.putBytes(r.substr(0,128-(h.messageLength128[3]+16&127)));for(var i=[],o=0;3>o;++o)i[o]=h.messageLength128[o]<<3|h.messageLength128[o-1]>>>28;i[3]=h.messageLength128[3]<<3,n.putInt32(i[0]),n.putInt32(i[1]),n.putInt32(i[2]),n.putInt32(i[3]);for(var u=new Array(s.length),o=0;o<s.length;++o)u[o]=s[o].slice(0);a(u,l,n);var p,c=e.util.createBuffer();p="SHA-512"===t?u.length:"SHA-384"===t?u.length-2:u.length-4;for(var o=0;p>o;++o)c.putInt32(u[o][0]),(o!==p-1||"SHA-512/224"!==t)&&c.putInt32(u[o][1]);return c},h}throw new Error("Invalid SHA-512 algorithm: "+t)};var r=null,i=!1,s=null,o=null}var r="sha512";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/sha512",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.md=e.md||{},e.md.algorithms={md5:e.md5,sha1:e.sha1,sha256:e.sha256},e.md.md5=e.md5,e.md.sha1=e.sha1,e.md.sha256=e.sha256}var r="md";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/md",["require","module","./md5","./sha1","./sha256","./sha512"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.hmac=e.hmac||{};t.create=function(){var t=null,n=null,r=null,i=null,s={};return s.start=function(s,o){if(null!==s)if("string"==typeof s){if(s=s.toLowerCase(),!(s in e.md.algorithms))throw'Unknown hash algorithm "'+s+'"';n=e.md.algorithms[s].create()}else n=s;if(null===o)o=t;else{if("string"==typeof o)o=e.util.createBuffer(o);else if(e.util.isArray(o)){var u=o;o=e.util.createBuffer();for(var a=0;a<u.length;++a)o.putByte(u[a])}var f=o.length();f>n.blockLength&&(n.start(),n.update(o.bytes()),o=n.digest()),r=e.util.createBuffer(),i=e.util.createBuffer(),f=o.length();for(var a=0;f>a;++a){var u=o.at(a);r.putByte(54^u),i.putByte(92^u)}if(f<n.blockLength)for(var u=n.blockLength-f,a=0;u>a;++a)r.putByte(54),i.putByte(92);t=o,r=r.bytes(),i=i.bytes()}n.start(),n.update(r)},s.update=function(e){n.update(e)},s.getMac=function(){var e=n.digest().bytes();return n.start(),n.update(i),n.update(e),n.digest()},s.digest=s.getMac,s}}var r="hmac";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/hmac",["require","module","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(e){for(var t=e.name+": ",n=[],r=function(e,t){return" "+t},i=0;i<e.values.length;++i)n.push(e.values[i].replace(/^(\S+\r\n)/,r));t+=n.join(",")+"\r\n";for(var s=0,o=-1,i=0;i<t.length;++i,++s)if(s>65&&-1!==o){var u=t[o];","===u?(++o,t=t.substr(0,o)+"\r\n "+t.substr(o)):t=t.substr(0,o)+"\r\n"+u+t.substr(o+1),s=i-o-1,o=-1,++i}else(" "===t[i]||"	"===t[i]||","===t[i])&&(o=i);return t}function r(e){return e.replace(/^\s+/,"")}var t=e.pem=e.pem||{};t.encode=function(t,r){r=r||{};var s,i="-----BEGIN "+t.type+"-----\r\n";if(t.procType&&(s={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},i+=n(s)),t.contentDomain&&(s={name:"Content-Domain",values:[t.contentDomain]},i+=n(s)),t.dekInfo&&(s={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&s.values.push(t.dekInfo.parameters),i+=n(s)),t.headers)for(var o=0;o<t.headers.length;++o)i+=n(t.headers[o]);return t.procType&&(i+="\r\n"),i+=e.util.encode64(t.body,r.maxline||64)+"\r\n",i+="-----END "+t.type+"-----\r\n"},t.decode=function(t){for(var u,n=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,s=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,o=/\r?\n/;u=i.exec(t),u;){var a={type:u[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:e.util.decode64(u[3])};if(n.push(a),u[2]){for(var f=u[2].split(o),l=0;u&&l<f.length;){for(var c=f[l].replace(/\s+$/,""),h=l+1;h<f.length;++h){var p=f[h];if(!/\s/.test(p[0]))break;c+=p,l=h}if(u=c.match(s)){for(var d={name:u[1],values:[]},v=u[2].split(","),m=0;m<v.length;++m)d.values.push(r(v[m]));if(a.procType)if(a.contentDomain||"Content-Domain"!==d.name)if(a.dekInfo||"DEK-Info"!==d.name)a.headers.push(d);else{if(0===d.values.length)throw{message:'Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.'};a.dekInfo={algorithm:v[0],parameters:v[1]||null}}else a.contentDomain=v[0]||"";else{if("Proc-Type"!==d.name)throw{message:'Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".'};if(2!==d.values.length)throw{message:'Invalid PEM formatted message. The "Proc-Type" header must have two subfields.'};a.procType={version:v[0],type:v[1]}}}++l}if("ENCRYPTED"===a.procType&&!a.dekInfo)throw{message:'Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".'}}}if(0===n.length)throw{message:"Invalid PEM formatted message."};return n}}var r="pem";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pem",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function t(t,n){var r=function(){return new e.des.Algorithm(t,n)};e.cipher.registerAlgorithm(t,r)}function l(e){for(var b,t=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],r=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],u=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],a=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],f=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],l=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],c=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],h=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],d=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],v=e.length()>8?3:1,m=[],g=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],y=0,w=0;v>w;w++){var E=e.getInt32(),S=e.getInt32();b=252645135&(E>>>4^S),S^=b,E^=b<<4,b=65535&(S>>>-16^E),E^=b,S^=b<<-16,b=858993459&(E>>>2^S),S^=b,E^=b<<2,b=65535&(S>>>-16^E),E^=b,S^=b<<-16,b=1431655765&(E>>>1^S),S^=b,E^=b<<1,b=16711935&(S>>>8^E),E^=b,S^=b<<8,b=1431655765&(E>>>1^S),S^=b,E^=b<<1,b=E<<8|S>>>20&240,E=S<<24|S<<8&16711680|S>>>8&65280|S>>>24&240,S=b;for(var x=0;x<g.length;++x){g[x]?(E=E<<2|E>>>26,S=S<<2|S>>>26):(E=E<<1|E>>>27,S=S<<1|S>>>27),E&=-15,S&=-15;var T=t[E>>>28]|n[E>>>24&15]|r[E>>>20&15]|i[E>>>16&15]|s[E>>>12&15]|o[E>>>8&15]|u[E>>>4&15],N=a[S>>>28]|f[S>>>24&15]|l[S>>>20&15]|c[S>>>16&15]|h[S>>>12&15]|p[S>>>8&15]|d[S>>>4&15];b=65535&(N>>>16^T),m[y++]=T^b,m[y++]=N^b<<16}}return m}function c(e,t,l,c){var p,h=32===e.length?3:9;p=3===h?c?[30,-2,-2]:[0,32,2]:c?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var d,v=t[0],m=t[1];d=252645135&(v>>>4^m),m^=d,v^=d<<4,d=65535&(v>>>16^m),m^=d,v^=d<<16,d=858993459&(m>>>2^v),v^=d,m^=d<<2,d=16711935&(m>>>8^v),v^=d,m^=d<<8,d=1431655765&(v>>>1^m),m^=d,v^=d<<1,v=v<<1|v>>>31,m=m<<1|m>>>31;for(var g=0;h>g;g+=3){for(var y=p[g+1],b=p[g+2],w=p[g];w!=y;w+=b){var E=m^e[w],S=(m>>>4|m<<28)^e[w+1];d=v,v=m,m=d^(r[E>>>24&63]|s[E>>>16&63]|u[E>>>8&63]|f[63&E]|n[S>>>24&63]|i[S>>>16&63]|o[S>>>8&63]|a[63&S])}d=v,v=m,m=d}v=v>>>1|v<<31,m=m>>>1|m<<31,d=1431655765&(v>>>1^m),m^=d,v^=d<<1,d=16711935&(m>>>8^v),v^=d,m^=d<<8,d=858993459&(m>>>2^v),v^=d,m^=d<<2,d=65535&(v>>>16^m),m^=d,v^=d<<16,d=252645135&(v>>>4^m),m^=d,v^=d<<4,l[0]=v,l[1]=m}function h(t){t=t||{};var i,n=(t.mode||"CBC").toUpperCase(),r="DES-"+n;i=t.decrypt?e.cipher.createDecipher(r,t.key):e.cipher.createCipher(r,t.key);var s=i.start;return i.start=function(t,n){var r=null;n instanceof e.util.ByteBuffer&&(r=n,n={}),n=n||{},n.output=r,n.iv=t,s.call(i,n)},i}e.des=e.des||{},e.des.startEncrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!1,mode:r||(null===t?"ECB":"CBC")});return i.start(t),i},e.des.createEncryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!1,mode:t})},e.des.startDecrypting=function(e,t,n,r){var i=h({key:e,output:n,decrypt:!0,mode:r||(null===t?"ECB":"CBC")});return i.start(t),i},e.des.createDecryptionCipher=function(e,t){return h({key:e,output:null,decrypt:!0,mode:t})},e.des.Algorithm=function(e,t){var n=this;n.name=e,n.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return c(n._keys,e,t,!1)},decrypt:function(e,t){return c(n._keys,e,t,!0)}}}),n._init=!1},e.des.Algorithm.prototype.initialize=function(t){if(!this._init){var n=e.util.createBuffer(t.key);if(0===this.name.indexOf("3DES")&&24!==n.length())throw new Error("Invalid Triple-DES key size: "+8*n.length());this._keys=l(n),this._init=!0}},t("DES-ECB",e.cipher.modes.ecb),t("DES-CBC",e.cipher.modes.cbc),t("DES-CFB",e.cipher.modes.cfb),t("DES-OFB",e.cipher.modes.ofb),t("DES-CTR",e.cipher.modes.ctr),t("3DES-ECB",e.cipher.modes.ecb),t("3DES-CBC",e.cipher.modes.cbc),t("3DES-CFB",e.cipher.modes.cfb),t("3DES-OFB",e.cipher.modes.ofb),t("3DES-CTR",e.cipher.modes.ctr);var n=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],r=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],i=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],s=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],o=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],a=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],f=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696]}var r="des";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/des",["require","module","./cipher","./cipherModes","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.pkcs5=e.pkcs5||{};e.pbkdf2=t.pbkdf2=function(t,n,r,i,s){("undefined"==typeof s||null===s)&&(s=e.md.sha1.create());var o=s.digestLength;if(i>4294967295*o)throw{message:"Derived key is too long."};var u=Math.ceil(i/o),a=i-(u-1)*o,f=e.hmac.create();f.start(s,t);for(var c,h,p,l="",d=1;u>=d;++d){f.start(null,null),f.update(n),f.update(e.util.int32ToBytes(d)),c=p=f.digest().getBytes();for(var v=2;r>=v;++v)f.start(null,null),f.update(p),h=f.digest().getBytes(),c=e.util.xorBytes(c,h,o),p=h;l+=u>d?c:c.substr(0,a)}return l}}var r="pbkdf2";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pbkdf2",["require","module","./hmac","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var n="undefined"!=typeof process&&process.versions&&process.versions.node,r=null;!e.disableNativeCode&&n&&(r=t("crypto"));var i=e.prng=e.prng||{};i.create=function(t){function u(e){if(n.pools[0].messageLength>=32)return f(),e();var t=32-n.pools[0].messageLength<<5;n.seedFile(t,function(t,r){return t?e(t):(n.collect(r),f(),e(),void 0)})}function a(){if(n.pools[0].messageLength>=32)return f();var e=32-n.pools[0].messageLength<<5;n.collect(n.seedFileSync(e)),f()}function f(){var e=n.plugin.md.create();e.update(n.pools[0].digest().getBytes()),n.pools[0].start();for(var t=1,r=1;32>r;++r)t=31===t?2147483648:t<<2,t%n.reseeds===0&&(e.update(n.pools[r].digest().getBytes()),n.pools[r].start());var i=e.digest().getBytes();e.start(),e.update(i);var s=e.digest().getBytes();n.key=n.plugin.formatKey(i),n.seed=n.plugin.formatSeed(s),n.reseeds=4294967295===n.reseeds?0:n.reseeds+1,n.generated=0}function l(t){var n=null;if("undefined"!=typeof window){var r=window.crypto||window.msCrypto;r&&r.getRandomValues&&(n=function(e){return r.getRandomValues(e)})}var i=e.util.createBuffer();if(n)for(;i.length()<t;){var s=Math.max(1,Math.min(t-i.length(),65536)/4),o=new Uint32Array(Math.floor(s));try{n(o);for(var u=0;u<o.length;++u)i.putInt32(o[u])}catch(a){if(!("undefined"!=typeof QuotaExceededError&&a instanceof QuotaExceededError))throw a}}if(i.length()<t)for(var f,l,c,h=Math.floor(65536*Math.random());i.length()<t;){l=16807*(65535&h),f=16807*(h>>16),l+=(32767&f)<<16,l+=f>>15,l=(2147483647&l)+(l>>31),h=4294967295&l;for(var u=0;3>u;++u)c=h>>>(u<<3),c^=Math.floor(256*Math.random()),i.putByte(String.fromCharCode(255&c))}return i.getBytes(t)}for(var n={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0},i=t.md,s=new Array(32),o=0;32>o;++o)s[o]=i.create();return n.pools=s,n.pool=0,n.generate=function(t,r){function l(c){if(c)return r(c);if(f.length()>=t)return r(null,f.getBytes(t));if(n.generated>1048575&&(n.key=null),null===n.key)return e.util.nextTick(function(){u(l)});var h=i(n.key,n.seed);n.generated+=h.length,f.putBytes(h),n.key=o(i(n.key,s(n.seed))),n.seed=a(i(n.key,n.seed)),e.util.setImmediate(l)}if(!r)return n.generateSync(t);var i=n.plugin.cipher,s=n.plugin.increment,o=n.plugin.formatKey,a=n.plugin.formatSeed,f=e.util.createBuffer();n.key=null,l()},n.generateSync=function(t){var r=n.plugin.cipher,i=n.plugin.increment,s=n.plugin.formatKey,o=n.plugin.formatSeed;n.key=null;for(var u=e.util.createBuffer();u.length()<t;){n.generated>1048575&&(n.key=null),null===n.key&&a();var f=r(n.key,n.seed);n.generated+=f.length,u.putBytes(f),n.key=s(r(n.key,i(n.seed))),n.seed=o(r(n.key,n.seed))}return u.getBytes(t)},r?(n.seedFile=function(e,t){r.randomBytes(e,function(e,n){return e?t(e):void t(null,n.toString())
})},n.seedFileSync=function(e){return r.randomBytes(e).toString()}):(n.seedFile=function(e,t){try{t(null,l(e))}catch(n){t(n)}},n.seedFileSync=l),n.collect=function(e){for(var t=e.length,r=0;t>r;++r)n.pools[n.pool].update(e.substr(r,1)),n.pool=31===n.pool?0:n.pool+1},n.collectInt=function(e,t){for(var r="",i=0;t>i;i+=8)r+=String.fromCharCode(e>>i&255);n.collect(r)},n.registerWorker=function(e){if(e===self)n.seedFile=function(e,t){function n(e){var r=e.data;r.forge&&r.forge.prng&&(self.removeEventListener("message",n),t(r.forge.prng.err,r.forge.prng.bytes))}self.addEventListener("message",n),self.postMessage({forge:{prng:{needed:e}}})};else{var t=function(t){var r=t.data;r.forge&&r.forge.prng&&n.seedFile(r.forge.prng.needed,function(t,n){e.postMessage({forge:{prng:{err:t,bytes:n}}})})};e.addEventListener("message",t)}},n}}var r="prng";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/prng",["require","module","./md","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.random&&e.random.getBytes||!function(t){function s(){var t=e.prng.create(n);return t.getBytes=function(e,n){return t.generate(e,n)},t.getBytesSync=function(e){return t.generate(e)},t}var n={},r=new Array(4),i=e.util.createBuffer();n.formatKey=function(t){var n=e.util.createBuffer(t);return t=new Array(4),t[0]=n.getInt32(),t[1]=n.getInt32(),t[2]=n.getInt32(),t[3]=n.getInt32(),e.aes._expandKey(t,!1)},n.formatSeed=function(t){var n=e.util.createBuffer(t);return t=new Array(4),t[0]=n.getInt32(),t[1]=n.getInt32(),t[2]=n.getInt32(),t[3]=n.getInt32(),t},n.cipher=function(t,n){return e.aes._updateBlock(t,n,r,!1),i.putInt32(r[0]),i.putInt32(r[1]),i.putInt32(r[2]),i.putInt32(r[3]),i.getBytes()},n.increment=function(e){return++e[3],e},n.md=e.md.sha256;var o=s(),u="undefined"!=typeof process&&process.versions&&process.versions.node,a=null;if("undefined"!=typeof window){var f=window.crypto||window.msCrypto;f&&f.getRandomValues&&(a=function(e){return f.getRandomValues(e)})}if(e.disableNativeCode||!u&&!a){if("undefined"==typeof window||void 0===window.document,o.collectInt(+new Date,32),"undefined"!=typeof navigator){var l="";for(var c in navigator)try{"string"==typeof navigator[c]&&(l+=navigator[c])}catch(h){}o.collect(l),l=null}t&&(t().mousemove(function(e){o.collectInt(e.clientX,16),o.collectInt(e.clientY,16)}),t().keypress(function(e){o.collectInt(e.charCode,8)}))}if(e.random)for(var c in o)e.random[c]=o[c];else e.random=o;e.random.createInstance=s}("undefined"!=typeof jQuery?jQuery:null)}var r="random";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/random",["require","module","./aes","./md","./prng","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],n=[1,2,3,5],r=function(e,t){return e<<t&65535|(65535&e)>>16-t},i=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.rc2=e.rc2||{},e.rc2.expandKey=function(n,r){"string"==typeof n&&(n=e.util.createBuffer(n)),r=r||128;var f,i=n,s=n.length(),o=r,u=Math.ceil(o/8),a=255>>(7&o);for(f=s;128>f;f++)i.putByte(t[i.at(f-1)+i.at(f-s)&255]);for(i.setAt(128-u,t[i.at(128-u)&a]),f=127-u;f>=0;f--)i.setAt(f,t[i.at(f+1)^i.at(f+u)]);return i};var s=function(t,s,o){var c,h,p,d,u=!1,a=null,f=null,l=null,v=[];for(t=e.rc2.expandKey(t,s),p=0;64>p;p++)v.push(t.getInt16Le());o?(c=function(e){for(p=0;4>p;p++)e[p]+=v[d]+(e[(p+3)%4]&e[(p+2)%4])+(~e[(p+3)%4]&e[(p+1)%4]),e[p]=r(e[p],n[p]),d++},h=function(e){for(p=0;4>p;p++)e[p]+=v[63&e[(p+3)%4]]}):(c=function(e){for(p=3;p>=0;p--)e[p]=i(e[p],n[p]),e[p]-=v[d]+(e[(p+3)%4]&e[(p+2)%4])+(~e[(p+3)%4]&e[(p+1)%4]),d--},h=function(e){for(p=3;p>=0;p--)e[p]-=v[63&e[(p+3)%4]]});var m=function(e){var t=[];for(p=0;4>p;p++){var n=a.getInt16Le();null!==l&&(o?n^=l.getInt16Le():l.putInt16Le(n)),t.push(65535&n)}d=o?0:63;for(var r=0;r<e.length;r++)for(var i=0;i<e[r][0];i++)e[r][1](t);for(p=0;4>p;p++)null!==l&&(o?l.putInt16Le(t[p]):t[p]^=l.getInt16Le()),f.putInt16Le(t[p])},g=null;return g={start:function(t,n){t&&"string"==typeof t&&(t=e.util.createBuffer(t)),u=!1,a=e.util.createBuffer(),f=n||new e.util.createBuffer,l=t,g.output=f},update:function(e){for(u||a.putBuffer(e);a.length()>=8;)m([[5,c],[1,h],[6,c],[1,h],[5,c]])},finish:function(e){var t=!0;if(o)if(e)t=e(8,a,!o);else{var n=8===a.length()?8:8-a.length();a.fillWithByte(n,n)}if(t&&(u=!0,g.update()),!o&&(t=0===a.length()))if(e)t=e(8,f,!o);else{var r=f.length(),i=f.at(r-1);i>r?t=!1:f.truncate(i)}return t}}};e.rc2.startEncrypting=function(t,n,r){var i=e.rc2.createEncryptionCipher(t,128);return i.start(n,r),i},e.rc2.createEncryptionCipher=function(e,t){return s(e,t,!0)},e.rc2.startDecrypting=function(t,n,r){var i=e.rc2.createDecryptionCipher(t,128);return i.start(n,r),i},e.rc2.createDecryptionCipher=function(e,t){return s(e,t,!1)}}var r="rc2";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/rc2",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function i(e,t,n){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new i(null)}function o(e,t,n,r,i,s){for(;--s>=0;){var o=t*this.data[e++]+n.data[r]+i;i=Math.floor(o/67108864),n.data[r++]=67108863&o}return i}function u(e,t,n,r,i,s){for(var o=32767&t,u=t>>15;--s>=0;){var a=32767&this.data[e],f=this.data[e++]>>15,l=u*a+f*o;a=o*a+((32767&l)<<15)+n.data[r]+(1073741823&i),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n.data[r++]=1073741823&a}return i}function a(e,t,n,r,i,s){for(var o=16383&t,u=t>>14;--s>=0;){var a=16383&this.data[e],f=this.data[e++]>>14,l=u*a+f*o;a=o*a+((16383&l)<<14)+n.data[r]+i,i=(a>>28)+(l>>14)+u*f,n.data[r++]=268435455&a}return i}function d(e){return l.charAt(e)}function v(e,t){var n=c[e.charCodeAt(t)];return null==n?-1:n}function m(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s}function g(e){this.t=1,this.s=0>e?-1:0,e>0?this.data[0]=e:-1>e?this.data[0]=e+this.DV:this.t=0}function y(e){var t=s();return t.fromInt(e),t}function b(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,s=!1,o=0;--r>=0;){var u=8==n?255&e[r]:v(e,r);0>u?"-"==e.charAt(r)&&(s=!0):(s=!1,0==o?this.data[this.t++]=u:o+n>this.DB?(this.data[this.t-1]|=(u&(1<<this.DB-o)-1)<<o,this.data[this.t++]=u>>this.DB-o):this.data[this.t-1]|=u<<o,o+=n,o>=this.DB&&(o-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,o>0&&(this.data[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&i.ZERO.subTo(this,this)}function w(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t}function E(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0)for(u<this.DB&&(r=this.data[o]>>u)>0&&(i=!0,s=d(r));o>=0;)t>u?(r=(this.data[o]&(1<<u)-1)<<t-u,r|=this.data[--o]>>(u+=this.DB-t)):(r=this.data[o]>>(u-=t)&n,0>=u&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=d(r));return i?s:"0"}function S(){var e=s();return i.ZERO.subTo(this,e),e}function x(){return this.s<0?this.negate():this}function T(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(t=n-e.t,0!=t)return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this.data[n]-e.data[n]))return t;return 0}function N(e){var n,t=1;return 0!=(n=e>>>16)&&(e=n,t+=16),0!=(n=e>>8)&&(e=n,t+=8),0!=(n=e>>4)&&(e=n,t+=4),0!=(n=e>>2)&&(e=n,t+=2),0!=(n=e>>1)&&(e=n,t+=1),t}function C(){return this.t<=0?0:this.DB*(this.t-1)+N(this.data[this.t-1]^this.s&this.DM)}function k(e,t){var n;for(n=this.t-1;n>=0;--n)t.data[n+e]=this.data[n];for(n=e-1;n>=0;--n)t.data[n]=0;t.t=this.t+e,t.s=this.s}function L(e,t){for(var n=e;n<this.t;++n)t.data[n-e]=this.data[n];t.t=Math.max(this.t-e,0),t.s=this.s}function A(e,t){var u,n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM;for(u=this.t-1;u>=0;--u)t.data[u+s+1]=this.data[u]>>r|o,o=(this.data[u]&i)<<n;for(u=s-1;u>=0;--u)t.data[u]=0;t.data[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function O(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)return void(t.t=0);var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t.data[0]=this.data[n]>>r;for(var o=n+1;o<this.t;++o)t.data[o-n-1]|=(this.data[o]&s)<<i,t.data[o-n]=this.data[o]>>r;r>0&&(t.data[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function M(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this.data[n]-e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=0>r?-1:0,-1>r?t.data[n++]=this.DV+r:r>0&&(t.data[n++]=r),t.t=n,t.clamp()}function _(e,t){var n=this.abs(),r=e.abs(),s=n.t;for(t.t=s+r.t;--s>=0;)t.data[s]=0;for(s=0;s<r.t;++s)t.data[s+n.t]=n.am(0,r.data[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&i.ZERO.subTo(t,t)}function D(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e.data[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t.data[n],e,2*n,0,1);(e.data[n+t.t]+=t.am(n+1,2*t.data[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e.data[n+t.t]-=t.DV,e.data[n+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(n,t.data[n],e,2*n,0,1)),e.s=0,e.clamp()}function P(e,t,n){var r=e.abs();if(!(r.t<=0)){var o=this.abs();if(o.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=s());var u=s(),a=this.s,f=e.s,l=this.DB-N(r.data[r.t-1]);l>0?(r.lShiftTo(l,u),o.lShiftTo(l,n)):(r.copyTo(u),o.copyTo(n));var c=u.t,h=u.data[c-1];if(0!=h){var p=h*(1<<this.F1)+(c>1?u.data[c-2]>>this.F2:0),d=this.FV/p,v=(1<<this.F1)/p,m=1<<this.F2,g=n.t,y=g-c,b=null==t?s():t;for(u.dlShiftTo(y,b),n.compareTo(b)>=0&&(n.data[n.t++]=1,n.subTo(b,n)),i.ONE.dlShiftTo(c,b),b.subTo(u,u);u.t<c;)u.data[u.t++]=0;for(;--y>=0;){var w=n.data[--g]==h?this.DM:Math.floor(n.data[g]*d+(n.data[g-1]+m)*v);if((n.data[g]+=u.am(0,w,n,y,0,c))<w)for(u.dlShiftTo(y,b),n.subTo(b,n);n.data[g]<--w;)n.subTo(b,n)}null!=t&&(n.drShiftTo(c,t),a!=f&&i.ZERO.subTo(t,t)),n.t=c,n.clamp(),l>0&&n.rShiftTo(l,n),0>a&&i.ZERO.subTo(n,n)}}}function H(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(i.ZERO)>0&&e.subTo(t,t),t}function B(e){this.m=e}function j(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function F(e){return e}function I(e){e.divRemTo(this.m,null,e)}function q(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function R(e,t){e.squareTo(t),this.reduce(t)}function U(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function z(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function W(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(i.ZERO)>0&&this.m.subTo(t,t),t}function X(e){var t=s();return e.copyTo(t),this.reduce(t),t}function V(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e.data[t],r=n*this.mpl+((n*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e.data[n]+=this.m.am(0,r,e,t,0,this.m.t);e.data[n]>=e.DV;)e.data[n]-=e.DV,e.data[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function $(e,t){e.squareTo(t),this.reduce(t)}function J(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function K(){return 0==(this.t>0?1&this.data[0]:this.s)}function Q(e,t){if(e>4294967295||1>e)return i.ONE;var n=s(),r=s(),o=t.convert(this),u=N(e)-1;for(o.copyTo(n);--u>=0;)if(t.sqrTo(n,r),(e&1<<u)>0)t.mulTo(r,o,n);else{var a=n;n=r,r=a}return t.revert(n)}function G(e,t){var n;return n=256>e||t.isEven()?new B(t):new z(t),this.exp(e,n)}function Y(){var e=s();return this.copyTo(e),e}function Z(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function et(){return 0==this.t?this.s:this.data[0]<<24>>24}function tt(){return 0==this.t?this.s:this.data[0]<<16>>16}function nt(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function rt(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function it(e){if(null==e&&(e=10),0==this.signum()||2>e||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=y(n),i=s(),o=s(),u="";for(this.divRemTo(r,i,o);i.signum()>0;)u=(n+o.intValue()).toString(e).substr(1)+u,i.divRemTo(r,i,o);return o.intValue().toString(e)+u}function st(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),s=!1,o=0,u=0,a=0;a<e.length;++a){var f=v(e,a);0>f?"-"==e.charAt(a)&&0==this.signum()&&(s=!0):(u=t*u+f,++o>=n&&(this.dMultiply(r),this.dAddOffset(u,0),o=0,u=0))}o>0&&(this.dMultiply(Math.pow(t,o)),this.dAddOffset(u,0)),s&&i.ZERO.subTo(this,this)}function ot(e,t,n){if("number"==typeof t)if(2>e)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(i.ONE.shiftLeft(e-1),dt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(i.ONE.shiftLeft(e-1),this);else{var r=new Array,s=7&e;r.length=(e>>3)+1,t.nextBytes(r),s>0?r[0]&=(1<<s)-1:r[0]=0,this.fromString(r,256)}}function ut(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-->0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)8>n?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,0>=n&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t}function at(e){return 0==this.compareTo(e)}function ft(e){return this.compareTo(e)<0?this:e}function lt(e){return this.compareTo(e)>0?this:e}function ct(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;s>r;++r)n.data[r]=t(this.data[r],e.data[r]);if(e.t<this.t){for(i=e.s&this.DM,r=s;r<this.t;++r)n.data[r]=t(this.data[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=s;r<e.t;++r)n.data[r]=t(i,e.data[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function ht(e,t){return e&t}function pt(e){var t=s();return this.bitwiseTo(e,ht,t),t}function dt(e,t){return e|t}function vt(e){var t=s();return this.bitwiseTo(e,dt,t),t}function mt(e,t){return e^t}function gt(e){var t=s();return this.bitwiseTo(e,mt,t),t}function yt(e,t){return e&~t}function bt(e){var t=s();return this.bitwiseTo(e,yt,t),t}function wt(){for(var e=s(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e}function Et(e){var t=s();return 0>e?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function St(e){var t=s();return 0>e?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function xt(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function Tt(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+xt(this.data[e]);return this.s<0?this.t*this.DB:-1}function Nt(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function Ct(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=Nt(this.data[n]^t);return e}function kt(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)}function Lt(e,t){var n=i.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function At(e){return this.changeBit(e,dt)}function Ot(e){return this.changeBit(e,yt)}function Mt(e){return this.changeBit(e,mt)}function _t(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);i>n;)r+=this.data[n]+e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=0>r?-1:0,r>0?t.data[n++]=r:-1>r&&(t.data[n++]=this.DV+r),t.t=n,t.clamp()}function Dt(e){var t=s();return this.addTo(e,t),t}function Pt(e){var t=s();return this.subTo(e,t),t}function Ht(e){var t=s();return this.multiplyTo(e,t),t}function Bt(e){var t=s();return this.divRemTo(e,t,null),t}function jt(e){var t=s();return this.divRemTo(e,null,t),t}function Ft(e){var t=s(),n=s();return this.divRemTo(e,t,n),new Array(t,n)}function It(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function qt(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}}function Rt(){}function Ut(e){return e}function zt(e,t,n){e.multiplyTo(t,n)}function Wt(e,t){e.squareTo(t)}function Xt(e){return this.exp(e,new Rt)}function Vt(e,t,n){var r=Math.min(this.t+e.t,t);for(n.s=0,n.t=r;r>0;)n.data[--r]=0;var i;for(i=n.t-this.t;i>r;++r)n.data[r+this.t]=this.am(0,e.data[r],n,r,0,this.t);for(i=Math.min(e.t,t);i>r;++r)this.am(0,e.data[r],n,r,0,t-r);n.clamp()}function $t(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n.data[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n.data[this.t+r-t]=this.am(t-r,e.data[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Jt(e){this.r2=s(),this.q3=s(),i.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function Kt(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t}function Qt(e){return e}function Gt(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)}function Yt(e,t){e.squareTo(t),this.reduce(t)}function Zt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function en(e,t){var r,o,n=e.bitLength(),i=y(1);if(0>=n)return i;r=18>n?1:48>n?3:144>n?4:768>n?5:6,o=8>n?new B(t):t.isEven()?new Jt(t):new z(t);var u=new Array,a=3,f=r-1,l=(1<<r)-1;if(u[1]=o.convert(this),r>1){var c=s();for(o.sqrTo(u[1],c);l>=a;)u[a]=s(),o.mulTo(c,u[a-2],u[a]),a+=2}var p,m,h=e.t-1,d=!0,v=s();for(n=N(e.data[h])-1;h>=0;){for(n>=f?p=e.data[h]>>n-f&l:(p=(e.data[h]&(1<<n+1)-1)<<f-n,h>0&&(p|=e.data[h-1]>>this.DB+n-f)),a=r;0==(1&p);)p>>=1,--a;if((n-=a)<0&&(n+=this.DB,--h),d)u[p].copyTo(i),d=!1;else{for(;a>1;)o.sqrTo(i,v),o.sqrTo(v,i),a-=2;a>0?o.sqrTo(i,v):(m=i,i=v,v=m),o.mulTo(v,u[p],i)}for(;h>=0&&0==(e.data[h]&1<<n);)o.sqrTo(i,v),m=i,i=v,v=m,--n<0&&(n=this.DB-1,--h)}return o.revert(i)}function tn(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(0>s)return t;for(s>i&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function nn(e){if(0>=e)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this.data[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this.data[r])%e;return n}function rn(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return i.ZERO;for(var n=e.clone(),r=this.clone(),s=y(1),o=y(0),u=y(0),a=y(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;r.isEven();)r.rShiftTo(1,r),t?(u.isEven()&&a.isEven()||(u.addTo(this,u),a.subTo(e,a)),u.rShiftTo(1,u)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);n.compareTo(r)>=0?(n.subTo(r,n),t&&s.subTo(u,s),o.subTo(a,o)):(r.subTo(n,r),t&&u.subTo(s,u),a.subTo(o,a))}return 0!=r.compareTo(i.ONE)?i.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a}function un(e){var t,n=this.abs();if(1==n.t&&n.data[0]<=sn[sn.length-1]){for(t=0;t<sn.length;++t)if(n.data[0]==sn[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<sn.length;){for(var r=sn[t],i=t+1;i<sn.length&&on>r;)r*=sn[i++];for(r=n.modInt(r);i>t;)if(r%sn[t++]==0)return!1}return n.millerRabin(e)}function an(e){var t=this.subtract(i.ONE),n=t.getLowestSetBit();if(0>=n)return!1;for(var o,r=t.shiftRight(n),s=fn(),u=0;e>u;++u){do o=new i(this.bitLength(),s);while(o.compareTo(i.ONE)<=0||o.compareTo(t)>=0);var a=o.modPow(r,this);if(0!=a.compareTo(i.ONE)&&0!=a.compareTo(t)){for(var f=1;f++<n&&0!=a.compareTo(t);)if(a=a.modPowInt(2,this),0==a.compareTo(i.ONE))return!1;if(0!=a.compareTo(t))return!1}}return!0}function fn(){return{nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())}}}var t,n=0xdeadbeefcafe,r=15715070==(16777215&n);"undefined"==typeof navigator?(i.prototype.am=a,t=28):r&&"Microsoft Internet Explorer"==navigator.appName?(i.prototype.am=u,t=30):r&&"Netscape"!=navigator.appName?(i.prototype.am=o,t=26):(i.prototype.am=a,t=28),i.prototype.DB=t,i.prototype.DM=(1<<t)-1,i.prototype.DV=1<<t;var f=52;i.prototype.FV=Math.pow(2,f),i.prototype.F1=f-t,i.prototype.F2=2*t-f;var h,p,l="0123456789abcdefghijklmnopqrstuvwxyz",c=new Array;for(h="0".charCodeAt(0),p=0;9>=p;++p)c[h++]=p;for(h="a".charCodeAt(0),p=10;36>p;++p)c[h++]=p;for(h="A".charCodeAt(0),p=10;36>p;++p)c[h++]=p;B.prototype.convert=j,B.prototype.revert=F,B.prototype.reduce=I,B.prototype.mulTo=q,B.prototype.sqrTo=R,z.prototype.convert=W,z.prototype.revert=X,z.prototype.reduce=V,z.prototype.mulTo=J,z.prototype.sqrTo=$,i.prototype.copyTo=m,i.prototype.fromInt=g,i.prototype.fromString=b,i.prototype.clamp=w,i.prototype.dlShiftTo=k,i.prototype.drShiftTo=L,i.prototype.lShiftTo=A,i.prototype.rShiftTo=O,i.prototype.subTo=M,i.prototype.multiplyTo=_,i.prototype.squareTo=D,i.prototype.divRemTo=P,i.prototype.invDigit=U,i.prototype.isEven=K,i.prototype.exp=Q,i.prototype.toString=E,i.prototype.negate=S,i.prototype.abs=x,i.prototype.compareTo=T,i.prototype.bitLength=C,i.prototype.mod=H,i.prototype.modPowInt=G,i.ZERO=y(0),i.ONE=y(1),Rt.prototype.convert=Ut,Rt.prototype.revert=Ut,Rt.prototype.mulTo=zt,Rt.prototype.sqrTo=Wt,Jt.prototype.convert=Kt,Jt.prototype.revert=Qt,Jt.prototype.reduce=Gt,Jt.prototype.mulTo=Zt,Jt.prototype.sqrTo=Yt;var sn=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],on=(1<<26)/sn[sn.length-1];i.prototype.chunkSize=nt,i.prototype.toRadix=it,i.prototype.fromRadix=st,i.prototype.fromNumber=ot,i.prototype.bitwiseTo=ct,i.prototype.changeBit=Lt,i.prototype.addTo=_t,i.prototype.dMultiply=It,i.prototype.dAddOffset=qt,i.prototype.multiplyLowerTo=Vt,i.prototype.multiplyUpperTo=$t,i.prototype.modInt=nn,i.prototype.millerRabin=an,i.prototype.clone=Y,i.prototype.intValue=Z,i.prototype.byteValue=et,i.prototype.shortValue=tt,i.prototype.signum=rt,i.prototype.toByteArray=ut,i.prototype.equals=at,i.prototype.min=ft,i.prototype.max=lt,i.prototype.and=pt,i.prototype.or=vt,i.prototype.xor=gt,i.prototype.andNot=bt,i.prototype.not=wt,i.prototype.shiftLeft=Et,i.prototype.shiftRight=St,i.prototype.getLowestSetBit=Tt,i.prototype.bitCount=Ct,i.prototype.testBit=kt,i.prototype.setBit=At,i.prototype.clearBit=Ot,i.prototype.flipBit=Mt,i.prototype.add=Dt,i.prototype.subtract=Pt,i.prototype.multiply=Ht,i.prototype.divide=Bt,i.prototype.remainder=jt,i.prototype.divideAndRemainder=Ft,i.prototype.modPow=en,i.prototype.modInverse=rn,i.prototype.pow=Xt,i.prototype.gcd=tn,i.prototype.isProbablePrime=un,e.jsbn=e.jsbn||{},e.jsbn.BigInteger=i}var r="jsbn";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/jsbn",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(t,n,r){r||(r=e.md.sha1.create());for(var i="",s=Math.ceil(n/r.digestLength),o=0;s>o;++o){var u=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);r.start(),r.update(t+u),i+=r.digest().getBytes()}return i.substring(0,n)}var t=e.pkcs1=e.pkcs1||{};t.encode_rsa_oaep=function(t,r,i){var s,o,u,a;"string"==typeof i?(s=i,o=arguments[3]||void 0,u=arguments[4]||void 0):i&&(s=i.label||void 0,o=i.seed||void 0,u=i.md||void 0,i.mgf1&&i.mgf1.md&&(a=i.mgf1.md)),u?u.start():u=e.md.sha1.create(),a||(a=u);var f=Math.ceil(t.n.bitLength()/8),l=f-2*u.digestLength-2;if(r.length>l)throw{message:"RSAES-OAEP input message length is too long.",length:r.length,maxLength:l};s||(s=""),u.update(s,"raw");for(var c=u.digest(),h="",p=l-r.length,d=0;p>d;d++)h+="\x00";var v=c.getBytes()+h+""+r;if(o){if(o.length!==u.digestLength)throw{message:"Invalid RSAES-OAEP seed. The seed length must match the digest length.",seedLength:o.length,digestLength:u.digestLength}}else o=e.random.getBytes(u.digestLength);var m=n(o,f-u.digestLength-1,a),g=e.util.xorBytes(v,m,v.length),y=n(g,u.digestLength,a),b=e.util.xorBytes(o,y,o.length);return"\x00"+b+g},t.decode_rsa_oaep=function(t,r,i){var s,o,u;"string"==typeof i?(s=i,o=arguments[3]||void 0):i&&(s=i.label||void 0,o=i.md||void 0,i.mgf1&&i.mgf1.md&&(u=i.mgf1.md));var a=Math.ceil(t.n.bitLength()/8);if(r.length!==a)throw{message:"RSAES-OAEP encoded message length is invalid.",length:r.length,expectedLength:a};if(void 0===o?o=e.md.sha1.create():o.start(),u||(u=o),a<2*o.digestLength+2)throw{message:"RSAES-OAEP key is too short for the hash function."};s||(s=""),o.update(s,"raw");for(var f=o.digest().getBytes(),l=r.charAt(0),c=r.substring(1,o.digestLength+1),h=r.substring(1+o.digestLength),p=n(h,o.digestLength,u),d=e.util.xorBytes(c,p,c.length),v=n(d,a-o.digestLength-1,u),m=e.util.xorBytes(h,v,h.length),g=m.substring(0,o.digestLength),y="\x00"!==l,b=0;b<o.digestLength;++b)y|=f.charAt(b)!==g.charAt(b);for(var w=1,E=o.digestLength,S=o.digestLength;S<m.length;S++){var x=m.charCodeAt(S),T=1&x^1,N=w?65534:0;y|=x&N,w&=T,E+=w}if(y||1!==m.charCodeAt(E))throw{message:"Invalid RSAES-OAEP padding."};return m.substring(E+1)}}var r="pkcs1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs1",["require","module","./util","./random","./sha1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function c(t,n,r){var i=e.util.createBuffer(),s=Math.ceil(n.n.bitLength()/8);if(t.length>s-11)throw{message:"Message is too long for PKCS#1 v1.5 padding.",length:t.length,max:s-11};i.putByte(0),i.putByte(r);var u,o=s-3-t.length;if(0===r||1===r){u=0===r?0:255;for(var a=0;o>a;++a)i.putByte(u)}else for(;o>0;){for(var f=0,l=e.random.getBytes(o),a=0;o>a;++a)u=l.charCodeAt(a),0===u?++f:i.putByte(u);o=f}return i.putByte(0),i.putBytes(t),i}function h(t,n,r,i){var s=Math.ceil(n.n.bitLength()/8),o=e.util.createBuffer(t),u=o.getByte(),a=o.getByte();if(0!==u||r&&0!==a&&1!==a||!r&&2!=a||r&&0===a&&"undefined"==typeof i)throw{message:"Encryption block is invalid."};var f=0;if(0===a){f=s-3-i;for(var l=0;f>l;++l)if(0!==o.getByte())throw{message:"Encryption block is invalid."}}else if(1===a)for(f=0;o.length()>1;){if(255!==o.getByte()){--o.read;break}++f}else if(2===a)for(f=0;o.length()>1;){if(0===o.getByte()){--o.read;break}++f}var c=o.getByte();if(0!==c||f!==s-3-o.length())throw{message:"Encryption block is invalid."};return o.getBytes()}function p(n,i,s){function p(){u=Math.max(1,u),d(n.pBits,function(e,t){return e?s(e):(n.p=t,void d(n.qBits,v))})}function d(e,r){function d(){var r=e-1,i=new t(e,n.rng);return i.testBit(r)||i.bitwiseTo(t.ONE.shiftLeft(r),h,i),i.dAddOffset(31-i.mod(c).byteValue(),0),i}function m(s){if(!v){--o;var u=s.data;if(u.found){for(var l=0;l<i.length;++l)i[l].terminate();return v=!0,r(null,new t(u.prime,16))}p.bitLength()>e&&(p=d());var c=p.toString(16);s.target.postMessage({e:n.eInt,hex:c,workLoad:a}),p.dAddOffset(f,0)}}for(var i=[],s=0;u>s;++s)i[s]=new Worker(l);for(var o=u,p=d(),s=0;u>s;++s)i[s].addEventListener("message",m);var v=!1}function v(e,i){if(n.q=i,n.p.compareTo(n.q)<0){var o=n.p;n.p=n.q,n.q=o}if(n.p1=n.p.subtract(t.ONE),n.q1=n.q.subtract(t.ONE),n.phi=n.p1.multiply(n.q1),0!==n.phi.gcd(n.e).compareTo(t.ONE))return n.p=n.q=null,void p();if(n.n=n.p.multiply(n.q),n.n.bitLength()!==n.bits)return n.q=null,void d(n.qBits,v);var u=n.e.modInverse(n.phi);n.keys={privateKey:r.rsa.setPrivateKey(n.n,n.e,u,n.p,n.q,u.mod(n.p1),u.mod(n.q1),n.q.modInverse(n.p)),publicKey:r.rsa.setPublicKey(n.n,n.e)},s(null,n.keys)}if("function"==typeof i&&(s=i,i={}),"undefined"==typeof Worker){var o=function(){return r.rsa.stepKeyPairGenerationState(n,10)?s(null,n.keys):void e.util.setImmediate(o)
};return o()}var u=i.workers||2,a=i.workLoad||100,f=30*a/8,l=i.workerScript||"forge/prime.worker.js",c=new t(null);c.fromInt(30);var h=function(e,t){return e|t};return-1===u?e.util.estimateCores(function(e,t){e&&(t=2),u=t-1,p()}):void p()}function d(t){var n=t.toString(16);return n[0]>="8"&&(n="00"+n),e.util.hexToBytes(n)}function v(e){return 100>=e?27:150>=e?18:200>=e?15:250>=e?12:300>=e?9:350>=e?8:400>=e?7:500>=e?6:600>=e?5:800>=e?4:1250>=e?3:2}if("undefined"==typeof t)var t=e.jsbn.BigInteger;var n=e.asn1;e.pki=e.pki||{},e.pki.rsa=e.rsa=e.rsa||{};var r=e.pki,i=[6,4,2,4,2,4,6,2],s={name:"PrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},o={name:"RSAPrivateKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},u={name:"RSAPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},a=e.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},f=function(e){var t;if(e.algorithm in r.oids){t=r.oids[e.algorithm];var i=n.oidToDer(t).getBytes(),s=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[]),o=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[]);o.value.push(n.create(n.Class.UNIVERSAL,n.Type.OID,!1,i)),o.value.push(n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,""));var u=n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,e.digest().getBytes());return s.value.push(o),s.value.push(u),n.toDer(s).getBytes()}throw{message:"Unknown message digest algorithm.",algorithm:e.algorithm}},l=function(e,n,r){var i;if(r)i=e.modPow(n.e,n.n);else if(n.p&&n.q){n.dP||(n.dP=n.d.mod(n.p.subtract(t.ONE))),n.dQ||(n.dQ=n.d.mod(n.q.subtract(t.ONE))),n.qInv||(n.qInv=n.q.modInverse(n.p));for(var s=e.mod(n.p).modPow(n.dP,n.p),o=e.mod(n.q).modPow(n.dQ,n.q);s.compareTo(o)<0;)s=s.add(n.p);i=s.subtract(o).multiply(n.qInv).mod(n.p).multiply(n.q).add(o)}else i=e.modPow(n.d,n.n);return i};r.rsa.encrypt=function(n,r,i){var o,s=i,u=Math.ceil(r.n.bitLength()/8);i!==!1&&i!==!0?(s=2===i,o=c(n,r,i)):(o=e.util.createBuffer(),o.putBytes(n));for(var a=new t(o.toHex(),16),f=l(a,r,s),h=f.toString(16),p=e.util.createBuffer(),d=u-Math.ceil(h.length/2);d>0;)p.putByte(0),--d;return p.putBytes(e.util.hexToBytes(h)),p.getBytes()},r.rsa.decrypt=function(n,r,i,s){var o=Math.ceil(r.n.bitLength()/8);if(n.length!==o)throw{message:"Encrypted message length is invalid.",length:n.length,expected:o};var u=new t(e.util.createBuffer(n).toHex(),16);if(u.compareTo(r.n)>=0)throw{message:"Encrypted message is invalid."};for(var a=l(u,r,i),f=a.toString(16),c=e.util.createBuffer(),p=o-Math.ceil(f.length/2);p>0;)c.putByte(0),--p;return c.putBytes(e.util.hexToBytes(f)),s!==!1?h(c.getBytes(),r,i):c.getBytes()},r.rsa.createKeyPairGenerationState=function(n,r,i){"string"==typeof n&&(n=parseInt(n,10)),n=n||2048,i=i||{},i.prng=i.prng||e.random;var s={nextBytes:function(e){for(var t=i.prng.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}},o={state:0,bits:n,rng:s,eInt:r||65537,e:new t(null),p:null,q:null,qBits:n>>1,pBits:n-(n>>1),pqState:0,num:null,keys:null};return o.e.fromInt(o.eInt),o},r.rsa.stepKeyPairGenerationState=function(e,n){var s=new t(null);s.fromInt(30);for(var f,o=0,u=function(e,t){return e|t},a=+new Date,l=0;null===e.keys&&(0>=n||n>l);){if(0===e.state){var c=null===e.p?e.pBits:e.qBits,h=c-1;0===e.pqState?(e.num=new t(c,e.rng),e.num.testBit(h)||e.num.bitwiseTo(t.ONE.shiftLeft(h),u,e.num),e.num.dAddOffset(31-e.num.mod(s).byteValue(),0),o=0,++e.pqState):1===e.pqState?e.num.bitLength()>c?e.pqState=0:e.num.isProbablePrime(v(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(i[o++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(t.ONE).gcd(e.e).compareTo(t.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(t.ONE),e.q1=e.q.subtract(t.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(t.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:r.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:r.rsa.setPublicKey(e.n,e.e)}}f=+new Date,l+=f-a,a=f}return null!==e.keys},r.rsa.generateKeyPair=function(e,t,n,i){1===arguments.length?"object"==typeof e?(n=e,e=void 0):"function"==typeof e&&(i=e,e=void 0):2===arguments.length?("number"==typeof e?"function"==typeof t?i=t:n=t:(n=e,i=t,e=void 0),t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof n&&(i=n,n=void 0):(i=n,n=t,t=void 0)),n=n||{},void 0===e&&(e=n.bits||2048),void 0===t&&(t=n.e||65537);var s=r.rsa.createKeyPairGenerationState(e,t,n);return i?void p(s,n,i):(r.rsa.stepKeyPairGenerationState(s,0),s.keys)},r.setRsaPublicKey=r.rsa.setPublicKey=function(t,i){var s={n:t,e:i};return s.encrypt=function(t,n,i){if("string"==typeof n?n=n.toUpperCase():void 0===n&&(n="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===n)n={encode:function(e,t){return c(e,t,2).getBytes()}};else if("RSA-OAEP"===n||"RSAES-OAEP"===n)n={encode:function(t,n){return e.pkcs1.encode_rsa_oaep(n,t,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(n))throw{message:'Unsupported encryption scheme: "'+n+'".'};n={encode:function(e){return e}}}var o=n.encode(t,s,!0);return r.rsa.encrypt(o,s,!0)},s.verify=function(e,t,i){"string"==typeof i?i=i.toUpperCase():void 0===i&&(i="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===i?i={verify:function(e,t){t=h(t,s,!0);var r=n.fromDer(t);return e===r.value[1].value}}:("NONE"===i||"NULL"===i||null===i)&&(i={verify:function(e,t){return t=h(t,s,!0),e===t}});var o=r.rsa.decrypt(t,s,!0,!1);return i.verify(e,o,s.n.bitLength())},s},r.setRsaPrivateKey=r.rsa.setPrivateKey=function(t,n,i,s,o,u,a,l){var c={n:t,e:n,d:i,p:s,q:o,dP:u,dQ:a,qInv:l};return c.decrypt=function(t,n,i){"string"==typeof n?n=n.toUpperCase():void 0===n&&(n="RSAES-PKCS1-V1_5");var s=r.rsa.decrypt(t,c,!1,!1);if("RSAES-PKCS1-V1_5"===n)n={decode:h};else if("RSA-OAEP"===n||"RSAES-OAEP"===n)n={decode:function(t,n){return e.pkcs1.decode_rsa_oaep(n,t,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(n))throw{message:'Unsupported encryption scheme: "'+n+'".'};n={decode:function(e){return e}}}return n.decode(s,c,!1)},c.sign=function(e,t){var n=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:f},n=1):("NONE"===t||"NULL"===t||null===t)&&(t={encode:function(){return e}},n=1);var i=t.encode(e,c.n.bitLength());return r.rsa.encrypt(i,c,n)},c},r.wrapRsaPrivateKey=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(0).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(r.oids.rsaEncryption).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,n.toDer(e).getBytes())])},r.privateKeyFromAsn1=function(i){var u={},a=[];if(n.validate(i,s,u,a)&&(i=n.fromDer(e.util.createBuffer(u.privateKey))),u={},a=[],!n.validate(i,o,u,a))throw{message:"Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.",errors:a};var f,l,c,h,p,d,v,m;return f=e.util.createBuffer(u.privateKeyModulus).toHex(),l=e.util.createBuffer(u.privateKeyPublicExponent).toHex(),c=e.util.createBuffer(u.privateKeyPrivateExponent).toHex(),h=e.util.createBuffer(u.privateKeyPrime1).toHex(),p=e.util.createBuffer(u.privateKeyPrime2).toHex(),d=e.util.createBuffer(u.privateKeyExponent1).toHex(),v=e.util.createBuffer(u.privateKeyExponent2).toHex(),m=e.util.createBuffer(u.privateKeyCoefficient).toHex(),r.setRsaPrivateKey(new t(f,16),new t(l,16),new t(c,16),new t(h,16),new t(p,16),new t(d,16),new t(v,16),new t(m,16))},r.privateKeyToAsn1=r.privateKeyToRSAPrivateKey=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,n.integerToDer(0).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.n)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.e)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.d)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.p)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.q)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.dP)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.dQ)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.qInv))])},r.publicKeyFromAsn1=function(i){var s={},o=[];if(n.validate(i,a,s,o)){var f=n.derToOid(s.publicKeyOid);if(f!==r.oids.rsaEncryption)throw{message:"Cannot read public key. Unknown OID.",oid:f};i=s.rsaPublicKey}if(o=[],!n.validate(i,u,s,o))throw{message:"Cannot read public key. ASN.1 object does not contain an RSAPublicKey.",errors:o};var l=e.util.createBuffer(s.publicKeyModulus).toHex(),c=e.util.createBuffer(s.publicKeyExponent).toHex();return r.setRsaPublicKey(new t(l,16),new t(c,16))},r.publicKeyToAsn1=r.publicKeyToSubjectPublicKeyInfo=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(r.oids.rsaEncryption).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.NULL,!1,"")]),n.create(n.Class.UNIVERSAL,n.Type.BITSTRING,!1,[r.publicKeyToRSAPublicKey(e)])])},r.publicKeyToRSAPublicKey=function(e){return n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.n)),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,d(e.e))])}}var r="rsa";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/rsa",["require","module","./asn1","./oids","./random","./util","./jsbn","./pkcs1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function a(e,t,n){for(var r=[f(e+t)],i=16,s=1;n>i;++s,i+=16)r.push(f(r[s-1]+e+t));return r.join("").substr(0,n)}function f(t){return e.md.md5.create().update(t).digest().getBytes()}if("undefined"==typeof t)var t=e.jsbn.BigInteger;var n=e.asn1,r=e.pki=e.pki||{};r.pbe=e.pbe=e.pbe||{};var i=r.oids,s={name:"EncryptedPrivateKeyInfo",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},o={name:"PBES2Algorithms",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,onstructed:!0,capture:"kdfIterationCount"}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:n.Class.UNIVERSAL,type:n.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:n.Class.UNIVERSAL,type:n.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:n.Class.UNIVERSAL,type:n.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:n.Class.UNIVERSAL,type:n.Type.INTEGER,constructed:!1,capture:"iterations"}]};r.encryptPrivateKeyInfo=function(t,s,o){o=o||{},o.saltSize=o.saltSize||8,o.count=o.count||2048,o.algorithm=o.algorithm||"aes128";var l,c,h,u=e.random.getBytesSync(o.saltSize),a=o.count,f=n.integerToDer(a);if(0===o.algorithm.indexOf("aes")||"des"===o.algorithm){var p,d,v;switch(o.algorithm){case"aes128":l=16,p=16,d=i["aes128-CBC"],v=e.aes.createEncryptionCipher;break;case"aes192":l=24,p=16,d=i["aes192-CBC"],v=e.aes.createEncryptionCipher;break;case"aes256":l=32,p=16,d=i["aes256-CBC"],v=e.aes.createEncryptionCipher;break;case"des":l=8,p=8,d=i.desCBC,v=e.des.createEncryptionCipher;break;default:throw{message:"Cannot encrypt private key. Unknown encryption algorithm.",algorithm:o.algorithm}}var m=e.pkcs5.pbkdf2(s,u,a,l),g=e.random.getBytesSync(p),y=v(m);y.start(g),y.update(n.toDer(t)),y.finish(),h=y.output.getBytes(),c=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(i.pkcs5PBES2).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(i.pkcs5PBKDF2).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,u),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,f.getBytes())])]),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(d).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,g)])])])}else{if("3des"!==o.algorithm)throw{message:"Cannot encrypt private key. Unknown encryption algorithm.",algorithm:o.algorithm};l=24;var b=new e.util.ByteBuffer(u),m=r.pbe.generatePkcs12Key(s,b,1,a,l),g=r.pbe.generatePkcs12Key(s,b,2,a,l),y=e.des.createEncryptionCipher(m);y.start(g),y.update(n.toDer(t)),y.finish(),h=y.output.getBytes(),c=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OID,!1,n.oidToDer(i["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,u),n.create(n.Class.UNIVERSAL,n.Type.INTEGER,!1,f.getBytes())])])}var w=n.create(n.Class.UNIVERSAL,n.Type.SEQUENCE,!0,[c,n.create(n.Class.UNIVERSAL,n.Type.OCTETSTRING,!1,h)]);return w},r.decryptPrivateKeyInfo=function(t,i){var o=null,u={},a=[];if(!n.validate(t,s,u,a))throw{message:"Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:a};var f=n.derToOid(u.encryptionOid),l=r.pbe.getCipher(f,u.encryptionParams,i),c=e.util.createBuffer(u.encryptedData);return l.update(c),l.finish()&&(o=n.fromDer(l.output)),o},r.encryptedPrivateKeyToPem=function(t,r){var i={type:"ENCRYPTED PRIVATE KEY",body:n.toDer(t).getBytes()};return e.pem.encode(i,{maxline:r})},r.encryptedPrivateKeyFromPem=function(t){var r=e.pem.decode(t)[0];if("ENCRYPTED PRIVATE KEY"!==r.type)throw{message:'Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".',headerType:r.type};if(r.procType&&"ENCRYPTED"===r.procType.type)throw{message:"Could not convert encrypted private key from PEM; PEM is encrypted."};return n.fromDer(r.body)},r.encryptRsaPrivateKey=function(t,i,s){if(s=s||{},!s.legacy){var o=r.wrapRsaPrivateKey(r.privateKeyToAsn1(t));return o=r.encryptPrivateKeyInfo(o,i,s),r.encryptedPrivateKeyToPem(o)}var u,f,l,c;switch(s.algorithm){case"aes128":u="AES-128-CBC",l=16,f=e.random.getBytesSync(16),c=e.aes.createEncryptionCipher;break;case"aes192":u="AES-192-CBC",l=24,f=e.random.getBytesSync(16),c=e.aes.createEncryptionCipher;break;case"aes256":u="AES-256-CBC",l=32,f=e.random.getBytesSync(16),c=e.aes.createEncryptionCipher;break;case"3des":u="DES-EDE3-CBC",l=24,f=e.random.getBytesSync(8),c=e.des.createEncryptionCipher;break;case"des":u="DES-CBC",l=8,f=e.random.getBytesSync(8),c=e.des.createEncryptionCipher;break;default:throw{message:'Could not encrypt RSA private key; unsupported encryption algorithm "'+s.algorithm+'".',algorithm:s.algorithm}}var h=a(i,f.substr(0,8),l),p=c(h);p.start(f),p.update(n.toDer(r.privateKeyToAsn1(t))),p.finish();var d={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:u,parameters:e.util.bytesToHex(f).toUpperCase()},body:p.output.getBytes()};return e.pem.encode(d)},r.decryptRsaPrivateKey=function(t,i){var s=null,o=e.pem.decode(t)[0];if("ENCRYPTED PRIVATE KEY"!==o.type&&"PRIVATE KEY"!==o.type&&"RSA PRIVATE KEY"!==o.type)throw{message:'Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".',headerType:o.type};if(o.procType&&"ENCRYPTED"===o.procType.type){var u,f;switch(o.dekInfo.algorithm){case"DES-CBC":u=8,f=e.des.createDecryptionCipher;break;case"DES-EDE3-CBC":u=24,f=e.des.createDecryptionCipher;break;case"AES-128-CBC":u=16,f=e.aes.createDecryptionCipher;break;case"AES-192-CBC":u=24,f=e.aes.createDecryptionCipher;break;case"AES-256-CBC":u=32,f=e.aes.createDecryptionCipher;break;case"RC2-40-CBC":u=5,f=function(t){return e.rc2.createDecryptionCipher(t,40)};break;case"RC2-64-CBC":u=8,f=function(t){return e.rc2.createDecryptionCipher(t,64)};break;case"RC2-128-CBC":u=16,f=function(t){return e.rc2.createDecryptionCipher(t,128)};break;default:throw{message:'Could not decrypt private key; unsupported encryption algorithm "'+o.dekInfo.algorithm+'".',algorithm:o.dekInfo.algorithm}}var l=e.util.hexToBytes(o.dekInfo.parameters),c=a(i,l.substr(0,8),u),h=f(c);if(h.start(l),h.update(e.util.createBuffer(o.body)),!h.finish())return s;s=h.output.getBytes()}else s=o.body;return s="ENCRYPTED PRIVATE KEY"===o.type?r.decryptPrivateKeyInfo(n.fromDer(s),i):n.fromDer(s),null!==s&&(s=r.privateKeyFromAsn1(s)),s},r.pbe.generatePkcs12Key=function(t,n,r,i,s,o){var u,a;("undefined"==typeof o||null===o)&&(o=e.md.sha1.create());var f=o.digestLength,l=o.blockLength,c=new e.util.ByteBuffer,h=new e.util.ByteBuffer;for(a=0;a<t.length;a++)h.putInt16(t.charCodeAt(a));h.putInt16(0);var p=h.length(),d=n.length(),v=new e.util.ByteBuffer;v.fillWithByte(r,l);var m=l*Math.ceil(d/l),g=new e.util.ByteBuffer;for(a=0;m>a;a++)g.putByte(n.at(a%d));var y=l*Math.ceil(p/l),b=new e.util.ByteBuffer;for(a=0;y>a;a++)b.putByte(h.at(a%p));var w=g;w.putBuffer(b);for(var E=Math.ceil(s/f),S=1;E>=S;S++){var x=new e.util.ByteBuffer;x.putBytes(v.bytes()),x.putBytes(w.bytes());for(var T=0;i>T;T++)o.start(),o.update(x.getBytes()),x=o.digest();var N=new e.util.ByteBuffer;for(a=0;l>a;a++)N.putByte(x.at(a%f));var C=Math.ceil(d/l)+Math.ceil(p/l),k=new e.util.ByteBuffer;for(u=0;C>u;u++){var L=new e.util.ByteBuffer(w.getBytes(l)),A=511;for(a=N.length()-1;a>=0;a--)A>>=8,A+=N.at(a)+L.at(a),L.setAt(a,255&A);k.putBuffer(L)}w=k,c.putBuffer(x)}return c.truncate(c.length()-s),c},r.pbe.getCipher=function(e,t,n){switch(e){case r.oids.pkcs5PBES2:return r.pbe.getCipherForPBES2(e,t,n);case r.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case r.oids["pbewithSHAAnd40BitRC2-CBC"]:return r.pbe.getCipherForPKCS12PBE(e,t,n);default:throw{message:"Cannot read encrypted PBE data block. Unsupported OID.",oid:e,supportedOids:["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"]}}},r.pbe.getCipherForPBES2=function(t,i,s){var u={},a=[];if(!n.validate(i,o,u,a))throw{message:"Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:a};if(t=n.derToOid(u.kdfOid),t!==r.oids.pkcs5PBKDF2)throw{message:"Cannot read encrypted private key. Unsupported key derivation function OID.",oid:t,supportedOids:["pkcs5PBKDF2"]};if(t=n.derToOid(u.encOid),t!==r.oids["aes128-CBC"]&&t!==r.oids["aes192-CBC"]&&t!==r.oids["aes256-CBC"]&&t!==r.oids["des-EDE3-CBC"]&&t!==r.oids.desCBC)throw{message:"Cannot read encrypted private key. Unsupported encryption scheme OID.",oid:t,supportedOids:["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"]};var f=u.kdfSalt,l=e.util.createBuffer(u.kdfIterationCount);l=l.getInt(l.length()<<3);var c,h;switch(r.oids[t]){case"aes128-CBC":c=16,h=e.aes.createDecryptionCipher;break;case"aes192-CBC":c=24,h=e.aes.createDecryptionCipher;break;case"aes256-CBC":c=32,h=e.aes.createDecryptionCipher;break;case"des-EDE3-CBC":c=24,h=e.des.createDecryptionCipher;break;case"desCBC":c=8,h=e.des.createDecryptionCipher}var p=e.pkcs5.pbkdf2(s,f,l,c),d=u.encIv,v=h(p);return v.start(d),v},r.pbe.getCipherForPKCS12PBE=function(t,i,s){var o={},a=[];if(!n.validate(i,u,o,a))throw{message:"Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.",errors:a};var f=e.util.createBuffer(o.salt),l=e.util.createBuffer(o.iterations);l=l.getInt(l.length()<<3);var c,h,p;switch(t){case r.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:c=24,h=8,p=e.des.startDecrypting;break;case r.oids["pbewithSHAAnd40BitRC2-CBC"]:c=5,h=8,p=function(t,n){var r=e.rc2.createDecryptionCipher(t,40);return r.start(n,null),r};break;default:throw{message:"Cannot read PKCS #12 PBE data block. Unsupported OID.",oid:t}}var d=r.pbe.generatePkcs12Key(s,f,1,l,c),v=r.pbe.generatePkcs12Key(s,f,2,l,h);return p(d,v)}}var r="pbe";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pbe",["require","module","./aes","./asn1","./des","./md","./oids","./pem","./pbkdf2","./random","./rc2","./rsa","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1,n=e.pkcs7asn1=e.pkcs7asn1||{};e.pkcs7=e.pkcs7||{},e.pkcs7.asn1=n;var r={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};n.contentInfoValidator=r;var i={name:"EncryptedContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent"}]};n.envelopedDataValidator={name:"EnvelopedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(i)},n.encryptedDataValidator={name:"EncryptedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"}].concat(i)};var s={name:"SignerInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1},{name:"SignerInfo.IssuerAndSerialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.DigestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.AuthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.DigestEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0},{name:"SignerInfo.EncryptedDigest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.UnauthenticatedAttributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0}]};n.signedDataValidator={name:"SignedData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},r,{name:"SignedData.Certificates",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,capture:"signerInfos",optional:!0,value:[s]}]},n.recipientInfoValidator={name:"RecipientInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:t.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}var r="pkcs7asn1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs7asn1",["require","module","./asn1","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.mgf=e.mgf||{};var t=e.mgf.mgf1=e.mgf1=e.mgf1||{};t.create=function(t){var n={generate:function(n,r){for(var i=new e.util.ByteBuffer,s=Math.ceil(r/t.digestLength),o=0;s>o;o++){var u=new e.util.ByteBuffer;u.putInt32(o),t.start(),t.update(n+u.getBytes()),i.putBuffer(t.digest())}return i.truncate(i.length()-r),i.getBytes()}};return n}}var r="mgf1";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/mgf1",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.mgf=e.mgf||{},e.mgf.mgf1=e.mgf1}var r="mgf";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/mgf",["require","module","./mgf1"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.pss=e.pss||{};t.create=function(t,n,r){var i=t.digestLength,s={};
return s.verify=function(s,o,u){var a,f=u-1,l=Math.ceil(f/8);if(o=o.substr(-l),i+r+2>l)throw{message:"Inconsistent parameters to PSS signature verification."};if(188!==o.charCodeAt(l-1))throw{message:"Encoded message does not end in 0xBC."};var c=l-i-1,h=o.substr(0,c),p=o.substr(c,i),d=65280>>8*l-f&255;if(0!==(h.charCodeAt(0)&d))throw{message:"Bits beyond keysize not zero as expected."};var v=n.generate(p,c),m="";for(a=0;c>a;a++)m+=String.fromCharCode(h.charCodeAt(a)^v.charCodeAt(a));m=String.fromCharCode(m.charCodeAt(0)&~d)+m.substr(1);var g=l-i-r-2;for(a=0;g>a;a++)if(0!==m.charCodeAt(a))throw{message:"Leftmost octets not zero as expected"};if(1!==m.charCodeAt(g))throw{message:"Inconsistent PSS signature, 0x01 marker not found"};var y=m.substr(-r),b=new e.util.ByteBuffer;b.fillWithByte(0,8),b.putBytes(s),b.putBytes(y),t.start(),t.update(b.getBytes());var w=t.digest().getBytes();return p===w},s.encode=function(s,o){var u,a=o-1,f=Math.ceil(a/8),l=s.digest().getBytes();if(i+r+2>f)throw{message:"Message is too long to encrypt"};var c=e.random.getBytes(r),h=new e.util.ByteBuffer;h.fillWithByte(0,8),h.putBytes(l),h.putBytes(c),t.start(),t.update(h.getBytes());var p=t.digest().getBytes(),d=new e.util.ByteBuffer;d.fillWithByte(0,f-r-i-2),d.putByte(1),d.putBytes(c);var v=d.getBytes(),m=f-i-1,g=n.generate(p,m),y="";for(u=0;m>u;u++)y+=String.fromCharCode(v.charCodeAt(u)^g.charCodeAt(u));var b=65280>>8*f-a&255;return y=String.fromCharCode(y.charCodeAt(0)&~b)+y.substr(1),y+p+String.fromCharCode(188)},s}}var r="pss";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pss",["require","module","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function l(e,t){"string"==typeof t&&(t={shortName:t});for(var r,n=null,i=0;null===n&&i<e.attributes.length;++i)r=e.attributes[i],t.type&&t.type===r.type?n=r:t.name&&t.name===r.name?n=r:t.shortName&&t.shortName===r.shortName&&(n=r);return n}function p(n){for(var i,s,r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),o=n.attributes,u=0;u<o.length;++u){i=o[u];var a=i.value,f=t.Type.PRINTABLESTRING;"valueTagClass"in i&&(f=i.valueTagClass,f===t.Type.UTF8&&(a=e.util.encodeUtf8(a))),s=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.type).getBytes()),t.create(t.Class.UNIVERSAL,f,!1,a)])]),r.value.push(s)}return r}function d(e){var n=t.create(t.Class.CONTEXT_SPECIFIC,3,!0,[]),r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);n.value.push(r);for(var i,s,o=0;o<e.length;++o){i=e[o],s=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),r.value.push(s),s.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(i.id).getBytes())),i.critical&&s.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255)));var u=i.value;"string"!=typeof i.value&&(u=t.toDer(u).getBytes()),s.value.push(t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,u))}return n}function m(e){for(var t,r=0;r<e.length;++r){if(t=e[r],"undefined"==typeof t.name&&(t.type&&t.type in n.oids?t.name=n.oids[t.type]:t.shortName&&t.shortName in i&&(t.name=n.oids[i[t.shortName]])),"undefined"==typeof t.type){if(!(t.name&&t.name in n.oids))throw{message:"Attribute type not specified.",attribute:t};t.type=n.oids[t.name]}if("undefined"==typeof t.shortName&&t.name&&t.name in i&&(t.shortName=i[t.name]),"undefined"==typeof t.value)throw{message:"Attribute value not specified.",attribute:t}}}function g(e,n){switch(e){case r["RSASSA-PSS"]:var i=[];return void 0!==n.hash.algorithmOid&&i.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])),void 0!==n.mgf.algorithmOid&&i.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.mgf.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.mgf.hash.algorithmOid).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")])])])),void 0!==n.saltLength&&i.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.saltLength).getBytes())])),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,i);default:return t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")}}function y(n){var r=t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===n.attributes.length)return r;for(var i=n.attributes,s=0;s<i.length;++s){var o=i[s],u=o.value,a=t.Type.UTF8;"valueTagClass"in o&&(a=o.valueTagClass),a===t.Type.UTF8&&(u=e.util.encodeUtf8(u));var f=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(o.type).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,a,!1,u)])]);r.value.push(f)}return r}var t=e.asn1,n=e.pki=e.pki||{},r=n.oids,i={};i.CN=r.commonName,i.commonName="CN",i.C=r.countryName,i.countryName="C",i.L=r.localityName,i.localityName="L",i.ST=r.stateOrProvinceName,i.stateOrProvinceName="ST",i.O=r.organizationName,i.organizationName="O",i.OU=r.organizationalUnitName,i.organizationalUnitName="OU",i.E=r.emailAddress,i.emailAddress="E";var s=e.pki.rsa.publicKeyValidator,o={name:"Certificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:t.Class.UNIVERSAL,type:t.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:t.Class.UNIVERSAL,type:t.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},s,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},u={name:"rsapss",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:t.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:t.Class.UNIVERSAL,type:t.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:t.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:t.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:t.Class.UNIVERSAL,type:t.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},a={name:"CertificationRequestInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},s,{name:"CertificationRequestInfo.attributes",tagClass:t.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0}]}]}]},f={name:"CertificationRequest",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[a,{name:"CertificationRequest.signatureAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};n.RDNAttributesAsArray=function(e,n){for(var o,u,a,s=[],f=0;f<e.value.length;++f){o=e.value[f];for(var l=0;l<o.value.length;++l)a={},u=o.value[l],a.type=t.derToOid(u.value[0].value),a.value=u.value[1].value,a.valueTagClass=u.value[1].type,a.type in r&&(a.name=r[a.type],a.name in i&&(a.shortName=i[a.name])),n&&(n.update(a.type),n.update(a.value)),s.push(a)}return s},n.CRIAttributesAsArray=function(e){for(var n=[],s=0;s<e.length;++s)for(var o=e[s],u=t.derToOid(o.value[0].value),a=o.value[1].value,f=0;f<a.length;++f){var l={};l.type=u,l.value=a[f].value,l.valueTagClass=a[f].type,l.type in r&&(l.name=r[l.type],l.name in i&&(l.shortName=i[l.name])),n.push(l)}return n};var c=function(n){for(var s,o,u,i=[],a=0;a<n.value.length;++a){u=n.value[a];for(var f=0;f<u.value.length;++f){if(o=u.value[f],s={},s.id=t.derToOid(o.value[0].value),s.critical=!1,o.value[1].type===t.Type.BOOLEAN?(s.critical=0!==o.value[1].value.charCodeAt(0),s.value=o.value[2].value):s.value=o.value[1].value,s.id in r)if(s.name=r[s.id],"keyUsage"===s.name){var l=t.fromDer(s.value),c=0,h=0;l.value.length>1&&(c=l.value.charCodeAt(1),h=l.value.length>2?l.value.charCodeAt(2):0),s.digitalSignature=128===(128&c),s.nonRepudiation=64===(64&c),s.keyEncipherment=32===(32&c),s.dataEncipherment=16===(16&c),s.keyAgreement=8===(8&c),s.keyCertSign=4===(4&c),s.cRLSign=2===(2&c),s.encipherOnly=1===(1&c),s.decipherOnly=128===(128&h)}else if("basicConstraints"===s.name){var l=t.fromDer(s.value);s.cA=l.value.length>0&&l.value[0].type===t.Type.BOOLEAN?0!==l.value[0].value.charCodeAt(0):!1;var p=null;l.value.length>0&&l.value[0].type===t.Type.INTEGER?p=l.value[0].value:l.value.length>1&&(p=l.value[1].value),null!==p&&(s.pathLenConstraint=t.derToInteger(p))}else if("extKeyUsage"===s.name)for(var l=t.fromDer(s.value),d=0;d<l.value.length;++d){var v=t.derToOid(l.value[d].value);v in r?s[r[v]]=!0:s[v]=!0}else if("nsCertType"===s.name){var l=t.fromDer(s.value),c=0;l.value.length>1&&(c=l.value.charCodeAt(1)),s.client=128===(128&c),s.server=64===(64&c),s.email=32===(32&c),s.objsign=16===(16&c),s.reserved=8===(8&c),s.sslCA=4===(4&c),s.emailCA=2===(2&c),s.objCA=1===(1&c)}else if("subjectAltName"===s.name||"issuerAltName"===s.name){s.altNames=[];for(var m,l=t.fromDer(s.value),g=0;g<l.value.length;++g){m=l.value[g];var y={type:m.type,value:m.value};switch(s.altNames.push(y),m.type){case 1:case 2:case 6:break;case 7:y.ip=e.util.bytesToIP(m.value);break;case 8:y.oid=t.derToOid(m.value)}}}else if("subjectKeyIdentifier"===s.name){var l=t.fromDer(s.value);s.subjectKeyIdentifier=e.util.bytesToHex(l.value)}i.push(s)}}return i},h=function(e,n,i){var s={};if(e!==r["RSASSA-PSS"])return s;i&&(s={hash:{algorithmOid:r.sha1},mgf:{algorithmOid:r.mgf1,hash:{algorithmOid:r.sha1}},saltLength:20});var o={},a=[];if(!t.validate(n,u,o,a))throw{message:"Cannot read RSASSA-PSS parameter block.",errors:a};return void 0!==o.hashOid&&(s.hash=s.hash||{},s.hash.algorithmOid=t.derToOid(o.hashOid)),void 0!==o.maskGenOid&&(s.mgf=s.mgf||{},s.mgf.algorithmOid=t.derToOid(o.maskGenOid),s.mgf.hash=s.mgf.hash||{},s.mgf.hash.algorithmOid=t.derToOid(o.maskGenHashOid)),void 0!==o.saltLength&&(s.saltLength=o.saltLength.charCodeAt(0)),s};n.certificateFromPem=function(r,i,s){var o=e.pem.decode(r)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type)throw{message:'Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".',headerType:o.type};if(o.procType&&"ENCRYPTED"===o.procType.type)throw{message:"Could not convert certificate from PEM; PEM is encrypted."};var u=t.fromDer(o.body,s);return n.certificateFromAsn1(u,i)},n.certificateToPem=function(r,i){var s={type:"CERTIFICATE",body:t.toDer(n.certificateToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.publicKeyFromPem=function(r){var i=e.pem.decode(r)[0];if("PUBLIC KEY"!==i.type&&"RSA PUBLIC KEY"!==i.type)throw{message:'Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".',headerType:i.type};if(i.procType&&"ENCRYPTED"===i.procType.type)throw{message:"Could not convert public key from PEM; PEM is encrypted."};var s=t.fromDer(i.body);return n.publicKeyFromAsn1(s)},n.publicKeyToPem=function(r,i){var s={type:"PUBLIC KEY",body:t.toDer(n.publicKeyToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.publicKeyToRSAPublicKeyPem=function(r,i){var s={type:"RSA PUBLIC KEY",body:t.toDer(n.publicKeyToRSAPublicKey(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.certificationRequestFromPem=function(r,i,s){var o=e.pem.decode(r)[0];if("CERTIFICATE REQUEST"!==o.type)throw{message:'Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".',headerType:o.type};if(o.procType&&"ENCRYPTED"===o.procType.type)throw{message:"Could not convert certification request from PEM; PEM is encrypted."};var u=t.fromDer(o.body,s);return n.certificationRequestFromAsn1(u,i)},n.certificationRequestToPem=function(r,i){var s={type:"CERTIFICATE REQUEST",body:t.toDer(n.certificationRequestToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.createCertificate=function(){var i={};return i.version=2,i.serialNumber="00",i.signatureOid=null,i.signature=null,i.siginfo={},i.siginfo.algorithmOid=null,i.validity={},i.validity.notBefore=new Date,i.validity.notAfter=new Date,i.issuer={},i.issuer.getField=function(e){return l(i.issuer,e)},i.issuer.addField=function(e){m([e]),i.issuer.attributes.push(e)},i.issuer.attributes=[],i.issuer.hash=null,i.subject={},i.subject.getField=function(e){return l(i.subject,e)},i.subject.addField=function(e){m([e]),i.subject.attributes.push(e)},i.subject.attributes=[],i.subject.hash=null,i.extensions=[],i.publicKey=null,i.md=null,i.setSubject=function(e,t){m(e),i.subject.attributes=e,delete i.subject.uniqueId,t&&(i.subject.uniqueId=t),i.subject.hash=null},i.setIssuer=function(e,t){m(e),i.issuer.attributes=e,delete i.issuer.uniqueId,t&&(i.issuer.uniqueId=t),i.issuer.hash=null},i.setExtensions=function(s){for(var o,u=0;u<s.length;++u){if(o=s[u],"undefined"==typeof o.name&&o.id&&o.id in n.oids&&(o.name=n.oids[o.id]),"undefined"==typeof o.id){if(!(o.name&&o.name in n.oids))throw{message:"Extension ID not specified.",extension:o};o.id=n.oids[o.name]}if("undefined"==typeof o.value){if("keyUsage"===o.name){var a=0,f=0,l=0;o.digitalSignature&&(f|=128,a=7),o.nonRepudiation&&(f|=64,a=6),o.keyEncipherment&&(f|=32,a=5),o.dataEncipherment&&(f|=16,a=4),o.keyAgreement&&(f|=8,a=3),o.keyCertSign&&(f|=4,a=2),o.cRLSign&&(f|=2,a=1),o.encipherOnly&&(f|=1,a=0),o.decipherOnly&&(l|=128,a=7);var c=String.fromCharCode(a);0!==l?c+=String.fromCharCode(f)+String.fromCharCode(l):0!==f&&(c+=String.fromCharCode(f)),o.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,c)}else if("basicConstraints"===o.name)o.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]),o.cA&&o.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in o&&o.value.value.push(t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(o.pathLenConstraint).getBytes()));else if("extKeyUsage"===o.name){o.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var h=o.value.value;for(var p in o)o[p]===!0&&(p in r?h.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r[p]).getBytes())):-1!==p.indexOf(".")&&h.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(p).getBytes())))}else if("nsCertType"===o.name){var a=0,f=0;o.client&&(f|=128,a=7),o.server&&(f|=64,a=6),o.email&&(f|=32,a=5),o.objsign&&(f|=16,a=4),o.reserved&&(f|=8,a=3),o.sslCA&&(f|=4,a=2),o.emailCA&&(f|=2,a=1),o.objCA&&(f|=1,a=0);var c=String.fromCharCode(a);0!==f&&(c+=String.fromCharCode(f)),o.value=t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,c)}else if("subjectAltName"===o.name||"issuerAltName"===o.name){o.value=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);for(var d,v=0;v<o.altNames.length;++v){d=o.altNames[v];var c=d.value;if(7===d.type&&d.ip){if(c=e.util.bytesFromIP(d.ip),null===c)throw{message:'Extension "ip" value is not a valid IPv4 or IPv6 address.',extension:o}}else 8===d.type&&(c=t.oidToDer(d.oid?t.oidToDer(d.oid):c));o.value.value.push(t.create(t.Class.CONTEXT_SPECIFIC,d.type,!1,c))}}else if("subjectKeyIdentifier"===o.name){var m=i.generateSubjectKeyIdentifier();o.subjectKeyIdentifier=m.toHex(),o.value=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,m.getBytes())}if("undefined"==typeof o.value)throw{message:"Extension value not specified.",extension:o}}}i.extensions=s},i.getExtension=function(e){"string"==typeof e&&(e={name:e});for(var n,t=null,r=0;null===t&&r<i.extensions.length;++r)n=i.extensions[r],e.id&&n.id===e.id?t=n:e.name&&n.name===e.name&&(t=n);return t},i.sign=function(s,o){i.md=o||e.md.sha1.create();var u=r[i.md.algorithm+"WithRSAEncryption"];if(!u)throw{message:"Could not compute certificate digest. Unknown message digest algorithm OID.",algorithm:i.md.algorithm};i.signatureOid=i.siginfo.algorithmOid=u,i.tbsCertificate=n.getTBSCertificate(i);var a=t.toDer(i.tbsCertificate);i.md.update(a.getBytes()),i.signature=s.sign(i.md)},i.verify=function(s){var o=!1;if(!i.issued(s)){var u=s.issuer,a=i.subject;throw{message:"The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.",expectedIssuer:u.attributes,actualIssuer:a.attributes}}var f=s.md;if(null===f){if(s.signatureOid in r){var l=r[s.signatureOid];switch(l){case"sha1WithRSAEncryption":f=e.md.sha1.create();break;case"md5WithRSAEncryption":f=e.md.md5.create();break;case"sha256WithRSAEncryption":f=e.md.sha256.create();break;case"RSASSA-PSS":f=e.md.sha256.create()}}if(null===f)throw{message:"Could not compute certificate digest. Unknown signature OID.",signatureOid:s.signatureOid};var c=s.tbsCertificate||n.getTBSCertificate(s),h=t.toDer(c);f.update(h.getBytes())}if(null!==f){var p;switch(s.signatureOid){case r.sha1WithRSAEncryption:p=void 0;break;case r["RSASSA-PSS"]:var d,v;if(d=r[s.signatureParameters.mgf.hash.algorithmOid],void 0===d||void 0===e.md[d])throw{message:"Unsupported MGF hash function.",oid:s.signatureParameters.mgf.hash.algorithmOid,name:d};if(v=r[s.signatureParameters.mgf.algorithmOid],void 0===v||void 0===e.mgf[v])throw{message:"Unsupported MGF function.",oid:s.signatureParameters.mgf.algorithmOid,name:v};if(v=e.mgf[v].create(e.md[d].create()),d=r[s.signatureParameters.hash.algorithmOid],void 0===d||void 0===e.md[d])throw{message:"Unsupported RSASSA-PSS hash function.",oid:s.signatureParameters.hash.algorithmOid,name:d};p=e.pss.create(e.md[d].create(),v,s.signatureParameters.saltLength)}o=i.publicKey.verify(f.digest().getBytes(),s.signature,p)}return o},i.isIssuer=function(e){var t=!1,n=i.issuer,r=e.subject;if(n.hash&&r.hash)t=n.hash===r.hash;else if(n.attributes.length===r.attributes.length){t=!0;for(var s,o,u=0;t&&u<n.attributes.length;++u)s=n.attributes[u],o=r.attributes[u],(s.type!==o.type||s.value!==o.value)&&(t=!1)}return t},i.issued=function(e){return e.isIssuer(i)},i.generateSubjectKeyIdentifier=function(){var r=t.toDer(n.publicKeyToRSAPublicKey(i.publicKey)),s=e.md.sha1.create();return s.update(r.getBytes()),s.digest()},i.verifySubjectKeyIdentifier=function(){for(var t=r.subjectKeyIdentifier,n=0;n<i.extensions.length;++n){var s=i.extensions[n];if(s.id===t){var o=i.generateSubjectKeyIdentifier().getBytes();return e.util.hexToBytes(s.subjectKeyIdentifier)===o}}return!1},i},n.certificateFromAsn1=function(i,s){var u={},a=[];if(!t.validate(i,o,u,a))throw{message:"Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.",errors:a};if("string"!=typeof u.certSignature){for(var f="\x00",p=0;p<u.certSignature.length;++p)f+=t.toDer(u.certSignature[p]).getBytes();u.certSignature=f}var d=t.derToOid(u.publicKeyOid);if(d!==n.oids.rsaEncryption)throw{message:"Cannot read public key. OID is not RSA."};var v=n.createCertificate();v.version=u.certVersion?u.certVersion.charCodeAt(0):0;var g=e.util.createBuffer(u.certSerialNumber);v.serialNumber=g.toHex(),v.signatureOid=e.asn1.derToOid(u.certSignatureOid),v.signatureParameters=h(v.signatureOid,u.certSignatureParams,!0),v.siginfo.algorithmOid=e.asn1.derToOid(u.certinfoSignatureOid),v.siginfo.parameters=h(v.siginfo.algorithmOid,u.certinfoSignatureParams,!1);var y=e.util.createBuffer(u.certSignature);++y.read,v.signature=y.getBytes();var b=[];if(void 0!==u.certValidity1UTCTime&&b.push(t.utcTimeToDate(u.certValidity1UTCTime)),void 0!==u.certValidity2GeneralizedTime&&b.push(t.generalizedTimeToDate(u.certValidity2GeneralizedTime)),void 0!==u.certValidity3UTCTime&&b.push(t.utcTimeToDate(u.certValidity3UTCTime)),void 0!==u.certValidity4GeneralizedTime&&b.push(t.generalizedTimeToDate(u.certValidity4GeneralizedTime)),b.length>2)throw{message:"Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate."};if(b.length<2)throw{message:"Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime."};if(v.validity.notBefore=b[0],v.validity.notAfter=b[1],v.tbsCertificate=u.tbsCertificate,s){if(v.md=null,v.signatureOid in r){var d=r[v.signatureOid];switch(d){case"sha1WithRSAEncryption":v.md=e.md.sha1.create();break;case"md5WithRSAEncryption":v.md=e.md.md5.create();break;case"sha256WithRSAEncryption":v.md=e.md.sha256.create();break;case"RSASSA-PSS":v.md=e.md.sha256.create()}}if(null===v.md)throw{message:"Could not compute certificate digest. Unknown signature OID.",signatureOid:v.signatureOid};var w=t.toDer(v.tbsCertificate);v.md.update(w.getBytes())}var E=e.md.sha1.create();v.issuer.getField=function(e){return l(v.issuer,e)},v.issuer.addField=function(e){m([e]),v.issuer.attributes.push(e)},v.issuer.attributes=n.RDNAttributesAsArray(u.certIssuer,E),u.certIssuerUniqueId&&(v.issuer.uniqueId=u.certIssuerUniqueId),v.issuer.hash=E.digest().toHex();var S=e.md.sha1.create();return v.subject.getField=function(e){return l(v.subject,e)},v.subject.addField=function(e){m([e]),v.subject.attributes.push(e)},v.subject.attributes=n.RDNAttributesAsArray(u.certSubject,S),u.certSubjectUniqueId&&(v.subject.uniqueId=u.certSubjectUniqueId),v.subject.hash=S.digest().toHex(),v.extensions=u.certExtensions?c(u.certExtensions):[],v.publicKey=n.publicKeyFromAsn1(u.subjectPublicKeyInfo),v},n.certificationRequestFromAsn1=function(i,s){var o={},u=[];if(!t.validate(i,f,o,u))throw{message:"Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.",errors:u};if("string"!=typeof o.csrSignature){for(var a="\x00",c=0;c<o.csrSignature.length;++c)a+=t.toDer(o.csrSignature[c]).getBytes();o.csrSignature=a}var p=t.derToOid(o.publicKeyOid);if(p!==n.oids.rsaEncryption)throw{message:"Cannot read public key. OID is not RSA."};var d=n.createCertificationRequest();d.version=o.csrVersion?o.csrVersion.charCodeAt(0):0,d.signatureOid=e.asn1.derToOid(o.csrSignatureOid),d.signatureParameters=h(d.signatureOid,o.csrSignatureParams,!0),d.siginfo.algorithmOid=e.asn1.derToOid(o.csrSignatureOid),d.siginfo.parameters=h(d.siginfo.algorithmOid,o.csrSignatureParams,!1);var v=e.util.createBuffer(o.csrSignature);if(++v.read,d.signature=v.getBytes(),d.certificationRequestInfo=o.certificationRequestInfo,s){if(d.md=null,d.signatureOid in r){var p=r[d.signatureOid];switch(p){case"sha1WithRSAEncryption":d.md=e.md.sha1.create();break;case"md5WithRSAEncryption":d.md=e.md.md5.create();break;case"sha256WithRSAEncryption":d.md=e.md.sha256.create();break;case"RSASSA-PSS":d.md=e.md.sha256.create()}}if(null===d.md)throw{message:"Could not compute certification request digest. Unknown signature OID.",signatureOid:d.signatureOid};var g=t.toDer(d.certificationRequestInfo);d.md.update(g.getBytes())}var y=e.md.sha1.create();return d.subject.getField=function(e){return l(d.subject,e)},d.subject.addField=function(e){m([e]),d.subject.attributes.push(e)},d.subject.attributes=n.RDNAttributesAsArray(o.certificationRequestInfoSubject,y),d.subject.hash=y.digest().toHex(),d.publicKey=n.publicKeyFromAsn1(o.subjectPublicKeyInfo),d.getAttribute=function(e){return l(d.attributes,e)},d.addAttribute=function(e){m([e]),d.attributes.push(e)},d.attributes=n.CRIAttributesAsArray(o.certificationRequestInfoAttributes||[]),d},n.createCertificationRequest=function(){var i={};return i.version=0,i.signatureOid=null,i.signature=null,i.siginfo={},i.siginfo.algorithmOid=null,i.subject={},i.subject.getField=function(e){return l(i.subject,e)},i.subject.addField=function(e){m([e]),i.subject.attributes.push(e)},i.subject.attributes=[],i.subject.hash=null,i.publicKey=null,i.attributes=[],i.getAttribute=function(e){return l(i.attributes,e)},i.addAttribute=function(e){m([e]),i.attributes.push(e)},i.md=null,i.setSubject=function(e){m(e),i.subject.attributes=e,i.subject.hash=null},i.setAttributes=function(e){m(e),i.attributes=e},i.sign=function(s,o){i.md=o||e.md.sha1.create();var u=r[i.md.algorithm+"WithRSAEncryption"];if(!u)throw{message:"Could not compute certification request digest. Unknown message digest algorithm OID.",algorithm:i.md.algorithm};i.signatureOid=i.siginfo.algorithmOid=u,i.certificationRequestInfo=n.getCertificationRequestInfo(i);var a=t.toDer(i.certificationRequestInfo);i.md.update(a.getBytes()),i.signature=s.sign(i.md)},i.verify=function(){var s=!1,o=i.md;if(null===o){if(i.signatureOid in r){var u=r[i.signatureOid];switch(u){case"sha1WithRSAEncryption":o=e.md.sha1.create();break;case"md5WithRSAEncryption":o=e.md.md5.create();break;case"sha256WithRSAEncryption":o=e.md.sha256.create();break;case"RSASSA-PSS":o=e.md.sha256.create()}}if(null===o)throw{message:"Could not compute certification request digest. Unknown signature OID.",signatureOid:i.signatureOid};var a=i.certificationRequestInfo||n.getCertificationRequestInfo(i),f=t.toDer(a);o.update(f.getBytes())}if(null!==o){var l;switch(i.signatureOid){case r.sha1WithRSAEncryption:break;case r["RSASSA-PSS"]:var c,h;if(c=r[i.signatureParameters.mgf.hash.algorithmOid],void 0===c||void 0===e.md[c])throw{message:"Unsupported MGF hash function.",oid:i.signatureParameters.mgf.hash.algorithmOid,name:c};if(h=r[i.signatureParameters.mgf.algorithmOid],void 0===h||void 0===e.mgf[h])throw{message:"Unsupported MGF function.",oid:i.signatureParameters.mgf.algorithmOid,name:h};if(h=e.mgf[h].create(e.md[c].create()),c=r[i.signatureParameters.hash.algorithmOid],void 0===c||void 0===e.md[c])throw{message:"Unsupported RSASSA-PSS hash function.",oid:i.signatureParameters.hash.algorithmOid,name:c};l=e.pss.create(e.md[c].create(),h,i.signatureParameters.saltLength)}s=i.publicKey.verify(o.digest().getBytes(),i.signature,l)}return s},i},n.getTBSCertificate=function(r){var i=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,e.util.hexToBytes(r.serialNumber)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.siginfo.algorithmOid).getBytes()),g(r.siginfo.algorithmOid,r.siginfo.parameters)]),p(r.issuer),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(r.validity.notBefore)),t.create(t.Class.UNIVERSAL,t.Type.UTCTIME,!1,t.dateToUtcTime(r.validity.notAfter))]),p(r.subject),n.publicKeyToAsn1(r.publicKey)]);return r.issuer.uniqueId&&i.value.push(t.create(t.Class.CONTEXT_SPECIFIC,1,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+r.issuer.uniqueId)])),r.subject.uniqueId&&i.value.push(t.create(t.Class.CONTEXT_SPECIFIC,2,!0,[t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+r.subject.uniqueId)])),r.extensions.length>0&&i.value.push(d(r.extensions)),i
},n.getCertificationRequestInfo=function(e){var r=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(e.version).getBytes()),p(e.subject),n.publicKeyToAsn1(e.publicKey),y(e)]);return r},n.distinguishedNameToAsn1=function(e){return p(e)},n.certificateToAsn1=function(e){var r=e.tbsCertificate||n.getTBSCertificate(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[r,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),g(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},n.certificationRequestToAsn1=function(e){var r=e.certificationRequestInfo||n.getCertificationRequestInfo(e);return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[r,t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.signatureOid).getBytes()),g(e.signatureOid,e.signatureParameters)]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},n.createCaStore=function(t){var r={certs:{}};if(r.getIssuer=function(t){var i=null;if(!t.issuer.hash){var s=e.md.sha1.create();t.issuer.attributes=n.RDNAttributesAsArray(p(t.issuer),s),t.issuer.hash=s.digest().toHex()}if(t.issuer.hash in r.certs&&(i=r.certs[t.issuer.hash],e.util.isArray(i)))throw{message:"Resolving multiple issuer matches not implemented yet."};return i},r.addCertificate=function(t){if("string"==typeof t&&(t=e.pki.certificateFromPem(t)),!t.subject.hash){var i=e.md.sha1.create();t.subject.attributes=n.RDNAttributesAsArray(p(t.subject),i),t.subject.hash=i.digest().toHex()}if(t.subject.hash in r.certs){var s=r.certs[t.subject.hash];e.util.isArray(s)||(s=[s]),s.push(t)}else r.certs[t.subject.hash]=t},t)for(var i=0;i<t.length;++i){var s=t[i];r.addCertificate(s)}return r},n.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},n.verifyCertificateChain=function(t,r,i){r=r.slice(0);var s=r.slice(0),o=new Date,u=!0,a=null,f=0,l=null;do{var c=r.shift();if(o<c.validity.notBefore||o>c.validity.notAfter)a={message:"Certificate is not valid yet or has expired.",error:n.certificateError.certificate_expired,notBefore:c.validity.notBefore,notAfter:c.validity.notAfter,now:o};else{var h=!1;if(r.length>0){l=r[0];try{h=l.verify(c)}catch(p){}}else{var d=t.getIssuer(c);if(null===d)a={message:"Certificate is not trusted.",error:n.certificateError.unknown_ca};else for(e.util.isArray(d)||(d=[d]);!h&&d.length>0;){l=d.shift();try{h=l.verify(c)}catch(p){}}}null===a&&!h&&(a={message:"Certificate signature is invalid.",error:n.certificateError.bad_certificate})}if(null===a&&!c.isIssuer(l)&&(a={message:"Certificate issuer is invalid.",error:n.certificateError.bad_certificate}),null===a)for(var v={keyUsage:!0,basicConstraints:!0},m=0;null===a&&m<c.extensions.length;++m){var g=c.extensions[m];g.critical&&!(g.name in v)&&(a={message:"Certificate has an unsupported critical extension.",error:n.certificateError.unsupported_certificate})}if(!u||0===r.length&&!l){var y=c.getExtension("basicConstraints"),b=c.getExtension("keyUsage");if(null!==b&&(!b.keyCertSign||null===y)&&(a={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:n.certificateError.bad_certificate}),null===a&&null!==y&&!y.cA&&(a={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:n.certificateError.bad_certificate}),null===a&&null!==b&&"pathLenConstraint"in y){for(var w=0,m=1;m<r.length-1;++m)r[m].isIssuer(r[m])&&++w;var E=y.pathLenConstraint+1;r.length-w>E&&(a={message:"Certificate basicConstraints pathLenConstraint violated.",error:n.certificateError.bad_certificate})}}var S=null===a?!0:a.error,x=i?i(S,f,s):S;if(x!==!0)throw S===!0&&(a={message:"The application rejected the certificate.",error:n.certificateError.bad_certificate}),(x||0===x)&&("object"!=typeof x||e.util.isArray(x)?"string"==typeof x&&(a.error=x):(x.message&&(a.message=x.message),x.error&&(a.error=x.error))),a;a=null,u=!1,++f}while(r.length>0);return!0}}var r="x509";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n.pki}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/x509",["require","module","./aes","./asn1","./des","./md","./mgf","./oids","./pem","./pss","./rsa","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function f(e,t,n,r){for(var i=[],s=0;s<e.length;s++)for(var o=0;o<e[s].safeBags.length;o++){var u=e[s].safeBags[o];(void 0===r||u.type===r)&&(null!==t?void 0!==u.attributes[t]&&u.attributes[t].indexOf(n)>=0&&i.push(u):i.push(u))}return i}function l(e,r,s,o){if(r=t.fromDer(r,s),r.tagClass!==t.Class.UNIVERSAL||r.type!==t.Type.SEQUENCE||r.constructed!==!0)throw{message:"PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo"};for(var u=0;u<r.value.length;u++){var a=r.value[u],f={},l=[];if(!t.validate(a,i,f,l))throw{message:"Cannot read ContentInfo.",errors:l};var p={encrypted:!1},d=null,v=f.content.value[0];switch(t.derToOid(f.contentType)){case n.oids.data:if(v.tagClass!==t.Class.UNIVERSAL||v.type!==t.Type.OCTETSTRING)throw{message:"PKCS#12 SafeContents Data is not an OCTET STRING."};d=v.value;break;case n.oids.encryptedData:if(void 0===o)throw{message:"Found PKCS#12 Encrypted SafeContents Data but no password available."};d=c(v,o),p.encrypted=!0;break;default:throw{message:"Unsupported PKCS#12 contentType.",contentType:t.derToOid(f.contentType)}}p.safeBags=h(d,s,o),e.safeContents.push(p)}}function c(r,i){var s={},o=[];if(!t.validate(r,e.pkcs7.asn1.encryptedDataValidator,s,o))throw{message:"Cannot read EncryptedContentInfo. ",errors:o};var u=t.derToOid(s.contentType);if(u!==n.oids.data)throw{message:"PKCS#12 EncryptedContentInfo ContentType is not Data.",oid:u};u=t.derToOid(s.encAlgorithm);var a=n.pbe.getCipher(u,s.encParameter,i),f=e.util.createBuffer(s.encryptedContent);if(a.update(f),!a.finish())throw{message:"Failed to decrypt PKCS#12 SafeContents."};return a.output.getBytes()}function h(e,r,i){if(e=t.fromDer(e,r),e.tagClass!==t.Class.UNIVERSAL||e.type!==t.Type.SEQUENCE||e.constructed!==!0)throw{message:"PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag"};for(var s=[],u=0;u<e.value.length;u++){var f=e.value[u],l={},c=[];if(!t.validate(f,o,l,c))throw{message:"Cannot read SafeBag.",errors:c};var h={type:t.derToOid(l.bagId),attributes:p(l.bagAttributes)};s.push(h);var d,v,m=l.bagValue.value[0];switch(h.type){case n.oids.pkcs8ShroudedKeyBag:if(void 0===i)throw{message:"Found PKCS#8 ShroudedKeyBag but no password available."};if(m=n.decryptPrivateKeyInfo(m,i),null===m)throw{message:"Unable to decrypt PKCS#8 ShroudedKeyBag, wrong password?"};case n.oids.keyBag:h.key=n.privateKeyFromAsn1(m);continue;case n.oids.certBag:d=a,v=function(){if(t.derToOid(l.certId)!==n.oids.x509Certificate)throw{message:"Unsupported certificate type, only X.509 supported.",oid:t.derToOid(l.certId)};h.cert=n.certificateFromAsn1(t.fromDer(l.cert,r),!0)};break;default:throw{message:"Unsupported PKCS#12 SafeBag type.",oid:h.type}}if(void 0!==d&&!t.validate(m,d,l,c))throw{message:"Cannot read PKCS#12 "+d.name,errors:c};v()}return s}function p(e){var r={};if(void 0!==e)for(var i=0;i<e.length;++i){var s={},o=[];if(!t.validate(e[i],u,s,o))throw{message:"Cannot read PKCS#12 BagAttribute.",errors:o};var a=t.derToOid(s.oid);if(void 0!==n.oids[a]){r[n.oids[a]]=[];for(var f=0;f<s.values.length;++f)r[n.oids[a]].push(s.values[f].value)}}return r}var t=e.asn1,n=e.pki,r=e.pkcs12=e.pkcs12||{},i={name:"ContentInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},s={name:"PFX",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"version"},i,{name:"PFX.macData",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:t.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,optional:!0,capture:"macIterations"}]}]},o={name:"SafeBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},u={name:"Attribute",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:t.Class.UNIVERSAL,type:t.Type.SET,constructed:!0,capture:"values"}]},a={name:"CertBag",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:t.Class.CONTEXT_SPECIFIC,constructed:!0,value:[{name:"CertBag.certValue[0]",tagClass:t.Class.UNIVERSAL,type:t.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};r.pkcs12FromAsn1=function(i,o,u){"string"==typeof o?(u=o,o=!0):void 0===o&&(o=!0);var a={},c=[];if(!t.validate(i,s,a,c))throw{message:"Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX.",errors:c};var h={version:a.version.charCodeAt(0),safeContents:[],getBags:function(t){var r,n={};return"localKeyId"in t?r=t.localKeyId:"localKeyIdHex"in t&&(r=e.util.hexToBytes(t.localKeyIdHex)),void 0===r&&!("friendlyName"in t)&&"bagType"in t&&(n[t.bagType]=f(h.safeContents,null,null,t.bagType)),void 0!==r&&(n.localKeyId=f(h.safeContents,"localKeyId",r,t.bagType)),"friendlyName"in t&&(n.friendlyName=f(h.safeContents,"friendlyName",t.friendlyName,t.bagType)),n},getBagsByFriendlyName:function(e,t){return f(h.safeContents,"friendlyName",e,t)},getBagsByLocalKeyId:function(e,t){return f(h.safeContents,"localKeyId",e,t)}};if(3!==a.version.charCodeAt(0))throw{message:"PKCS#12 PFX of version other than 3 not supported.",version:a.version.charCodeAt(0)};if(t.derToOid(a.contentType)!==n.oids.data)throw{message:"Only PKCS#12 PFX in password integrity mode supported.",oid:t.derToOid(a.contentType)};var p=a.content.value[0];if(p.tagClass!==t.Class.UNIVERSAL||p.type!==t.Type.OCTETSTRING)throw{message:"PKCS#12 authSafe content data is not an OCTET STRING."};if(a.mac){var d=null,v=0,m=t.derToOid(a.macAlgorithm);switch(m){case n.oids.sha1:d=e.md.sha1.create(),v=20;break;case n.oids.sha256:d=e.md.sha256.create(),v=32;break;case n.oids.sha384:d=e.md.sha384.create(),v=48;break;case n.oids.sha512:d=e.md.sha512.create(),v=64;break;case n.oids.md5:d=e.md.md5.create(),v=16}if(null===d)throw{message:"PKCS#12 uses unsupported MAC algorithm: "+m};var g=new e.util.ByteBuffer(a.macSalt),y="macIterations"in a?parseInt(e.util.bytesToHex(a.macIterations),16):1,b=r.generateKey(u||"",g,3,y,v,d),w=e.hmac.create();w.start(d,b),w.update(p.value);var E=w.getMac();if(E.getBytes()!==a.macDigest)throw{message:"PKCS#12 MAC could not be verified. Invalid password?"}}return l(h,p.value,o,u),h},r.toPkcs12Asn1=function(i,s,o,u){u=u||{},u.saltSize=u.saltSize||8,u.count=u.count||2048,u.algorithm=u.algorithm||u.encAlgorithm||"aes128","useMac"in u||(u.useMac=!0),"localKeyId"in u||(u.localKeyId=null),"generateLocalKeyId"in u||(u.generateLocalKeyId=!0);var f,a=u.localKeyId;if(null!==a)a=e.util.hexToBytes(a);else if(u.generateLocalKeyId)if(s){var l=e.util.isArray(s)?s[0]:s;"string"==typeof l&&(l=n.certificateFromPem(l));var c=e.md.sha1.create();c.update(t.toDer(n.certificateToAsn1(l)).getBytes()),a=c.digest().getBytes()}else a=e.random.getBytes(20);var h=[];null!==a&&h.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.localKeyId).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,a)])])),"friendlyName"in u&&h.push(t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.friendlyName).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,[t.create(t.Class.UNIVERSAL,t.Type.BMPSTRING,!1,u.friendlyName)])])),h.length>0&&(f=t.create(t.Class.UNIVERSAL,t.Type.SET,!0,h));var p=[],d=[];null!==s&&(d=e.util.isArray(s)?s:[s]);for(var v=[],m=0;m<d.length;++m){s=d[m],"string"==typeof s&&(s=n.certificateFromPem(s));var g=0===m?f:void 0,y=n.certificateToAsn1(s),b=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.certBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.x509Certificate).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(y).getBytes())])])]),g]);v.push(b)}if(v.length>0){var w=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,v),E=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(w).getBytes())])]);p.push(E)}var S=null;if(null!==i){var x=n.wrapRsaPrivateKey(n.privateKeyToAsn1(i));S=null===o?t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.keyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[x]),f]):t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.pkcs8ShroudedKeyBag).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[n.encryptPrivateKeyInfo(x,o,u)]),f]);var T=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[S]),N=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(T).getBytes())])]);p.push(N)}var k,C=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,p);if(u.useMac){var c=e.md.sha1.create(),L=new e.util.ByteBuffer(e.random.getBytes(u.saltSize)),A=u.count,i=r.generateKey(o||"",L,3,A,20),O=e.hmac.create();O.start(c,i),O.update(t.toDer(C).getBytes());var M=O.getMac();k=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.sha1).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,M.getBytes())]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,L.getBytes()),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(A).getBytes())])}return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(3).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.oids.data).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(C).getBytes())])]),k])},r.generateKey=e.pbe.generatePkcs12Key}var r="pkcs12";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs12",["require","module","./asn1","./hmac","./oids","./pkcs7asn1","./pbe","./random","./rsa","./sha1","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1,n=e.pki=e.pki||{};n.pemToDer=function(t){var n=e.pem.decode(t)[0];if(n.procType&&"ENCRYPTED"===n.procType.type)throw{message:"Could not convert PEM to DER; PEM is encrypted."};return e.util.createBuffer(n.body)},n.privateKeyFromPem=function(r){var i=e.pem.decode(r)[0];if("PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw{message:'Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".',headerType:i.type};if(i.procType&&"ENCRYPTED"===i.procType.type)throw{message:"Could not convert private key from PEM; PEM is encrypted."};var s=t.fromDer(i.body);return n.privateKeyFromAsn1(s)},n.privateKeyToPem=function(r,i){var s={type:"RSA PRIVATE KEY",body:t.toDer(n.privateKeyToAsn1(r)).getBytes()};return e.pem.encode(s,{maxline:i})},n.privateKeyInfoToPem=function(n,r){var i={type:"PRIVATE KEY",body:t.toDer(n).getBytes()};return e.pem.encode(i,{maxline:r})}}var r="pki";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pki",["require","module","./asn1","./oids","./pbe","./pem","./pbkdf2","./pkcs12","./pss","./rsa","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=function(t,n,r,i){var s=e.util.createBuffer(),o=t.length>>1,u=o+(1&t.length),a=t.substr(0,u),f=t.substr(o,u),l=e.util.createBuffer(),c=e.hmac.create();r=n+r;var h=Math.ceil(i/16),p=Math.ceil(i/20);c.start("MD5",a);var d=e.util.createBuffer();l.putBytes(r);for(var v=0;h>v;++v)c.start(null,null),c.update(l.getBytes()),l.putBuffer(c.digest()),c.start(null,null),c.update(l.bytes()+r),d.putBuffer(c.digest());c.start("SHA1",f);var m=e.util.createBuffer();l.clear(),l.putBytes(r);for(var v=0;p>v;++v)c.start(null,null),c.update(l.getBytes()),l.putBuffer(c.digest()),c.start(null,null),c.update(l.bytes()+r),m.putBuffer(c.digest());return s.putBytes(e.util.xorBytes(d.getBytes(),m.getBytes(),i)),s},r=function(t,n,r){var i=e.hmac.create();i.start("SHA1",t);var s=e.util.createBuffer();return s.putInt32(n[0]),s.putInt32(n[1]),s.putByte(r.type),s.putByte(r.version.major),s.putByte(r.version.minor),s.putInt16(r.length),s.putBytes(r.fragment.bytes()),i.update(s.getBytes()),i.digest().getBytes()},i=function(t,n){var i=!1;try{var s=t.deflate(n.fragment.getBytes());n.fragment=e.util.createBuffer(s),n.length=s.length,i=!0}catch(o){}return i},s=function(t,n){var i=!1;try{var s=t.inflate(n.fragment.getBytes());n.fragment=e.util.createBuffer(s),n.length=s.length,i=!0}catch(o){}return i},o=function(t,n){var r=0;switch(n){case 1:r=t.getByte();break;case 2:r=t.getInt16();break;case 3:r=t.getInt24();break;case 4:r=t.getInt32()}return e.util.createBuffer(t.getBytes(r))},u=function(e,t,n){e.putInt(n.length(),t<<3),e.putBuffer(n)},a={};a.Versions={TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,minor:2},TLS_1_2:{major:3,minor:3}},a.SupportedVersions=[a.Versions.TLS_1_1,a.Versions.TLS_1_0],a.Version=a.SupportedVersions[0],a.MaxFragment=15360,a.ConnectionEnd={server:0,client:1},a.PRFAlgorithm={tls_prf_sha256:0},a.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2},a.CipherType={stream:0,block:1,aead:2},a.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4},a.CompressionMethod={none:0,deflate:1},a.ContentType={change_cipher_spec:20,alert:21,handshake:22,application_data:23,heartbeat:24},a.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20},a.Alert={},a.Alert.Level={warning:1,fatal:2},a.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100},a.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2},a.CipherSuites={},a.getCipherSuite=function(e){var t=null;for(var n in a.CipherSuites){var r=a.CipherSuites[n];if(r.id[0]===e.charCodeAt(0)&&r.id[1]===e.charCodeAt(1)){t=r;break}}return t},a.handleUnexpected=function(e){var n=!e.open&&e.entity===a.ConnectionEnd.client;n||e.error(e,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unexpected_message}})},a.handleHelloRequest=function(e){!e.handshaking&&e.handshakes>0&&(a.queue(e,a.createAlert(e,{level:a.Alert.Level.warning,description:a.Alert.Description.no_renegotiation})),a.flush(e)),e.process()},a.parseHelloMessage=function(t,n,r){var i=null,s=t.entity===a.ConnectionEnd.client;if(38>r)t.error(t,{message:s?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});else{var u=n.fragment,f=u.length();if(i={version:{major:u.getByte(),minor:u.getByte()},random:e.util.createBuffer(u.getBytes(32)),session_id:o(u,1),extensions:[]},s?(i.cipher_suite=u.getBytes(2),i.compression_method=u.getByte()):(i.cipher_suites=o(u,2),i.compression_methods=o(u,1)),f=r-(f-u.length()),f>0){for(var l=o(u,2);l.length()>0;)i.extensions.push({type:[l.getByte(),l.getByte()],data:o(l,2)});if(!s)for(var c=0;c<i.extensions.length;++c){var h=i.extensions[c];if(0===h.type[0]&&0===h.type[1])for(var p=o(h.data,2);p.length()>0;){var d=p.getByte();if(0!==d)break;t.session.extensions.server_name.serverNameList.push(o(p,2).getBytes())}}}if(t.session.version&&(i.version.major!==t.session.version.major||i.version.minor!==t.session.version.minor))return t.error(t,{message:"TLS version change is disallowed during renegotiation.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}});if(s)t.session.cipherSuite=a.getCipherSuite(i.cipher_suite);else for(var v=e.util.createBuffer(i.cipher_suites.bytes());v.length()>0&&(t.session.cipherSuite=a.getCipherSuite(v.getBytes(2)),null===t.session.cipherSuite););if(null===t.session.cipherSuite)return t.error(t,{message:"No cipher suites in common.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.handshake_failure},cipherSuite:e.util.bytesToHex(i.cipher_suite)});t.session.compressionMethod=s?i.compression_method:a.CompressionMethod.none}return i},a.createSecurityParameters=function(e,t){var n=e.entity===a.ConnectionEnd.client,r=t.random.bytes(),i=n?e.session.sp.client_random:r,s=n?r:a.createRandom().getBytes();e.session.sp={entity:e.entity,prf_algorithm:a.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,compression_algorithm:e.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:i,server_random:s}},a.handleServerHello=function(e,t,n){var r=a.parseHelloMessage(e,t,n);if(!e.fail){if(!(r.version.minor<=e.version.minor))return e.error(e,{message:"Incompatible TLS version.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}});e.version.minor=r.version.minor,e.session.version=e.version;var i=r.session_id.bytes();i.length>0&&i===e.session.id?(e.expect=d,e.session.resuming=!0,e.session.sp.server_random=r.random.bytes()):(e.expect=l,e.session.resuming=!1,a.createSecurityParameters(e,r)),e.session.id=i,e.process()}},a.handleClientHello=function(t,n,r){var i=a.parseHelloMessage(t,n,r);if(!t.fail){var s=i.session_id.bytes(),o=null;if(t.sessionCache&&(o=t.sessionCache.getSession(s),null===o?s="":(o.version.major!==i.version.major||o.version.minor>i.version.minor)&&(o=null,s="")),0===s.length&&(s=e.random.getBytes(32)),t.session.id=s,t.session.clientHelloVersion=i.version,t.session.sp={},o)t.version=t.session.version=o.version,t.session.sp=o.sp;else{for(var u,f=1;f<a.SupportedVersions.length&&(u=a.SupportedVersions[f],!(u.minor<=i.version.minor));++f);t.version={major:u.major,minor:u.minor},t.session.version=t.version}null!==o?(t.expect=S,t.session.resuming=!0,t.session.sp.client_random=i.random.bytes()):(t.expect=t.verifyClient!==!1?b:w,t.session.resuming=!1,a.createSecurityParameters(t,i)),t.open=!0,a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createServerHello(t)})),t.session.resuming?(a.queue(t,a.createRecord(t,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),t.state.pending=a.createConnectionState(t),t.state.current.write=t.state.pending.write,a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createFinished(t)}))):(a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createCertificate(t)})),t.fail||(a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createServerKeyExchange(t)})),t.verifyClient!==!1&&a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createCertificateRequest(t)})),a.queue(t,a.createRecord(t,{type:a.ContentType.handshake,data:a.createServerHelloDone(t)})))),a.flush(t),t.process()}},a.handleCertificate=function(t,n,r){if(3>r)return t.error(t,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var u,f,i=n.fragment,s={certificate_list:o(i,3)},l=[];try{for(;s.certificate_list.length()>0;)u=o(s.certificate_list,3),f=e.asn1.fromDer(u),u=e.pki.certificateFromAsn1(f,!0),l.push(u)}catch(h){return t.error(t,{message:"Could not parse certificate list.",cause:h,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}})}var p=t.entity===a.ConnectionEnd.client;!p&&t.verifyClient!==!0||0!==l.length?0===l.length?t.expect=p?c:w:(p?t.session.serverCertificate=l[0]:t.session.clientCertificate=l[0],a.verifyCertificateChain(t,l)&&(t.expect=p?c:w)):t.error(t,{message:p?"No server certificate provided.":"No client certificate provided.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}}),t.process()},a.handleServerKeyExchange=function(e,t,n){return n>0?e.error(e,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unsupported_certificate}}):(e.expect=h,void e.process())},a.handleClientKeyExchange=function(t,n,r){if(48>r)return t.error(t,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unsupported_certificate}});var i=n.fragment,s={enc_pre_master_secret:o(i,2).getBytes()},u=null;if(t.getPrivateKey)try{u=t.getPrivateKey(t,t.session.serverCertificate),u=e.pki.privateKeyFromPem(u)}catch(f){t.error(t,{message:"Could not get private key.",cause:f,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}})}if(null===u)return t.error(t,{message:"No private key set.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}});try{var l=t.session.sp;l.pre_master_secret=u.decrypt(s.enc_pre_master_secret);var c=t.session.clientHelloVersion;if(c.major!==l.pre_master_secret.charCodeAt(0)||c.minor!==l.pre_master_secret.charCodeAt(1))throw{message:"TLS version rollback attack detected."}}catch(f){l.pre_master_secret=e.random.getBytes(48)}t.expect=S,null!==t.session.clientCertificate&&(t.expect=E),t.process()},a.handleCertificateRequest=function(e,t,n){if(3>n)return e.error(e,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var r=t.fragment,i={certificate_types:o(r,1),certificate_authorities:o(r,2)};e.session.certificateRequest=i,e.expect=p,e.process()},a.handleCertificateVerify=function(t,n,r){if(2>r)return t.error(t,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var i=n.fragment;i.read-=4;var s=i.bytes();i.read+=4;var u={signature:o(i,2).getBytes()},f=e.util.createBuffer();f.putBuffer(t.session.md5.digest()),f.putBuffer(t.session.sha1.digest()),f=f.getBytes();try{var l=t.session.clientCertificate;if(!l.publicKey.verify(f,u.signature,"NONE"))throw{message:"CertificateVerify signature does not match."};t.session.md5.update(s),t.session.sha1.update(s)}catch(c){return t.error(t,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.handshake_failure}})}t.expect=S,t.process()},a.handleServerHelloDone=function(t,n,r){if(r>0)return t.error(t,{message:"Invalid ServerHelloDone message. Invalid length.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.record_overflow}});if(null===t.serverCertificate){var i={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.insufficient_security}},s=0,o=t.verify(t,i.alert.description,s,[]);if(o!==!0)return(o||0===o)&&("object"!=typeof o||e.util.isArray(o)?"number"==typeof o&&(i.alert.description=o):(o.message&&(i.message=o.message),o.alert&&(i.alert.description=o.alert))),t.error(t,i)}null!==t.session.certificateRequest&&(n=a.createRecord(t,{type:a.ContentType.handshake,data:a.createCertificate(t)}),a.queue(t,n)),n=a.createRecord(t,{type:a.ContentType.handshake,data:a.createClientKeyExchange(t)}),a.queue(t,n),t.expect=g;var u=function(e,t){null!==e.session.certificateRequest&&null!==e.session.clientCertificate&&a.queue(e,a.createRecord(e,{type:a.ContentType.handshake,data:a.createCertificateVerify(e,t)})),a.queue(e,a.createRecord(e,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),e.state.pending=a.createConnectionState(e),e.state.current.write=e.state.pending.write,a.queue(e,a.createRecord(e,{type:a.ContentType.handshake,data:a.createFinished(e)})),e.expect=d,a.flush(e),e.process()
};return null===t.session.certificateRequest||null===t.session.clientCertificate?u(t,null):void a.getClientSignature(t,u)},a.handleChangeCipherSpec=function(e,t){if(1!==t.fragment.getByte())return e.error(e,{message:"Invalid ChangeCipherSpec message received.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.illegal_parameter}});var n=e.entity===a.ConnectionEnd.client;(e.session.resuming&&n||!e.session.resuming&&!n)&&(e.state.pending=a.createConnectionState(e)),e.state.current.read=e.state.pending.read,(!e.session.resuming&&n||e.session.resuming&&!n)&&(e.state.pending=null),e.expect=n?v:x,e.process()},a.handleFinished=function(n,r){var s=r.fragment;s.read-=4;var o=s.bytes();s.read+=4;var u=r.fragment.getBytes();s=e.util.createBuffer(),s.putBuffer(n.session.md5.digest()),s.putBuffer(n.session.sha1.digest());var f=n.entity===a.ConnectionEnd.client,l=f?"server finished":"client finished",c=n.session.sp,h=12,p=t;return s=p(c.master_secret,l,s.getBytes(),h),s.getBytes()!==u?n.error(n,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.decrypt_error}}):(n.session.md5.update(o),n.session.sha1.update(o),(n.session.resuming&&f||!n.session.resuming&&!f)&&(a.queue(n,a.createRecord(n,{type:a.ContentType.change_cipher_spec,data:a.createChangeCipherSpec()})),n.state.current.write=n.state.pending.write,n.state.pending=null,a.queue(n,a.createRecord(n,{type:a.ContentType.handshake,data:a.createFinished(n)}))),n.expect=f?m:T,n.handshaking=!1,++n.handshakes,n.peerCertificate=f?n.session.serverCertificate:n.session.clientCertificate,a.flush(n),n.isConnected=!0,n.connected(n),n.process(),void 0)},a.handleAlert=function(e,t){var i,n=t.fragment,r={level:n.getByte(),description:n.getByte()};switch(r.description){case a.Alert.Description.close_notify:i="Connection closed.";break;case a.Alert.Description.unexpected_message:i="Unexpected message.";break;case a.Alert.Description.bad_record_mac:i="Bad record MAC.";break;case a.Alert.Description.decryption_failed:i="Decryption failed.";break;case a.Alert.Description.record_overflow:i="Record overflow.";break;case a.Alert.Description.decompression_failure:i="Decompression failed.";break;case a.Alert.Description.handshake_failure:i="Handshake failure.";break;case a.Alert.Description.bad_certificate:i="Bad certificate.";break;case a.Alert.Description.unsupported_certificate:i="Unsupported certificate.";break;case a.Alert.Description.certificate_revoked:i="Certificate revoked.";break;case a.Alert.Description.certificate_expired:i="Certificate expired.";break;case a.Alert.Description.certificate_unknown:i="Certificate unknown.";break;case a.Alert.Description.illegal_parameter:i="Illegal parameter.";break;case a.Alert.Description.unknown_ca:i="Unknown certificate authority.";break;case a.Alert.Description.access_denied:i="Access denied.";break;case a.Alert.Description.decode_error:i="Decode error.";break;case a.Alert.Description.decrypt_error:i="Decrypt error.";break;case a.Alert.Description.export_restriction:i="Export restriction.";break;case a.Alert.Description.protocol_version:i="Unsupported protocol version.";break;case a.Alert.Description.insufficient_security:i="Insufficient security.";break;case a.Alert.Description.internal_error:i="Internal error.";break;case a.Alert.Description.user_canceled:i="User canceled.";break;case a.Alert.Description.no_renegotiation:i="Renegotiation not supported.";break;default:i="Unknown error."}return r.description===a.Alert.Description.close_notify?e.close():(e.error(e,{message:i,send:!1,origin:e.entity===a.ConnectionEnd.client?"server":"client",alert:r}),void e.process())},a.handleHandshake=function(t,n){var r=n.fragment,i=r.getByte(),s=r.getInt24();if(s>r.length())return t.fragmented=n,n.fragment=e.util.createBuffer(),r.read-=4,t.process();t.fragmented=null,r.read-=4;var o=r.bytes(s+4);r.read+=4,i in q[t.entity][t.expect]?(t.entity===a.ConnectionEnd.server&&!t.open&&!t.fail&&(t.handshaking=!0,t.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:e.md.md5.create(),sha1:e.md.sha1.create()}),i!==a.HandshakeType.hello_request&&i!==a.HandshakeType.certificate_verify&&i!==a.HandshakeType.finished&&(t.session.md5.update(o),t.session.sha1.update(o)),q[t.entity][t.expect][i](t,n,s)):a.handleUnexpected(t,n)},a.handleApplicationData=function(e,t){e.data.putBuffer(t.fragment),e.dataReady(e),e.process()},a.handleHeartbeat=function(t,n){var r=n.fragment,i=r.getByte(),s=r.getInt16(),o=r.getBytes(s);if(i===a.HeartbeatMessageType.heartbeat_request){if(t.handshaking||s>o.length)return t.process();a.queue(t,a.createRecord(t,{type:a.ContentType.heartbeat,data:a.createHeartbeat(a.HeartbeatMessageType.heartbeat_response,o)})),a.flush(t)}else if(i===a.HeartbeatMessageType.heartbeat_response){if(o!==t.expectedHeartbeatPayload)return t.process();t.heartbeatReceived&&t.heartbeatReceived(t,e.util.createBuffer(o))}t.process()};var f=0,l=1,c=2,h=3,p=4,d=5,v=6,m=7,g=8,y=0,b=1,w=2,E=3,S=4,x=5,T=6,C=a.handleUnexpected,k=a.handleChangeCipherSpec,L=a.handleAlert,A=a.handleHandshake,O=a.handleApplicationData,M=a.handleHeartbeat,_=[];_[a.ConnectionEnd.client]=[[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[k,L,C,C,M],[C,L,A,C,M],[C,L,A,O,M],[C,L,A,C,M]],_[a.ConnectionEnd.server]=[[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[C,L,A,C,M],[k,L,C,C,M],[C,L,A,C,M],[C,L,A,O,M],[C,L,A,C,M]];var D=a.handleHelloRequest,P=a.handleServerHello,H=a.handleCertificate,B=a.handleServerKeyExchange,j=a.handleCertificateRequest,F=a.handleServerHelloDone,I=a.handleFinished,q=[];q[a.ConnectionEnd.client]=[[C,C,P,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,H,B,j,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,B,j,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,j,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,F,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,I],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[D,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]];var R=a.handleClientHello,U=a.handleClientKeyExchange,z=a.handleCertificateVerify;q[a.ConnectionEnd.server]=[[C,R,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,H,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,U,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,z,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,I],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C],[C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C,C]],a.generateKeys=function(e,n){var r=t,i=n.client_random+n.server_random;e.session.resuming||(n.master_secret=r(n.pre_master_secret,"master secret",i,48).bytes(),n.pre_master_secret=null),i=n.server_random+n.client_random;var s=2*n.mac_key_length+2*n.enc_key_length,o=e.version.major===a.Versions.TLS_1_0.major&&e.version.minor===a.Versions.TLS_1_0.minor;o&&(s+=2*n.fixed_iv_length);var u=r(n.master_secret,"key expansion",i,s),f={client_write_MAC_key:u.getBytes(n.mac_key_length),server_write_MAC_key:u.getBytes(n.mac_key_length),client_write_key:u.getBytes(n.enc_key_length),server_write_key:u.getBytes(n.enc_key_length)};return o&&(f.client_write_IV=u.getBytes(n.fixed_iv_length),f.server_write_IV=u.getBytes(n.fixed_iv_length)),f},a.createConnectionState=function(e){var t=e.entity===a.ConnectionEnd.client,n=function(){var e={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,cipherState:null,cipherFunction:function(){return!0},compressionState:null,compressFunction:function(){return!0},updateSequenceNumber:function(){4294967295===e.sequenceNumber[1]?(e.sequenceNumber[1]=0,++e.sequenceNumber[0]):++e.sequenceNumber[1]}};return e},r={read:n(),write:n()};if(r.read.update=function(e,t){return r.read.cipherFunction(t,r.read)?r.read.compressFunction(e,t,r.read)||e.error(e,{message:"Could not decompress record.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.decompression_failure}}):e.error(e,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_record_mac}}),!e.fail},r.write.update=function(e,t){return r.write.compressFunction(e,t,r.write)?r.write.cipherFunction(t,r.write)||e.error(e,{message:"Could not encrypt record.",send:!1,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}):e.error(e,{message:"Could not compress record.",send:!1,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}),!e.fail},e.session){var o=e.session.sp;switch(e.session.cipherSuite.initSecurityParameters(o),o.keys=a.generateKeys(e,o),r.read.macKey=t?o.keys.server_write_MAC_key:o.keys.client_write_MAC_key,r.write.macKey=t?o.keys.client_write_MAC_key:o.keys.server_write_MAC_key,e.session.cipherSuite.initConnectionState(r,e,o),o.compression_algorithm){case a.CompressionMethod.none:break;case a.CompressionMethod.deflate:r.read.compressFunction=s,r.write.compressFunction=i;break;default:throw{message:"Unsupported compression algorithm."}}}return r},a.createRandom=function(){var t=new Date,n=+t+6e4*t.getTimezoneOffset(),r=e.util.createBuffer();return r.putInt32(n),r.putBytes(e.random.getBytes(28)),r},a.createRecord=function(e,t){if(!t.data)return null;var n={type:t.type,version:{major:e.version.major,minor:e.version.minor},length:t.data.length(),fragment:t.data};return n},a.createAlert=function(t,n){var r=e.util.createBuffer();return r.putByte(n.level),r.putByte(n.description),a.createRecord(t,{type:a.ContentType.alert,data:r})},a.createClientHello=function(t){t.session.clientHelloVersion={major:t.version.major,minor:t.version.minor};for(var n=e.util.createBuffer(),r=0;r<t.cipherSuites.length;++r){var i=t.cipherSuites[r];n.putByte(i.id[0]),n.putByte(i.id[1])}var s=n.length(),o=e.util.createBuffer();o.putByte(a.CompressionMethod.none);var f=o.length(),l=e.util.createBuffer();if(t.virtualHost){var c=e.util.createBuffer();c.putByte(0),c.putByte(0);var h=e.util.createBuffer();h.putByte(0),u(h,2,e.util.createBuffer(t.virtualHost));var p=e.util.createBuffer();u(p,2,h),u(c,2,p),l.putBuffer(c)}var d=l.length();d>0&&(d+=2);var v=t.session.id,m=v.length+1+2+4+28+2+s+1+f+d,g=e.util.createBuffer();return g.putByte(a.HandshakeType.client_hello),g.putInt24(m),g.putByte(t.version.major),g.putByte(t.version.minor),g.putBytes(t.session.sp.client_random),u(g,1,e.util.createBuffer(v)),u(g,2,n),u(g,1,o),d>0&&u(g,2,l),g},a.createServerHello=function(t){var n=t.session.id,r=n.length+1+2+4+28+2+1,i=e.util.createBuffer();return i.putByte(a.HandshakeType.server_hello),i.putInt24(r),i.putByte(t.version.major),i.putByte(t.version.minor),i.putBytes(t.session.sp.server_random),u(i,1,e.util.createBuffer(n)),i.putByte(t.session.cipherSuite.id[0]),i.putByte(t.session.cipherSuite.id[1]),i.putByte(t.session.compressionMethod),i},a.createCertificate=function(t){var n=t.entity===a.ConnectionEnd.client,r=null;if(t.getCertificate){var i;i=n?t.session.certificateRequest:t.session.extensions.server_name.serverNameList,r=t.getCertificate(t,i)}var s=e.util.createBuffer();if(null!==r)try{e.util.isArray(r)||(r=[r]);for(var o=null,f=0;f<r.length;++f){var l=e.pem.decode(r[f])[0];if("CERTIFICATE"!==l.type&&"X509 CERTIFICATE"!==l.type&&"TRUSTED CERTIFICATE"!==l.type)throw{message:'Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".',headerType:l.type};if(l.procType&&"ENCRYPTED"===l.procType.type)throw{message:"Could not convert certificate from PEM; PEM is encrypted."};var c=e.util.createBuffer(l.body);null===o&&(o=e.asn1.fromDer(c.bytes(),!1));var h=e.util.createBuffer();u(h,3,c),s.putBuffer(h)}r=e.pki.certificateFromAsn1(o),n?t.session.clientCertificate=r:t.session.serverCertificate=r}catch(p){return t.error(t,{message:"Could not send certificate list.",cause:p,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}})}var d=3+s.length(),v=e.util.createBuffer();return v.putByte(a.HandshakeType.certificate),v.putInt24(d),u(v,3,s),v},a.createClientKeyExchange=function(t){var n=e.util.createBuffer();n.putByte(t.session.clientHelloVersion.major),n.putByte(t.session.clientHelloVersion.minor),n.putBytes(e.random.getBytes(46));var r=t.session.sp;r.pre_master_secret=n.getBytes();var i=t.session.serverCertificate.publicKey;n=i.encrypt(r.pre_master_secret);var s=n.length+2,o=e.util.createBuffer();return o.putByte(a.HandshakeType.client_key_exchange),o.putInt24(s),o.putInt16(n.length),o.putBytes(n),o},a.createServerKeyExchange=function(){var n=0,r=e.util.createBuffer();return n>0&&(r.putByte(a.HandshakeType.server_key_exchange),r.putInt24(n)),r},a.getClientSignature=function(t,n){var r=e.util.createBuffer();r.putBuffer(t.session.md5.digest()),r.putBuffer(t.session.sha1.digest()),r=r.getBytes(),t.getSignature=t.getSignature||function(t,n,r){var i=null;if(t.getPrivateKey)try{i=t.getPrivateKey(t,t.session.clientCertificate),i=e.pki.privateKeyFromPem(i)}catch(s){t.error(t,{message:"Could not get private key.",cause:s,send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}})}null===i?t.error(t,{message:"No private key set.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.internal_error}}):n=i.sign(n,null),r(t,n)},t.getSignature(t,r,n)},a.createCertificateVerify=function(t,n){var r=n.length+2,i=e.util.createBuffer();return i.putByte(a.HandshakeType.certificate_verify),i.putInt24(r),i.putInt16(n.length),i.putBytes(n),i},a.createCertificateRequest=function(t){var n=e.util.createBuffer();n.putByte(1);var r=e.util.createBuffer();for(var i in t.caStore.certs){var s=t.caStore.certs[i],o=e.pki.distinguishedNameToAsn1(s.subject);r.putBuffer(e.asn1.toDer(o))}var f=1+n.length()+2+r.length(),l=e.util.createBuffer();return l.putByte(a.HandshakeType.certificate_request),l.putInt24(f),u(l,1,n),u(l,2,r),l},a.createServerHelloDone=function(){var n=e.util.createBuffer();return n.putByte(a.HandshakeType.server_hello_done),n.putInt24(0),n},a.createChangeCipherSpec=function(){var t=e.util.createBuffer();return t.putByte(1),t},a.createFinished=function(n){var r=e.util.createBuffer();r.putBuffer(n.session.md5.digest()),r.putBuffer(n.session.sha1.digest());var i=n.entity===a.ConnectionEnd.client,s=n.session.sp,o=12,u=t,f=i?"client finished":"server finished";r=u(s.master_secret,f,r.getBytes(),o);var l=e.util.createBuffer();return l.putByte(a.HandshakeType.finished),l.putInt24(r.length()),l.putBuffer(r),l},a.createHeartbeat=function(t,n,r){"undefined"==typeof r&&(r=n.length);var i=e.util.createBuffer();i.putByte(t),i.putInt16(r),i.putBytes(n);var s=i.length(),o=Math.max(16,s-r-3);return i.putBytes(e.random.getBytes(o)),i},a.queue=function(t,n){if(n){if(n.type===a.ContentType.handshake){var r=n.fragment.bytes();t.session.md5.update(r),t.session.sha1.update(r),r=null}var i;if(n.fragment.length()<=a.MaxFragment)i=[n];else{i=[];for(var s=n.fragment.bytes();s.length>a.MaxFragment;)i.push(a.createRecord(t,{type:n.type,data:e.util.createBuffer(s.slice(0,a.MaxFragment))})),s=s.slice(a.MaxFragment);s.length>0&&i.push(a.createRecord(t,{type:n.type,data:e.util.createBuffer(s)}))}for(var o=0;o<i.length&&!t.fail;++o){var u=i[o],f=t.state.current.write;f.update(t,u)&&t.records.push(u)}}},a.flush=function(e){for(var t=0;t<e.records.length;++t){var n=e.records[t];e.tlsData.putByte(n.type),e.tlsData.putByte(n.version.major),e.tlsData.putByte(n.version.minor),e.tlsData.putInt16(n.fragment.length()),e.tlsData.putBuffer(e.records[t].fragment)}return e.records=[],e.tlsDataReady(e)};var W=function(t){switch(t){case!0:return!0;case e.pki.certificateError.bad_certificate:return a.Alert.Description.bad_certificate;case e.pki.certificateError.unsupported_certificate:return a.Alert.Description.unsupported_certificate;case e.pki.certificateError.certificate_revoked:return a.Alert.Description.certificate_revoked;case e.pki.certificateError.certificate_expired:return a.Alert.Description.certificate_expired;case e.pki.certificateError.certificate_unknown:return a.Alert.Description.certificate_unknown;case e.pki.certificateError.unknown_ca:return a.Alert.Description.unknown_ca;default:return a.Alert.Description.bad_certificate}},X=function(t){switch(t){case!0:return!0;case a.Alert.Description.bad_certificate:return e.pki.certificateError.bad_certificate;case a.Alert.Description.unsupported_certificate:return e.pki.certificateError.unsupported_certificate;case a.Alert.Description.certificate_revoked:return e.pki.certificateError.certificate_revoked;case a.Alert.Description.certificate_expired:return e.pki.certificateError.certificate_expired;case a.Alert.Description.certificate_unknown:return e.pki.certificateError.certificate_unknown;case a.Alert.Description.unknown_ca:return e.pki.certificateError.unknown_ca;default:return e.pki.certificateError.bad_certificate}};a.verifyCertificateChain=function(t,n){try{e.pki.verifyCertificateChain(t.caStore,n,function(r,i,s){var u=(W(r),t.verify(t,r,i,s));if(u!==!0){if("object"==typeof u&&!e.util.isArray(u)){var f={message:"The application rejected the certificate.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.bad_certificate}};throw u.message&&(f.message=u.message),u.alert&&(f.alert.description=u.alert),f}u!==r&&(u=X(u))}return u})}catch(r){var i=r;("object"!=typeof i||e.util.isArray(i))&&(i={send:!0,alert:{level:a.Alert.Level.fatal,description:W(r)}}),"send"in i||(i.send=!0),"alert"in i||(i.alert={level:a.Alert.Level.fatal,description:W(i.error)}),t.error(t,i)}return!t.fail},a.createSessionCache=function(t,n){var r=null;if(t&&t.getSession&&t.setSession&&t.order)r=t;else{r={},r.cache=t||{},r.capacity=Math.max(n||100,1),r.order=[];for(var i in t)r.order.length<=n?r.order.push(i):delete t[i];r.getSession=function(t){var n=null,i=null;if(t?i=e.util.bytesToHex(t):r.order.length>0&&(i=r.order[0]),null!==i&&i in r.cache){n=r.cache[i],delete r.cache[i];for(var s in r.order)if(r.order[s]===i){r.order.splice(s,1);break}}return n},r.setSession=function(t,n){if(r.order.length===r.capacity){var i=r.order.shift();delete r.cache[i]}var i=e.util.bytesToHex(t);r.order.push(i),r.cache[i]=n}}return r},a.createConnection=function(t){var n=null;n=t.caStore?e.util.isArray(t.caStore)?e.pki.createCaStore(t.caStore):t.caStore:e.pki.createCaStore();var r=t.cipherSuites||null;if(null===r){r=[];for(var i in a.CipherSuites)r.push(a.CipherSuites[i])}var s=t.server?a.ConnectionEnd.server:a.ConnectionEnd.client,o=t.sessionCache?a.createSessionCache(t.sessionCache):null,u={version:{major:a.Version.major,minor:a.Version.minor},entity:s,sessionId:t.sessionId,caStore:n,sessionCache:o,cipherSuites:r,connected:t.connected,virtualHost:t.virtualHost||null,verifyClient:t.verifyClient||!1,verify:t.verify||function(e,t){return t},getCertificate:t.getCertificate||null,getPrivateKey:t.getPrivateKey||null,getSignature:t.getSignature||null,input:e.util.createBuffer(),tlsData:e.util.createBuffer(),data:e.util.createBuffer(),tlsDataReady:t.tlsDataReady,dataReady:t.dataReady,heartbeatReceived:t.heartbeatReceived,closed:t.closed,error:function(e,n){n.origin=n.origin||(e.entity===a.ConnectionEnd.client?"client":"server"),n.send&&(a.queue(e,a.createAlert(e,n.alert)),a.flush(e));var r=n.fatal!==!1;r&&(e.fail=!0),t.error(e,n),r&&e.close(!1)},deflate:t.deflate||null,inflate:t.inflate||null};u.reset=function(e){u.version={major:a.Version.major,minor:a.Version.minor},u.record=null,u.session=null,u.peerCertificate=null,u.state={pending:null,current:null},u.expect=u.entity===a.ConnectionEnd.client?f:y,u.fragmented=null,u.records=[],u.open=!1,u.handshakes=0,u.handshaking=!1,u.isConnected=!1,u.fail=!e&&"undefined"!=typeof e,u.input.clear(),u.tlsData.clear(),u.data.clear(),u.state.current=a.createConnectionState(u)},u.reset();var l=function(e,t){var n=t.type-a.ContentType.change_cipher_spec,r=_[e.entity][e.expect];n in r?r[n](e,t):a.handleUnexpected(e,t)},c=function(t){var n=0,r=t.input,i=r.length();if(5>i)n=5-i;else{t.record={type:r.getByte(),version:{major:r.getByte(),minor:r.getByte()},length:r.getInt16(),fragment:e.util.createBuffer(),ready:!1};var s=t.record.version.major===t.version.major;s&&t.session&&t.session.version&&(s=t.record.version.minor===t.version.minor),s||t.error(t,{message:"Incompatible TLS version.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.protocol_version}})}return n},h=function(e){var t=0,n=e.input,r=n.length();if(r<e.record.length)t=e.record.length-r;else{e.record.fragment.putBytes(n.getBytes(e.record.length)),n.compact();var i=e.state.current.read;i.update(e,e.record)&&(null!==e.fragmented&&(e.fragmented.type===e.record.type?(e.fragmented.fragment.putBuffer(e.record.fragment),e.record=e.fragmented):e.error(e,{message:"Invalid fragmented record.",send:!0,alert:{level:a.Alert.Level.fatal,description:a.Alert.Description.unexpected_message}})),e.record.ready=!0)}return t};return u.handshake=function(t){if(u.entity!==a.ConnectionEnd.client)u.error(u,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(u.handshaking)u.error(u,{message:"Handshake already in progress.",fatal:!1});else{u.fail&&!u.open&&0===u.handshakes&&(u.fail=!1),u.handshaking=!0,t=t||"";var n=null;t.length>0&&(u.sessionCache&&(n=u.sessionCache.getSession(t)),null===n&&(t="")),0===t.length&&u.sessionCache&&(n=u.sessionCache.getSession(),null!==n&&(t=n.id)),u.session={id:t,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:e.md.md5.create(),sha1:e.md.sha1.create()},n&&(u.version=n.version,u.session.sp=n.sp),u.session.sp.client_random=a.createRandom().getBytes(),u.open=!0,a.queue(u,a.createRecord(u,{type:a.ContentType.handshake,data:a.createClientHello(u)})),a.flush(u)}},u.process=function(e){var t=0;return e&&u.input.putBytes(e),u.fail||(null!==u.record&&u.record.ready&&u.record.fragment.isEmpty()&&(u.record=null),null===u.record&&(t=c(u)),!u.fail&&null!==u.record&&!u.record.ready&&(t=h(u)),!u.fail&&null!==u.record&&u.record.ready&&l(u,u.record)),t},u.prepare=function(t){return a.queue(u,a.createRecord(u,{type:a.ContentType.application_data,data:e.util.createBuffer(t)})),a.flush(u)},u.prepareHeartbeatRequest=function(t,n){return t instanceof e.util.ByteBuffer&&(t=t.bytes()),"undefined"==typeof n&&(n=t.length),u.expectedHeartbeatPayload=t,a.queue(u,a.createRecord(u,{type:a.ContentType.heartbeat,data:a.createHeartbeat(a.HeartbeatMessageType.heartbeat_request,t,n)})),a.flush(u)},u.close=function(e){if(!u.fail&&u.sessionCache&&u.session){var t={id:u.session.id,version:u.session.version,sp:u.session.sp};t.sp.keys=null,u.sessionCache.setSession(t.id,t)}u.open&&(u.open=!1,u.input.clear(),(u.isConnected||u.handshaking)&&(u.isConnected=u.handshaking=!1,a.queue(u,a.createAlert(u,{level:a.Alert.Level.warning,description:a.Alert.Description.close_notify})),a.flush(u)),u.closed(u)),u.reset(e)},u},e.tls=e.tls||{};for(var V in a)"function"!=typeof a[V]&&(e.tls[V]=a[V]);e.tls.prf_tls1=t,e.tls.hmac_sha1=r,e.tls.createSessionCache=a.createSessionCache,e.tls.createConnection=a.createConnection}var r="tls";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/tls",["require","module","./asn1","./hmac","./md","./pem","./pki","./random","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(n,i,s){var o=i.entity===e.tls.ConnectionEnd.client;n.read.cipherState={init:!1,cipher:e.cipher.createDecipher("AES-CBC",o?s.keys.server_write_key:s.keys.client_write_key),iv:o?s.keys.server_write_IV:s.keys.client_write_IV},n.write.cipherState={init:!1,cipher:e.cipher.createCipher("AES-CBC",o?s.keys.client_write_key:s.keys.server_write_key),iv:o?s.keys.client_write_IV:s.keys.server_write_IV},n.read.cipherFunction=u,n.write.cipherFunction=r,n.read.macLength=n.write.macLength=s.mac_length,n.read.macFunction=n.write.macFunction=t.hmac_sha1}function r(n,r){var s=!1,o=r.macFunction(r.macKey,r.sequenceNumber,n);n.fragment.putBytes(o),r.updateSequenceNumber();var u;u=n.version.minor===t.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:e.random.getBytesSync(16),r.cipherState.init=!0;var a=r.cipherState.cipher;return a.start({iv:u}),n.version.minor>=t.Versions.TLS_1_1.minor&&a.output.putBytes(u),a.update(n.fragment),a.finish(i)&&(n.fragment=a.output,n.length=n.fragment.length(),s=!0),s}function i(e,t,n){if(!n){var r=e-t.length()%e;t.fillWithByte(r-1,r)}return!0}function s(e,t,n){var r=!0;if(n){for(var i=t.length(),s=t.last(),o=i-1-s;i-1>o;++o)r=r&&t.at(o)==s;r&&t.truncate(s+1)}return r}function u(n,r){var i=!1;++o;var u;u=n.version.minor===t.Versions.TLS_1_0.minor?r.cipherState.init?null:r.cipherState.iv:n.fragment.getBytes(16),r.cipherState.init=!0;var a=r.cipherState.cipher;a.start({iv:u}),a.update(n.fragment),i=a.finish(s);for(var f=r.macLength,l="",c=0;f>c;++c)l+=String.fromCharCode(0);var h=a.output.length();h>=f?(n.fragment=a.output.getBytes(h-f),l=a.output.getBytes(f)):n.fragment=a.output.getBytes(),n.fragment=e.util.createBuffer(n.fragment),n.length=n.fragment.length();var p=r.macFunction(r.macKey,r.sequenceNumber,n);return r.updateSequenceNumber(),i=p===l&&i}var t=e.tls;t.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=16,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:n},t.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(e){e.bulk_cipher_algorithm=t.BulkCipherAlgorithm.aes,e.cipher_type=t.CipherType.block,e.enc_key_length=32,e.block_length=16,e.fixed_iv_length=16,e.record_iv_length=16,e.mac_algorithm=t.MACAlgorithm.hmac_sha1,e.mac_length=20,e.mac_key_length=20},initConnectionState:n};var o=0}var r="aesCipherSuites";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/aesCipherSuites",["require","module","./aes","./tls"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.debug=e.debug||{},e.debug.storage={},e.debug.get=function(t,n){var r;return"undefined"==typeof t?r=e.debug.storage:t in e.debug.storage&&(r="undefined"==typeof n?e.debug.storage[t]:e.debug.storage[t][n]),r},e.debug.set=function(t,n,r){t in e.debug.storage||(e.debug.storage[t]={}),e.debug.storage[t][n]=r},e.debug.clear=function(t,n){"undefined"==typeof t?e.debug.storage={}:t in e.debug.storage&&("undefined"==typeof n?delete e.debug.storage[t]:delete e.debug.storage[t][n])}}var r="debug";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/debug",["require","module"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){e.log=e.log||{},e.log.levels=["none","error","warning","info","debug","verbose","max"];var t={},n=[],r=null;e.log.LEVEL_LOCKED=2,e.log.NO_LEVEL_CHECK=4,e.log.INTERPOLATE=8;for(var i=0;i<e.log.levels.length;++i){var s=e.log.levels[i];t[s]={index:i,name:s.toUpperCase()}}e.log.logMessage=function(r){for(var i=t[r.level].index,s=0;s<n.length;++s){var o=n[s];if(o.flags&e.log.NO_LEVEL_CHECK)o.f(r);else{var u=t[o.level].index;u>=i&&o.f(o,r)}}},e.log.prepareStandard=function(e){"standard"in e||(e.standard=t[e.level].name+" ["+e.category+"] "+e.message)},e.log.prepareFull=function(t){if(!("full"in t)){var n=[t.message];n=n.concat([]||t.arguments),t.full=e.util.format.apply(this,n)}},e.log.prepareStandardFull=function(t){"standardFull"in t||(e.log.prepareStandard(t),t.standardFull=t.standard)};for(var o=["error","warning","info","debug","verbose"],i=0;i<o.length;++i)(function(t){e.log[t]=function(n,r){var i=Array.prototype.slice.call(arguments).slice(2),s={timestamp:new Date,level:t,category:n,message:r,arguments:i};e.log.logMessage(s)}})(o[i]);if(e.log.makeLogger=function(t){var n={flags:0,f:t};return e.log.setLevel(n,"none"),n},e.log.setLevel=function(t,n){var r=!1;if(t&&!(t.flags&e.log.LEVEL_LOCKED))for(var i=0;i<e.log.levels.length;++i){var s=e.log.levels[i];if(n==s){t.level=n,r=!0;break}}return r},e.log.lock=function(t,n){"undefined"==typeof n||n?t.flags|=e.log.LEVEL_LOCKED:t.flags&=~e.log.LEVEL_LOCKED},e.log.addLogger=function(e){n.push(e)},"undefined"!=typeof console&&"log"in console){var u;if(console.error&&console.warn&&console.info&&console.debug){var a={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug},f=function(t,n){e.log.prepareStandard(n);var r=a[n.level],i=[n.standard];i=i.concat(n.arguments.slice()),r.apply(console,i)};u=e.log.makeLogger(f)}else{var f=function(t,n){e.log.prepareStandardFull(n),console.log(n.standardFull)};u=e.log.makeLogger(f)}e.log.setLevel(u,"debug"),e.log.addLogger(u),r=u}else console={log:function(){}};if(null!==r){var l=e.util.getQueryVariables();if("console.level"in l&&e.log.setLevel(r,l["console.level"].slice(-1)[0]),"console.lock"in l){var c=l["console.lock"].slice(-1)[0];"true"==c&&e.log.lock(r)}}e.log.consoleLogger=r}var r="log";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/log",["require","module","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t=e.asn1,n=e.pkcs7=e.pkcs7||{};n.messageFromPem=function(r){var i=e.pem.decode(r)[0];if("PKCS7"!==i.type)throw{message:'Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".',headerType:i.type};if(i.procType&&"ENCRYPTED"===i.procType.type)throw{message:"Could not convert PKCS#7 message from PEM; PEM is encrypted."};var s=t.fromDer(i.body);return n.messageFromAsn1(s)},n.messageToPem=function(n,r){var i={type:"PKCS7",body:t.toDer(n.toAsn1()).getBytes()};return e.pem.encode(i,{maxline:r})},n.messageFromAsn1=function(r){var i={},s=[];
if(!t.validate(r,n.asn1.contentInfoValidator,i,s))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.",errors:s};var u,o=t.derToOid(i.contentType);switch(o){case e.pki.oids.envelopedData:u=n.createEnvelopedData();break;case e.pki.oids.encryptedData:u=n.createEncryptedData();break;case e.pki.oids.signedData:u=n.createSignedData();break;default:throw{message:"Cannot read PKCS#7 message. ContentType with OID "+o+" is not (yet) supported."}}return u.fromAsn1(i.content.value[0]),u};var r=function(r){var i={},s=[];if(!t.validate(r,n.asn1.recipientInfoValidator,i,s))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 EnvelopedData.",errors:s};return{version:i.version.charCodeAt(0),issuer:e.pki.RDNAttributesAsArray(i.issuer),serialNumber:e.util.createBuffer(i.serial).toHex(),encryptedContent:{algorithm:t.derToOid(i.encAlgorithm),parameter:i.encParameter.value,content:i.encKey}}},i=function(n){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(n.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[e.pki.distinguishedNameToAsn1({attributes:n.issuer}),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,e.util.hexToBytes(n.serialNumber))]),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.encryptedContent.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.encryptedContent.content)])},s=function(e){for(var t=[],n=0;n<e.length;n++)t.push(r(e[n]));return t},o=function(e){for(var t=[],n=0;n<e.length;n++)t.push(i(e[n]));return t},u=function(n){return[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.pki.oids.data).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(n.algorithm).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.parameter.getBytes())]),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,n.content.getBytes())])]},a=function(n,r,i){var s={},o=[];if(!t.validate(r,i,s,o))throw{message:"Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.",errors:o};var u=t.derToOid(s.contentType);if(u!==e.pki.oids.data)throw{message:"Unsupported PKCS#7 message. Only wrapped ContentType Data supported."};if(s.encryptedContent){var a="";if(e.util.isArray(s.encryptedContent))for(var f=0;f<s.encryptedContent.length;++f){if(s.encryptedContent[f].type!==t.Type.OCTETSTRING)throw{message:"Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects."};a+=s.encryptedContent[f].value}else a=s.encryptedContent;n.encryptedContent={algorithm:t.derToOid(s.encAlgorithm),parameter:e.util.createBuffer(s.encParameter.value),content:e.util.createBuffer(a)}}if(s.content){var a="";if(e.util.isArray(s.content))for(var f=0;f<s.content.length;++f){if(s.content[f].type!==t.Type.OCTETSTRING)throw{message:"Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects."};a+=s.content[f].value}else a=s.content;n.content=e.util.createBuffer(a)}return n.version=s.version.charCodeAt(0),n.rawCapture=s,s},f=function(t){if(void 0===t.encryptedContent.key)throw{message:"Symmetric key not available."};if(void 0===t.content){var n;switch(t.encryptedContent.algorithm){case e.pki.oids["aes128-CBC"]:case e.pki.oids["aes192-CBC"]:case e.pki.oids["aes256-CBC"]:n=e.aes.createDecryptionCipher(t.encryptedContent.key);break;case e.pki.oids.desCBC:case e.pki.oids["des-EDE3-CBC"]:n=e.des.createDecryptionCipher(t.encryptedContent.key);break;default:throw{message:"Unsupported symmetric cipher, OID "+t.encryptedContent.algorithm}}if(n.start(t.encryptedContent.parameter),n.update(t.encryptedContent.content),!n.finish())throw{message:"Symmetric decryption failed."};t.content=n.output}};n.createSignedData=function(){var r=null;return r={type:e.pki.oids.signedData,version:1,certificates:[],crls:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){a(r,t,n.asn1.signedDataValidator),r.certificates=[],r.crls=[],r.digestAlgorithmIdentifiers=[],r.contentInfo=null,r.signerInfos=[];for(var i=r.rawCapture.certificates.value,s=0;s<i.length;++s)r.certificates.push(e.pki.certificateFromAsn1(i[s]))},toAsn1:function(){if("content"in r)throw"Signing PKCS#7 content not yet implemented.";r.contentInfo||r.sign();for(var n=[],i=0;i<r.certificates.length;++i)n.push(e.pki.certificateToAsn1(r.certificates[0]));var s=[];return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,r.digestAlgorithmIdentifiers),r.contentInfo,t.create(t.Class.CONTEXT_SPECIFIC,0,!0,n),t.create(t.Class.CONTEXT_SPECIFIC,1,!0,s),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,r.signerInfos)])])])},sign:function(){if("content"in r)throw"PKCS#7 signing not yet implemented.";"object"!=typeof r.content&&(r.contentInfo=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(e.pki.oids.data).getBytes())]),"content"in r&&r.contentInfo.value.push(t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,r.content)])))},verify:function(){throw"PKCS#7 signature verification not yet implemented."},addCertificate:function(t){"string"==typeof t&&(t=e.pki.certificateFromPem(t)),r.certificates.push(t)},addCertificateRevokationList:function(){throw"PKCS#7 CRL support not yet implemented."}}},n.createEncryptedData=function(){var t=null;return t={type:e.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:e.pki.oids["aes256-CBC"]},fromAsn1:function(e){a(t,e,n.asn1.encryptedDataValidator)},decrypt:function(e){void 0!==e&&(t.encryptedContent.key=e),f(t)}}},n.createEnvelopedData=function(){var r=null;return r={type:e.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:e.pki.oids["aes256-CBC"]},fromAsn1:function(e){var t=a(r,e,n.asn1.envelopedDataValidator);r.recipients=s(t.recipientInfos.value)},toAsn1:function(){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(r.type).getBytes()),t.create(t.Class.CONTEXT_SPECIFIC,0,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(r.version).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SET,!0,o(r.recipients)),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,u(r.encryptedContent))])])])},findRecipient:function(e){for(var t=e.issuer.attributes,n=0;n<r.recipients.length;++n){var i=r.recipients[n],s=i.issuer;if(i.serialNumber===e.serialNumber&&s.length===t.length){for(var o=!0,u=0;u<t.length;++u)if(s[u].type!==t[u].type||s[u].value!==t[u].value){o=!1;break}if(o)return i}}return null},decrypt:function(t,n){if(void 0===r.encryptedContent.key&&void 0!==t&&void 0!==n)switch(t.encryptedContent.algorithm){case e.pki.oids.rsaEncryption:case e.pki.oids.desCBC:var i=n.decrypt(t.encryptedContent.content);r.encryptedContent.key=e.util.createBuffer(i);break;default:throw{message:"Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm}}f(r)},addRecipient:function(t){r.recipients.push({version:0,issuer:t.subject.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:e.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,n){if(void 0===r.encryptedContent.content){n=n||r.encryptedContent.algorithm,t=t||r.encryptedContent.key;var i,s,o;switch(n){case e.pki.oids["aes128-CBC"]:i=16,s=16,o=e.aes.createEncryptionCipher;break;case e.pki.oids["aes192-CBC"]:i=24,s=16,o=e.aes.createEncryptionCipher;break;case e.pki.oids["aes256-CBC"]:i=32,s=16,o=e.aes.createEncryptionCipher;break;case e.pki.oids["des-EDE3-CBC"]:i=24,s=8,o=e.des.createEncryptionCipher;break;default:throw{message:"Unsupported symmetric cipher, OID "+n}}if(void 0===t)t=e.util.createBuffer(e.random.getBytes(i));else if(t.length()!=i)throw{message:"Symmetric key has wrong length; got "+t.length()+" bytes, expected "+i+"."};r.encryptedContent.algorithm=n,r.encryptedContent.key=t,r.encryptedContent.parameter=e.util.createBuffer(e.random.getBytes(s));var u=o(t);if(u.start(r.encryptedContent.parameter.copy()),u.update(r.content),!u.finish())throw{message:"Symmetric encryption failed."};r.encryptedContent.content=u.output}for(var a=0;a<r.recipients.length;a++){var f=r.recipients[a];if(void 0===f.encryptedContent.content)switch(f.encryptedContent.algorithm){case e.pki.oids.rsaEncryption:f.encryptedContent.content=f.encryptedContent.key.encrypt(r.encryptedContent.key.data);break;default:throw{message:"Unsupported asymmetric cipher, OID "+f.encryptedContent.algorithm}}}}}}}var r="pkcs7";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/pkcs7",["require","module","./aes","./asn1","./des","./oids","./pem","./pkcs7asn1","./random","./util","./x509"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){var t="forge.task",n=0,r={},i=0;e.debug.set(t,"tasks",r);var s={};e.debug.set(t,"queues",s);var o="?",u=30,a=20,f="ready",l="running",c="blocked",h="sleeping",p="done",d="error",v="stop",m="start",g="block",y="unblock",b="sleep",w="wakeup",E="cancel",S="fail",x={};x[f]={},x[f][v]=f,x[f][m]=l,x[f][E]=p,x[f][S]=d,x[l]={},x[l][v]=f,x[l][m]=l,x[l][g]=c,x[l][y]=l,x[l][b]=h,x[l][w]=l,x[l][E]=p,x[l][S]=d,x[c]={},x[c][v]=c,x[c][m]=c,x[c][g]=c,x[c][y]=c,x[c][b]=c,x[c][w]=c,x[c][E]=p,x[c][S]=d,x[h]={},x[h][v]=h,x[h][m]=h,x[h][g]=h,x[h][y]=h,x[h][b]=h,x[h][w]=h,x[h][E]=p,x[h][S]=d,x[p]={},x[p][v]=p,x[p][m]=p,x[p][g]=p,x[p][y]=p,x[p][b]=p,x[p][w]=p,x[p][E]=p,x[p][S]=d,x[d]={},x[d][v]=d,x[d][m]=d,x[d][g]=d,x[d][y]=d,x[d][b]=d,x[d][w]=d,x[d][E]=d,x[d][S]=d;var T=function(s){this.id=-1,this.name=s.name||o,this.parent=s.parent||null,this.run=s.run,this.subtasks=[],this.error=!1,this.state=f,this.blocks=0,this.timeoutId=null,this.swapTime=null,this.userData=null,this.id=i++,r[this.id]=this,n>=1&&e.log.verbose(t,"[%s][%s] init",this.id,this.name,this)};T.prototype.debug=function(n){n=n||"",e.log.debug(t,n,"[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",s)},T.prototype.next=function(e,t){"function"==typeof e&&(t=e,e=this.name);var n=new T({run:t,name:e,parent:this});return n.state=l,n.type=this.type,n.successCallback=this.successCallback||null,n.failureCallback=this.failureCallback||null,this.subtasks.push(n),this},T.prototype.parallel=function(t,n){return e.util.isArray(t)&&(n=t,t=this.name),this.next(t,function(r){var i=r;i.block(n.length);for(var s=function(t,r){e.task.start({type:t,run:function(e){n[r](e)},success:function(){i.unblock()},failure:function(){i.unblock()}})},o=0;o<n.length;o++){var u=t+"__parallel-"+r.id+"-"+o,a=o;s(u,a)}})},T.prototype.stop=function(){this.state=x[this.state][v]},T.prototype.start=function(){this.error=!1,this.state=x[this.state][m],this.state===l&&(this.start=new Date,this.run(this),C(this,0))},T.prototype.block=function(e){e="undefined"==typeof e?1:e,this.blocks+=e,this.blocks>0&&(this.state=x[this.state][g])},T.prototype.unblock=function(e){return e="undefined"==typeof e?1:e,this.blocks-=e,0===this.blocks&&this.state!==p&&(this.state=l,C(this,0)),this.blocks},T.prototype.sleep=function(e){e="undefined"==typeof e?0:e,this.state=x[this.state][b];var t=this;this.timeoutId=setTimeout(function(){t.timeoutId=null,t.state=l,C(t,0)},e)},T.prototype.wait=function(e){e.wait(this)},T.prototype.wakeup=function(){this.state===h&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state=l,C(this,0))},T.prototype.cancel=function(){this.state=x[this.state][E],this.permitsNeeded=0,null!==this.timeoutId&&(cancelTimeout(this.timeoutId),this.timeoutId=null),this.subtasks=[]},T.prototype.fail=function(e){if(this.error=!0,k(this,!0),e)e.error=this.error,e.swapTime=this.swapTime,e.userData=this.userData,C(e,0);else{if(null!==this.parent){for(var t=this.parent;null!==t.parent;)t.error=this.error,t.swapTime=this.swapTime,t.userData=this.userData,t=t.parent;k(t,!0)}this.failureCallback&&this.failureCallback(this)}};var N=function(e){e.error=!1,e.state=x[e.state][m],setTimeout(function(){e.state===l&&(e.swapTime=+new Date,e.run(e),C(e,0))},0)},C=function(e,t){var n=t>u||+new Date-e.swapTime>a,r=function(t){if(t++,e.state===l)if(n&&(e.swapTime=+new Date),e.subtasks.length>0){var r=e.subtasks.shift();r.error=e.error,r.swapTime=e.swapTime,r.userData=e.userData,r.run(r),r.error||C(r,t)}else k(e),e.error||null!==e.parent&&(e.parent.error=e.error,e.parent.swapTime=e.swapTime,e.parent.userData=e.userData,C(e.parent,t))};n?setTimeout(r,0):r(t)},k=function(i,o){i.state=p,delete r[i.id],n>=1&&e.log.verbose(t,"[%s][%s] finish",i.id,i.name,i),null===i.parent&&(i.type in s?0===s[i.type].length?e.log.error(t,"[%s][%s] task queue empty [%s]",i.id,i.name,i.type):s[i.type][0]!==i?e.log.error(t,"[%s][%s] task not first in queue [%s]",i.id,i.name,i.type):(s[i.type].shift(),0===s[i.type].length?(n>=1&&e.log.verbose(t,"[%s][%s] delete queue [%s]",i.id,i.name,i.type),delete s[i.type]):(n>=1&&e.log.verbose(t,"[%s][%s] queue start next [%s] remain:%s",i.id,i.name,i.type,s[i.type].length),s[i.type][0].start())):e.log.error(t,"[%s][%s] task queue missing [%s]",i.id,i.name,i.type),o||(i.error&&i.failureCallback?i.failureCallback(i):!i.error&&i.successCallback&&i.successCallback(i)))};e.task=e.task||{},e.task.start=function(r){var i=new T({run:r.run,name:r.name||o});i.type=r.type,i.successCallback=r.success||null,i.failureCallback=r.failure||null,i.type in s?s[r.type].push(i):(n>=1&&e.log.verbose(t,"[%s][%s] create queue [%s]",i.id,i.name,i.type),s[i.type]=[i],N(i))},e.task.cancel=function(e){e in s&&(s[e]=[s[e][0]])},e.task.createCondition=function(){var e={tasks:{}};return e.wait=function(t){t.id in e.tasks||(t.block(),e.tasks[t.id]=t)},e.notify=function(){var t=e.tasks;e.tasks={};for(var n in t)t[n].unblock()},e}}var r="task";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/task",["require","module","./debug","./log","./util"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){function e(e){function n(t,n){var r=n.toString(16);r[0]>="8"&&(r="00"+r);var i=e.util.hexToBytes(r);t.putInt32(i.length),t.putBytes(i)}function r(e,t){e.putInt32(t.length),e.putString(t)}function i(){for(var t=e.md.sha1.create(),n=arguments.length,r=0;n>r;++r)t.update(arguments[r]);return t.digest()}var t=e.ssh=e.ssh||{};t.privateKeyToPutty=function(t,s,o){o=o||"",s=s||"";var u="ssh-rsa",a=""===s?"none":"aes256-cbc",f="PuTTY-User-Key-File-2: "+u+"\r\n";f+="Encryption: "+a+"\r\n",f+="Comment: "+o+"\r\n";var l=e.util.createBuffer();r(l,u),n(l,t.e),n(l,t.n);var c=e.util.encode64(l.bytes(),64),h=Math.floor(c.length/66)+1;f+="Public-Lines: "+h+"\r\n",f+=c;var p=e.util.createBuffer();n(p,t.d),n(p,t.p),n(p,t.q),n(p,t.qInv);var d;if(s){var v=p.length()+16-1;v-=v%16;var m=i(p.bytes());m.truncate(m.length()-v+p.length()),p.putBuffer(m);var g=e.util.createBuffer();g.putBuffer(i("\x00\x00\x00\x00",s)),g.putBuffer(i("\x00\x00\x00",s));var y=e.aes.createEncryptionCipher(g.truncate(8),"CBC");y.start(e.util.createBuffer().fillWithByte(0,16)),y.update(p.copy()),y.finish();var b=y.output;b.truncate(16),d=e.util.encode64(b.bytes(),64)}else d=e.util.encode64(p.bytes(),64);h=Math.floor(d.length/66)+1,f+="\r\nPrivate-Lines: "+h+"\r\n",f+=d;var w=i("putty-private-key-file-mac-key",s),E=e.util.createBuffer();r(E,u),r(E,a),r(E,o),E.putInt32(l.length()),E.putBuffer(l),E.putInt32(p.length()),E.putBuffer(p);var S=e.hmac.create();return S.start("sha1",w),S.update(E.bytes()),f+="\r\nPrivate-MAC: "+S.digest().toHex()+"\r\n"},t.publicKeyToOpenSSH=function(t,i){var s="ssh-rsa";i=i||"";var o=e.util.createBuffer();return r(o,s),n(o,t.e),n(o,t.n),s+" "+e.util.encode64(o.bytes())+" "+i},t.privateKeyToOpenSSH=function(t,n){return n?e.pki.encryptRsaPrivateKey(t,n,{legacy:!0,algorithm:"aes128"}):e.pki.privateKeyToPem(t)}}var r="ssh";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var i=!0;n=function(e,n){n(t,module)}}var s,o=function(t,n){n.exports=function(n){var i=s.map(function(e){return t(e)}).concat(e);if(n=n||{},n.defined=n.defined||{},n.defined[r])return n[r];n.defined[r]=!0;for(var o=0;o<i.length;++o)i[o](n);return n[r]}},u=n;(n=function(e,t){return s="string"==typeof e?t.slice(2):e.slice(2),i?(delete n,u.apply(null,Array.prototype.slice.call(arguments,0))):(n=u,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/ssh",["require","module","./util","./sha1","./aes","./hmac"],function(){o.apply(null,Array.prototype.slice.call(arguments,0))})}(),function(){var e="forge";if("function"!=typeof n){if("object"!=typeof module||!module.exports)return void("undefined"==typeof forge&&(forge={disableNativeCode:!1}));var r=!0;n=function(e,n){n(t,module)}}var i,s=function(t,n){n.exports=function(n){var r=i.map(function(e){return t(e)});if(n=n||{},n.defined=n.defined||{},n.defined[e])return n[e];n.defined[e]=!0;for(var s=0;s<r.length;++s)r[s](n);return n},n.exports.disableNativeCode=!1,n.exports(n.exports)},o=n;(n=function(e,t){return i="string"==typeof e?t.slice(2):e.slice(2),r?(delete n,o.apply(null,Array.prototype.slice.call(arguments,0))):(n=o,n.apply(null,Array.prototype.slice.call(arguments,0)))})("js/forge",["require","module","./aes","./aesCipherSuites","./asn1","./cipher","./cipherModes","./debug","./des","./hmac","./log","./pbkdf2","./pem","./pkcs7","./pkcs1","./pkcs12","./pki","./prng","./pss","./random","./rc2","./task","./tls","./util","./md","./mgf1","./ssh"],function(){s.apply(null,Array.prototype.slice.call(arguments,0))})}(),t("js/forge")}),!function(w){if("object"==typeof exports)module.exports=w();else if("function"==typeof define&&define.amd)define(w);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.eio=w()}}(function(){return function f(g,h,b){function c(d,e){if(!h[d]){if(!g[d]){var k="function"==typeof require&&require;if(!e&&k)return k(d,!0);if(a)return a(d,!0);throw Error("Cannot find module '"+d+"'")}k=h[d]={exports:{}},g[d][0].call(k.exports,function(b){var a=g[d][1][b];return c(a?a:b)},k,k.exports,f,g,h,b)}return h[d].exports}for(var a="function"==typeof require&&require,e=0;e<b.length;e++)c(b[e]);return c}({1:[function(f,g){g.exports=f("./lib/")},{"./lib/":2}],2:[function(f,g){g.exports=f("./socket"),g.exports.parser=f("engine.io-parser")},{"./socket":3,"engine.io-parser":15}],3:[function(f,g){(function(b){function c(a,d){if(!(this instanceof c))return new c(a,d);if(d=d||{},a&&"object"==typeof a&&(d=a,a=null),a&&(a=l(a),d.host=a.host,d.secure="https"==a.protocol||"wss"==a.protocol,d.port=a.port,a.query&&(d.query=a.query)),this.secure=null!=d.secure?d.secure:b.location&&"https:"==location.protocol,d.host){var e=d.host.split(":");d.hostname=e.shift(),e.length&&(d.port=e.pop())}this.agent=d.agent||!1,this.hostname=d.hostname||(b.location?location.hostname:"localhost"),this.port=d.port||(b.location&&location.port?location.port:this.secure?443:80),this.query=d.query||{},"string"==typeof this.query&&(this.query=q.decode(this.query)),this.upgrade=!1!==d.upgrade,this.path=(d.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!d.forceJSONP,this.forceBase64=!!d.forceBase64,this.timestampParam=d.timestampParam||"t",this.timestampRequests=d.timestampRequests,this.transports=d.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=d.policyPort||843,this.rememberUpgrade=d.rememberUpgrade||!1,this.open(),this.binaryType=null,this.onlyBinaryUpgrades=d.onlyBinaryUpgrades}var a=f("./transports"),e=f("component-emitter"),d=f("debug")("engine.io-client:socket"),h=f("indexof"),k=f("engine.io-parser"),l=f("parseuri"),p=f("parsejson"),q=f("parseqs");g.exports=c,c.priorWebsocketSuccess=!1,e(c.prototype),c.protocol=k.protocol,c.Socket=c,c.Transport=f("./transport"),c.transports=f("./transports"),c.parser=f("engine.io-parser"),c.prototype.createTransport=function(b){d('creating transport "%s"',b);var m,c=this.query,e={};for(m in c)c.hasOwnProperty(m)&&(e[m]=c[m]);return e.EIO=k.protocol,e.transport=b,this.id&&(e.sid=this.id),new a[b]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,forceBase64:this.forceBase64,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this})},c.prototype.open=function(){var a;a=this.rememberUpgrade&&c.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket")?"websocket":this.transports[0],this.readyState="opening",a=this.createTransport(a),a.open(),this.setTransport(a)},c.prototype.setTransport=function(a){d("setting transport %s",a.name);var b=this;this.transport&&(d("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},c.prototype.probe=function(a){function b(){if(g.onlyBinaryUpgrades){var m=!this.supportsBinary&&g.transport.supportsBinary;h=h||m}h||(d('probe transport "%s" opened',a),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(b){h||("pong"==b.type&&"probe"==b.data?(d('probe transport "%s" pong',a),g.upgrading=!0,g.emit("upgrading",n),c.priorWebsocketSuccess="websocket"==n.name,d('pausing current transport "%s"',g.transport.name),g.transport.pause(function(){h||"closed"==g.readyState||"closing"==g.readyState||(d("changing transport and sending upgrade packet"),l(),g.setTransport(n),n.send([{type:"upgrade"}]),g.emit("upgrade",n),n=null,g.upgrading=!1,g.flush())})):(d('probe transport "%s" failed',a),b=Error("probe error"),b.transport=n.name,g.emit("upgradeError",b)))}))}function e(){h||(h=!0,l(),n.close(),n=null)}function m(b){var c=Error("probe error: "+b);c.transport=n.name,e(),d('probe transport "%s" failed because of error: %s',a,b),g.emit("upgradeError",c)}function k(){m("transport closed")}function f(){m("socket closed")}function u(a){n&&a.name!=n.name&&(d('"%s" works - aborting "%s"',a.name,n.name),e())}function l(){n.removeListener("open",b),n.removeListener("error",m),n.removeListener("close",k),g.removeListener("close",f),g.removeListener("upgrading",u)}d('probing transport "%s"',a);var n=this.createTransport(a,{probe:1}),h=!1,g=this;c.priorWebsocketSuccess=!1,n.once("open",b),n.once("error",m),n.once("close",k),this.once("close",f),this.once("upgrading",u),n.open()},c.prototype.onOpen=function(){if(d("socket open"),this.readyState="open",c.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){d("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},c.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(d('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(p(a.data));break;case"pong":this.setPing();break;case"error":var b=Error("server error");b.code=a.data,this.emit("error",b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else d('packet received with socket readyState "%s"',this.readyState)},c.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},c.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},c.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){d("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},c.prototype.ping=function(){this.sendPacket("ping")},c.prototype.onDrain=function(){for(var a=0;a<this.prevBufferLen;a++)this.callbackBuffer[a]&&this.callbackBuffer[a]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},c.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(d("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},c.prototype.write=c.prototype.send=function(a,b){return this.sendPacket("message",a,b),this},c.prototype.sendPacket=function(a,b,c){a={type:a,data:b},this.emit("packetCreate",a),this.writeBuffer.push(a),this.callbackBuffer.push(c),this.flush()},c.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),d("socket closing - telling transport to close"),this.transport.close()),this},c.prototype.onError=function(a){d("socket error %j",a),c.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},c.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState){d('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){c.writeBuffer=[],c.callbackBuffer=[],c.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b)}},c.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;d>c;c++)~h(this.transports,a[c])&&b.push(a[c]);return b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":4,"./transports":5,"component-emitter":12,debug:14,"engine.io-parser":15,indexof:23,parsejson:24,parseqs:25,parseuri:26}],4:[function(f,g){function b(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket}var c=f("engine.io-parser");f=f("component-emitter"),g.exports=b,f(b.prototype),b.timestamps=0,b.prototype.onError=function(a,b){var c=Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},b.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},b.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},b.prototype.send=function(a){if("open"!=this.readyState)throw Error("Transport not open");this.write(a)},b.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},b.prototype.onData=function(a){try{var b=c.decodePacket(a,this.socket.binaryType);this.onPacket(b)}catch(d){d.data=a,this.onError("parser decode error",d)}},b.prototype.onPacket=function(a){this.emit("packet",a)},b.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":12,"engine.io-parser":15}],5:[function(f,g,h){(function(b){var c=f("xmlhttprequest"),a=f("./polling-xhr"),e=f("./polling-jsonp"),d=f("./websocket");h.polling=function(d){var k=!1;if(b.location){var k="https:"==location.protocol,f=location.port;f||(f=k?443:80),k=d.hostname!=location.hostname||f!=d.port}return d.xdomain=k,"open"in new c(d)&&!d.forceJSONP?new a(d):new e(d)},h.websocket=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,xmlhttprequest:10}],6:[function(f,g){(function(b){function c(){}function a(a){e.call(this,a),this.query=this.query||{},l||(b.___eio||(b.___eio=[]),l=b.___eio),this.index=l.length;var d=this;l.push(function(a){d.onData(a)}),this.query.j=this.index,b.document&&b.addEventListener&&b.addEventListener("beforeunload",function(){d.script&&(d.script.onerror=c)})}var e=f("./polling"),d=f("component-inherit");g.exports=a;var l,h=/\n/g,k=/\\n/g;d(a,e),a.prototype.supportsBinary=!1,a.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),e.prototype.doClose.call(this)},a.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c),this.script=b,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},a.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{u=document.createElement('<iframe src="javascript:0" name="'+e.iframeId+'">')}catch(b){u=document.createElement("iframe"),u.name=e.iframeId,u.src="javascript:0"}u.id=e.iframeId,e.form.appendChild(u),e.iframe=u}var e=this;if(!this.form){var u,m=document.createElement("form"),f=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;m.className="socketio",m.style.position="absolute",m.style.top="-1000px",m.style.left="-1000px",m.target=l,m.method="POST",m.setAttribute("accept-charset","utf-8"),f.name="d",m.appendChild(f),document.body.appendChild(m),this.form=m,this.area=f}this.form.action=this.uri(),d(),a=a.replace(k,"\\\n"),this.area.value=a.replace(h,"\\n");try{this.form.submit()}catch(g){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,"component-inherit":13}],7:[function(f,g){(function(b){function c(){}function a(a){if(k.call(this,a),b.location){var c="https:"==location.protocol,d=location.port;d||(d=c?443:80),this.xd=a.hostname!=b.location.hostname||d!=a.port}}function e(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.create(a.isBinary,a.supportsBinary)
}function d(){for(var a in e.requests)e.requests.hasOwnProperty(a)&&e.requests[a].abort()}var h=f("xmlhttprequest"),k=f("./polling"),l=f("component-emitter"),p=f("component-inherit"),q=f("debug")("engine.io-client:polling-xhr");g.exports=a,g.exports.Request=e,p(a,k),a.prototype.supportsBinary=!0,a.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,new e(a)},a.prototype.doWrite=function(a,b){var c=this.request({method:"POST",data:a,isBinary:"string"!=typeof a&&void 0!==a}),d=this;c.on("success",b),c.on("error",function(a){d.onError("xhr post error",a)}),this.sendXhr=c},a.prototype.doPoll=function(){q("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},l(e.prototype),e.prototype.create=function(a,c){var d=this.xhr=new h({agent:this.agent,xdomain:this.xd}),m=this;try{if(q("xhr open %s: %s",this.method,this.uri),d.open(this.method,this.uri,this.async),c&&(d.responseType="arraybuffer"),"POST"==this.method)try{a?d.setRequestHeader("Content-type","application/octet-stream"):d.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(f){}"withCredentials"in d&&(d.withCredentials=!0),d.onreadystatechange=function(){var a;try{if(4!=d.readyState)return;200==d.status||1223==d.status?a="application/octet-stream"===d.getResponseHeader("Content-Type")?d.response:c?"ok":d.responseText:setTimeout(function(){m.onError(d.status)},0)}catch(b){m.onError(b)}null!=a&&m.onData(a)},q("xhr data %s",this.data),d.send(this.data)}catch(k){return void setTimeout(function(){m.onError(k)},0)}b.document&&(this.index=e.requestsCount++,e.requests[this.index]=this)},e.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},e.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},e.prototype.onError=function(a){this.emit("error",a),this.cleanup()},e.prototype.cleanup=function(){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.xhr.onreadystatechange=c;try{this.xhr.abort()}catch(a){}b.document&&delete e.requests[this.index],this.xhr=null}},e.prototype.abort=function(){this.cleanup()},b.document&&(e.requestsCount=0,e.requests={},b.attachEvent?b.attachEvent("onunload",d):b.addEventListener&&b.addEventListener("beforeunload",d))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":8,"component-emitter":12,"component-inherit":13,debug:14,xmlhttprequest:10}],8:[function(f,g,h){function b(a){var b=a&&a.forceBase64;(!v||b)&&(this.supportsBinary=!1),c.call(this,a)}var c=f("../transport"),a=f("parseqs"),e=f("engine.io-parser");h=f("component-inherit");var d=f("debug")("engine.io-client:polling");g.exports=b;var v=function(){return null!=new(f("xmlhttprequest"))({agent:this.agent,xdomain:!1}).responseType}();h(b,c),b.prototype.name="polling",b.prototype.doOpen=function(){this.poll()},b.prototype.pause=function(a){function b(){d("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var e=0;this.polling&&(d("we are currently polling - waiting to pause"),e++,this.once("pollComplete",function(){d("pre-pause polling complete"),--e||b()})),this.writable||(d("we are currently writing - waiting to pause"),e++,this.once("drain",function(){d("pre-pause writing complete"),--e||b()}))}else b()},b.prototype.poll=function(){d("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},b.prototype.onData=function(a){var b=this;d("polling got data %s",a),e.decodePayload(a,this.socket.binaryType,function(a){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():d('ignoring poll - transport state "%s"',this.readyState))},b.prototype.doClose=function(){function a(){d("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(d("transport open - closing"),a()):(d("transport not open - deferring close"),this.once("open",a))},b.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;e.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},b.prototype.uri=function(){var b=this.query||{},d=this.secure?"https":"http",e="";return!1!==this.timestampRequests&&(b[this.timestampParam]=+new Date+"-"+c.timestamps++),this.supportsBinary||b.sid||(b.b64=1),b=a.encode(b),this.port&&("https"==d&&443!=this.port||"http"==d&&80!=this.port)&&(e=":"+this.port),b.length&&(b="?"+b),d+"://"+this.hostname+e+this.path+b}},{"../transport":4,"component-inherit":13,debug:14,"engine.io-parser":15,parseqs:25,xmlhttprequest:10}],9:[function(f,g,h){function b(a){a&&a.forceBase64&&(this.supportsBinary=!1),c.call(this,a)}var c=f("../transport"),a=f("engine.io-parser"),e=f("parseqs");h=f("component-inherit");var d=f("debug")("engine.io-client:websocket"),v=f("ws");g.exports=b,h(b,c),b.prototype.name="websocket",b.prototype.supportsBinary=!0,b.prototype.doOpen=function(){if(this.check()){var a=this.uri();this.ws=new v(a,void 0,{agent:this.agent}),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},b.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(b.prototype.onData=function(a){var b=this;setTimeout(function(){c.prototype.onData.call(b,a)},0)}),b.prototype.write=function(b){var c=this;this.writable=!1;for(var e=0,f=b.length;f>e;e++)a.encodePacket(b[e],this.supportsBinary,function(a){try{c.ws.send(a)}catch(b){d("websocket closed before onclose event")}});setTimeout(function(){c.writable=!0,c.emit("drain")},0)},b.prototype.onClose=function(){c.prototype.onClose.call(this)},b.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},b.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";return this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=+new Date),this.supportsBinary||(a.b64=1),a=e.encode(a),a.length&&(a="?"+a),b+"://"+this.hostname+c+this.path+a},b.prototype.check=function(){return!(!v||"__initialize"in v&&this.name===b.prototype.name)}},{"../transport":4,"component-inherit":13,debug:14,"engine.io-parser":15,parseqs:25,ws:27}],10:[function(f,g){var b=f("has-cors");g.exports=function(c){c=c.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!c||b))return new XMLHttpRequest}catch(a){}if(!c)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":21}],11:[function(f,g){(function(b){function c(b,c){c=c||{};for(var d=new a,e=0;e<b.length;e++)d.append(b[e]);return c.type?d.getBlob(c.type):d.getBlob()}var e,a=b.BlobBuilder||b.WebKitBlobBuilder||b.MSBlobBuilder||b.MozBlobBuilder;try{e=2==new Blob(["hi"]).size}catch(d){e=!1}var f=a&&a.prototype.append&&a.prototype.getBlob;b=e?b.Blob:f?c:void 0,g.exports=b}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(f,g){function b(c){if(c){for(var a in b.prototype)c[a]=b.prototype[a];return c}}g.exports=b,b.prototype.on=b.prototype.addEventListener=function(b,a){return this._callbacks=this._callbacks||{},(this._callbacks[b]=this._callbacks[b]||[]).push(a),this},b.prototype.once=function(b,a){function e(){d.off(b,e),a.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},e.fn=a,this.on(b,e),this},b.prototype.off=b.prototype.removeListener=b.prototype.removeAllListeners=b.prototype.removeEventListener=function(b,a){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var e=this._callbacks[b];if(!e)return this;if(1==arguments.length)return delete this._callbacks[b],this;for(var d,f=0;f<e.length;f++)if(d=e[f],d===a||d.fn===a){e.splice(f,1);break}return this},b.prototype.emit=function(b){this._callbacks=this._callbacks||{};var a=[].slice.call(arguments,1),e=this._callbacks[b];if(e)for(var e=e.slice(0),d=0,f=e.length;f>d;++d)e[d].apply(this,a);return this},b.prototype.listeners=function(b){return this._callbacks=this._callbacks||{},this._callbacks[b]||[]},b.prototype.hasListeners=function(b){return!!this.listeners(b).length}},{}],13:[function(f,g){g.exports=function(b,c){var a=function(){};a.prototype=c.prototype,b.prototype=new a,b.prototype.constructor=b}},{}],14:[function(f,g){function b(a){return b.enabled(a)?function(c){c instanceof Error&&(c=c.stack||c.message);var d=new Date,f=d-(b[a]||d);b[a]=d,c=a+" "+c+" +"+b.humanize(f),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}g.exports=b,b.names=[],b.skips=[],b.enable=function(a){try{localStorage.debug=a}catch(c){}for(var d=(a||"").split(/[\s,]+/),f=d.length,h=0;f>h;h++)a=d[h].replace("*",".*?"),"-"===a[0]?b.skips.push(new RegExp("^"+a.substr(1)+"$")):b.names.push(new RegExp("^"+a+"$"))},b.disable=function(){b.enable("")},b.humanize=function(a){return a>=36e5?(a/36e5).toFixed(1)+"h":a>=6e4?(a/6e4).toFixed(1)+"m":a>=1e3?(a/1e3|0)+"s":a+"ms"},b.enabled=function(a){for(var c=0,d=b.skips.length;d>c;c++)if(b.skips[c].test(a))return!1;for(c=0,d=b.names.length;d>c;c++)if(b.names[c].test(a))return!0;return!1};try{window.localStorage&&b.enable(localStorage.debug)}catch(c){}},{}],15:[function(f,g,h){(function(b){function c(a,b,c){if(!b)return h.encodeBase64Packet(a,c);var d=new FileReader;return d.onload=function(){a.data=d.result,h.encodePacket(a,b,c)},d.readAsArrayBuffer(a.data)}function a(a,b,c){var d=Array(a.length);c=k(a.length,c);for(var e=function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})},f=0;f<a.length;f++)e(f,a[f],c)}var e=f("./keys"),d=f("arraybuffer.slice"),g=f("base64-arraybuffer"),k=f("after"),l=f("utf8"),p=navigator.userAgent.match(/Android/i);h.protocol=2;var q=h.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},t=e(q),r={type:"error",data:"parser error"},s=f("blob");h.encodePacket=function(a,d,e){"function"==typeof d&&(e=d,d=!1);var f=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&f instanceof ArrayBuffer){if(d){for(f=a.data,d=new Uint8Array(f),f=new Uint8Array(1+f.byteLength),f[0]=q[a.type],a=0;a<d.length;a++)f[a+1]=d[a];a=e(f.buffer)}else a=h.encodeBase64Packet(a,e);return a}return s&&f instanceof b.Blob?(d?p?a=c(a,d,e):(d=new Uint8Array(1),d[0]=q[a.type],a=new s([d.buffer,a.data]),a=e(a)):a=h.encodeBase64Packet(a,e),a):(d=q[a.type],void 0!==a.data&&(d+=l.encode(String(a.data))),e(""+d))},h.encodeBase64Packet=function(a,d){var c="b"+h.packets[a.type];if(s&&a.data instanceof s){var e=new FileReader;return e.onload=function(){var a=e.result.split(",")[1];d(c+a)},e.readAsDataURL(a.data)}var f;try{f=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(g){f=new Uint8Array(a.data);for(var l=Array(f.length),k=0;k<f.length;k++)l[k]=f[k];f=String.fromCharCode.apply(null,l)}return c+=b.btoa(f),d(c)},h.decodePacket=function(a,b){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return h.decodeBase64Packet(a.substr(1),b);a=l.decode(a);var c=a.charAt(0);return Number(c)==c&&t[c]?1<a.length?{type:t[c],data:a.substring(1)}:{type:t[c]}:r}var c=new Uint8Array(a)[0],e=d(a,1);return s&&"blob"===b&&(e=new s([e])),{type:t[c],data:e}},h.decodeBase64Packet=function(a,c){var d=t[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var e=g.decode(a.substr(1));return"blob"===c&&s&&(e=new s([e])),{type:d,data:e}},h.encodePayload=function(b,c,d){return"function"==typeof c&&(d=c,c=null),c?s&&!p?h.encodePayloadAsBlob(b,d):h.encodePayloadAsArrayBuffer(b,d):b.length?void a(b,function(a,b){h.encodePacket(a,c,function(a){b(null,a.length+":"+a)})},function(a,b){return d(b.join(""))}):d("0:")},h.decodePayload=function(a,b,c){if("string"!=typeof a)return h.decodePayloadAsBinary(a,b,c);"function"==typeof b&&(c=b,b=null);var d;if(""==a)return c(r,0,1);d="";for(var e,f,g=0,l=a.length;l>g;g++)if(f=a.charAt(g),":"!=f)d+=f;else{if(""==d||d!=(e=Number(d)))return c(r,0,1);if(f=a.substr(g+1,e),d!=f.length)return c(r,0,1);if(f.length){if(d=h.decodePacket(f,b),r.type==d.type&&r.data==d.data)return c(r,0,1);if(!1===c(d,g+e,l))return}g+=e,d=""}return""!=d?c(r,0,1):void 0},h.encodePayloadAsArrayBuffer=function(b,c){return b.length?void a(b,function(a,b){h.encodePacket(a,!0,function(a){return b(null,a)})},function(a,b){var d=b.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return b.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var c=new Uint8Array(a.length),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);c=c.buffer}for(e[f++]=b?0:1,a=c.byteLength.toString(),d=0;d<a.length;d++)e[f++]=parseInt(a[d]);for(e[f++]=255,c=new Uint8Array(c),d=0;d<c.length;d++)e[f++]=c[d]}),c(e.buffer)}):c(new ArrayBuffer(0))},h.encodePayloadAsBlob=function(b,c){a(b,function(a,b){h.encodePacket(a,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var d=(a instanceof ArrayBuffer?a.byteLength:a.size).toString(),f=new Uint8Array(d.length+1),e=0;e<d.length;e++)f[e]=parseInt(d[e]);f[d.length]=255,s&&(a=new s([c.buffer,f.buffer,a]),b(null,a))})},function(a,b){return c(new s(b))})},h.decodePayloadAsBinary=function(a,b,c){"function"==typeof b&&(c=b,b=null);for(var e=[];0<a.byteLength;){for(var f=new Uint8Array(a),g=0===f[0],l="",k=1;255!=f[k];k++)l+=f[k];if(a=d(a,2+l.length),l=parseInt(l),f=d(a,0,l),g)try{f=String.fromCharCode.apply(null,new Uint8Array(f))}catch(p){for(g=new Uint8Array(f),f="",k=0;k<g.length;k++)f+=String.fromCharCode(g[k])}e.push(f),a=d(a,l)}var v=e.length;e.forEach(function(a,d){c(h.decodePacket(a,b),d,v)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":16,after:17,"arraybuffer.slice":18,"base64-arraybuffer":19,blob:11,utf8:20}],16:[function(f,g){g.exports=Object.keys||function(b){var e,c=[],a=Object.prototype.hasOwnProperty;for(e in b)a.call(b,e)&&c.push(e);return c}},{}],17:[function(f,g){function b(){}g.exports=function(c,a,e){function d(b,c){if(0>=d.count)throw Error("after called too many times");--d.count,b?(f=!0,a(b),a=e):0!==d.count||f||a(null,c)}var f=!1;return e=e||b,d.count=c,0===c?a():d}},{}],18:[function(f,g){g.exports=function(b,c,a){var e=b.byteLength;if(c=c||0,a=a||e,b.slice)return b.slice(c,a);if(0>c&&(c+=e),0>a&&(a+=e),a>e&&(a=e),c>=e||c>=a||0===e)return new ArrayBuffer(0);b=new Uint8Array(b);for(var e=new Uint8Array(a-c),d=0;a>c;c++,d++)e[d]=b[c];return e.buffer}},{}],19:[function(f,g,h){!function(b){h.encode=function(c){c=new Uint8Array(c);var a,e=c.length,d="";for(a=0;e>a;a+=3)d+=b[c[a]>>2],d+=b[(3&c[a])<<4|c[a+1]>>4],d+=b[(15&c[a+1])<<2|c[a+2]>>6],d+=b[63&c[a+2]];return 2===e%3?d=d.substring(0,d.length-1)+"=":1===e%3&&(d=d.substring(0,d.length-2)+"=="),d},h.decode=function(c){var f,g,h,p,a=.75*c.length,e=c.length,d=0;"="===c[c.length-1]&&(a--,"="===c[c.length-2]&&a--);for(var q=new ArrayBuffer(a),t=new Uint8Array(q),a=0;e>a;a+=4)f=b.indexOf(c[a]),g=b.indexOf(c[a+1]),h=b.indexOf(c[a+2]),p=b.indexOf(c[a+3]),t[d++]=f<<2|g>>4,t[d++]=(15&g)<<4|h>>2,t[d++]=(3&h)<<6|63&p;return q}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],20:[function(f,g,h){(function(b){!function(c){function a(a){for(var e,f,b=[],c=0,d=a.length;d>c;)e=a.charCodeAt(c++),e>=55296&&56319>=e&&d>c?(f=a.charCodeAt(c++),56320==(64512&f)?b.push(((1023&e)<<10)+(1023&f)+65536):(b.push(e),c--)):b.push(e);return b}function e(){if(r>=t)throw Error("Invalid byte index");var a=255&q[r];if(r++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function d(){var a,b,c,d;if(r>t)throw Error("Invalid byte index");if(r==t)return!1;if(a=255&q[r],r++,0==(128&a))return a;if(192==(224&a)){if(b=e(),a=(31&a)<<6|b,a>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=e(),c=e(),a=(15&a)<<12|b<<6|c,a>=2048)return a;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=e(),c=e(),d=e(),a=(15&a)<<18|b<<12|c<<6|d,a>=65536&&1114111>=a))return a;throw Error("Invalid UTF-8 detected")}var f="object"==typeof h&&h,k="object"==typeof g&&g&&g.exports==f&&g,l="object"==typeof b&&b;(l.global===l||l.window===l)&&(c=l);var q,t,r,p=String.fromCharCode,l={version:"2.0.0",encode:function(b){b=a(b);for(var e,c=b.length,d=-1,f="";++d<c;){if(e=b[d],0==(4294967168&e))e=p(e);else{var g="";0==(4294965248&e)?g=p(e>>6&31|192):0==(4294901760&e)?(g=p(e>>12&15|224),g+=p(e>>6&63|128)):0==(4292870144&e)&&(g=p(e>>18&7|240),g+=p(e>>12&63|128),g+=p(e>>6&63|128)),e=g+=p(63&e|128)}f+=e}return f},decode:function(b){q=a(b),t=q.length,r=0,b=[];for(var c;!1!==(c=d());)b.push(c);c=b.length;for(var f,e=-1,g="";++e<c;)f=b[e],f>65535&&(f-=65536,g+=p(f>>>10&1023|55296),f=56320|1023&f),g+=p(f);return g}};if(f&&!f.nodeType)if(k)k.exports=l;else{c={}.hasOwnProperty;for(var s in l)c.call(l,s)&&(f[s]=l[s])}else c.utf8=l}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(f,g){f=f("global");try{g.exports="XMLHttpRequest"in f&&"withCredentials"in new f.XMLHttpRequest}catch(b){g.exports=!1}},{global:22}],22:[function(f,g){g.exports=function(){return this}()},{}],23:[function(f,g){var b=[].indexOf;g.exports=function(c,a){if(b)return c.indexOf(a);for(var e=0;e<c.length;++e)if(c[e]===a)return e;return-1}},{}],24:[function(f,g){(function(b){var c=/^[\],:{}\s]*$/,a=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,d=/(?:^|:|,)(?:\s*\[)+/g,f=/^\s+/,h=/\s+$/;g.exports=function(g){return"string"==typeof g&&g?(g=g.replace(f,"").replace(h,""),b.JSON&&JSON.parse?JSON.parse(g):c.test(g.replace(a,"@").replace(e,"]").replace(d,""))?new Function("return "+g)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],25:[function(f,g,h){h.encode=function(b){var a,c="";for(a in b)b.hasOwnProperty(a)&&(c.length&&(c+="&"),c+=encodeURIComponent(a)+"="+encodeURIComponent(b[a]));return c},h.decode=function(b){var c={};b=b.split("&");for(var a=0,e=b.length;e>a;a++){var d=b[a].split("=");c[decodeURIComponent(d[0])]=decodeURIComponent(d[1])}return c}},{}],26:[function(f,g){var b=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");g.exports=function(a){a=b.exec(a||"");for(var e={},d=14;d--;)e[c[d]]=a[d]||"";return e}},{}],27:[function(f,g){function b(a,b){return b?new c(a,b):new c(a)}f=function(){return this}();var c=f.WebSocket||f.MozWebSocket;g.exports=c?b:null,c&&(b.prototype=c.prototype)},{}]},{},[1])(1)});var api={map:{},emit:function(type,data){if(this.map[type])for(var i in this.map[type])this.map[type][i](data)},on:function(type,handler){this.map[type]||(this.map[type]=[]),this.map[type].push(handler)}},appcore={version:.26,connected:!1,sock:null,sockbuffer:[],write:null,map:{},generatedRSAKey:null,username:"",displayname:"",uid:"",passwordTempHolder:"",pubKey:"",derivedKeySalt:"",derivedKey:"",derivedKeyHash:"",activeCall:"",list:[],listHash:{},profileBlob:{},reconnect:-1,bufferTimestampIgnore:[],bufferTimestampReplace:[],userList:[],noListBuffer:[],currentUploadTarget:""};appcore.sockemit=function(type,message){if(!appcore.sock)throw new Error("No socket is defined.");"raw"!=type?(message.sockType=type,appcore.connected?appcore.sock.send(JSON.stringify(message)):appcore.sockbuffer.push(message)):appcore.sock.send(message)},appcore.sockon=function(type,callback){appcore.map[type]&&console.log("WARNING: Rebinding for "+type),appcore.map[type]=callback},api.on("connect",function(){if(!appcore.connected){var server="wss://subrosa.io";"#local"==document.location.hash&&(server=""),appcore.sock=new eio(server),appcore.sock.on("open",function(){console.log("open"),appcore.connected=!0,clearInterval(appcore.reconnect),appcore.reconnect=-1,appcore.derivedKey&&appcore.sockemit("loginMain",{step:2,username:appcore.username,hash:appcore.derivedKeyHash,resendBlob:!1});for(var i in appcore.sockbuffer)appcore.sock.send(JSON.stringify(appcore.sockbuffer[i]));appcore.sockbuffer=[],api.emit("connectionState",{state:"connected"})}),appcore.sock.on("message",function(data){if("{"==data[0])if(appcore.map[data[0]])appcore.map[data[0]](data.substr(1));else{try{data=JSON.parse(data)}catch(error){return}if(!data.sockType)throw new Error("Unknown type"+data.sockType);appcore.map[data.sockType]&&appcore.map[data.sockType](data)}}),appcore.sock.on("close",function(){console.log("close"),appcore.connected=!1,-1==appcore.reconnect&&(appcore.reconnect=setInterval(function(){api.emit("connect")},1500)),closeEvents(),api.emit("connectionState",{state:"disconnected"})})}}),api.emit("connect",{}),api.on("userExists",function(data){data.username&&appcore.sockemit("userExists",{username:data.username})}),appcore.sockon("log",function(data){console.log("log event: "+data.msg)}),appcore.sockon("*",function(){api.emit("sendRawComm","*")}),appcore.sockon("userExists",function(data){api.emit("userExistsResult",data)}),appcore.sockon("captcha",function(data){api.emit("gotCaptcha",data)}),api.on("getCaptcha",function(data){appcore.sockemit("getCaptcha",{purpose:data.purpose})}),api.on("genKey",function(data){var rsa=forge.pki.rsa,state=rsa.createKeyPairGenerationState(2048,415031),step=function(){rsa.stepKeyPairGenerationState(state,100)?(appcore.generatedRSAKey=state.keys,data.generated()):(data.generating(),setTimeout(step,1))};setTimeout(step)}),api.on("register",function(data){var profileBlob={};profileBlob.privateKey=forge.pki.privateKeyToPem(appcore.generatedRSAKey.privateKey),profileBlob.conversations={};var publicKey=forge.pki.publicKeyToPem(appcore.generatedRSAKey.publicKey),profileBlobJson=JSON.stringify(profileBlob),pbdkf2Salt=forge.random.getBytesSync(32),derivedKey=forge.pbkdf2(data.password,pbdkf2Salt,1e4,32),derivedKeyHash=forge.sha256.create().update(derivedKey).digest().toHex(),iv=forge.random.getBytesSync(16),cipher=forge.cipher.createCipher("AES-CBC",derivedKey);cipher.start({iv:iv}),cipher.update(forge.util.createBuffer(profileBlobJson)),cipher.finish();var cipherOutput=btoa(cipher.output.data),encryptedBlob={iv:iv,pbdkf2Salt:pbdkf2Salt,data:cipherOutput};appcore.sockemit("register",{encryptedBlob:encryptedBlob,publicKey:publicKey,username:data.username,displayname:data.displayname,email:data.email,newsletter:data.newsletter,challenge:data.challenge,captcha:data.captcha,derivedKeyHash:derivedKeyHash})}),appcore.sockon("register",function(data){"OK"==data.status&&(appcore.generatedRSAKey={}),api.emit("registerResult",data)}),api.on("loginMain",function(data){api.emit("connect",{}),appcore.sockemit("loginMain",{step:1,username:data.username}),appcore.username=data.username,appcore.passwordTempHolder=data.password}),appcore.sockon("loginMain",function(data){if(1==data.step)if(data.salt){var password=appcore.passwordTempHolder;appcore.passwordTempHolder="";var derivedKey=forge.pbkdf2(password,data.salt,1e4,32),derivedKeyHash=forge.sha256.create().update(derivedKey).digest().toHex();appcore.derivedKeySalt=data.salt,appcore.derivedKey=derivedKey,appcore.derivedKeyHash=derivedKeyHash,appcore.sockemit("loginMain",{step:2,username:appcore.username,hash:derivedKeyHash})}else api.emit("loginMainResult",data);else if(2==data.step)if(data.iv){var encryptedBlob=atob(data.userBlob),cipher=forge.cipher.createDecipher("AES-CBC",appcore.derivedKey);cipher.start({iv:data.iv}),cipher.update(forge.util.createBuffer(encryptedBlob)),cipher.finish();var profileBlob,cipherOutput=cipher.output.data;try{profileBlob=JSON.parse(cipherOutput)}catch(exception){api.emit("loginMainResult",{status:"FAIL",message:"Decryption has failed - the encrypted data became corrupt."})}if(profileBlob){appcore.profileBlob=profileBlob;var privateKey=forge.pki.privateKeyFromPem(appcore.profileBlob.privateKey),publicKey=forge.pki.setRsaPublicKey(privateKey.n,privateKey.e);appcore.pubKey=forge.pki.publicKeyToPem(publicKey),appcore.username=data.username,appcore.displayname=data.displayname,appcore.status=data.status,appcore.avatar=data.avatar,appcore.uid=data.uid,appcore.bgColor=data.bgColor,api.emit("loginMainResult",{status:"OK"}),updateBlob(),api.emit("getHome")}}else api.emit("loginMainResult",data)}),appcore.sockon("news",function(data){api.emit("homeData",{news:data.news})}),api.on("getHome",function(){appcore.sockemit("news",{})}),appcore.sockon("getLists",function(data){appcore.list=data.list;for(var i in appcore.list)appcore.listHash[appcore.list[i].id]=i,appcore.list[i].active&&20==appcore.list[i].id.length&&api.emit("callUpdate",{state:"CALLING",oldState:"",target:appcore.list[i].id,callType:appcore.list[i].active.type}),appcore.profileBlob.conversations[appcore.list[i].id]||api.emit("generateKeyExchange",{id:appcore.list[i].id});api.emit("getListsResult",{})}),appcore.sockon("newList",function(data){if(data.autojoin&&37==data.object.id.length){var uids=data.object.id.substr(4).split("-");if(getProp(uids[0]+"-blocked")||getProp(uids[1]+"-blocked"))return appcore.sockemit("removeList",{removeID:data.object.id})}if(data.object.waitingForBundle=!0,appcore.list.push(data.object),data.object.active&&20==data.object.id.length&&api.emit("callUpdate",{state:"CALLING",oldState:"",target:data.object.id,callType:data.object.type}),appcore.listHash[data.object.id]=appcore.list.length-1,appcore.noListBuffer[data.object.id]){for(var i in appcore.noListBuffer[data.object.id])commHandler(appcore.noListBuffer[data.object.id][i]);delete appcore.noListBuffer[data.object.id]}appcore.profileBlob.conversations[data.object.id]||api.emit("generateKeyExchange",{id:data.object.id}),api.emit("getListsResult",{})}),api.on("addList",function(data){data.id&&appcore.sockemit("addList",{addID:data.id})}),api.on("removeList",function(data){if(data.id){data.onlySync||appcore.sockemit("removeList",{removeID:data.id}),appcore.list.splice(appcore.listHash[data.id],1);var minusOneAfter=appcore.listHash[data.id];delete appcore.listHash[data.id],delete convBodyHolders[data.id];for(var i in appcore.listHash)appcore.listHash[i]>minusOneAfter&&appcore.listHash[i]--}}),appcore.sockon("kicked",function(data){var roomName=appcore.list[appcore.listHash[data.target]].name;api.emit("removeList",{id:data.target,onlySync:!0}),api.emit("notify",{type:"kicked",kickerUID:data.kickerUID,kickerUsername:data.kickerUsername,target:data.target,roomName:roomName})}),appcore.sockon("noInvite",function(){api.emit("notify",{type:"noInvite"})}),api.on("changeStatus",function(data){appcore.status=data.status,appcore.sockemit("changeStatus",{status:parseInt(data.status)})}),api.on("changeProfile",function(data){if(data.displayname&&data.displayname!=appcore.displayname&&(appcore.displayname=data.displayname.substr(0,30)),data.oldpass&&data.newpass){var derivedKey=forge.pbkdf2(data.oldpass,appcore.derivedKeySalt,1e4,32),derivedKeyHash=forge.sha256.create().update(derivedKey).digest().toHex();if(derivedKeyHash!=appcore.derivedKeyHash)return void api.emit("notify",{type:"changePassOldWrong"});data.oldDerivedKeyHash=appcore.derivedKeyHash,appcore.derivedKeySalt=forge.random.getBytesSync(32),appcore.derivedKey=forge.pbkdf2(data.newpass,appcore.derivedKeySalt,1e4,32),appcore.derivedKeyHash=forge.sha256.create().update(appcore.derivedKey).digest().toHex(),updateBlob(!0,"changeProfile"),data.oldpass="",data.newpass="",data.derivedKeyHash=appcore.derivedKeyHash,data.derivedKeySalt=appcore.derivedKeySalt}data.bgColor&&(appcore.bgColor=data.bgColor),appcore.sockemit("changeProfile",data)}),api.on("changeGroupInfo",function(data){var listItem=appcore.list[appcore.listHash[data.target]];if(data.name&&listItem.name!=data.name){var oldName=listItem.name;listItem.name=data.name.substr(0,20),api.emit("notify",{type:"displaynameChanged",id:data.target,newName:data.name.substr(0,20),oldName:oldName})}appcore.sockemit("changeGroupInfo",data)}),api.on("addContact",function(data){if(data.id){var listItem=appcore.list[appcore.listHash[data.id]];api.emit("sendComm",{type:5,target:data.id,message:{msg:data.message}}),commHandler({type:5,sender:appcore.uid,decrypted:{msg:data.message},target:data.id}),listItem.contact=1,listItem.myRequest=!0}}),api.on("removeContact",function(data){data.id&&(appcore.sockemit("removeContact",{removeID:data.id}),api.emit("notify",{type:"contactChange",id:data.id,contact:data.contact}),appcore.list[appcore.listHash[data.id]].contact=0,delete appcore.list[appcore.listHash[data.id]].displayname,delete appcore.list[appcore.listHash[data.id]].status)}),api.on("generateKeyExchange",function(data){var listItem=appcore.list[appcore.listHash[data.id]];if(!listItem.keyExchange&&20!=listItem.id.length){if(appcore.profileBlob.conversations[data.id])return void(listItem.keyExchange="existing");listItem.keyExchange="pending",appcore.sockemit("getPubKey",{uid:listItem.uid})}}),api.on("keyExchange",function(data){var listItem=appcore.list[appcore.listHash[data.id]];if(!listItem.keyExchange||!listItem.keyExchange.encrypted)throw new Error("keyExchange called when it is not ready");appcore.profileBlob.conversations[listItem.id]||(appcore.sockemit("comm",{type:1,target:listItem.id,data:listItem.keyExchange.encrypted,auxdata:listItem.keyExchange.signature}),commHandler({type:1,target:listItem.id,data:listItem.keyExchange.encrypted,auxdata:listItem.keyExchange.signature}),appcore.profileBlob.conversations[listItem.id]=listItem.keyExchange.convKey,updateBlob(!0,"keyExchange"))}),api.on("acceptContact",function(data){if(data.id){var listItem=appcore.list[appcore.listHash[data.id]];api.emit("sendComm",{type:5,target:data.id,message:{accepted:!0}}),commHandler({type:5,sender:appcore.uid,decrypted:{accepted:!0},target:data.id}),listItem.contact=2}}),api.on("createRoom",function(data){var inviteToRoom,convKey,roomName;"new"==data.mode?(inviteToRoom="conv"+randomUID(16),convKey=forge.random.getBytesSync(32),roomName=data.name,appcore.profileBlob.conversations[inviteToRoom]=convKey,appcore.sockemit("createRoom",{roomID:inviteToRoom,name:data.name}),updateBlob(!0,"createRoom")):"add"==data.mode&&(inviteToRoom=data.target,convKey=appcore.profileBlob.conversations[inviteToRoom],roomName=appcore.list[appcore.listHash[inviteToRoom]].name);for(var i in data.invite){var theirUsername=appcore.list[appcore.listHash["conv"+sortUID(data.invite[i],appcore.uid)]].username,theMessage={target:inviteToRoom,name:roomName,convKey:convKey};api.emit("sendComm",{type:7,target:"conv"+sortUID(data.invite[i],appcore.uid),message:theMessage,inviteToRoom:inviteToRoom}),commHandler({type:7,target:"conv"+sortUID(data.invite[i],appcore.uid),decrypted:theMessage}),commHandler({type:8,target:inviteToRoom,decrypted:{username:theirUsername,uid:data.invite[i]}})}}),api.on("joinRoom",function(data){appcore.profileBlob.conversations[data.target]||(appcore.profileBlob.conversations[data.target]=data.convKey,updateBlob(!0,"joinRoom")),appcore.sockemit("addList",{addID:data.target})}),api.on("kickUser",function(data){var listItem=appcore.list[appcore.listHash[data.target]];listItem.users.indexOf(data.kicking)&&listItem.users.splice(listItem.users.indexOf(data.kicking),1),appcore.sockemit("kickUser",data)}),appcore.sockon("comm",function(d){commHandler(d)});var callTimeout;api.on("getUsers",function(data){appcore.sockemit("getUsers",{target:data.target})}),appcore.sockon("userList",function(data){var listItem=appcore.list[appcore.listHash[data.target]];for(var i in data.users)-1==listItem.users.indexOf(data.users[i][1])&&listItem.users.push(data.users[i][1]),appcore.userList[data.users[i][1]]={username:data.users[i][0]};
listItem.pendingInvites=data.invites||[],listItem.ranks=data.ranks,api.emit("userList",data)}),api.on("setUserRank",function(data){var listItem=appcore.list[appcore.listHash[data.target]],myRank=listItem.myRank,theirRank=0;return listItem.ranks&&listItem.ranks[data.user]&&(theirRank=listItem.ranks[data.user]),4>myRank?api.emit("notify",{type:"noPermission",action:"setUserRank"}):theirRank>=myRank&&9!=myRank?api.emit("notify",{type:"noPermission",action:"setUserRank"}):data.newRank>=myRank&&9!=myRank?api.emit("notify",{type:"noPermission",action:"setUserRank"}):(appcore.sockemit("setUserRank",data),void commHandler({type:11,target:data.target,decrypted:{targetUserUID:data.user,targetUserUsername:getNameFromUID(data.user),newRank:data.newRank}}))}),appcore.sockon("1",function(){appcore.activeCall}),appcore.sockon("2",function(){appcore.activeCall}),appcore.sockon("statusUpdate",function(data){var relevantList=appcore.list[appcore.listHash["conv"+sortUID(appcore.uid,data.target)]];if(relevantList){if(data.displayname&&(relevantList.displayname=data.displayname),"undefined"!=typeof data.status&&(null==data.status&&(data.status=void 0),api.emit("notify",{type:"statusChanged",uid:data.target,displayname:relevantList.displayname||relevantList.username,newStatus:data.status,oldStatus:relevantList.status}),relevantList.status=data.status,0===data.status))if(relevantList.active)api.emit("dropCall",{target:relevantList.id});else for(var i in appcore.list)if(appcore.list[i].active&&appcore.list[i].active.callUsers&&-1!=appcore.list[i].active.callUsers.indexOf(data.target))return void handleRoomCallQuit(appcore.list[i].id,data.target);if("undefined"!=typeof data.contact&&(relevantList.contact=data.contact,"undefined"!=typeof data.myRequest&&(relevantList.myRequest=data.myRequest),api.emit("notify",{type:"contactChange",uid:data.target,contact:data.contact})),"undefined"!=typeof data.displayname){var oldDisplayname=relevantList.displayname;relevantList.displayname=data.displayname,api.emit("notify",{type:"displaynameChanged",uid:data.target,displayname:data.displayname,oldDisplayname:oldDisplayname})}api.emit("lay",{id:"conv"+sortUID(appcore.uid,data.target)})}}),appcore.sockon("groupUpdate",function(data){var relevantList=appcore.list[appcore.listHash[data.target]];if(relevantList){if("undefined"!=typeof data.name){var oldName=relevantList.name;relevantList.name=data.name,api.emit("notify",{type:"displaynameChanged",id:data.target,name:relevantList.name,oldName:oldName})}api.emit("lay",{id:data.target})}}),appcore.sockon("commBundle",function(data){var listItem=appcore.list[appcore.listHash[data.target]];listItem&&(listItem.hasBundle=data.small?1:2,listItem.waitingForBundle=!1),api.emit("notify",{type:"bundleRecieved",target:data.target,more:data.small});for(var i in data.bundle)commHandler(data.bundle[i],data.target,!0)}),appcore.sockon("typingState",function(data){var listItem=appcore.list[appcore.listHash[data.target]];if(listItem.typings||(listItem.typings=[]),!getProp(data.uid+"-blocked")){var alreadyInTypings=!1;for(var i in listItem.typings)if(listItem.typings[i][0]==data.uid){alreadyInTypings=!0,"empty"!=data.state?(listItem.typings[i][1]=data.state,listItem.typings[i][2]=(new Date).getTime()):listItem.typings.splice(i,1);break}alreadyInTypings||"empty"==data.state||listItem.typings.push([data.uid,data.state,(new Date).getTime()]),api.emit("refreshTypingDisplay",{})}}),setInterval(function(){var curTime=(new Date).getTime()-6e3;for(var i in appcore.list)if(appcore.list[i].typings)for(var j in appcore.list[i].typings)("typed"==appcore.list[i].typings[j][1]&&appcore.list[i].typings[j][2]<curTime||"empty"==appcore.list[i].typings[j][1])&&(appcore.list[i].typings.splice(j,1),api.emit("refreshTypingDisplay",{}))},3500),api.on("blockUser",function(data){var listItem=appcore.list[appcore.listHash[data.target]];data.unblock?api.emit("setProp",{name:listItem.uid+"-blocked",value:null}):(2==listItem.contact&&api.emit("removeContact",{id:currentTab}),listItem.typings.length&&(listItem.typings=[],api.emit("refreshTypingDisplay",{})),api.emit("setProp",{name:listItem.uid+"-blocked",value:!0}),api.emit("removeList",{id:data.target}))}),api.on("updateTypingState",function(data){var listItem=appcore.list[appcore.listHash[data.target]];if("typing"==data.state){if(4==appcore.status)return;listItem.typingState&&"typing"==listItem.typingState?(clearTimeout(listItem.stoppedTypingTimeout),listItem.stoppedTypingTimeout=setTimeout(function(){listItem.typingState="typed",appcore.sockemit("typingState",{target:data.target,state:"typed"})},3e3)):(listItem.typingState="typing",appcore.sockemit("typingState",{target:data.target,state:"typing"}),listItem.stoppedTypingTimeout&&clearTimeout(listItem.stoppedTypingTimeout),"empty"!=data.state&&(listItem.stoppedTypingTimeout=setTimeout(function(){listItem.typingState="typed",appcore.sockemit("typingState",{target:data.target,state:"typed"})},3e3)))}else"empty"==data.state&&(clearTimeout(listItem.stoppedTypingTimeout),listItem.typingState&&"empty"==listItem.typingState||(listItem.typingState="empty",appcore.sockemit("typingState",{target:data.target,state:"empty"})))}),api.on("sendText",function(data){if(0!=data.message.length){data.message=data.message.substr(0,1e3);var listItem=appcore.list[appcore.listHash[data.target]];if(appcore.list[appcore.listHash[data.target]].typingState="",clearTimeout(listItem.stoppedTypingTimeout),listItem.keyExchange&&"pending"!=listItem.keyExchange||appcore.profileBlob.conversations[data.target]){var currentTime=(new Date).getTime();listItem.lastRead=currentTime,api.emit("sendComm",{target:data.target,type:2,message:{msg:data.message},clientTs:currentTime}),commHandler({type:2,sender:appcore.uid,decrypted:{msg:data.message},target:data.target,time:currentTime})}}}),api.on("editText",function(data){0==data.newMessage.length&&(data.newMessage="."),api.emit("sendComm",{target:data.target,type:2,message:{msg:data.newMessage,replaceTimestamp:data.replaceTimestamp}}),commHandler({type:2,sender:appcore.uid,decrypted:{msg:data.newMessage,replaceTimestamp:data.replaceTimestamp},target:data.target})}),api.on("clearHistory",function(data){appcore.sockemit("clearHistory",data)}),api.on("uploadAvatar",function(data){appcore.fileString=data.data,appcore.currentUploadTarget=data.target,appcore.partsTotal=Math.ceil(appcore.fileString.length/10240),uploadPart(!0)}),appcore.sockon("avatarSet",function(data){data.error?api.emit("avatarUploadProgress",{percent:-1,target:data.target}):(api.emit("avatarUploadProgress",{percent:100,target:data.target}),"self"==data.target?(appcore.avatar=data.newAvatar,api.emit("notify",{type:"avatarUpdated",uid:appcore.uid,avatar:data.newAvatar})):(appcore.list[appcore.listHash[data.target]].avatar=data.newAvatar,api.emit("notify",{type:"avatarUpdated",id:data.target,avatar:data.newAvatar})),appcore.currentUploadTarget="")}),appcore.sockon("avatar",function(data){if(data.uid)var listItem=appcore.list[appcore.listHash["conv"+sortUID(appcore.uid,data.uid)]];else if(data.id)var listItem=appcore.list[appcore.listHash[data.id]];listItem.avatar=data.avatar,api.emit("notify",{type:"avatarUpdated",uid:data.uid,id:data.id,avatar:data.avatar})}),appcore.sockon("gotPart",function(){uploadPart(!1)}),api.on("makeCall",function(data){var listItem=appcore.list[appcore.listHash[data.target]];listItem.active&&"INCALL"==listItem.active.state&&api.emit("dropCall",{target:data.target}),listItem.active={type:data.type,state:"CALLING"},api.emit("sendComm",{target:data.target,type:6,message:{type:data.type}}),api.emit("callUpdate",{state:"CALLING",oldState:"",myInitiate:!0,target:listItem.id,callType:data.type}),37==data.target.length?(listItem.active.myInitiate=!0,callTimeout=setTimeout(function(){if("CALLING"==listItem.active.state){var callType=listItem.active.type;listItem.active=-1,api.emit("callUpdate",{state:"",oldState:"CALLING",target:listItem.id,callType:callType})}},3e4)):(listItem.active.myInitiate=!1,listItem.active.callUsers=[appcore.uid],acceptCall(data.target,!1))}),api.on("dropCall",function(data){clearTimeout(callTimeout);var listItem=appcore.list[appcore.listHash[data.target]],oldState=listItem.active&&listItem.active.state||"",oldType=listItem.active&&listItem.active.type;37==data.target.length?listItem.active=!1:(listItem.active.state="CALLING",listItem.active.callUsers.splice(listItem.active.callUsers.indexOf(appcore.uid),1),0==listItem.active.callUsers.length&&(listItem.active=!1)),appcore.activeCall="",api.emit("sendComm",{target:data.target,type:6,message:{type:"dropCall"}}),20==data.target.length&&appcore.sockemit("dropActive",{target:data.target}),api.emit("callUpdate",{state:listItem.active?"CALLING":"",oldState:oldState,target:listItem.id,callType:oldType})}),api.on("acceptCall",function(data){acceptCall(data.target,!0)}),api.on("verifyKey",function(data){var keyCombined,otherPubKey=appcore.list[appcore.listHash[data.target]].pubKey,myPubKey=appcore.pubKey;keyCombined=data.target.substr(4).split("-")[0]==appcore.uid?myPubKey+otherPubKey:otherPubKey+myPubKey;var md=forge.md.sha256.create();md.update(keyCombined),api.emit("notify",{type:"verifyKeyInfo",hash:md.digest().toHex()})});var fingerprintsToVerify=[];api.on("verifyFingerprint",function(data){appcore.sockemit("verifyFingerprint",{uid:data.uid,remoteFingerprint:data.remoteFingerprint,localFingerprint:data.localFingerprint}),fingerprintsToVerify.push(data.uid),setTimeout(function(){-1!=fingerprintsToVerify.indexOf(data.uid)&&appcore.activeCall&&(api.emit("dropCall",{target:appcore.activeCall}),api.emit("verifyFingerprintResult",{result:data.result}))},6e3)}),appcore.sockon("verifyFingerprint",function(data){var otherUID=data.uids[0]==appcore.uid?data.uids[1]:data.uids[0];-1!=fingerprintsToVerify.indexOf(otherUID)&&fingerprintsToVerify.splice(fingerprintsToVerify.indexOf(otherUID),1),"FAIL"==data.result&&appcore.activeCall?api.emit("dropCall",{target:appcore.activeCall}):"SUCCESS"==data.result&&console.log("Fingerprint verified successfully."),api.emit("verifyFingerprintResult",{result:data.result})}),api.on("sendComm",function(data){var listItem=appcore.list[appcore.listHash[data.target]],convKey=appcore.profileBlob.conversations[listItem.id];if(convKey||(api.emit("keyExchange",{id:listItem.id}),convKey=appcore.profileBlob.conversations[listItem.id]),data.message.t)throw new Error("Message already has property 't' reserved for client timestamp",data.message);var shortTimestamp=Math.floor(((new Date).getTime()-14e11)/36e5);data.message.t=shortTimestamp;var iv=forge.random.getBytesSync(16),cipher=forge.cipher.createCipher("AES-GCM",convKey);cipher.start({iv:iv,tagLength:128}),cipher.update(forge.util.createBuffer(JSON.stringify(data.message))),cipher.finish();var encrypted=cipher.output.data,tag=cipher.mode.tag.data,auxdata=iv.toString()+tag.toString(),inviteToRoom=data.inviteToRoom?data.inviteToRoom:void 0,clientTs=data.clientTs?data.clientTs:void 0;appcore.sockemit("comm",{target:data.target,type:data.type,data:encrypted,auxdata:auxdata,inviteToRoom:inviteToRoom,clientTs:clientTs})}),api.on("sendRawComm",function(data){appcore.sockemit("raw",data)}),appcore.sockon("ack",function(data){api.emit("notify",{type:"messageAck",clientTs:data.cTs,serverTs:data.sTs,target:data.target})}),appcore.sockon("getPubKey",function(data){var listItem=appcore.list[appcore.listHash["conv"+sortUID(data.uid,appcore.uid)]];console.log(data.pubKey),listItem.pubKey=data.pubKey;var convKey=forge.random.getBytesSync(32),signedMessage=convKey+"conv"+sortUID(data.uid,appcore.uid),otherPartyPublicKey=forge.pki.publicKeyFromPem(data.pubKey),privateKey=forge.pki.privateKeyFromPem(appcore.profileBlob.privateKey),md=forge.md.sha256.create();md.update(signedMessage,"utf8");var signature=privateKey.sign(md),encrypted=otherPartyPublicKey.encrypt(signedMessage,"RSA-OAEP");listItem.keyExchange={encrypted:encrypted,signature:signature,convKey:convKey}});var commReadBuffer=[],commReadBufferTimeout=-1;api.on("markRead",function(data){appcore.list[appcore.listHash[data.target]].canMarkRead&&(appcore.sockemit("markRead",{target:data.target}),appcore.list[appcore.listHash[data.target]].canMarkRead=!1)}),api.on("getBuffer",function(data){var listItem=appcore.list[appcore.listHash[data.target]];1==data.small?listItem.hasBundle||listItem.waitingForBundle||(appcore.sockemit("getBuffer",{target:data.target,small:!0}),listItem.waitingForBundle=!0):2==listItem.hasBundle||listItem.waitingForBundle||appcore.sockemit("getBuffer",{target:data.target,small:!1})}),api.on("setProp",function(data){null==data.value?delete appcore.profileBlob.props[data.name]:appcore.profileBlob.props[data.name]=data.value,updateBlob(!0,"setProp")}),api.on("logout",function(){appcore.reconnect=0,appcore.sock.close(),appcore.sockbuffer=[],appcore.list=[],appcore.listHash=[],appcore.profileBlob={},appcore.bufferTimestampIgnore=[],appcore.bufferTimestampReplace=[],appcore.userList=[],appcore.noListBuffer=[],appcore.derivedKeyHash="",appcore.derivedKey="",appcore.derivedKeySalt="",appcore.displayname="",appcore.pubKey="",appcore.uid="",appcore.username="",appcore.avatar="",appcore.activeCall=""}),appcore.sockemit("version",{}),appcore.sockon("version",function(data){data.latestVersion?appcore.version<data.mandatory?api.emit("versionCheck",2):appcore.version<data.latestVersion?api.emit("versionCheck",1):api.emit("versionCheck",0):api.emit("versionCheck",-1),Math.abs(data.time-(new Date).getTime())>72e5&&api.emit("systemTimeInaccurate",{})});var updateCheckerInterval=setInterval(function(){appcore.sockemit("version",{})},18e5);window.onerror=function(errorMessage,url,line,column,stackTrace){var environmentDetails=navigator.userAgent;if(stackTrace)var message=stackTrace.message+"\n"+stackTrace.stack+"\n"+environmentDetails;else var message=errorMessage+"\n(Browser does not support stack traces)\n"+environmentDetails;return api.emit("errorReporter",{trace:message}),!1},api.on("sendErrorReport",function(data){appcore.sockemit("errorReport",{trace:data.trace})});var convMessageMetaHidden=!1,sidebarCollapsed=!1,sidebarWidth=255;window.localStorage&&window.localStorage.getItem("sidebarWidth")&&(sidebarWidth=Math.max(window.localStorage.getItem("sidebarWidth"),215)),api.on("lay",function(){layContent(!0,!1)});var lastLayTime=0,layUsersTimeout=0,keepPos,lastTrigger;jQuery.fn.clearable=function(){function tog(v){return v?"addClass":"removeClass"}$(this).addClass("clearable"),$(this).on("input",function(){$(this)[tog(this.value)]("x")}),$(this).mousemove(function(e){$(this).hasClass("x")&&$(this)[tog(this.offsetWidth-18<e.clientX-this.getBoundingClientRect().left)]("onX")}),$(this).click(function(){$(this).hasClass("onX")&&($(this).removeClass("x onX").val(""),$(this).trigger("keyup"))})},jQuery.fn.popover=function(obj){var triggerElement=$(this),popover=obj;$("body").unbind("click.dismissPopover"),keepPos=function(){if(!triggerElement.is(":hidden")){if(popover.hasClass("popoverBottom"))var top=triggerElement.offset().top-triggerElement.outerHeight()-popover.outerHeight()-32;else if(popover.hasClass("popoverRight")||popover.hasClass("popoverLeft"))var top=triggerElement.position().top-popover.outerHeight()/2+triggerElement.outerHeight()/2;else var top=triggerElement.position().top+8+triggerElement.outerHeight();if(popover.hasClass("popoverRight"))var left=triggerElement.offset().left+triggerElement.outerWidth()+8;else var left=triggerElement.offset().left+triggerElement.width()/2-popover.outerWidth()/2;var leftCorrection=0,topCorrection=0;if($(window).width()-left-popover.outerWidth()<20&&(leftCorrection=20-($(window).width()-left-popover.outerWidth())),10>top&&(topCorrection-=-10-top),left-=leftCorrection,top-=topCorrection,popover.css("top",top),popover.css("left",left),popover.hasClass("popoverBottom"));else if(popover.hasClass("popoverRight"))popover.find(".popoverCaret").css("top",popover.outerHeight()/2-8+topCorrection);else{var caretTop=top-16;popover.find(".popoverCaret").css("top",caretTop-top)}if(!popover.hasClass("popoverRight")){var caretLeft=triggerElement.offset().left+triggerElement.width()/2-left;popover.find(".popoverCaret").css("left",caretLeft)}}},$("body").on("mousedown.dismissPopover",function(event){0!=$(event.target).parents(".popover").length||$(event.target).is(triggerElement)||$(triggerElement).children().is(event.target)?keepPos&&keepPos():($("div[data-popover='true']").fadeOut().attr("data-popover",""),lastTrigger&&lastTrigger.removeClass("active"),keepPos=null,$("body").unbind("mousedown.dismissPopover"))}),popover.attr("data-popover")?(popover.fadeOut(),triggerElement.removeClass("active"),popover.attr("data-popover",""),keepPos=null):($("div[data-popover='true']").fadeOut().attr("data-popover",""),lastTrigger&&lastTrigger.removeClass("active"),popover.finish().fadeIn(),keepPos(),triggerElement.addClass("active"),popover.attr("data-popover","true")),lastTrigger=triggerElement};var activeModal;$("#overlay,#modalClose").click(function(){activeModal&&$.modal("","hide")}),jQuery.fn.moveCaretToEnd=function(){var el=$(this)[0];if("number"==typeof el.selectionStart)el.selectionStart=el.selectionEnd=el.value.length;else if("undefined"!=typeof el.createTextRange){el.focus();var range=el.createTextRange();range.collapse(!1),range.select()}},jQuery.fn.draggable=function(){var dragging=!1,lastPos=[0,0];$(this).mousedown(function(event){if("SELECT"!=event.target.tagName&&"P"!=event.target.tagName&&"SPAN"!=event.target.tagName&&"PRE"!=event.target.tagName){1===event.which&&(dragging=!0,lastPos=[event.pageX,event.pageY]);var element=$(this)[0];$("body").on("mousemove.videoPanelDrag",function(event){var diffX=event.pageX-lastPos[0],diffY=event.pageY-lastPos[1],curX=parseInt(element.style.left.split("px")[0]),curY=parseInt(element.style.top.split("px")[0]);element.style.left=curX+diffX+"px",element.style.top=curY+diffY+"px",lastPos=[event.pageX,event.pageY]})}}),$(this).mouseup(function(){dragging=!1,$("body").unbind("mousemove.videoPanelDrag")})},$("#modal").draggable(),jQuery.modal=function(ref,state){var thisModal=$("#modal");$(thisModal).is(":visible")||state&&"show"!=state?!$(thisModal).is(":visible")||state&&"hide"!=state||($(thisModal).fadeOut(425,function(){$("#overlay").css("z-index",-100)}),$("#overlay").css("opacity",0)):(activeModal=$(thisModal),thisModal.find("div[data-ref]").hide(),thisModal.find("div[data-ref='"+ref+"']").show(),$(thisModal).fadeIn(425),$("#overlay").css({opacity:.5,"z-index":1e4}),keepPosModals())},jQuery.fn.shake=function(intShakes,intDistance,intDuration){return intShakes||(intShakes=2),intDistance=10,intDuration=400,this.each(function(){$(this).css("position","relative");for(var x=1;intShakes>=x;x++)$(this).animate({left:-1*intDistance},intDuration/intShakes/4).animate({left:intDistance},intDuration/intShakes/2).animate({left:0},intDuration/intShakes/4)}),this};var baseFaviconImage=new Image;baseFaviconImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB5UlEQVQ4jY2SvWuTURTGf+ckqdUEk1pbKGp50W4W2sYEQQeD4tA6GP+DdKkZBZ0duoqQMRbBzO0SwdEhnRSsSQqKIn68dFEsocSPRmNzr0PyviZpSz3wwP3gOc+5z3OFvprOv7iuSFrA6T634BpssZpNPu4+F28xky9PKSaHkOpv2lOWkkFvVbLxdb/BuQdrUWupirRVr5w8jHM0iBMJYKzlVa3JZqNF6XOz3cPiijD98maiHuz0LYjghEPK3fPHmRwewBjjY/JYCGMMydEm99Z/0BEqADdkZql8Sa0pAdxJjnB1PNxD7sfyhwYrHxsAGNGUijEZgIsnwsyejqKq+0JEuDZ+iJFBbRtoTEYR0gCzZ2IHklWVyECAs0NBL4J0UCAGEB+LoOqH0mu8taiqvx89EvAijHkmEh1sG9VP9JS7S+SfkFqLC/B+6/eeI+8F93vLj1NFqAIsv6n9F3m7BZ++7XQmoapGNOf9qIPIqsrD13W+NlpejDmtLMRX5yaGi7cvnEJEdj3FV96xLD7f5OnGtvf8YmUhvhoEWLzsuBv1X+79Z1+cJ+9qjEVCzE0MYa31sfJ2i59/OiZbSggZb3K/4vm1R9K52K+spVDOJub9FLovy9nEfMvaNFDczaRkRFPdZIC/EibJIIaTP3UAAAAASUVORK5CYII=",setTimeout(function(){setFaviconBadge(0)},1);var titleAlertInterval=-1,originalTitle="";layScreen(),$(document).ready(function(){$(window).resize(layScreen),$(".preloader").hide(),hooks(),startScreen(!1)});var statusText=["Offline","Online","Busy","Away","Invisible"],hasFocus=!0,titleBadgeCount=0,openNotifications=[];$(window).focus(function(){hasFocus=!0;for(var i in openNotifications)openNotifications[i].cancel?openNotifications[i].cancel():openNotifications[i].close();openNotifications=[],titleBadgeCount=0,document.title="Subrosa",setFaviconBadge(0),focusInput()}),$(window).blur(function(){hasFocus=!1});var entropyToCollect=1024;$("body").on("mousemove.entropyCollect",function(e){entropyToCollect--,0==entropyToCollect&&$("body").unbind("mousemove.entropyCollect"),forge.random.collectInt(e.clientX,16),forge.random.collectInt(e.clientY,16)});var dividerDragging="",lastMessageContentWidth=0,checkUsernameTimeout=null,lastCaptchaChallenge=-1,hasNotificationPerm=!1,permissionsContinue,lastTab="",currentTab="",convBodyHolders={},convInputHolders={};api.on("replaceText",function(data){if(data.target==currentTab){var $theMessage=$(".convMessage[data-timestamp='"+data.replaceTimestamp+"'].chatMessage");$theMessage.length&&$theMessage.attr("data-user")==data.user&&($theMessage.find(".convMessageContent").html(data.newMessage),$theMessage.find(".convMessageContent").addClass("edited"))}if(convBodyHolders[data.target]){var replaceHTML=function(htmlString){return $("#htmlToText").html(htmlString),$convMessage=$("#htmlToText").find(".convMessage"),$convMessage.length&&$convMessage.hasClass("chatMessage")&&$convMessage.attr("data-user")==data.user&&$convMessage.attr("data-timestamp")==data.replaceTimestamp?($convMessage.find(".convMessageContent").html(data.newMessage),$convMessage.find(".convMessageContent").addClass("edited"),$("#htmlToText").html()):htmlString};for(var i in convBodyHolders[data.target].buffer)-1!=convBodyHolders[data.target].buffer[i].indexOf(data.replaceTimestamp)&&(convBodyHolders[data.target].buffer[i]=replaceHTML(convBodyHolders[data.target].buffer[i]));for(var i in convBodyHolders[data.target].live)-1!=convBodyHolders[data.target].live[i].indexOf(data.replaceTimestamp)&&(convBodyHolders[data.target].live[i]=replaceHTML(convBodyHolders[data.target].live[i]));$("#htmlToText").html("")}});const shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var searchNameTimeout=-1;api.on("homeData",function(data){var homeNewsHTML="";for(var i in data.news)data.news[i].link&&"http://"!=data.news[i].link.substr(0,7)&&"https://"!=data.news[i].link.substr(0,8)||(homeNewsHTML+='<div class="homeNewsElem">'+(data.news[i].link?'<a href="'+escapeText(data.news[i].link)+'" target="_blank">':"")+'<span class="title">'+escapeText(data.news[i].title)+"</span>"+(data.news[i].link?"</a>":"")+'<span class="time">'+(data.news[i].time?friendlyTime(data.news[i].time):"")+'</span><span class="content">'+escapeText(data.news[i].content)+"</span></div>");homeNewsHTML+="</div>",$("#homeNews").append(homeNewsHTML)}),api.on("versionCheck",function(status){0==status?$("#versionInfo").text("up to date"):($("#versionInfo").addClass("errorMessage"),1==status?($("#versionInfo").text("New version available"),$("#outdatedVersionMandatory").hide(),$.modal("outdatedVersion")):2==status?($("#versionInfo").text("Critical security update required. You must update."),$("#outdatedVersionOptional").hide(),$("#loginButton,#createAccountBtn").addClass("disabled"),$.modal("outdatedVersion")):$("#versionInfo").text("Failed to check."))}),api.on("systemTimeInaccurate",function(){$.modal("systemTimeInaccurate")}),api.on("avatarUploadProgress",function(data){100==data.percent?($(".uploadAvatarProgress[data-target='"+data.target+"']").html("<br />Uploaded avatar."),$(".avatarFile[data-target='"+data.target+"']").show()):-1==data.percent?($(".uploadAvatarProgress[data-target='"+data.target+"']").hide(),$(".avatarFile[data-target='"+data.target+"']").show(),$.modal("avatarUploadFailed")):$(".uploadAvatarProgress[data-target='"+data.target+"']").text("Uploading ("+data.percent+"%)")}),api.on("callUpdate",function(data){if("CALLING"==data.state)if(37==data.target.length){if(!data.myInitiate){startRinging();var icon=appcore.list[appcore.listHash[data.target]].avatar||"img/noavatar.png",name=appcore.list[appcore.listHash[data.target]].name||appcore.list[appcore.listHash[data.target]].displayname;newNotification(icon,"Call from "+escapeText(name),escapeText(name)+" is ringing you..",0,!1),startTitleAlert("CALL | Subrosa")}data.target!=currentTab&&changeTabTo(data.target)}else setListItem(data.target);else"INCALL"==data.state&&(startCallInput(20==appcore.activeCall.length,data.callType),setListItem(data.target));"INCALL"==data.oldState&&stopCallInput(data.callType),"CALLING"==data.oldState&&(stopRinging(),stopTitleAlert(),document.title="Subrosa"),""==data.state&&setListItem(data.target),data.target==currentTab&&layContent(!0,!1)}),api.on("gotCaptcha",function(data){"createAccount"==data.purpose?($("#createAccountStep4CaptchaImg").html("<img id='createAccountCaptchaImg' />"),$("#createAccountCaptchaImg").attr("src",data.captcha),lastCaptchaChallenge=data.challenge):console.log(data)}),api.on("connectionState",function(data){"connected"==data.state?$("#disconnectedOverlay").hide():$("#disconnectedOverlay").show()}),api.on("errorReporter",function(data){$("#errorReportTrace").text(data.trace),$("#errorReporterAsk").show(),$("#errorReporterThanks").hide(),$.modal("errorReporter","show")}),api.on("notify",function(data){if("statusChanged"==data.type){if(0!=data.newStatus&&!data.oldStatus){if(-1!=currentTab.indexOf("-")&&(currentTab.split("-")[0]==data.uid||currentTab.split("-")[1]==data.uid))return;var icon=appcore.list[appcore.listHash["conv"+sortUID(data.uid,appcore.uid)]].avatar||"img/noavatar.png";newNotification(icon,escapeText(data.displayname)+" is online",statusText[data.newStatus],5e3,!0)}$(".sidebarListItem[data-item='conv"+sortUID(data.uid,appcore.uid)+"'] .listItemIcon").attr("data-status",void 0==data.newStatus?"":data.newStatus)}else if("displaynameChanged"==data.type)setListItem(data.uid?"conv"+sortUID(data.uid,appcore.uid):data.id);else if("newMessage"==data.type){if(-1!=data.target.indexOf("-")||data.target==currentTab){var icon=getUserItem(data.uid).avatar||"img/noavatar.png";hasFocus?data.target!=currentTab&&(appcore.list[appcore.listHash[data.target]].relatedNotifications||(appcore.list[appcore.listHash[data.target]].relatedNotifications=[]),appcore.list[appcore.listHash[data.target]].relatedNotifications.push(newNotification(icon,escapeText(data.displayname),data.message,0,!0))):($("#soundNewMessage")[0].volume=getProp("generalVolume")!==!1?getProp("generalVolume"):.7,$("#soundNewMessage")[0].play(),newNotification(icon,escapeText(data.displayname),data.message,0,!1))}}else if("messageAck"==data.type){if(data.target==currentTab&&$(".convMessage[data-timestamp='"+data.clientTs+"']").attr("data-timestamp",data.serverTs),convBodyHolders[data.target])for(var i in convBodyHolders[data.target].live){var messageHTML=convBodyHolders[data.target].live[i];if(-1!=messageHTML.indexOf("data-timestamp='"+data.clientTs+"'"))return void(convBodyHolders[data.target].live[i]=messageHTML.replace("data-timestamp='"+data.clientTs+"'","data-timestamp='"+data.serverTs+"'"))}}else if("changePassOldWrong"==data.type)$("#editProfilePassOldFail").show().shake();else if("bundleRecieved"==data.type){var lastScrollPos;if(data.target==currentTab)if($("#convText").find("#bufferLoading").remove(),data.more)$("#convText").prepend("<a id='bufferMore' href='javascript:;'><span class='fa fa-clock-o'></span>Decrypt earlier history</a>");else{var bufferMore=$("#convText").find("#bufferMore");lastScrollPos=bufferMore.attr("data-scrollPos")}!data.more&&convBodyHolders[data.target]&&convBodyHolders[data.target].buffer.length&&(convBodyHolders[data.target].buffer=[],layContent(!1,!0),lastScrollPos&&setTimeout(function(){$("#convText")[0].scrollTop=$("#convText")[0].scrollHeight-lastScrollPos},10))}else"userIdentified"==data.type?data.target==currentTab&&layUsers():"kicked"==data.type?(removeList(data.target),$("#kickerUsername").text(data.kickerUsername),$("#kickerUsername").attr("data-uid",data.kickerUID),$("#kickedFromName").text(data.roomName),$.modal("kicked","show")):"noInvite"==data.type?$.modal("noInvite","show"):"callUserUpdate"==data.type?(data.target==currentTab&&(layContent(!0,!1),layUsersMore(!0)),callUserUpdate(data.event,data.uid,data.callType)):"avatarUpdated"==data.type?data.uid==appcore.uid?$(".sidebarListItem[data-item=me]").find(".listItemIcon")[0].src=data.avatar:data.uid?($(".sidebarListItem[data-item='conv"+sortUID(appcore.uid,data.uid)+"']").find(".listItemIcon")[0].src=data.avatar,-1!=currentTab.indexOf(data.uid)&&layContent(!0,!1)):$(".sidebarListItem[data-item='"+data.id+"']").find(".listItemIcon")[0].src=data.avatar:"verifyKeyInfo"==data.type?($("#verifyKeyHash #main").text(data.hash.substr(0,8)),$("#verifyKeyHash #tiny").text(data.hash.substr(8)),$.modal("verifyKey")):"contactChange"==data.type?setListItem(data.id?data.id:"conv"+sortUID(appcore.uid,data.uid)):"verifyFingerprintResult"==data.type?"SUCCESS"==data.result||$.modal("verifyFingerprintResultFail","show"):"noPermission"==data.type?$.modal("noPermission","show"):"userRankChanged"==data.type&&data.target==currentTab&&$("#usersMorePopover:visible").length&&layUsersMore(!1)});var audioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.operaAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var appcall={};appcall.micMute=!1,appcall.videoMute=!1,appcall.mediaTestAudioContext,appcall.mediaTestAnalyser,appcall.mediaTestMicrophone,appcall.mediaTestNode,appcall.callDuration=0,appcall.callDurationInterval=-1,"undefined"==typeof AudioContext&&"undefined"!=typeof webkitAudioContext&&(AudioContext=webkitAudioContext),appcall.createVideoPanel=function(mediaStream,me,pc,userDisplay){var id="panel"+Math.round(999999999*Math.random());$("body").append("<div id='"+id+"' class='videoPanel'><video></video><div class='videoPanelActions'><div class='videoName'>"+(me?"You":escapeText(userDisplay))+"</div><div class='videoHangup'>End</div></div></div>");var videoPanel=$("#"+id);return videoPanel.draggable(),videoPanel.find(".videoHangup").click(function(){api.emit("dropCall",{target:appcore.activeCall})}),apprtc.playerCount++,me?(videoPanel.addClass("small"),apprtc.group?(videoPanel[0].style.left=window.innerWidth-160-25+"px",videoPanel[0].style.top="315px"):window.innerHeight>=570?(videoPanel[0].style.left=window.innerWidth-160-25+"px",videoPanel[0].style.top="410px"):(videoPanel[0].style.left=window.innerWidth-400-160-15-25+"px",videoPanel[0].style.top="95px")):apprtc.group?(pc.playerID=id,videoPanel.addClass("medium"),videoPanel[0].style.left=window.innerWidth-292*(apprtc.playerCount-1)+"px",videoPanel[0].style.top="95px"):(pc.playerID=id,videoPanel[0].style.left=window.innerWidth-400-25+"px",videoPanel[0].style.top="95px"),attachMediaStream(videoPanel.find("video")[0],mediaStream),videoPanel.find("video")[0].play(),id},appcall.createAudioPlayer=function(mediaStream,me,pc){var id="player"+Math.round(999999999*Math.random());return pc.playerID=id,apprtc.playerCount++,apprtc.audioPlayers[id]=new Audio,attachMediaStream(apprtc.audioPlayers[id],mediaStream),apprtc.audioPlayers[id].play(),id},appcall.removeVideoPanel=function(playerID){playerID&&$("#"+playerID).remove()},appcall.removeAudioPlayer=function(playerID){playerID&&(apprtc.audioPlayers[playerID].pause(),delete apprtc.audioPlayers[playerID])};var apprtc={};apprtc.supported=!0,apprtc.mediaStream,apprtc.playerCount=0,apprtc.localVideoPanel,apprtc.callVideo=null,apprtc.pc=[],apprtc.audioPlayers=[],apprtc.group=null,apprtc.pc_config={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:46.28.205.143:3478",credential:"turnserver",username:"subrosa"}]},apprtc.pc_constraints={optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]},apprtc.sdpVoiceConstraints={mandatory:{OfferToReceiveAudio:!0}},apprtc.sdpVideoConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};var dataChannelsEnabled=!1;
"undefined"!=typeof webkitRTCPeerConnection?RTCPeerConnection=webkitRTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?RTCPeerConnection=mozRTCPeerConnection:apprtc.supported=!1,"undefined"!=typeof mozRTCSessionDescription&&(RTCSessionDescription=mozRTCSessionDescription),"undefined"!=typeof mozRTCIceCandidate&&(RTCIceCandidate=mozRTCIceCandidate),function(){var emoticons=[":)",":-)",":]",":-]",":(",":-(",":[",":-[",":D",":-D",":O",":-O","&gt;_&lt;"];this.markUp=function(src){var which,loc,newLoc,msg="";src=" "+src+" ";const l=emoticons.length;do{which=null,loc=-1;for(var i=0;l>i;i++)newLoc=src.indexOf(" "+emoticons[i]+" "),newLoc>loc&&(which=emoticons[i],loc=newLoc);which&&(msg+=src.substring(0,loc)+' <span class="subrosa-image-emoticon" title="'+which+'"></span> ',src=src.substring(loc+which.length+2))}while(which);return(msg+src).trim()}}.call(window.SubrosaEmoticons={});